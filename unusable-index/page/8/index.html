<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"invincible-nerd.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="For explorer everywhere">
<meta property="og:type" content="website">
<meta property="og:title" content="IVN">
<meta property="og:url" content="http://invincible-nerd.github.io/unusable-index/page/8/index.html">
<meta property="og:site_name" content="IVN">
<meta property="og:description" content="For explorer everywhere">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="invincible-nerd">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://invincible-nerd.github.io/unusable-index/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>IVN</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">IVN</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/28/monotonic_stack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/28/monotonic_stack/" class="post-title-link" itemprop="url">monotonic_stack</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-28 17:09:24" itemprop="dateCreated datePublished" datetime="2022-04-28T17:09:24+08:00">2022-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-07 06:19:36" itemprop="dateModified" datetime="2023-04-07T06:19:36+08:00">2023-04-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Monotonic-Stack选编"><a href="#Monotonic-Stack选编" class="headerlink" title="Monotonic Stack选编"></a>Monotonic Stack选编</h1><p><strong>通常是一维数组，要寻找任一个元素的右边或者左边第一个比自己大或者小的元素的位置，此时就要想到可以用单调栈了</strong>。</p>
<p>时间复杂度为O(n)。</p>
<p>单调栈的本质是空间换时间，因为在遍历的过程中需要用一个栈来记录右边第一个比当前元素大&#x2F;小的元素，优点是只需要遍历一次。</p>
<p>在使用单调栈的时候首先要明确如下几点：</p>
<ol>
<li>单调栈里存放的元素是什么？</li>
</ol>
<p>单调栈里只需要存放元素的下标i就可以了，如果需要使用对应的元素，直接T[i]就可以获取。</p>
<ol>
<li>单调栈里元素是递增呢？ 还是递减呢？</li>
</ol>
<p><strong>注意一下顺序为 从栈顶到栈底的顺序</strong></p>
<p>使用单调栈主要有三个判断条件。</p>
<ul>
<li>当前遍历的元素T[i]小于栈顶元素T[st.top()]的情况</li>
<li>当前遍历的元素T[i]等于栈顶元素T[st.top()]的情况</li>
<li>当前遍历的元素T[i]大于栈顶元素T[st.top()]的情况</li>
</ul>
<p>经典模板：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">nextGreaterElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">res</span><span class="params">(nums.size())</span></span>; <span class="comment">// 存放答案的数组</span></span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    <span class="comment">// 倒着往栈里放</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = nums.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// 判定个子高矮</span></span><br><span class="line">        <span class="keyword">while</span> (!s.<span class="built_in">empty</span>() &amp;&amp; s.<span class="built_in">top</span>() &lt;= nums[i]) &#123;</span><br><span class="line">            <span class="comment">// 矮个起开，反正也被挡着了。。。can never be the &quot;next great number&quot;!</span></span><br><span class="line">            s.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nums[i] 身后的 next great number</span></span><br><span class="line">        res[i] = s.<span class="built_in">empty</span>() ? <span class="number">-1</span> : s.<span class="built_in">top</span>();</span><br><span class="line">        s.<span class="built_in">push</span>(nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>for 循环要从后往前扫描元素，因为我们借助的是栈的结构，倒着入栈，其实是正着出栈。while 循环是把两个「个子高」元素之间的元素排除，因为他们的存在没有意义，前面挡着个「更高」的元素，所以他们不可能被作为后续进来的元素的 Next Great Number 了。</li>
<li>分析它的时间复杂度，要从整体来看：总共有 <code>n</code> 个元素，每个元素都被 <code>push</code> 入栈了一次，而最多会被 <code>pop</code> 一次，没有任何冗余操作。所以总的计算规模是和元素规模 <code>n</code> 成正比的，也就是 <code>O(n)</code> 的复杂度。</li>
</ol>
<h2 id="739-Daily-Temperatures"><a href="#739-Daily-Temperatures" class="headerlink" title="739. Daily Temperatures"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/daily-temperatures/">739. Daily Temperatures</a></h2><p>单调栈图解详见：</p>
<p><a target="_blank" rel="noopener" href="https://programmercarl.com/0739.%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6.html#%E6%80%9D%E8%B7%AF">https://programmercarl.com/0739.%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6.html#%E6%80%9D%E8%B7%AF</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] dailyTemperatures(<span class="type">int</span>[] temperatures) &#123;</span><br><span class="line">    <span class="comment">//monotonic stack</span></span><br><span class="line">    <span class="comment">//find the next greater element</span></span><br><span class="line">    <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[temperatures.length];</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> temperatures.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; temperatures[stack.peek()]&lt;=temperatures[i])&#123;</span><br><span class="line">            stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        res[i]=stack.peek()==<span class="literal">null</span> ? <span class="number">0</span> : stack.peek()-i;</span><br><span class="line">        stack.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="496-Next-Greater-Element-I"><a href="#496-Next-Greater-Element-I" class="headerlink" title="496. Next Greater Element I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/next-greater-element-i/">496. Next Greater Element I</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] nextGreaterElement(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">        Map&lt;Integer,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums2.length; i++) &#123;</span><br><span class="line">            map.put(nums2[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] list=<span class="keyword">new</span> <span class="title class_">int</span>[nums2.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums2.length-<span class="number">1</span>; i &gt;=<span class="number">0</span> ; i--) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; nums2[stack.peek()]&lt;=nums2[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            list[i]=stack.isEmpty()? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[nums1.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; res.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> index=map.get(nums1[i]);</span><br><span class="line">            res[i]=list[index]==-<span class="number">1</span> ? -<span class="number">1</span> : nums2[list[index]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="503-Next-Greater-Element-II"><a href="#503-Next-Greater-Element-II" class="headerlink" title="503. Next Greater Element II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/next-greater-element-ii/">503. Next Greater Element II</a></h2><p>circular integer array <code>nums</code></p>
<p>对于循环数组：考虑用mod运算模拟在nums后再加一个nums</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode503</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] nextGreaterElements(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>*(nums.length - <span class="number">1</span>)+<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; stack.peek()&lt;=nums[i%nums.length])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            res[i%nums.length]=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            stack.push(nums[i%nums.length]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="84-Largest-Rectangle-in-Histogram"><a href="#84-Largest-Rectangle-in-Histogram" class="headerlink" title="84. Largest Rectangle in Histogram"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/largest-rectangle-in-histogram/">84. Largest Rectangle in Histogram</a></h2><p>我们归纳一下枚举「高」的方法：</p>
<p>首先我们枚举某一根柱子 i 作为高  <em>h</em>&#x3D;<em>heights</em>[<em>i</em>]；</p>
<p>随后我们需要进行向左右两边扩展，使得扩展到的柱子的高度均不小于 h。换句话说，我们需要找到左右两侧最近的高度小于 h 的柱子，这样这两根柱子之间（不包括其本身）的所有柱子高度均不小于 h，并且就是 i 能够扩展到的最远范围。</p>
<p>笨方法：用两个单调栈</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode84</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">largestRectangleArea</span><span class="params">(<span class="type">int</span>[] heights)</span> &#123;</span><br><span class="line">        Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] right=<span class="keyword">new</span> <span class="title class_">int</span>[heights.length]; <span class="comment">//记录右边第一个比它小的 不存在则存入length</span></span><br><span class="line">        <span class="type">int</span>[] left=<span class="keyword">new</span> <span class="title class_">int</span>[heights.length]; <span class="comment">//记录左边第一个比它小的  不存在则存入-1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> heights.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; heights[stack.peek()]&gt;=heights[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            right[i]=stack.isEmpty() ? heights.length : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; heights.length; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; heights[stack.peek()]&gt;=heights[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            left[i]=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> res=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; heights.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> r=right[i];</span><br><span class="line">            <span class="type">int</span> l=left[i];</span><br><span class="line">            <span class="type">int</span> area=(r-l-<span class="number">1</span>)*heights[i];</span><br><span class="line">            res=Math.max(res,area);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="42-Trapping-Rain-Water"><a href="#42-Trapping-Rain-Water" class="headerlink" title="42. Trapping Rain Water"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/trapping-rain-water/">42. Trapping Rain Water</a></h2><h3 id="法一：单调栈"><a href="#法一：单调栈" class="headerlink" title="法一：单调栈"></a>法一：单调栈</h3><h3 id="法二：双指针-dp优化"><a href="#法二：双指针-dp优化" class="headerlink" title="法二：双指针+dp优化"></a>法二：双指针+dp优化</h3><p>largest rectangle area是要找一根柱子的左右两边的next greater element</p>
<p>trapping rain water是要找一根柱子的左右两边的greastet element，并加以判断：若两边的greatest element都比这根柱子高，则可以在这根柱子上蓄水</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[] maxLeft=<span class="keyword">new</span> <span class="title class_">int</span>[height.length];</span><br><span class="line">    <span class="type">int</span>[] maxRight=<span class="keyword">new</span> <span class="title class_">int</span>[height.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; maxLeft.length-<span class="number">1</span>; i++) &#123;</span><br><span class="line">        maxLeft[i]=Math.max(maxLeft[i-<span class="number">1</span>],height[i-<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> maxRight.length - <span class="number">2</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        maxRight[i]=Math.max(maxRight[i+<span class="number">1</span>],height[i+<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> start=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> end= height.length-<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=start; i&lt;=end; i++)&#123;</span><br><span class="line">        <span class="type">int</span> left=maxLeft[i];</span><br><span class="line">        <span class="type">int</span> right=maxRight[i];</span><br><span class="line">        <span class="keyword">if</span>(left&lt;=height[i] || right&lt;=height[i])&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> h=Math.min(left,right)-height[i];</span><br><span class="line">        res+=h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="85-Maximal-Rectangle"><a href="#85-Maximal-Rectangle" class="headerlink" title="85. Maximal Rectangle"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/maximal-rectangle/">85. Maximal Rectangle</a></h2><p>就是largest rectangle area的应用</p>
<p>把矩阵的每一行看成一个底面，迭代计算每一行的largest recatangle area</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode85</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximalRectangle</span><span class="params">(<span class="type">char</span>[][] matrix)</span> &#123;</span><br><span class="line">        <span class="type">int</span> row=matrix.length;</span><br><span class="line">        <span class="type">int</span> col=matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[col];</span><br><span class="line">        <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">                dp[j]=matrix[i][j]==<span class="string">&#x27;0&#x27;</span> ? <span class="number">0</span> : dp[j]+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            max=Math.max(max,largestArea(dp));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">largestArea</span><span class="params">(<span class="type">int</span>[] dp)</span>&#123;</span><br><span class="line">        <span class="comment">//largest rectangle</span></span><br><span class="line">        <span class="comment">//monotonic stack</span></span><br><span class="line">        <span class="comment">//next &quot;greater&quot; element, in this case, next smaller element</span></span><br><span class="line">        <span class="type">int</span> n=dp.length;</span><br><span class="line">        Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] rightSmall=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; dp[stack.peek()]&gt;=dp[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            rightSmall[i]=stack.isEmpty() ? n : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] leftSmall=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; dp[stack.peek()]&gt;=dp[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            leftSmall[i]=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> height=dp[i];</span><br><span class="line">            <span class="type">int</span> area=height*(rightSmall[i]-leftSmall[i]-<span class="number">1</span>);</span><br><span class="line">            max=Integer.max(max,area);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="456-132-Pattern"><a href="#456-132-Pattern" class="headerlink" title="456. 132 Pattern"></a>456. 132 Pattern</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//9 11 8 9 10 7 9</span></span><br><span class="line"><span class="comment">//   4  12  11  10  2 1</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">find132pattern</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> numLeft=Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i]&lt;numLeft)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; stack.peek()&lt;nums[i])&#123;</span><br><span class="line">            numLeft=stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        stack.push(nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="907-Sum-of-Subarray-Minimums"><a href="#907-Sum-of-Subarray-Minimums" class="headerlink" title="907. Sum of Subarray Minimums"></a>907. Sum of Subarray Minimums</h2><p>注意：</p>
<ul>
<li>需考虑每个元素，因此 right 范围为 [0,n]</li>
<li>每当栈顶元素不能维持处于谷底，则出栈并计算</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumSubarrayMins</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=arr.length;</span><br><span class="line">    <span class="type">int</span> mod=(<span class="type">int</span>)<span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> curVal=i==n ? <span class="number">0</span> : arr[i];</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; arr[stack.peek()]&gt;curVal)&#123;</span><br><span class="line">            <span class="type">int</span> mid=stack.pop();</span><br><span class="line">            <span class="type">int</span> l=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            <span class="type">long</span> count=(mid-l)*(i-mid)%mod;</span><br><span class="line">            <span class="type">long</span> p=arr[mid]*count%mod;</span><br><span class="line">            res+=p;</span><br><span class="line">            res%=mod;</span><br><span class="line">        &#125;</span><br><span class="line">        stack.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2104-Sum-of-Subarray-Ranges"><a href="#2104-Sum-of-Subarray-Ranges" class="headerlink" title="2104. Sum of Subarray Ranges"></a>2104. Sum of Subarray Ranges</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">subArrayRanges</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">long</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> curVal= i==n ? Integer.MIN_VALUE : nums[i];</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; nums[stack.peek()]&gt;curVal)&#123;</span><br><span class="line">            <span class="type">int</span> mid=stack.pop();</span><br><span class="line">            <span class="type">int</span> l=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            res-=(<span class="type">long</span>)(mid-l)*(i-mid)*nums[mid];</span><br><span class="line">        &#125;</span><br><span class="line">        stack.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    stack.clear();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> curVal= i==n ? Integer.MAX_VALUE : nums[i];</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; nums[stack.peek()]&lt;curVal)&#123;</span><br><span class="line">            <span class="type">int</span> mid=stack.pop();</span><br><span class="line">            <span class="type">int</span> l=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            res+=(<span class="type">long</span>)(mid-l)*(i-mid)*nums[mid];</span><br><span class="line">        &#125;</span><br><span class="line">        stack.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1130-Minimum-Cost-Tree-From-Leaf-Values"><a href="#1130-Minimum-Cost-Tree-From-Leaf-Values" class="headerlink" title="1130. Minimum Cost Tree From Leaf Values"></a>1130. Minimum Cost Tree From Leaf Values</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mctFromLeafValues</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    stack.push(Integer.MAX_VALUE);</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : arr) &#123;</span><br><span class="line">        <span class="keyword">while</span>(stack.peek()&lt;=num)&#123;</span><br><span class="line">            <span class="comment">//left          mid        right</span></span><br><span class="line">            <span class="comment">//stack.peek() stack.pop() num</span></span><br><span class="line">            <span class="type">int</span> mid=stack.pop();</span><br><span class="line">            res+=mid*Math.min(stack.peek(),num);</span><br><span class="line">        &#125;</span><br><span class="line">        stack.push(num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(stack.size()&gt;<span class="number">2</span>)&#123;</span><br><span class="line">        res+=stack.pop()*stack.peek();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1475-Final-Prices-With-a-Special-Discount-in-a-Shop"><a href="#1475-Final-Prices-With-a-Special-Discount-in-a-Shop" class="headerlink" title="1475. Final Prices With a Special Discount in a Shop"></a>1475. Final Prices With a Special Discount in a Shop</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] finalPrices(<span class="type">int</span>[] prices) &#123;</span><br><span class="line">    <span class="comment">//next smaller or equal element</span></span><br><span class="line">    <span class="type">int</span> n=prices.length;</span><br><span class="line">    <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">int</span> cur=prices[i];</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; stack.peek()&gt;cur)&#123;</span><br><span class="line">            stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> dis=stack.isEmpty() ? <span class="number">0</span> : stack.peek();</span><br><span class="line">        res[i]=cur-dis;</span><br><span class="line">        stack.push(cur);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1673-Find-the-Most-Competitive-Subsequence"><a href="#1673-Find-the-Most-Competitive-Subsequence" class="headerlink" title="1673. Find the Most Competitive Subsequence"></a>1673. Find the Most Competitive Subsequence</h2><p>If the element is greater than the dequeue’s kth element, we don’t need to store it. This also slightly improves performance while removing from the dequeue, as we didn’t add unnecessary elements.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] mostCompetitive(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="comment">//make sure after deleting, there is &gt;= k elements</span></span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp;stack.size()+n-i&gt;k &amp;&amp; stack.peek()&gt;nums[i])&#123;</span><br><span class="line">            stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(stack.size()&lt;k)&#123;</span><br><span class="line">            stack.push(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> idx=k-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(idx&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        res[idx--]=stack.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1776-Car-Fleet-II"><a href="#1776-Car-Fleet-II" class="headerlink" title="1776. Car Fleet II"></a>1776. Car Fleet II</h2><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/car-fleet-ii/discuss/1105620/Java-oror-clean-O(n)-Monotonic-Stack-Solution-oror-Detailed-Explanations">https://leetcode.com/problems/car-fleet-ii/discuss/1105620/Java-oror-clean-O(n)-Monotonic-Stack-Solution-oror-Detailed-Explanations</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span>[] getCollisionTimes(<span class="type">int</span>[][] cars) &#123;</span><br><span class="line">    <span class="type">int</span> n=cars.length;</span><br><span class="line">    <span class="type">double</span>[] res=<span class="keyword">new</span> <span class="title class_">double</span>[n];</span><br><span class="line">    Arrays.fill(res,-<span class="number">1.0</span>);</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">int</span>[] car=cars[i];</span><br><span class="line">        <span class="type">int</span> pos=car[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> speed=car[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> j=stack.peek();</span><br><span class="line">            <span class="type">int</span>[] car2=cars[j];</span><br><span class="line">            <span class="type">int</span> pos2=car2[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> speed2=car2[<span class="number">1</span>];</span><br><span class="line">            <span class="type">double</span> time=(<span class="type">double</span>)(pos2-pos)/(speed-speed2);</span><br><span class="line">            <span class="keyword">if</span>(speed&gt;speed2 &amp;&amp; (time&lt;res[j]</span><br><span class="line">                    || res[j]&lt;<span class="number">0</span>))&#123;</span><br><span class="line">                <span class="comment">//1.faster</span></span><br><span class="line">                <span class="comment">//2.collide before car 2 vanishes, or never vanishes</span></span><br><span class="line">                res[i]=time;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//car2 would never be collided by [0,car1]</span></span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        stack.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2355-Maximum-Number-of-Books-You-Can-Take"><a href="#2355-Maximum-Number-of-Books-You-Can-Take" class="headerlink" title="2355. Maximum Number of Books You Can Take"></a>2355. Maximum Number of Books You Can Take</h2><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/maximum-number-of-books-you-can-take/discuss/2508360/Java-O(n)-DP-%2B-Monotonic-Stack-oror-Beats-73-time-and-space-oror-Explanation-with-comments">https://leetcode.com/problems/maximum-number-of-books-you-can-take/discuss/2508360/Java-O(n)-DP-%2B-Monotonic-Stack-oror-Beats-73-time-and-space-oror-Explanation-with-comments</a></p>
<p>Basically for any index <em>i</em>, <em>j</em> is the first index to the left of <em>i</em> where books[j] &lt; books[i] - i + j. This index <em>j</em> is obtained using a <strong>monotonic stack</strong>.</p>
<p><strong>first smaller element to the left</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">maximumBooks</span><span class="params">(<span class="type">int</span>[] books)</span> &#123;</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> n=books.length;</span><br><span class="line">    <span class="type">long</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span>[] dp=<span class="keyword">new</span> <span class="title class_">long</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="comment">//books[i], books[i]-1, books[i]-i+j</span></span><br><span class="line">        <span class="comment">//i,        i-1,       j</span></span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp;</span><br><span class="line">                books[i]-i+stack.peek()&lt;=books[stack.peek()])&#123;</span><br><span class="line">            <span class="comment">//once valid, will be valid for all following elements</span></span><br><span class="line">            stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//books[i]-i+j+1,..books[i]</span></span><br><span class="line">        dp[i]=(stack.isEmpty() ? <span class="number">0</span> : dp[stack.peek()]) +</span><br><span class="line">                sum(books[i]) -</span><br><span class="line">                sum(books[i]-i+(stack.isEmpty() ? -<span class="number">1</span> : stack.peek()));</span><br><span class="line">        res=Math.max(res,dp[i]);</span><br><span class="line">        stack.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">long</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//0,1,2,...,n</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="type">long</span>)n*(<span class="type">long</span>)(n+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/28/%E5%9B%9E%E6%BA%AF%E6%B3%95(2)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/28/%E5%9B%9E%E6%BA%AF%E6%B3%95(2)/" class="post-title-link" itemprop="url">回溯法(2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-28 17:08:02" itemprop="dateCreated datePublished" datetime="2022-04-28T17:08:02+08:00">2022-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-01-06 14:54:45" itemprop="dateModified" datetime="2023-01-06T14:54:45+08:00">2023-01-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="backtracking经典题选编-2"><a href="#backtracking经典题选编-2" class="headerlink" title="backtracking经典题选编(2)"></a>backtracking经典题选编(2)</h1><h2 id="51-N-Queens"><a href="#51-N-Queens" class="headerlink" title="51. N-Queens"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/n-queens/">51. N-Queens</a></h2><p>思路：</p>
<ol>
<li>从上往下，一行一行填</li>
<li>某一行元素逐个判断，valid则填入并继续探索下一行（，否则跳过，直接探索该行下一个元素）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode51</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; res;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">solveNQueens</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">char</span>[][] board=<span class="keyword">new</span> <span class="title class_">char</span>[n][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                board[i][j]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        backtracking(board,n,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; <span class="title function_">toList</span><span class="params">(<span class="type">char</span>[][] board)</span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                sb.append(board[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(sb.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">char</span>[][] board,<span class="type">int</span> n, <span class="type">int</span> row)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(row==n)&#123;</span><br><span class="line">            List&lt;String&gt; list=toList(board);</span><br><span class="line">            <span class="built_in">this</span>.res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(valid(board,n,row,i))&#123;</span><br><span class="line">                board[row][i]=<span class="string">&#x27;Q&#x27;</span>;</span><br><span class="line">                backtracking(board,n,row+<span class="number">1</span>);</span><br><span class="line">                board[row][i]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">valid</span><span class="params">(<span class="type">char</span>[][] board,<span class="type">int</span> n,<span class="type">int</span> row,<span class="type">int</span> col)</span>&#123;</span><br><span class="line">        <span class="comment">//从上往下填的，只需考察上方元素，下方都是空</span></span><br><span class="line">        <span class="comment">//正上方不能有Q</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(board[i][col]==<span class="string">&#x27;Q&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//左上不能有Q</span></span><br><span class="line">        <span class="type">int</span> r=row-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> c=col-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(r&gt;=<span class="number">0</span> &amp;&amp; c&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(board[r][c]==<span class="string">&#x27;Q&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            r--;</span><br><span class="line">            c--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右上不能有Q</span></span><br><span class="line">        r=row-<span class="number">1</span>;</span><br><span class="line">        c=col+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(r&gt;=<span class="number">0</span> &amp;&amp; c&lt;n)&#123;</span><br><span class="line">            <span class="keyword">if</span>(board[r][c]==<span class="string">&#x27;Q&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            r--;</span><br><span class="line">            c++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="131-Palindrome-Partitioning"><a href="#131-Palindrome-Partitioning" class="headerlink" title="131. Palindrome Partitioning"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/palindrome-partitioning/">131. Palindrome Partitioning</a></h2><p>本题难点：</p>
<ul>
<li>切割问题可以抽象为组合问题</li>
<li>如何模拟那些切割线</li>
<li>切割问题中递归如何终止</li>
<li>在递归循环中如何截取子串</li>
<li>如何判断回文</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;String&gt;&gt; res;</span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">partition</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),s,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(String s, <span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(start&lt;end)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.charAt(start)!=s.charAt(end))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        start++;</span><br><span class="line">        end--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;String&gt; list,String s,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start&gt;=s.length())&#123;</span><br><span class="line">        <span class="built_in">this</span>.res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPalindrome(s,start,i))&#123;</span><br><span class="line">            list.add(s.substring(start,i+<span class="number">1</span>)); <span class="comment">//s[start,i]加进去了</span></span><br><span class="line">            backtracking(list,s,i+<span class="number">1</span>); <span class="comment">//继续探索s[i+1,length-1]</span></span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="93-Restore-IP-Addresses"><a href="#93-Restore-IP-Addresses" class="headerlink" title="93. Restore IP Addresses"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/restore-ip-addresses/">93. Restore IP Addresses</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode93</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">restoreIpAddresses</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        List&lt;String&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(res,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(),s,<span class="number">3</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s, <span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start&lt;end &amp;&amp; s.charAt(start)==<span class="string">&#x27;0&#x27;</span> || end-start&gt;=<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> digit=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(start&lt;=end)&#123;</span><br><span class="line">            sum+=(s.charAt(end)-<span class="string">&#x27;0&#x27;</span>)*digit;</span><br><span class="line">            digit*=<span class="number">10</span>;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum&lt;=<span class="number">255</span> ? <span class="literal">true</span> : <span class="literal">false</span>; <span class="comment">//注意int溢出 2147483647</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;String&gt; res, LinkedList&lt;String&gt; list, String s, <span class="type">int</span> dot, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start&gt;=s.length())&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(dot==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(isValid(s,start,s.length()-<span class="number">1</span>))&#123;</span><br><span class="line">                StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="keyword">for</span> (String s1 : list) &#123;</span><br><span class="line">                    sb.append(s1);</span><br><span class="line">                &#125;</span><br><span class="line">                sb.append(s.substring(start,s.length()));</span><br><span class="line">                res.add(<span class="keyword">new</span> <span class="title class_">String</span>(sb));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(isValid(s,start,i))&#123;</span><br><span class="line">                list.add(s.substring(start,i+<span class="number">1</span>));</span><br><span class="line">                list.add(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">                backtracking(res,list,s,dot-<span class="number">1</span>,i+<span class="number">1</span>);</span><br><span class="line">                list.removeLast();</span><br><span class="line">                list.removeLast();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="37-Sudoku-Solver"><a href="#37-Sudoku-Solver" class="headerlink" title="37. Sudoku Solver"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sudoku-solver/">37. Sudoku Solver</a></h2><p>思考：为什么这种void写法不行，一定要将helper设为boolean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wrong answer!</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">char</span>[][] board,<span class="type">int</span> row,<span class="type">int</span> col,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(index&gt;=row*col)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> i=index/row;</span><br><span class="line">    <span class="type">int</span> j=index%row;</span><br><span class="line">    <span class="keyword">if</span>(board[i][j]!=<span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">        backtracking(board,row,col,index+<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>; c &lt;= <span class="string">&#x27;9&#x27;</span>; c++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(valid(board,c,i,j))&#123;</span><br><span class="line">                board[i][j]=c;</span><br><span class="line">                backtracking(board,row,col,index+<span class="number">1</span>);</span><br><span class="line">                board[i][j]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">solveSudoku</span><span class="params">(<span class="type">char</span>[][] board)</span> &#123;</span><br><span class="line">        solveSudokuHelper(board);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">solveSudokuHelper</span><span class="params">(<span class="type">char</span>[][] board)</span>&#123;</span><br><span class="line">        <span class="comment">//「一个for循环遍历棋盘的行，一个for循环遍历棋盘的列，</span></span><br><span class="line">        <span class="comment">// 一行一列确定下来之后，递归遍历这个位置放9个数字的可能性！」</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123; <span class="comment">// 遍历行</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">9</span>; j++)&#123; <span class="comment">// 遍历列</span></span><br><span class="line">                <span class="keyword">if</span> (board[i][j] != <span class="string">&#x27;.&#x27;</span>)&#123; <span class="comment">// 跳过原始数字</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">char</span> <span class="variable">k</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>; k &lt;= <span class="string">&#x27;9&#x27;</span>; k++)&#123; <span class="comment">// (i, j) 这个位置放k是否合适</span></span><br><span class="line">                    <span class="keyword">if</span> (isValidSudoku(i, j, k, board))&#123;</span><br><span class="line">                        board[i][j] = k;</span><br><span class="line">                        <span class="keyword">if</span> (solveSudokuHelper(board))&#123; <span class="comment">// 如果找到合适一组立刻返回</span></span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        board[i][j] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 9个数都试完了，都不行，那么就返回false</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// 因为如果一行一列确定下来了，这里尝试了9个数都不行，说明这个棋盘找不到解决数独问题的解！</span></span><br><span class="line">                <span class="comment">// 那么会直接返回， 「这也就是为什么没有终止条件也不会永远填不满棋盘而无限递归下去！」</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 遍历完没有返回false，说明找到了合适棋盘位置了</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断棋盘是否合法有如下三个维度:</span></span><br><span class="line"><span class="comment">     *     同行是否重复</span></span><br><span class="line"><span class="comment">     *     同列是否重复</span></span><br><span class="line"><span class="comment">     *     9宫格里是否重复</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isValidSudoku</span><span class="params">(<span class="type">int</span> row, <span class="type">int</span> col, <span class="type">char</span> val, <span class="type">char</span>[][] board)</span>&#123;</span><br><span class="line">        <span class="comment">// 同行是否重复</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (board[row][i] == val)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 同列是否重复</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">9</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (board[j][col] == val)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 9宫格里是否重复</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">startRow</span> <span class="operator">=</span> (row / <span class="number">3</span>) * <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">startCol</span> <span class="operator">=</span> (col / <span class="number">3</span>) * <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startRow; i &lt; startRow + <span class="number">3</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> startCol; j &lt; startCol + <span class="number">3</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == val)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="491-Increasing-Subsequences"><a href="#491-Increasing-Subsequences" class="headerlink" title="491. Increasing Subsequences"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/increasing-subsequences/">491. Increasing Subsequences</a></h2><p>注意去重逻辑：不能对原数组排序，所以排序+visited数组老方法不行！</p>
<p>不仅是和该元素前一个相比较，而是和该元素之前的全部元素相比较</p>
<p>新去重思路：在每一层开一个map，每一层的相同元素只有第一个元素保留，其余都剪枝</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">findSubsequences</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(res,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(),nums,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, LinkedList&lt;Integer&gt; list, <span class="type">int</span>[] nums,<span class="type">int</span> start )</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start&gt;=nums.length)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;Integer,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!list.isEmpty() &amp;&amp; list.getLast()&gt;nums[i])&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(map.getOrDefault(nums[i],<span class="number">0</span>)&gt;=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(nums[i]);</span><br><span class="line">        map.put(nums[i],map.getOrDefault(nums[i],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(list.size()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(list));</span><br><span class="line">        &#125;</span><br><span class="line">        backtracking(res,list,nums,i+<span class="number">1</span>);</span><br><span class="line">        list.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>优化思路：由于元素范围有限，可用数组代替map</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode491</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res;</span><br><span class="line">    LinkedList&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">findSubsequences</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,  <span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(list));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(start==nums.length)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span>[] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[<span class="number">201</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(visited[nums[i]+<span class="number">100</span>])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(list.size()==<span class="number">0</span> || nums[i]&gt;=list.getLast())&#123;</span><br><span class="line">                list.add(nums[i]);</span><br><span class="line">                visited[nums[i]+<span class="number">100</span>]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">                list.removeLast();</span><br><span class="line">                <span class="comment">//注意，某一个值visited过了，就一直标记，这一层再也不选用</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="332-Reconstruct-Itinerary"><a href="#332-Reconstruct-Itinerary" class="headerlink" title="332. Reconstruct Itinerary"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reconstruct-itinerary/">332. Reconstruct Itinerary</a></h2><p>You must use all the tickets once and only once.</p>
<p>list.get(0)&#x3D;”JFK” 起点给定</p>
<p>回溯终止条件：所有票都used， 即 list.length&#x3D;&#x3D;tickets.length+1</p>
<p>哪些票valid: used&#x3D;&#x3D;false &amp;&amp; 起点.equals(list.getLast())</p>
<p>结果itineray不止一条：取字典序最小的一条</p>
<p>超时的笨方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; res;</span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(list,tickets,<span class="keyword">new</span> <span class="title class_">boolean</span>[tickets.size()]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">( List&lt;String&gt; list, List&lt;List&lt;String&gt;&gt; tickets, <span class="type">boolean</span>[] used)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==tickets.size()+<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(res.size()==<span class="number">0</span> || better(list,res))&#123;</span><br><span class="line">            res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tickets.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(tickets.get(i).get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>))&#123;</span><br><span class="line">                list.add(<span class="string">&quot;JFK&quot;</span>);</span><br><span class="line">                list.add(tickets.get(i).get(<span class="number">1</span>));</span><br><span class="line">                used[i]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(list,tickets,used);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                used[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; used.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(used[i])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String last=list.get(list.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(tickets.get(i).get(<span class="number">0</span>).equals(last))&#123;</span><br><span class="line">                list.add(tickets.get(i).get(<span class="number">1</span>));</span><br><span class="line">                used[i]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(list,tickets,used);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                used[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">better</span><span class="params">(List&lt;String&gt; l1,List&lt;String&gt; l2)</span>&#123;</span><br><span class="line">    StringBuilder sb1=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    StringBuilder sb2=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (String s : l1) &#123;</span><br><span class="line">        sb1.append(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String s : l2) &#123;</span><br><span class="line">        sb2.append(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(sb1.toString().compareTo(sb2.toString())&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>笨方法不行，考虑先排序，再backtracking, 保证“小”票先被used</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; res;</span><br><span class="line"><span class="type">boolean</span> found;</span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">    tickets.sort(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;List&lt;String&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(List&lt;String&gt; o1, List&lt;String&gt; o2)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> !o1.get(<span class="number">0</span>).equals(o2.get(<span class="number">0</span>)) ? o1.get(<span class="number">0</span>).compareTo(o2.get(<span class="number">0</span>)) : o1.get(<span class="number">1</span>).compareTo(o2.get(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(list,tickets,<span class="keyword">new</span> <span class="title class_">boolean</span>[tickets.size()]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">( List&lt;String&gt; list, List&lt;List&lt;String&gt;&gt; tickets, <span class="type">boolean</span>[] used)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==tickets.size()+<span class="number">1</span>)&#123;</span><br><span class="line">        res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list);</span><br><span class="line">        found=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tickets.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(tickets.get(i).get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>))&#123;</span><br><span class="line">                list.add(<span class="string">&quot;JFK&quot;</span>);</span><br><span class="line">                list.add(tickets.get(i).get(<span class="number">1</span>));</span><br><span class="line">                used[i]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(list,tickets,used);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                used[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; used.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(found)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(used[i])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String last=list.get(list.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(tickets.get(i).get(<span class="number">0</span>).equals(last))&#123;</span><br><span class="line">                list.add(tickets.get(i).get(<span class="number">1</span>));</span><br><span class="line">                used[i]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(list,tickets,used);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                used[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="320-Generalized-Abbreviation"><a href="#320-Generalized-Abbreviation" class="headerlink" title="320. Generalized Abbreviation"></a>320. Generalized Abbreviation</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Set&lt;String&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">LinkedList&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">generateAbbreviations</span><span class="params">(String word)</span> &#123;</span><br><span class="line">    backtracking(word,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(String word, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start==word.length())&#123;</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">            sb.append(s);</span><br><span class="line">        &#125;</span><br><span class="line">        String s=sb.toString();</span><br><span class="line">        <span class="keyword">if</span>(!set.contains(s))&#123;</span><br><span class="line">            set.add(s);</span><br><span class="line">            res.add(s);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//word[start,i]</span></span><br><span class="line">    <span class="type">boolean</span> avoid=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(!list.isEmpty())&#123;</span><br><span class="line">        String last=list.getLast();</span><br><span class="line">        <span class="keyword">if</span>(Character.isDigit(last.charAt(<span class="number">0</span>)))&#123;</span><br><span class="line">            avoid=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; word.length(); i++) &#123;</span><br><span class="line">        String sub=word.substring(start,i+<span class="number">1</span>);</span><br><span class="line">        list.add(sub);</span><br><span class="line">        backtracking(word,i+<span class="number">1</span>);</span><br><span class="line">        list.removeLast();</span><br><span class="line">        <span class="keyword">if</span>(!avoid)&#123;</span><br><span class="line">            <span class="type">int</span> len=sub.length();</span><br><span class="line">            list.add(Integer.toString(len));</span><br><span class="line">            backtracking(word,i+<span class="number">1</span>);</span><br><span class="line">            list.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="254-Factor-Combinations"><a href="#254-Factor-Combinations" class="headerlink" title="254. Factor Combinations"></a>254. Factor Combinations</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;Integer&gt;&gt; res;</span><br><span class="line">List&lt;Integer&gt; list;</span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">getFactors</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(n,<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> cur, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(cur==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt;= cur; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(cur%i==<span class="number">0</span>) &#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">            backtracking(cur / i, i);</span><br><span class="line">            list.remove(list.size() - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/28/sliding-window/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/28/sliding-window/" class="post-title-link" itemprop="url">sliding window</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-28 16:10:32" itemprop="dateCreated datePublished" datetime="2022-04-28T16:10:32+08:00">2022-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-07-13 09:01:52" itemprop="dateModified" datetime="2023-07-13T09:01:52+08:00">2023-07-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="sliding-window选编"><a href="#sliding-window选编" class="headerlink" title="sliding window选编"></a>sliding window选编</h1><h2 id="76-Minimum-Window-Substring"><a href="#76-Minimum-Window-Substring" class="headerlink" title="76. Minimum Window Substring"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/minimum-window-substring/">76. Minimum Window Substring</a></h2><p>难点：</p>
<ol>
<li>如何判断window满足要求</li>
<li>window满足要求后，如何优化window (start尽可能右移)</li>
</ol>
<p>目标：</p>
<ol>
<li>找start</li>
<li>找len</li>
</ol>
<p>写法一：用HashMap</p>
<p>PS：理论上你可以设计两端都开或者两端都闭的区间，但设计为左闭右开区间是最方便处理的。因为这样初始化 <code>left = right = 0</code> 时区间 <code>[0, 0)</code> 中没有元素，但只要让 <code>right</code> 向右移动（扩大）一位，区间 <code>[0, 1)</code> 就包含一个元素 <code>0</code> 了。如果你设置为两端都开的区间，那么让 <code>right</code> 向右移动一位后开区间 <code>(0, 1)</code> 仍然没有元素；如果你设置为两端都闭的区间，那么初始区间 <code>[0, 0]</code> 就包含了一个元素。这两种情况都会给边界处理带来不必要的麻烦。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">minWindow</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">    HashMap&lt;Character,Integer&gt; need = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();<span class="comment">//用来存储匹配串的字符以及其频率</span></span><br><span class="line">    HashMap&lt;Character,Integer&gt; window = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();<span class="comment">//目前窗口中的字符和其出现的频率</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">t_length</span> <span class="operator">=</span> t.length();<span class="comment">//匹配串的长度</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 统计 匹配串t的字符 和 其出现的频率</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; t_length; i++) &#123;</span><br><span class="line">        need.put(t.charAt(i),need.getOrDefault(t.charAt(i),<span class="number">0</span>)+<span class="number">1</span>);<span class="comment">//获取指定的key对应的 value 如果找不到key 则返回设置的默认值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span><span class="number">0</span>;<span class="comment">//初始化左指针</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//初始化右指针</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">valid</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//窗口中 满足need条件的字符个数，如果valid和need.size 大小相同 说明 窗口完全满足条件了 可以选择收缩了</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//记录最小覆盖子串的起使索引</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> Integer.MAX_VALUE;<span class="comment">//记录最小覆盖字串的长度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//右指针到达 目标串s的末尾的时候停止</span></span><br><span class="line">    <span class="keyword">while</span>(right &lt; s.length())&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(right);<span class="comment">//获取右指针所在位置的char</span></span><br><span class="line">        right++;<span class="comment">//右指针右移 窗口扩大</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (need.containsKey(c))&#123;<span class="comment">//如果need中包含当前指针所在的字符c</span></span><br><span class="line">            window.put(c,window.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);<span class="comment">//将当前char c 存入对应的window位置</span></span><br><span class="line">            <span class="keyword">if</span> (window.get(c).equals(need.get(c)))&#123;<span class="comment">//如果目标map 中的 相对应的 字符数量符 和 当前window中的 对应的字符数量相同 则 符合的valid++</span></span><br><span class="line">                valid++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (valid == need.size())&#123;<span class="comment">//如果 window中符合need中的char数量则说明确实找到了可行解</span></span><br><span class="line">            <span class="keyword">if</span> (right - left &lt; len)&#123;<span class="comment">//说明现在的子串的长度比 之前记录的长度还要小</span></span><br><span class="line">                len = right - left;<span class="comment">//更新字串长度记录</span></span><br><span class="line">                start = left;<span class="comment">//更新起使索引到left</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将当前left位置的字符移除窗口</span></span><br><span class="line">            <span class="type">char</span> <span class="variable">d</span> <span class="operator">=</span> s.charAt(left);</span><br><span class="line">            <span class="comment">//左移窗口</span></span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">if</span> (need.containsKey(d))&#123;<span class="comment">//如果当前移除的字符 存在于 need中 需要对窗口内的数据进行一系列更新</span></span><br><span class="line">                <span class="keyword">if</span> (window.get(d).equals(need.get(d)))&#123;<span class="comment">//如果当前需要移除的字符数量 和 need中需要移除的字符数量相同 则将 匹配的字符个数 -1</span></span><br><span class="line">                    valid--;</span><br><span class="line">                &#125;</span><br><span class="line">                window.put(d,window.get(d)-<span class="number">1</span>);<span class="comment">//将当前的</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//right到达了字符串的末尾</span></span><br><span class="line">    <span class="type">return</span> <span class="variable">len</span> <span class="operator">=</span>= Integer.MAX_VALUE ? <span class="string">&quot;&quot;</span> : s.substring(start,start+len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>写法二：用数组</p>
<p>to be continued</p>
<h2 id="567-Permutation-in-String"><a href="#567-Permutation-in-String" class="headerlink" title="567. Permutation in String"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/permutation-in-string/">567. Permutation in String</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkInclusion</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    Map&lt;Character,Integer&gt; need=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s1.length(); i++) &#123;</span><br><span class="line">        need.put(s1.charAt(i),need.getOrDefault(s1.charAt(i),<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> valid=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    Map&lt;Character,Integer&gt; window=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span>(right&lt;s2.length())&#123; <span class="comment">//[left,right)</span></span><br><span class="line">        <span class="type">char</span> c=s2.charAt(right);</span><br><span class="line">        window.put(c,window.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        right++;</span><br><span class="line">        <span class="keyword">if</span>(need.containsKey(c)&amp;&amp;need.get(c).equals(window.get(c)))&#123;</span><br><span class="line">            valid++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(valid==need.size())&#123; <span class="comment">//找到包含permutation的substring后开始缩，直到满足条件返回true</span></span><br><span class="line">            <span class="keyword">if</span>(right-left==s1.length())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">char</span> d=s2.charAt(left);</span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">if</span>(need.containsKey(d))&#123;</span><br><span class="line">                <span class="keyword">if</span>(need.get(d).equals(window.get(d)))&#123;</span><br><span class="line">                    valid--;</span><br><span class="line">                &#125;</span><br><span class="line">                window.put(d,window.get(d)-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="3-Longest-Substring-Without-Repeating-Characters"><a href="#3-Longest-Substring-Without-Repeating-Characters" class="headerlink" title="3. Longest Substring Without Repeating Characters"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">3. Longest Substring Without Repeating Characters</a></h2><p>sliding window 模板：</p>
<p><strong>现在开始套模板，只需要思考以下四个问题</strong>：</p>
<p>1、当移动 <code>right</code> 扩大窗口，即加入字符时，应该更新哪些数据？</p>
<p>2、什么条件下，窗口应该暂停扩大，开始移动 <code>left</code> 缩小窗口？</p>
<p>3、当移动 <code>left</code> 缩小窗口，即移出字符时，应该更新哪些数据？</p>
<p>4、我们要的结果应该在扩大窗口时还是缩小窗口时进行更新？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    Map&lt;Character,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">while</span>(right&lt;s.length())&#123;</span><br><span class="line">        <span class="type">char</span> c=s.charAt(right);</span><br><span class="line">        map.put(c,map.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        right++;</span><br><span class="line">        <span class="keyword">while</span>(map.get(c)!=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="type">char</span> d=s.charAt(left);</span><br><span class="line">            map.put(d,map.get(d)-<span class="number">1</span>);</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">        max=Math.max(max,right-left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max==Integer.MIN_VALUE ? <span class="number">0</span> : max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="438-Find-All-Anagrams-in-a-String"><a href="#438-Find-All-Anagrams-in-a-String" class="headerlink" title="438. Find All Anagrams in a String"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-all-anagrams-in-a-string/">438. Find All Anagrams in a String</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findAnagrams</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    Map&lt;Character,Integer&gt; need=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    Map&lt;Character,Integer&gt; window=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; p.length(); i++) &#123;</span><br><span class="line">        need.put(p.charAt(i),need.getOrDefault(p.charAt(i),<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> start=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> valid=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(right&lt;s.length())&#123; <span class="comment">//[left,right)</span></span><br><span class="line">        <span class="type">char</span> c=s.charAt(right);</span><br><span class="line">        right++;</span><br><span class="line">        <span class="keyword">if</span>(need.containsKey(c))&#123;</span><br><span class="line">            window.put(c,window.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(need.get(c).equals(window.get(c)))&#123;</span><br><span class="line">                valid++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(valid==need.size())&#123;</span><br><span class="line">            <span class="keyword">if</span>(right-left==p.length())&#123;<span class="comment">//[left,right)</span></span><br><span class="line">                res.add(left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">char</span> d=s.charAt(left);</span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">if</span>(window.containsKey(d))&#123;</span><br><span class="line">                window.put(d,window.get(d)-<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(need.get(d)&gt;window.get(d))&#123;</span><br><span class="line">                    valid--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="159-Longest-Substring-with-At-Most-Two-Distinct-Characters"><a href="#159-Longest-Substring-with-At-Most-Two-Distinct-Characters" class="headerlink" title="159. Longest Substring with At Most Two Distinct Characters"></a>159. Longest Substring with At Most Two Distinct Characters</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstringTwoDistinct</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=s.length();</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>;</span><br><span class="line">    Map&lt;Character,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span>(r&lt;n)&#123;</span><br><span class="line">        <span class="comment">//[l,r)</span></span><br><span class="line">        <span class="type">char</span> c=s.charAt(r++);</span><br><span class="line">        map.put(c,map.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(map.keySet().size()&gt;<span class="number">2</span>)&#123;</span><br><span class="line">            c=s.charAt(l++);</span><br><span class="line">            map.put(c,map.get(c)-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(map.get(c)==<span class="number">0</span>)&#123;</span><br><span class="line">                map.remove(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res=Math.max(res,r-l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="424-Longest-Repeating-Character-Replacement"><a href="#424-Longest-Repeating-Character-Replacement" class="headerlink" title="424. Longest Repeating Character Replacement"></a>424. Longest Repeating Character Replacement</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//longest substring with at most k chars not the same</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">characterReplacement</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=s.length();</span><br><span class="line">    <span class="type">int</span>[] count=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> mostFreqCount=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(right&lt;n)&#123;</span><br><span class="line">        <span class="comment">//[left,right)</span></span><br><span class="line">        <span class="type">char</span> c=s.charAt(right++);</span><br><span class="line">        count[c-<span class="string">&#x27;A&#x27;</span>]++;</span><br><span class="line">        mostFreqCount=Math.max(mostFreqCount,count[c-<span class="string">&#x27;A&#x27;</span>]);</span><br><span class="line">        <span class="keyword">while</span>(right-left-mostFreqCount&gt;k)&#123;</span><br><span class="line">            <span class="type">char</span> d=s.charAt(left++);</span><br><span class="line">            count[d-<span class="string">&#x27;A&#x27;</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line">        res=Math.max(res,right-left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2398-Maximum-Number-of-Robots-Within-Budget"><a href="#2398-Maximum-Number-of-Robots-Within-Budget" class="headerlink" title="2398. Maximum Number of Robots Within Budget"></a>2398. Maximum Number of Robots Within Budget</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumRobots</span><span class="params">(<span class="type">int</span>[] chargeTimes, <span class="type">int</span>[] runningCosts, <span class="type">long</span> budget)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n= chargeTimes.length;</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="comment">//[idx,val]</span></span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; pq=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;(b[<span class="number">1</span>]-a[<span class="number">1</span>]));</span><br><span class="line">    <span class="type">long</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(right&lt;n)&#123;</span><br><span class="line">        <span class="comment">//[left,right)</span></span><br><span class="line">        sum+=runningCosts[right];</span><br><span class="line">        pq.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;right,chargeTimes[right]&#125;);</span><br><span class="line">        right++;</span><br><span class="line">        <span class="keyword">while</span>(!pq.isEmpty() &amp;&amp; pq.peek()[<span class="number">0</span>]&lt;left)&#123;</span><br><span class="line">            pq.poll();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">long</span> cur=pq.peek()[<span class="number">1</span>]+(right-left)*sum;</span><br><span class="line">        <span class="keyword">while</span>(cur&gt;budget)&#123;</span><br><span class="line">            sum-=runningCosts[left++];</span><br><span class="line">            <span class="keyword">while</span>(!pq.isEmpty() &amp;&amp; pq.peek()[<span class="number">0</span>]&lt;left)&#123;</span><br><span class="line">                pq.poll();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(left&lt;right)&#123;</span><br><span class="line">                cur=pq.peek()[<span class="number">1</span>]+(right-left)*sum;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                cur=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res=Math.max(res,right-left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1151-Minimum-Swaps-to-Group-All-1’s-Together"><a href="#1151-Minimum-Swaps-to-Group-All-1’s-Together" class="headerlink" title="1151. Minimum Swaps to Group All 1’s Together"></a>1151. Minimum Swaps to Group All 1’s Together</h2><p>注意：</p>
<ul>
<li>find the subarray of ones length with maximum number of 1</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minSwaps</span><span class="params">(<span class="type">int</span>[] data)</span> &#123;</span><br><span class="line">    <span class="type">int</span> ones=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : data) &#123;</span><br><span class="line">        <span class="keyword">if</span>(num==<span class="number">1</span>)&#123;</span><br><span class="line">            ones++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(ones&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> n=data.length;</span><br><span class="line">    <span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(right&lt;n)&#123;</span><br><span class="line">        <span class="comment">//[left,right)</span></span><br><span class="line">        <span class="keyword">if</span>(data[right++]==<span class="number">1</span>)&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(right-left&gt;ones)&#123;</span><br><span class="line">            <span class="keyword">if</span>(data[left++]==<span class="number">1</span>)&#123;</span><br><span class="line">                count--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(right-left==ones)&#123;</span><br><span class="line">            max=Math.max(max,count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ones-max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="992-Subarrays-with-K-Different-Integers"><a href="#992-Subarrays-with-K-Different-Integers" class="headerlink" title="992. Subarrays with K Different Integers"></a>992. Subarrays with K Different Integers</h2><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/subarrays-with-k-different-integers/discuss/523136/JavaC%2B%2BPython-Sliding-Window">https://leetcode.com/problems/subarrays-with-k-different-integers/discuss/523136/JavaC%2B%2BPython-Sliding-Window</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subarraysWithKDistinct</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> atMostK(nums,k)-atMostK(nums,k-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">atMostK</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    Map&lt;Integer,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">0</span>; r &lt; n; r++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(map.getOrDefault(nums[r],<span class="number">0</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">            k--;</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(nums[r],map.getOrDefault(nums[r],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(k&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            map.put(nums[l],map.get(nums[l])-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(map.get(nums[l])==<span class="number">0</span>)&#123;</span><br><span class="line">                k++;</span><br><span class="line">            &#125;</span><br><span class="line">            l++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//[l,r] [l+1,r], .. [r,r]</span></span><br><span class="line">        res+=r-l+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1456-Maximum-Number-of-Vowels-in-a-Substring-of-Given-Length"><a href="#1456-Maximum-Number-of-Vowels-in-a-Substring-of-Given-Length" class="headerlink" title="1456. Maximum Number of Vowels in a Substring of Given Length"></a>1456. Maximum Number of Vowels in a Substring of Given Length</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxVowels</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] chars=s.toCharArray();</span><br><span class="line">    <span class="type">int</span> n=chars.length;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(r&lt;n)&#123;</span><br><span class="line">        <span class="comment">//[l,r)</span></span><br><span class="line">        <span class="keyword">if</span>(isVowel(chars[r]))&#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        r++;</span><br><span class="line">        <span class="keyword">if</span>(r-l==k)&#123;</span><br><span class="line">            res=Math.max(res,count);</span><br><span class="line">            <span class="keyword">if</span>(isVowel(chars[l]))&#123;</span><br><span class="line">                count--;</span><br><span class="line">            &#125;</span><br><span class="line">            l++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isVowel</span><span class="params">(<span class="type">char</span> c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;a&#x27;</span> || c==<span class="string">&#x27;e&#x27;</span> || c==<span class="string">&#x27;i&#x27;</span> || c==<span class="string">&#x27;o&#x27;</span> || c==<span class="string">&#x27;u&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2461-Maximum-Sum-of-Distinct-Subarrays-With-Length-K"><a href="#2461-Maximum-Sum-of-Distinct-Subarrays-With-Length-K" class="headerlink" title="2461. Maximum Sum of Distinct Subarrays With Length K"></a>2461. Maximum Sum of Distinct Subarrays With Length K</h2><p>看到maximum&#x2F;minimum subarray, 考虑sliding window</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">maximumSubarraySum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    Map&lt;Integer,Integer&gt; window=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> max=<span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(r&lt;n)&#123;</span><br><span class="line">        <span class="comment">//[l,r)</span></span><br><span class="line">        sum+=nums[r];</span><br><span class="line">        window.put(nums[r],window.getOrDefault(nums[r],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        r++;</span><br><span class="line">        <span class="keyword">while</span>(r-l&gt;k || window.get(nums[r-<span class="number">1</span>])&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            sum-=nums[l];</span><br><span class="line">            window.put(nums[l],window.get(nums[l])-<span class="number">1</span>);</span><br><span class="line">            l++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(r-l==k)&#123;</span><br><span class="line">            max=Math.max(max,sum);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/24/ssp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/24/ssp/" class="post-title-link" itemprop="url">ssp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-25 09:20:03" itemprop="dateCreated datePublished" datetime="2022-04-25T09:20:03+08:00">2022-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 15:25:01" itemprop="dateModified" datetime="2022-11-29T15:25:01+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>81k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:14</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-cfgcenter"><a href="#1-cfgcenter" class="headerlink" title="1. cfgcenter"></a>1. cfgcenter</h1><h2 id="1-1-cfg-api"><a href="#1-1-cfg-api" class="headerlink" title="1.1 cfg-api"></a>1.1 cfg-api</h2><p>理论上，给gdsinsing的其它地方直接使用，只需要调用接口，无需重复实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICfgService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//根据编号查找一个配置</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getCfgString</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Integer <span class="title function_">getCfgInteger</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Date <span class="title function_">getCfgDate</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-2-cfg-provider"><a href="#1-2-cfg-provider" class="headerlink" title="1.2 cfg-provider"></a>1.2 cfg-provider</h2><h3 id="1-2-1-CfgServiceImpl-java"><a href="#1-2-1-CfgServiceImpl-java" class="headerlink" title="1.2.1 CfgServiceImpl.java"></a>1.2.1 CfgServiceImpl.java</h3><p>理论上，provider实现api的接口，用于分布式，其它模块直接调用api即可</p>
<p>目前没用上，还是必须在其它模块的pom里<dependency>provider</dependency></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CfgServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICfgService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssCfgTeConfigService iGdssCfgTeConfigService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getCfgString</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">GdssCfgTeConfig</span> <span class="variable">value</span> <span class="operator">=</span> iGdssCfgTeConfigService.getEntityByCode(code);</span><br><span class="line">      <span class="keyword">if</span> (value == <span class="literal">null</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value.getCfgValue();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Integer <span class="title function_">getCfgInteger</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> <span class="built_in">this</span>.getCfgString(code);</span><br><span class="line">      <span class="keyword">return</span> Integer.valueOf(val);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Date <span class="title function_">getCfgDate</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> <span class="built_in">this</span>.getCfgString(code);</span><br><span class="line">         <span class="keyword">return</span> DateUtil.string2Date(val);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">         ex.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-2-2-CfgcenterProviderApp"><a href="#1-2-2-CfgcenterProviderApp" class="headerlink" title="1.2.2 CfgcenterProviderApp"></a>1.2.2 CfgcenterProviderApp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.lll.**.mapper&quot;)</span></span><br><span class="line"><span class="meta">@ServletComponentScan(value = &#123;&quot;cn.lll.cfgcenter&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CfgcenterProviderApp</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(CfgcenterProviderApp.class);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(CfgcenterProviderApp.class, args);</span><br><span class="line">      SpringUtil.setApplicationContext(context);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      log.info(<span class="string">&quot;************************************************************* CfgcenterProviderApp 启动完成!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>Spring boot 框架注解</li>
</ol>
<h3 id="1-2-3-TestCfgService-java"><a href="#1-2-3-TestCfgService-java" class="headerlink" title="1.2.3 TestCfgService.java"></a>1.2.3 TestCfgService.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = CfgcenterProviderApp.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCfgService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(TestCfgService.class);</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> ICfgService iCfgService;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;开始&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">end</span><span class="params">()</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;结束&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCfgString</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> <span class="string">&quot;001&quot;</span>;</span><br><span class="line">         </span><br><span class="line">         <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> iCfgService.getCfgString(code);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">if</span>(val.equals(<span class="string">&quot;测试&quot;</span>))&#123;</span><br><span class="line">            Assert.assertTrue(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         Assert.assertTrue(<span class="literal">false</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         Assert.assertTrue(<span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>Spring boot 框架注解</li>
</ol>
<h2 id="1-3-cfg-dao"><a href="#1-3-cfg-dao" class="headerlink" title="1.3 cfg-dao"></a>1.3 cfg-dao</h2><p>一张数据库表，一个xml，一个mapper，一个model，一个service，一个serviceImpl</p>
<p>​                        </p>
<h3 id="1-3-1-xml-mybatis-GdssCfgTeConfig-xml"><a href="#1-3-1-xml-mybatis-GdssCfgTeConfig-xml" class="headerlink" title="1.3.1 xml    mybatis-GdssCfgTeConfig.xml"></a>1.3.1 xml    mybatis-GdssCfgTeConfig.xml</h3><p>1.主体是个<mapper> </mapper>, namespace指定sql功能对应的mapper接口，每个sql功能和接口中的方法一一对应</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;cn.lll.cfgcenter.mapper.IGdssCfgTeConfigMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>常用的CRUD操作由<insert></insert>,  <select></select>, <update></update>,<delete></delete>定义好以备试用，id和mapper接口中的方法名对应</p>
<p><parameterType> 输入参数类型</p>
<p><resultType> <resultMap> 输出参数类型</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delEntity&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">   DELETE FROM</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   WHERE ID = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.<resultMap></resultMap>指定sql操作的结果集，由type指定路径，将数据库表中的记录ORM映射到model中定义的java bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;GdssCfgTeConfigMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;cn.lll.cfgcenter.model.GdssCfgTeConfig&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;ID&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;CHAR&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      &lt;result column=&quot;ID&quot; property=&quot;id&quot; jdbcType=&quot;CHAR&quot; javaType=&quot;String&quot; /&gt;--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;CODE&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;CFG_VALUE&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cfgValue&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;REMARK&quot;</span> <span class="attr">property</span>=<span class="string">&quot;remark&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3.<sql></sql>自定义可重用的sql语句，减少重复工作</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;TableName&quot;</span>&gt;</span>GDSS_CFG_TE_CONFIG<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delEntity&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">   DELETE FROM</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   WHERE ID = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;Base_Column_List&quot;</span>&gt;</span></span><br><span class="line">   ID,CODE,CFG_VALUE,REMARK</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEntity&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;cn.lll.cfgcenter.model.GdssCfgTeConfig&quot;</span>&gt;</span></span><br><span class="line">   INSERT INTO</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   (</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">   )</span><br><span class="line">   VALUES</span><br><span class="line">   (#&#123;id,jdbcType=CHAR&#125;,#&#123;code,jdbcType=VARCHAR&#125;,#&#123;cfgValue,jdbcType=VARCHAR&#125;,#&#123;remark,jdbcType=VARCHAR&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>这个id&#x3D;”condition”的可重用sql语句较长：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;condition&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span>AND ID = #&#123;id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;code != null&quot;</span>&gt;</span>AND CODE = #&#123;code&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cfgValue != null&quot;</span>&gt;</span>AND CFG_VALUE = #&#123;cfgValue&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark != null&quot;</span>&gt;</span>AND REMARK = #&#123;remark&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id_like != null&quot;</span>&gt;</span>AND ID LIKE &quot;%&quot;#&#123;id_like&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;code_like != null&quot;</span>&gt;</span>AND CODE LIKE &quot;%&quot;#&#123;code_like&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cfgValue_like != null&quot;</span>&gt;</span>AND CFG_VALUE LIKE &quot;%&quot;#&#123;cfgValue_like&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark_like != null&quot;</span>&gt;</span>AND REMARK LIKE &quot;%&quot;#&#123;remark_like&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>但需要使用时可大大减轻工作量：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delEntityByParam&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;cn.lll.cfgcenter.model.GdssCfgTeConfig&quot;</span>&gt;</span></span><br><span class="line">   DELETE FROM</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;condition&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li><p>id_like等like没什么用</p>
</li>
<li><p>ID LIKE “%”#{id_like}”%”，左右加百分号，表示左右都可有0-无穷个字符，用于模糊查询</p>
</li>
</ol>
<p>自定义查询, id&#x3D;”vagueCondition”    &#x2F;&#x2F;没什么用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;vagueCondition&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span>AND ID LIKE &quot;%&quot;#&#123;id&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;code != null&quot;</span>&gt;</span>AND CODE LIKE &quot;%&quot;#&#123;code&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cfgValue != null&quot;</span>&gt;</span>AND CFG_VALUE LIKE &quot;%&quot;#&#123;cfgValue&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark != null&quot;</span>&gt;</span>AND REMARK LIKE &quot;%&quot;#&#123;remark&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;vagueCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">parameterType</span>=<span class="string">&quot;cn.lll.cfgcenter.model.param.GdssCfgTeConfigParam&quot;</span>&gt;</span></span><br><span class="line">   SELECT COUNT(0) FROM</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;vagueCondition&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-3-2-mapper-IGdssCfgTeConfigMapper-java"><a href="#1-3-2-mapper-IGdssCfgTeConfigMapper-java" class="headerlink" title="1.3.2 mapper    IGdssCfgTeConfigMapper.java"></a>1.3.2 mapper    IGdssCfgTeConfigMapper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGdssCfgTeConfigMapper</span> <span class="keyword">extends</span> <span class="title class_">ILllBaseMapper</span>&lt;GdssCfgTeConfig&gt; &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">vagueCount</span><span class="params">(GdssCfgTeConfigParam param)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> List&lt;GdssCfgTeConfig&gt; <span class="title function_">vagueSearch</span><span class="params">(GdssCfgTeConfigParam param)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@description</span>:根据id数组，批量删除</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> idList</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@exception</span> </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="type">int</span> <span class="title function_">batchDelete</span><span class="params">(<span class="meta">@Param(&quot;idList&quot;)</span> List&lt;String&gt; idList)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ILllBaseMapper</span>&lt;T&gt; &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addEntity</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delEntity</span><span class="params">(String id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delEntityByParam</span><span class="params">(T params)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateEntity</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> T <span class="title function_">getEntityById</span><span class="params">(String id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   <span class="keyword">public</span> T <span class="title function_">getEntity</span><span class="params">(T params)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">searchEntity</span><span class="params">(T params)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span> <span class="keyword">throws</span> Exception; </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countByParam</span><span class="params">(T params)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>在Springboot, mybatis中，mapper无需手动写实现类</li>
<li>mapper接口中的方法名需要与xml中的CRUD标签的id保持一致，mybatis才能自动对应上</li>
<li>mapper只用于数据库表ORM映射到model，为mybatis专用，别无他用！</li>
</ol>
<h3 id="1-3-3-model-GdssCfgConfig-java"><a href="#1-3-3-model-GdssCfgConfig-java" class="headerlink" title="1.3.3 model    GdssCfgConfig.java"></a>1.3.3 model    GdssCfgConfig.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LllBaseModel</span> <span class="keyword">implements</span> <span class="title class_">IAbleJson</span>,Cloneable</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GdssCfgTeConfig</span> <span class="keyword">extends</span> <span class="title class_">LllBaseModel</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> String id;</span><br><span class="line">   <span class="keyword">private</span> String code;</span><br><span class="line">   <span class="keyword">private</span> String cfgValue;</span><br><span class="line">   <span class="keyword">private</span> String remark;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String id_like;</span><br><span class="line">   <span class="keyword">private</span> String code_like;</span><br><span class="line">   <span class="keyword">private</span> String cfgValue_like;</span><br><span class="line">   <span class="keyword">private</span> String remark_like;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.code;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(String code)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.code = code;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getCfgValue</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.cfgValue;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCfgValue</span><span class="params">(String cfgValue)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.cfgValue = cfgValue;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getRemark</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.remark;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRemark</span><span class="params">(String remark)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.remark = remark;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIdLike</span><span class="params">(String id)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.id_like = id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCodeLike</span><span class="params">(String code)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.code_like = code;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCfgValueLike</span><span class="params">(String cfgValue)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.cfgValue_like = cfgValue;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRemarkLike</span><span class="params">(String remark)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.remark_like = remark;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getPkidValue</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPkidValue</span><span class="params">(String id)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>model里的java bean中的参数可以包含数据库表中没有的字段， 但数据库表中的每个字段model里的java bean都必须一一对应！</li>
<li>model里的java bean中基本数据类型字段要用包装类，不要用int，用Integer，和mybatis中定义相一致！</li>
</ol>
<h3 id="1-3-4-service-IGdssCfgConfigService-java-GdssCfgTeConfigServiceImpl-java"><a href="#1-3-4-service-IGdssCfgConfigService-java-GdssCfgTeConfigServiceImpl-java" class="headerlink" title="1.3.4 service    IGdssCfgConfigService.java, GdssCfgTeConfigServiceImpl.java"></a>1.3.4 service    IGdssCfgConfigService.java, GdssCfgTeConfigServiceImpl.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ILllDbRedisBaseService</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">addEntity</span><span class="params">(T entity)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">    <span class="comment">//arg依照业务，可为usrId,account等</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delEntityById</span><span class="params">(String id, String arg)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateEntityById</span><span class="params">(T t, String id, String arg)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">getEntityById</span><span class="params">(String id)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">    T <span class="title function_">getEntity</span><span class="params">(T params)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">    List&lt;T&gt; <span class="title function_">searchEntity</span><span class="params">(<span class="type">int</span> pagesize, <span class="type">int</span> pageno)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">searchEntity</span><span class="params">(T params,<span class="type">int</span> pagesize,<span class="type">int</span> pageno)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">count</span><span class="params">(T params)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGdssCfgTeConfigService</span> <span class="keyword">extends</span> <span class="title class_">ILllDbRedisBaseService</span>&lt;GdssCfgTeConfig&gt; &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">vagueCount</span><span class="params">(GdssCfgTeConfigParam param)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> List&lt;GdssCfgTeConfig&gt; <span class="title function_">vagueSearch</span><span class="params">(GdssCfgTeConfigParam param, <span class="type">int</span> pagesize, <span class="type">int</span> pageno)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> GdssCfgTeConfig <span class="title function_">getEntityByCode</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">   <span class="type">int</span> <span class="title function_">batchDelete</span><span class="params">(List&lt;String&gt; idList)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">reloadAllConfCache</span><span class="params">()</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>MVC 是一种使用 MVC（Model View Controller 模型-视图-控制器）设计创建 Web 应用程序的模式：</p>
<ul>
<li>Model（模型）表示应用程序核心（如数据库）。</li>
<li>View（视图）显示效果（HTML页面）。</li>
<li>Controller（控制器）处理输入（业务逻辑）。</li>
</ul>
<p><strong>Model（模型）</strong>是应用程序中用于处理应用程序数据逻辑的部分。<br> 　通常模型对象负责在数据库中存取数据。</p>
<p><strong>View（视图）</strong>是应用程序中处理数据显示的部分。<br> 　通常视图是依据模型数据创建的。</p>
<p><strong>Controller（控制器）</strong>是应用程序中处理用户交互的部分。<br> 　通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。</p>
<p>注意：</p>
<ol>
<li>虽然本package名为service，但是仍然属于dao层&#x2F;持久层&#x2F;Model层，而不是业务层&#x2F;Controller层！</li>
<li>serviceImpl中@Autowired自动装载了mapper：<code>private IGdssCfgTeConfigMapper iGdssCfgTeConfigMapper;</code></li>
<li>serviceImpl中的方法实现，直接调用mapper接口中的方法，mybatis自动对应到xml中相应的sql语句：例如delEntityById中调用了mapper接口里的delEntity</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delEntityById</span><span class="params">(String id, String code)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">   <span class="keyword">if</span> (StringUtil.isEmpty(id))&#123;</span><br><span class="line">      log.error(<span class="string">&quot;id can not be empty&quot;</span>);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;DaoService&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> iGdssCfgTeConfigMapper.delEntity(id);</span><br><span class="line">      <span class="keyword">if</span> (rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">         flushCache(<span class="literal">null</span>, id, <span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> rows;</span><br><span class="line">   &#125;<span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">      log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;DaoService&quot;</span>,ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h1 id="2-app-ssp-mgr-module-conf"><a href="#2-app-ssp-mgr-module-conf" class="headerlink" title="2. app-ssp-mgr-module-conf"></a>2. app-ssp-mgr-module-conf</h1><h2 id="2-1-controller"><a href="#2-1-controller" class="headerlink" title="2.1 controller"></a>2.1 controller</h2><p>ConfController调用ConfService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ConfService confService;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-model"><a href="#2-2-model" class="headerlink" title="2.2 model"></a>2.2 model</h2><h2 id="2-3-service"><a href="#2-3-service" class="headerlink" title="2.3 service"></a>2.3 service</h2><p>ConfServiceImpl调用cfg-dao-service里的IGdssCfgTeConfigService:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IGdssCfgTeConfigService iGdssCfgTeConfigService;</span><br></pre></td></tr></table></figure>





<h1 id="3-Spring-boot注解-amp-配置"><a href="#3-Spring-boot注解-amp-配置" class="headerlink" title="3. Spring boot注解&amp;配置"></a>3. Spring boot注解&amp;配置</h1><h2 id="3-1-常用注解"><a href="#3-1-常用注解" class="headerlink" title="3.1 常用注解"></a>3.1 常用注解</h2><h3 id="3-1-1-Configuration"><a href="#3-1-1-Configuration" class="headerlink" title="3.1.1 @Configuration"></a>3.1.1 @Configuration</h3><p>用来标记类可以当做一个bean的定义，被Spring IOC容器使用。</p>
<h3 id="3-1-2-Bean"><a href="#3-1-2-Bean" class="headerlink" title="3.1.2 @Bean"></a>3.1.2 @Bean</h3><p>表示此方法将要返回一个对象，作为一个bean注册进Spring应用上下文。</p>
<h3 id="3-1-3-Component"><a href="#3-1-3-Component" class="headerlink" title="3.1.3 @Component"></a>3.1.3 @Component</h3><p>将 java 类标记为 bean。它是任何 Spring 管理组件的通用构造型。spring 的组件扫描机制现在可以将其拾取并将其拉入应用程序环境中。</p>
<h3 id="3-1-4-Controller"><a href="#3-1-4-Controller" class="headerlink" title="3.1.4 @Controller"></a>3.1.4 @Controller</h3><p>将一个类标记为 Spring Web MVC 控制器。标有它的 Bean 会自动导入到 IoC 容器中。</p>
<h3 id="3-1-5-Service"><a href="#3-1-5-Service" class="headerlink" title="3.1.5 @Service"></a>3.1.5 @Service</h3><p>此注解是组件注解的特化。它不会对 @Component 注解提供任何其他行为。您可以在服务层类中使用 @Service 而不是 @Component，因为它以更好的方式指定了意图。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span>  <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;执行service中的保存逻辑&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">    context.register(SpringConfig.class);</span><br><span class="line">    context.refresh();</span><br><span class="line">    <span class="comment">//获取接口实例</span></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">    <span class="comment">//创建实例的代理</span></span><br><span class="line">    <span class="type">UserServiceProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceProxy</span>(service);</span><br><span class="line">    <span class="comment">//执行方法</span></span><br><span class="line">    proxy.saveUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>context.getBean(Interface.class) 自动装配</li>
</ol>
<h3 id="3-1-6-Repository"><a href="#3-1-6-Repository" class="headerlink" title="3.1.6 @Repository"></a>3.1.6 @Repository</h3><p>表示使用注解实例化此类，并交给 Spring 的容器管理。</p>
<p>这个注解是具有类似用途和功能的 @Component 注解的特化。它为 DAO 提供了额外的好处。它将 DAO 导入 IoC 容器，并使未经检查的异常有资格转换为 Spring DataAccessException。</p>
<h3 id="3-1-7-Required"><a href="#3-1-7-Required" class="headerlink" title="3.1.7 @Required"></a>3.1.7 @Required</h3><p>这个注解表明bean的属性必须在配置的时候设置，通过一个bean定义的显式的属性值或通过自动装配，若@Required注解的bean属性未被设置，容器将抛出BeanInitializationException。</p>
<h3 id="3-1-8-Autowired和-Resource"><a href="#3-1-8-Autowired和-Resource" class="headerlink" title="3.1.8 @Autowired和@Resource"></a>3.1.8 @Autowired和@Resource</h3><p>@Autowired默认是按照类型装配注入的，默认情况下它要求依赖对象必须存在（可以设置它required属性为false）。@Autowired 注解提供了更细粒度的控制，包括在何处以及如何完成自动装配。它的用法和@Required一样，修饰 setter方法、构造器、属性或者具有任意名称和&#x2F;或多个参数的PN方法。</p>
<p>注意：</p>
<ol>
<li>@Autowired可用于：构造函数、成员变量、Setter方法</li>
<li>@Autowired和@Resource之间的区别</li>
<li>@Autowired默认是按照类型装配注入的，默认情况下它要求依赖对象必须存在（可以设置它required<br>属性为false）。</li>
<li>@Resource默认是按照名称来装配注入的，只有当找不到与名称匹配的bean才会按照类型来装配注入。</li>
</ol>
<h3 id="3-1-9-Qualifier"><a href="#3-1-9-Qualifier" class="headerlink" title="3.1.9 @Qualifier"></a>3.1.9 @Qualifier</h3><p>当您创建多个相同类型的 bean 并希望仅使用属性装配其中一个 bean 时，您可以使用@Qualifier 注解和 @Autowired 通过指定应该装配哪个确切的 bean 来消除歧义。</p>
<h3 id="3-1-10-RequestMapping"><a href="#3-1-10-RequestMapping" class="headerlink" title="3.1.10 @RequestMapping"></a>3.1.10 @RequestMapping</h3><p>@RequestMapping 注解用于将特定 HTTP 请求方法映射到将处理相应请求的控制器中的特定类&#x2F;方法。<br>此注释可应用于两个级别：</p>
<ol>
<li>类级别：映射请求的 URL</li>
<li>方法级别：映射 URL 以及 HTTP 请求方法</li>
</ol>
<h3 id="3-1-11-RestController"><a href="#3-1-11-RestController" class="headerlink" title="3.1.11 @RestController"></a>3.1.11 @RestController</h3><p>RestController用于传json数据</p>
<p>@RequestParam(value &#x3D; “file”) 指定拿前端的file属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.file.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.ListPageVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.file.model.AdminFileVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.login.model.SysUser;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.controller.JsonResult;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.file.proxy.modle.LllFileV2;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.file.proxy.modle.ULFileInfoVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.MgrBaseController;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.file.service.IAdminFileService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span>:2020/6/5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@function</span>:文件控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/mgrapi/admin/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminFileController</span> <span class="keyword">extends</span> <span class="title class_">MgrBaseController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(AdminFileController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAdminFileService iAdminFileService;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;上传文件&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">   <span class="meta">@RequestMapping(path = &quot;/upload&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(value = &quot;file&quot;)</span> MultipartFile file, ULFileInfoVo fileInfo)</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">LllFileV2</span> <span class="variable">fileinfo</span> <span class="operator">=</span> iAdminFileService.uploadFile(file,fileInfo);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(fileinfo, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">          log.error(<span class="string">&quot;&quot;</span>,ex);</span><br><span class="line">          <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* @GetMapping(path = &quot;/token&quot;)</span></span><br><span class="line"><span class="comment">    public JsonResult fetchToken()&#123;</span></span><br><span class="line"><span class="comment">        try&#123;</span></span><br><span class="line"><span class="comment">            String token = iAdminFileService.fetchToken();</span></span><br><span class="line"><span class="comment">            return JsonResult.createSuccess(token, &quot;&quot;);</span></span><br><span class="line"><span class="comment">        &#125;catch (Exception ex)&#123;</span></span><br><span class="line"><span class="comment">            return JsonResult.createFail(ex);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询文件列表&quot;, notes = &quot;查询文件列表&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/query&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">queryFileList</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">int</span> pageno, <span class="meta">@RequestParam</span> <span class="type">int</span> pagesize, String id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> <span class="built_in">this</span>.getCurrentSysUser();</span><br><span class="line">            ListPageVo&lt;AdminFileVo&gt; list = iAdminFileService.queryFilePage(pageno, pagesize, id, sysUser);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(list, <span class="string">&quot;OK&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(ex);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取文件详情&quot;, httpMethod = &quot;GET&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(path = &quot;/query/detail&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">queryFileDetailById</span><span class="params">(<span class="meta">@RequestParam</span> String id)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">AdminFileVo</span> <span class="variable">vo</span> <span class="operator">=</span> iAdminFileService.queryFileDetail(id);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(vo, <span class="string">&quot;获取成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;get file detail msg error&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(<span class="string">&quot;公共服务平台未知异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;通过文件id删除文件&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">deleteFileById</span><span class="params">(<span class="meta">@RequestParam</span> String ids)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            iAdminFileService.deleteFileByFileId(ids);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>, <span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;delete file error&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-2-启动类注解-SpringBootApplication"><a href="#3-2-启动类注解-SpringBootApplication" class="headerlink" title="3.2 启动类注解@SpringBootApplication"></a>3.2 启动类注解@SpringBootApplication</h2><h3 id="3-2-1-SpringBootConfiguration"><a href="#3-2-1-SpringBootConfiguration" class="headerlink" title="3.2.1 @SpringBootConfiguration"></a>3.2.1 @SpringBootConfiguration</h3><p>组合了 @Configuration 注解，实现配置文件的功能。</p>
<h3 id="3-2-2-EnableAutoConfiguration"><a href="#3-2-2-EnableAutoConfiguration" class="headerlink" title="3.2.2 @EnableAutoConfiguration"></a>3.2.2 @EnableAutoConfiguration</h3><p>打开自动配置的功能，也可以关闭某个自动配置的选项，如关闭数据源自动配置功能： </p>
<p>@SpringBootApplication(exclude&#x3D; { DataSourceAutoConfiguration.class })</p>
<h3 id="3-2-3-EnableTransactionManagement"><a href="#3-2-3-EnableTransactionManagement" class="headerlink" title="3.2.3 @EnableTransactionManagement"></a>3.2.3 @EnableTransactionManagement</h3><p>事务处理</p>
<p>proxyTargetClass设置为true表示使用基于子类实现的代理(<code>CGLIB</code>)</p>
<h3 id="3-2-4-ComponentScan"><a href="#3-2-4-ComponentScan" class="headerlink" title="3.2.4 @ComponentScan*"></a>3.2.4 @ComponentScan*</h3><p>Spring组件扫描。</p>
<p>例如：</p>
<ol>
<li>@MapperScan(“cn.lll.**.mapper”)</li>
<li>@ServletComponentScan(value &#x3D; {“cn.lll.iic”})</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.util.SpringUtil;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.compile.handler.HandlerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationArguments;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.ApplicationContextEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.lll.**.mapper&quot;)</span></span><br><span class="line"><span class="meta">@ServletComponentScan(value = &#123;&quot;cn.lll.iic&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement(proxyTargetClass = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IICAppSspApp</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span>, ApplicationListener&lt;ApplicationContextEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(IICAppSspApp.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//修复logback bug</span></span><br><span class="line">        HandlerFactory.getLogbackHandler().execute( IICAppSspApp.class.getClassLoader() );</span><br><span class="line"></span><br><span class="line">        SpringApplication.run(IICAppSspApp.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;************************************************************* IICAppSspApp 启动完成!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationContextEvent event)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> event.getApplicationContext();</span><br><span class="line">        SpringUtil.setApplicationContext(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-3-yml配置"><a href="#3-3-yml配置" class="headerlink" title="3.3 yml配置"></a>3.3 yml配置</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8095</span></span><br><span class="line">    <span class="attr">compression:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">mime-types:</span> <span class="string">text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml</span></span><br><span class="line">    <span class="attr">session:</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="number">1800</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">maxFileSize:</span> <span class="string">20MB</span></span><br><span class="line">      <span class="attr">maxRequestSize:</span> <span class="string">20MB</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">classpath:/templates/</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="comment"># config-location: classpath:mybatis-config.xml</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath*:**/mybatis-*.xml</span></span><br><span class="line">  <span class="comment">#type-aliases-package: cn.lll.tsp.model</span></span><br><span class="line">    <span class="attr">configuration:</span></span><br><span class="line">      <span class="attr">cache-enabled:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">use-actual-param-name:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#标识业务统计</span></span><br><span class="line"><span class="attr">stat:</span></span><br><span class="line">  <span class="attr">redis-ip:</span> <span class="number">114.67</span><span class="number">.117</span><span class="number">.77</span></span><br><span class="line">  <span class="attr">redis-pwd:</span> <span class="string">y0aoQ67K62pHrPjp</span></span><br><span class="line">  <span class="attr">redis-key:</span> <span class="string">IIC_STAT_SSP</span></span><br></pre></td></tr></table></figure>





<h1 id="4-AOP"><a href="#4-AOP" class="headerlink" title="4. AOP"></a>4. AOP</h1><p>动态代理实现：相比静态代理，同样需要target类实现接口，但无需手动定义proxy类实现同样的接口，而是定义动态代理器implements InvocationHandler</p>
<ol>
<li>动态处理器</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DynamicProxy</span><span class="params">(<span class="keyword">final</span> Object object)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                  System.out.println(<span class="string">&quot;执行前逻辑&quot;</span>);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(object, args);</span><br><span class="line">                  System.out.println(<span class="string">&quot;执行后逻辑&quot;</span>);</span><br><span class="line">                   <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>测试类代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">        context.register(SpringConfig.class);</span><br><span class="line">        context.refresh();</span><br><span class="line">        <span class="comment">//获取接口实例</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">        <span class="comment">//动态创建实例的代理</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService)Proxy.newProxyInstance(UserService.class.getClassLoader(),</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;UserService.class&#125;, <span class="keyword">new</span> <span class="title class_">DynamicProxy</span>(service));</span><br><span class="line">        <span class="comment">//proxy执行方法</span></span><br><span class="line">        proxy.saveUser();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Proxy.newProxyInstance()的参数：</p>
<ul>
<li><strong>ClassLoader loader</strong>: 指定当前目标对象使用的类加载器，获取加载器的方法是固定的</li>
<li><strong>Class&lt;?&gt;[] interfaces</strong>: 指定目标对象实现的接口的类型，使用泛型方式确认类型</li>
<li><strong>InvocationHandler</strong>: 指定动态处理器，执行目标对象的方法时，会触发事件处理器的方法</li>
</ul>
<h1 id="5-IOC"><a href="#5-IOC" class="headerlink" title="5. IOC"></a>5. IOC</h1><h1 id="6-user-list-从html到mysql"><a href="#6-user-list-从html到mysql" class="headerlink" title="6. user-list 从html到mysql"></a>6. user-list 从html到mysql</h1><h2 id="6-1-router-cfg-js"><a href="#6-1-router-cfg-js" class="headerlink" title="6.1 router-cfg.js"></a>6.1 router-cfg.js</h2><p>vue.js 配置文件</p>
<p>第一部分：path与jsFile对应，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-list.js&quot;</span>&#125;,</span><br></pre></td></tr></table></figure>

<p>第二部分：组件的alias与component中的js对应，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;iic-table&quot;</span>: <span class="string">&quot;/components/iic-table/iic-table.js&quot;</span>,</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">RouterCfg</span> = [</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/home/home.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/home&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/home/home.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/update-pwd&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/home/update-pwd.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/account&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/home/account.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/account/manage-company-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/home/manage-company-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/type/usermod-type-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/type/usermod-type-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/type/usermod-type-add/:parentId&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/type/usermod-type-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/type/usermod-type-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/type/usermod-type-edit.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/datamod/usermod-datamod-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/datamod/usermod-datamod-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/datamod/usermod-datamod-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/datamod/usermod-datamod-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/datamod/usermod-datamod-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/datamod/usermod-datamod-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/datamod/usermod-datamod-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/datamod/usermod-datamod-info.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/detail&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-detail/han-handle-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/encrypt/detail&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/encrypt-handle/encrypt-handle-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/middleware/detail&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/middleware-handle/middleware-handle-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/user-handle&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/user-handle/han-user-handle.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/admin/user-handle/:account&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/user-handle/han-user-handle-admin.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/edit&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-edit/handle-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/create&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-create/handle-create.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/admin/create/:prefix&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-create/handle-create-admin.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/admin/create&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-create/handle-create-admin.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-create-bus&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-create-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-delete-bus&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-delete-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-edit-bus&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-edit-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-detail-bus/:hanId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-detail-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-batch-create-process&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/admin-batch-create-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-batch-create/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-create-batch-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-batch-create/detail/:busId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-create-batch-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-error-bus&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-error-bus.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/middleware/middleware-add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middleware/middleware-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/middleware/middleware-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middleware/middleware-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/middleware/middleware-detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middleware/middleware-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/middleware/bus-type-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middleware/handle-bus-type-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/usystem/usystem-add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/usystem/usystem-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/usystem/usystem-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/usystem/usystem-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/usystem/usystem-info/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/usystem/usystem-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/usystem/usystem-edit/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/usystem/usystem-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/system-api-add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/system-api/system-api-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/system-api-edit/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/system-api/system-api-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/system-api-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/system-api/system-api-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/system-api-info/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/system-api/system-api-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/:apiId/api-method-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/api-method/api-method-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/:apiId/api-method-add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/api-method/api-method-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/:apiId/api-method-edit/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/api-method/api-method-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/:apiId/api-method-info/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/api-method/api-method-info.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/file/upload&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/file/file-upload.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/file/mine&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/file/file-mine.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/file/detail/:fileId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/file/file-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-manage.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/record&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-record.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/record/detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-record-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/edit/:confId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-edit.js&quot;</span>&#125;,</span><br><span class="line">    <span class="comment">//废弃开始 2021.3.31</span></span><br><span class="line">    <span class="comment">// &#123;path: &quot;/assit/sdk/home/&quot;, jsFile: &quot;/pages/assist/sdk-home.js&quot;&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;path: &quot;/assit/sdk/download/&quot;, jsFile: &quot;/pages/assist/sdk-download.js&quot;&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;path: &quot;/assit/demo/download/&quot;, jsFile: &quot;/pages/assist/demo-download.js&quot;&#125;,</span></span><br><span class="line">    <span class="comment">//废弃结束</span></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/user/sdk-config/record&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-user-config.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/user/sdk-config/detail/:recordId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-user-config-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/user/sdk/renew-record&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-renew-record.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/sdk/edit/:sdkId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/sdk/detail/:sdkId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/sdk/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-manage.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#123;path: &quot;/assit/sdk-demo/download/&quot;, jsFile: &quot;/pages/assist/sdk-download.js&quot;&#125;,</span></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/middleware/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middlewareadmin/middleware-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/middleware/detail&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middlewareadmin/middleware-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/user-system/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/user-system/usystem-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/user-system/detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/user-system/usystem-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/system-api/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/sapi-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/http-api/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/hapi-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/system-api/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/sapi-manage.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/system-api/detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/sapi-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/http-api/detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/hapi-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/api-method/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/api-method/method-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/system-api/:apiId/api-method-info/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/api-method/method-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/log/login-log/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/logcenter/login-log-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/audit/user-action/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auditcenter/user-action-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/log/login-log/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/log/login-log-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/audit/apply-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/apply-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/audit/apply-detail/:id&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/apply-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/audit/apply-edit/:id&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/apply-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/audit/audited-list&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/audited-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/audit/audited-record-detail/:id&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/audited-record-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/admin/file/mine&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/filecenter/file-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/admin/file/upload&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/filecenter/file-upload.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/file/detail/:fileId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/filecenter/file-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/auth/menu/menu-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auth/menu/menu-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/handle-data-type/handle-data-type-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/han/handle-data-type/handle-data-type-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/handle-extrainfo/handle-extrainfo-edit&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/han/handle-extrainfo/handle-extrainfo-edit.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-role/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-role.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/bind-company/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-bind-company.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-prefix&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/user/user/user-prefix.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/company-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/company-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/company-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/company-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/bind-user/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-bind-user.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/goods/goods-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/goods/goods-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/goods/goods/goods-detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/goods/goods/goods-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/singlegoods/singlegoods-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/singlegoods/singlegoods-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/singlegoods/singlegoods-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/singlegoods/singlegoods-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/singlegoods/singlegoods-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/singlegoods/singlegoods-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/singlegoods/singlegoods-detail/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/singlegoods/singlegoods-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/saleorder/saleorder-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/saleorder/saleorder-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/pay/pay-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/pay/pay-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/goods/pay/pay-saleorder/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/goods/pay/pay-saleorder.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/recharge/recharge-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/recharge/recharge-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/system-viewmode-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/system-viewmode-list.js&quot;</span>&#125;,</span><br><span class="line">    <span class="comment">// &#123;path:&quot;/usermod/viewmod/viewmode-create&quot;, jsFile:&quot;/pages/usermod/viewmod/viewmode-create.js&quot;&#125;,</span></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/viewmode-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/viewmode-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-datacfg-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-datacfg-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-datacfg-create&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-datacfg-create.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-datacfg-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-datacfg-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-datacfg-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-datacfg-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-pageinfo-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-pageinfo-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-pageinfo-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-pageinfo-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-pageinfo-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-pageinfo-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/system-staticfile-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/staticfile/system-staticfile-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/staticfile/staticfile-create&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/staticfile/staticfile-create.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/staticfile/staticfile-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/staticfile/staticfile-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/staticfile/staticfile-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/staticfile/staticfile-edit.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/user/viewmod-market&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/usermod/viewmod-user/viewmod-market.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/admin/auth/menu/menu-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/auth/menu/menu-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/admin/auth/role/role-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auth/role/role-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/admin/auth/url/url-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auth/url/url-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/admin/auth/api/api-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auth/api/api-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/home/admin-home&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/home/admin-home.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/home/user-home&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/home/user-home.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/admin/user-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/admin/user-statis.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/user/order-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/user/order-statis.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/user/body-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/user/body-statis.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/user/msg-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/user/msg-statis.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/user/other-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/user/other-statis.js&quot;</span>&#125;,</span><br><span class="line">    </span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/error/403&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/error/403.js&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">//组件cfg</span></span><br><span class="line">seajs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="attr">alias</span>:&#123;</span><br><span class="line">        <span class="string">&quot;iic-checkbox&quot;</span>: <span class="string">&quot;/components/iic-checkbox/iic-checkbox.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-radio&quot;</span>: <span class="string">&quot;/components/iic-radio/iic-radio.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-html&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-html.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-image&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-image.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-imagebig&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-imagebig.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-text&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-text.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-url&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-url.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-video&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-video.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-mgr&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-mgr.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-relateinfo-edit&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/iic-relateinfo-edit.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ri-index-select&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/el/ri-index-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ri-type-select&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/el/ri-type-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ri-row-btn&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/el/ri-row-btn.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ri-dm-win&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/el/ri-dm-win.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;dmr-index&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/dmr-index/dmr-index.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-dm-detail-win&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-dm-detail-win.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-relateinfo-type&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-relateinfo-type.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-file-upload&quot;</span>: <span class="string">&quot;/components/iic-file-upload/iic-file-upload.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-img-upload&quot;</span>: <span class="string">&quot;/components/iic-img-upload/iic-img-upload.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-date&quot;</span>: <span class="string">&quot;/components/iic-input-date/iic-input-date.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-datetime&quot;</span>: <span class="string">&quot;/components/iic-input-datetime/iic-input-datetime.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-email&quot;</span>: <span class="string">&quot;/components/iic-input-email/iic-input-email.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-int&quot;</span>: <span class="string">&quot;/components/iic-input-int/iic-input-int.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-number&quot;</span>: <span class="string">&quot;/components/iic-input-number/iic-input-number.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-mobile&quot;</span>: <span class="string">&quot;/components/iic-input-mobile/iic-input-mobile.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-text&quot;</span>: <span class="string">&quot;/components/iic-input-text/iic-input-text.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-code&quot;</span>: <span class="string">&quot;/components/iic-input-code/iic-input-code.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-search&quot;</span>: <span class="string">&quot;/components/iic-input-search/iic-input-search.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-page-split&quot;</span>: <span class="string">&quot;/components/iic-page-split/iic-page-split.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select&quot;</span>: <span class="string">&quot;/components/iic-select/iic-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select-input&quot;</span>: <span class="string">&quot;/components/iic-select-input/iic-select-input.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select-tree&quot;</span>: <span class="string">&quot;/components/iic-select-tree/iic-select-tree.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select-area&quot;</span>: <span class="string">&quot;/components/iic-select-area/iic-select-area.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-user-dmtype-tree&quot;</span>: <span class="string">&quot;/components/iic-user-dmtype-tree/iic-user-dmtype-tree.js&quot;</span>,</span><br><span class="line">        <span class="comment">//使用此组件需要引入 iic-vmod-list</span></span><br><span class="line">        <span class="string">&quot;iic-vmod-select&quot;</span>: <span class="string">&quot;/components/iic-vmod-select/iic-vmod-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-panel-top&quot;</span>: <span class="string">&quot;/components/iic-panel-top/iic-panel-top.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-table&quot;</span>: <span class="string">&quot;/components/iic-table/iic-table.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-tabs&quot;</span>: <span class="string">&quot;/components/iic-tabs/iic-tabs.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-tool-bars&quot;</span>: <span class="string">&quot;/components/iic-tool-bars/iic-tool-bars.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-form&quot;</span>: <span class="string">&quot;/components/iic-form/iic-form.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-select&quot;</span>: <span class="string">&quot;/components/iic-select/iic-input-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-html&quot;</span>: <span class="string">&quot;/components/iic-input-html/iic-input-html.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-textarea&quot;</span>: <span class="string">&quot;/components/iic-textarea/iic-input-textarea.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-readonly&quot;</span>: <span class="string">&quot;/components/iic-readonly/iic-readonly.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-file&quot;</span>: <span class="string">&quot;/components/iic-input-file/iic-input-file.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-apimethod-tree&quot;</span>: <span class="string">&quot;/components/iic-apimethod-tree/iic-apimethod-tree.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-apimethod-header&quot;</span>: <span class="string">&quot;/components/iic-apimethod-header/iic-apimethod-header.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-page-menu&quot;</span>: <span class="string">&quot;/components/iic-page-menu/iic-page-menu.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-other&quot;</span>: <span class="string">&quot;/components/iic-other/iic-other.js&quot;</span>,<span class="comment">//无法归类的杂组件</span></span><br><span class="line">        <span class="string">&quot;iic-file&quot;</span>: <span class="string">&quot;/components/iic-file/iic-file.js&quot;</span>,<span class="comment">//文件相关的杂组件</span></span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;iic-handle-detail-item&quot;</span>: <span class="string">&quot;/components/iic-handle-detail-item/iic-handle-detail-item.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamodel-select&quot;</span>: <span class="string">&quot;/components/iic-datamodel-select/iic-datamodel-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-viewmodel-select&quot;</span>: <span class="string">&quot;/components/iic-viewmodel-select/iic-viewmodel-select.js&quot;</span>,</span><br><span class="line">        <span class="comment">//此组件需要require(&#x27;iic-select-tree&#x27;); require(&#x27;iic-vmod-type-select&#x27;); require(&#x27;iic-table&#x27;);</span></span><br><span class="line">        <span class="string">&quot;iic-vmod-list&quot;</span>: <span class="string">&quot;/components/iic-vmod-list/iic-vmod-list.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-vmod-type-select&quot;</span>: <span class="string">&quot;/components/iic-vmod-type-select/iic-vmod-type-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-handle&quot;</span>: <span class="string">&quot;/components/iic-input-handle/iic-input-handle.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-admin-input-handle&quot;</span>: <span class="string">&quot;/components/iic-input-handle/iic-admin-input-handle.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select-checktree&quot;</span>: <span class="string">&quot;/components/iic-select-checktree/iic-select-checktree.js&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;statis-base&quot;</span>: <span class="string">&quot;/pages/statis/statis-base.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256&quot;</span>: <span class="string">&quot;/assets/js/common/sha256.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;math&quot;</span>: <span class="string">&quot;/assets/libs/math/math.min.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h2 id="6-2-user-list-html"><a href="#6-2-user-list-html" class="headerlink" title="6.2 user-list.html"></a>6.2 user-list.html</h2><p>只展示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- start page title --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-title-box d-flex align-items-center justify-content-between&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;mb-0 font-size-18&quot;</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-title-right&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb m-0&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb-item&quot;</span>&gt;</span>用户中心<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb-item active&quot;</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- end page title --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-12&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 工具栏 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-6&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-toolbar&quot;</span> <span class="attr">role</span>=<span class="string">&quot;toolbar&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;go(&#x27;/user/user/user-add&#x27;)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        新增</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;edit(&#x27;/user/user/user-edit/&#123;id&#125;&#x27;)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-edit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        编辑</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;del()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-trash-alt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        删除</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;refresh()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-recycle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        刷新</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onClickCacheAllBus&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-recycle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>刷新所有业务</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;cacheAdmBus&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-recycle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>刷新admin业务</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-6&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float: right;&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-control form-control-sm&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入用户账户&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;queryByAcct()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 40px;&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                                &lt;a href=&quot;javascript:void(0)&quot; class=&quot;btn btn-primary waves-effect waves-light btn-sm&quot; style=&quot;width: 100px; border-left-color:#ced4da;&quot;&gt;</span></span><br><span class="line"><span class="comment">                                    高级查询</span></span><br><span class="line"><span class="comment">                                &lt;/a&gt;</span></span><br><span class="line"><span class="comment">                                --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-responsive mt-3&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table mb-0 table-striped&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>  <span class="attr">style</span>=<span class="string">&quot;width: 50px;&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;custom-control custom-checkbox&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-input&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;selectAll&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-label&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onSelectAll()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>账号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>昵称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>账号状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>接入状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>接入语言<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>角色权限<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>注册时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span> <span class="attr">width</span>=<span class="string">&quot;240&quot;</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;obj in datas&quot;</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;custom-control custom-checkbox&quot;</span>&gt;</span></span><br><span class="line">                                           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-input&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;obj.selected&quot;</span> &gt;</span></span><br><span class="line">                                           <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;customCheck1&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onSelectOne(obj)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.userName&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.nickname&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                                      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;obj.status==1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-blank-circle text-success mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 有效<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                                      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;obj.status==-1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-blank-circle text-danger mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 无效<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;obj.accessStatus==1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-blank-circle text-success mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>已接入<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-blank-circle text-danger mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>未接入<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.language&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.roleNames | ls-string&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.createTime&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                   &lt;td&gt;--&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">iic-table-buttons</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">iic-table-button</span> <span class="attr">label</span>=<span class="string">&quot;查看&quot;</span> <span class="attr">cls</span>=<span class="string">&quot;btn btn-outline-info btn-sm&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickView(obj,&#x27;/user/user/user-info/&#x27;+obj.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">iic-table-button</span> <span class="attr">label</span>=<span class="string">&quot;编辑&quot;</span> <span class="attr">cls</span>=<span class="string">&quot;btn btn-outline-success btn-sm&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickEdit(obj,&#x27;/user/user/user-edit/&#x27;+obj.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">iic-table-button-more</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">iic-table-button-more-item</span> <span class="attr">label</span>=<span class="string">&quot;分配权限&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickView(obj,&#x27;/user/user/user-role/&#x27;+obj.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button-more-item</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">iic-table-button-more-item</span> <span class="attr">label</span>=<span class="string">&quot;关联企业&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickView(obj,&#x27;/user/user/bind-company/&#x27;+obj.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button-more-item</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">iic-table-button-more-item</span> <span class="attr">label</span>=<span class="string">&quot;删除&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickDel(obj,&#x27;/mgrapi/user/del&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button-more-item</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">iic-table-button-more-item</span> <span class="attr">label</span>=<span class="string">&quot;刷新业务缓存&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickCacheBus(obj)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button-more-item</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;/<span class="name">iic-table-button-more</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">iic-table-buttons</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                      &lt;button type=&quot;button&quot; @click=&quot;go(&#x27;/user/user/user-info/&#123;id&#125;&#x27;,obj.id)&quot; class=&quot;btn btn-outline-info btn-sm&quot;&gt;查看&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                      &lt;button type=&quot;button&quot; @click=&quot;go(&#x27;/user/user/user-edit/&#123;id&#125;&#x27;,obj.id)&quot; class=&quot;btn btn-outline-success btn-sm&quot;&gt;编辑&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                      &lt;button type=&quot;button&quot; @click=&quot;go(&#x27;/user/user/user-role/&#123;id&#125;&#x27;,obj.id)&quot; class=&quot;btn btn-outline-info btn-sm&quot;&gt;分配权限&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                        &lt;button type=&quot;button&quot; @click=&quot;go(&#x27;/user/user/bind-company/&#123;id&#125;&#x27;,obj.id)&quot; class=&quot;btn btn-outline-success btn-sm&quot;&gt;关联企业&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                        &lt;button type=&quot;button&quot; @click=&quot;del(obj.id)&quot; class=&quot;btn btn-outline-danger btn-sm&quot;&gt;删除&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                   &lt;/td&gt;--&gt;</span></span><br><span class="line">                               <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--分页--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">iic-table-page-split</span> <span class="attr">:totalRows</span>=<span class="string">&quot;pageInfo.recordTotal&quot;</span> <span class="attr">:pageSize</span>=<span class="string">&quot;pageInfo.pagesize&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;pageInfo.pageno&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;changePage&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-page-split</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- end row --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-3-user-list-js"><a href="#6-3-user-list-js" class="headerlink" title="6.3 user-list.js"></a>6.3 user-list.js</h2><p>通过template将js传入html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tpl = <span class="built_in">require</span>(<span class="string">&#x27;./user-list.html&#x27;</span>); <span class="attr">template</span>: tpl</span><br></pre></td></tr></table></figure>



<p>SeaJs: CMD模块化</p>
<ol>
<li><p>通过require引入依赖，调用其他js模块(接口)</p>
</li>
<li><p>通过module.exports提供接口</p>
</li>
<li><p>Vue.extend创建Vue, 有参数: extends, props, data(function), watch, methods, template</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>,<span class="built_in">exports</span>,<span class="variable language_">module</span></span>)&#123;</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-panel-top&quot;</span>);</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-tool-bars&quot;</span>);</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-table&quot;</span>);</span><br><span class="line">   <span class="keyword">var</span> tpl = <span class="built_in">require</span>(<span class="string">&#x27;./user-list.html&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">      <span class="attr">extends</span>: <span class="title class_">IICBaseTable</span>,</span><br><span class="line">      <span class="attr">props</span>: [],</span><br><span class="line">        <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">datas</span>: [],</span><br><span class="line">            <span class="attr">pageInfo</span>: &#123;</span><br><span class="line">               <span class="attr">pagesize</span>: <span class="number">10</span>,</span><br><span class="line">               <span class="attr">pageno</span>: <span class="number">1</span>,</span><br><span class="line">               <span class="attr">recordTotal</span>: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">               <span class="attr">typeId</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">selectAll</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">watch</span>: &#123;</span><br><span class="line">         <span class="string">&#x27;$route&#x27;</span>: <span class="string">&#x27;initCom&#x27;</span>,</span><br><span class="line">         <span class="attr">keyword</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">//删除了查找关键字，回到第一页数据</span></span><br><span class="line">            <span class="keyword">if</span> ( !<span class="variable language_">this</span>.<span class="property">keyword</span>.<span class="title function_">trim</span>() ) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">changePage</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;</span><br><span class="line">           <span class="attr">initCom</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">loadData</span>();</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="title function_">queryByAcct</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">keyword</span>.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">               <span class="title class_">Iic</span>.<span class="title function_">showMessage</span>(<span class="string">&quot;请输入用户账号&quot;</span>);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pageInfo</span>.<span class="property">pageno</span> = <span class="number">1</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadData</span>(<span class="literal">true</span>);</span><br><span class="line">         &#125;,</span><br><span class="line">           <span class="attr">loadData</span>: <span class="keyword">function</span>(<span class="params">searchByAcct</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">            <span class="keyword">var</span> url = <span class="string">&#x27;./mgrapi/user/user-list&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (searchByAcct) &#123;</span><br><span class="line">               url += <span class="string">&quot;?usrAcct=&quot;</span> + <span class="title function_">encodeUrl</span>(<span class="variable language_">this</span>.<span class="property">keyword</span>);</span><br><span class="line">            &#125;</span><br><span class="line">              <span class="keyword">var</span> params = &#123;</span><br><span class="line">                 <span class="attr">pagesize</span>: _this.<span class="property">pageInfo</span>.<span class="property">pagesize</span>,</span><br><span class="line">                 <span class="attr">pageno</span>: _this.<span class="property">pageInfo</span>.<span class="property">pageno</span></span><br><span class="line">              &#125;;</span><br><span class="line">              <span class="title function_">ajaxPost</span>(url,params).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">                 _this.<span class="property">datas</span> = data.<span class="property">datas</span>;</span><br><span class="line">               _this.<span class="property">pageInfo</span>.<span class="property">recordTotal</span> = data.<span class="property">recordTotal</span>;</span><br><span class="line">               _this.<span class="property">selectAll</span> = <span class="literal">false</span>;</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">exeDel</span>: <span class="keyword">function</span>(<span class="params">ids</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">var</span> url = <span class="string">&#x27;./mgrapi/user/del&#x27;</span>;</span><br><span class="line">              <span class="keyword">var</span> params = &#123;<span class="attr">ids</span>:ids&#125;;</span><br><span class="line">              <span class="title function_">ajaxPost</span>(url,params).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                 _this.<span class="title function_">loadData</span>();</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           </span><br><span class="line">           <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">           <span class="comment">///////////////////////////////////  默认方法  //////////////////////////////////////////</span></span><br><span class="line">           <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">           <span class="attr">onSelectAll</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              _this.<span class="property">selectAll</span> = !_this.<span class="property">selectAll</span>;</span><br><span class="line">              _this.<span class="property">datas</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                 obj.<span class="property">selected</span> = _this.<span class="property">selectAll</span>;</span><br><span class="line">              &#125;);</span><br><span class="line">              _this.<span class="property">datas</span> = _this.<span class="property">datas</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">onSelectOne</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">              obj.<span class="property">selected</span> = !obj.<span class="property">selected</span>;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">datas</span> = <span class="variable language_">this</span>.<span class="property">datas</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">isSelected</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(obj.<span class="property">selected</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">go</span>: <span class="keyword">function</span>(<span class="params">url,id</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(id)&#123;</span><br><span class="line">                 url = url.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;id&#125;&#x27;</span>,id);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = url;</span><br><span class="line">         &#125;,</span><br><span class="line">          <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 跳转到指定页</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; pageNo </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="attr">changePage</span>: <span class="keyword">function</span>(<span class="params">pageNo</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pageInfo</span>.<span class="property">pageno</span> = pageNo;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadData</span>();</span><br><span class="line">            &#125;,</span><br><span class="line">           <span class="attr">edit</span>: <span class="keyword">function</span>(<span class="params">url,id</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">                 <span class="keyword">var</span> datas = <span class="variable language_">this</span>.<span class="title function_">_getSelectedData</span>();</span><br><span class="line">                 <span class="keyword">if</span>(datas.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                     <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;请选择要操作的记录&#x27;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                 <span class="keyword">if</span>(datas.<span class="property">length</span>&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;只能选择一条记录&#x27;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">                 id = datas[<span class="number">0</span>].<span class="property">id</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              url = url.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;id&#125;&#x27;</span>,id);</span><br><span class="line">              <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = url;</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">del</span>: <span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">var</span> ids = [];</span><br><span class="line">              </span><br><span class="line">              <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">                 <span class="keyword">var</span> datas = <span class="variable language_">this</span>.<span class="title function_">_getSelectedData</span>();</span><br><span class="line">                  <span class="keyword">if</span>(datas.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                     <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;请选择要删除的记录&#x27;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  datas.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                     ids.<span class="title function_">push</span>(obj.<span class="property">id</span>);</span><br><span class="line">                  &#125;);</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 ids=[id];</span><br><span class="line">              &#125;</span><br><span class="line">              </span><br><span class="line">              <span class="title function_">showConfrim</span>(<span class="string">&#x27;确定要删除吗?&#x27;</span>).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                  _this.<span class="title function_">exeDel</span>(ids.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>));</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">_getSelectedData</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> res = [];</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">datas</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                 <span class="keyword">if</span>(obj.<span class="property">selected</span>)&#123;</span><br><span class="line">                    res.<span class="title function_">push</span>(obj);</span><br><span class="line">                 &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">              <span class="keyword">return</span> res;</span><br><span class="line">           &#125;,</span><br><span class="line">            <span class="title function_">onClickCacheAllBus</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新所有业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">var</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache/all&#x27;</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&quot;任务提交成功&quot;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">onClickCacheBus</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache?username=&#x27;</span> + obj.<span class="property">userName</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&#x27;操作成功&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">cacheAdmBus</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache/adm&#x27;</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&#x27;任务提交成功&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">template</span>: tpl</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>,<span class="built_in">exports</span>,<span class="variable language_">module</span></span>)&#123;</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-panel-top&quot;</span>);</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-tool-bars&quot;</span>);</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-table&quot;</span>);</span><br><span class="line">   <span class="keyword">var</span> tpl = <span class="built_in">require</span>(<span class="string">&#x27;./user-list.html&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">      <span class="attr">extends</span>: <span class="title class_">IICBaseTable</span>,</span><br><span class="line">      <span class="attr">props</span>: [],</span><br><span class="line">        <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">datas</span>: [],</span><br><span class="line">            <span class="attr">pageInfo</span>: &#123;</span><br><span class="line">               <span class="attr">pagesize</span>: <span class="number">10</span>,</span><br><span class="line">               <span class="attr">pageno</span>: <span class="number">1</span>,</span><br><span class="line">               <span class="attr">recordTotal</span>: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">               <span class="attr">typeId</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">selectAll</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">watch</span>: &#123;</span><br><span class="line">         <span class="string">&#x27;$route&#x27;</span>: <span class="string">&#x27;initCom&#x27;</span>,</span><br><span class="line">         <span class="attr">keyword</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">//删除了查找关键字，回到第一页数据</span></span><br><span class="line">            <span class="keyword">if</span> ( !<span class="variable language_">this</span>.<span class="property">keyword</span>.<span class="title function_">trim</span>() ) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">changePage</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;</span><br><span class="line">           <span class="attr">initCom</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">loadData</span>();</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="title function_">queryByAcct</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">keyword</span>.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">               <span class="title class_">Iic</span>.<span class="title function_">showMessage</span>(<span class="string">&quot;请输入用户账号&quot;</span>);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pageInfo</span>.<span class="property">pageno</span> = <span class="number">1</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadData</span>(<span class="literal">true</span>);</span><br><span class="line">         &#125;,</span><br><span class="line">           <span class="attr">loadData</span>: <span class="keyword">function</span>(<span class="params">searchByAcct</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">            <span class="keyword">var</span> url = <span class="string">&#x27;./mgrapi/user/user-list&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (searchByAcct) &#123;</span><br><span class="line">               url += <span class="string">&quot;?usrAcct=&quot;</span> + <span class="title function_">encodeUrl</span>(<span class="variable language_">this</span>.<span class="property">keyword</span>);</span><br><span class="line">            &#125;</span><br><span class="line">              <span class="keyword">var</span> params = &#123;</span><br><span class="line">                 <span class="attr">pagesize</span>: _this.<span class="property">pageInfo</span>.<span class="property">pagesize</span>,</span><br><span class="line">                 <span class="attr">pageno</span>: _this.<span class="property">pageInfo</span>.<span class="property">pageno</span></span><br><span class="line">              &#125;;</span><br><span class="line">              <span class="title function_">ajaxPost</span>(url,params).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">                 _this.<span class="property">datas</span> = data.<span class="property">datas</span>;</span><br><span class="line">               _this.<span class="property">pageInfo</span>.<span class="property">recordTotal</span> = data.<span class="property">recordTotal</span>;</span><br><span class="line">               _this.<span class="property">selectAll</span> = <span class="literal">false</span>;</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">exeDel</span>: <span class="keyword">function</span>(<span class="params">ids</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">var</span> url = <span class="string">&#x27;./mgrapi/user/del&#x27;</span>;</span><br><span class="line">              <span class="keyword">var</span> params = &#123;<span class="attr">ids</span>:ids&#125;;</span><br><span class="line">              <span class="title function_">ajaxPost</span>(url,params).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                 _this.<span class="title function_">loadData</span>();</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           </span><br><span class="line">           <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">           <span class="comment">///////////////////////////////////  默认方法  //////////////////////////////////////////</span></span><br><span class="line">           <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">           <span class="attr">onSelectAll</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              _this.<span class="property">selectAll</span> = !_this.<span class="property">selectAll</span>;</span><br><span class="line">              _this.<span class="property">datas</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                 obj.<span class="property">selected</span> = _this.<span class="property">selectAll</span>;</span><br><span class="line">              &#125;);</span><br><span class="line">              _this.<span class="property">datas</span> = _this.<span class="property">datas</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">onSelectOne</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">              obj.<span class="property">selected</span> = !obj.<span class="property">selected</span>;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">datas</span> = <span class="variable language_">this</span>.<span class="property">datas</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">isSelected</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(obj.<span class="property">selected</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">go</span>: <span class="keyword">function</span>(<span class="params">url,id</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(id)&#123;</span><br><span class="line">                 url = url.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;id&#125;&#x27;</span>,id);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = url;</span><br><span class="line">         &#125;,</span><br><span class="line">          <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 跳转到指定页</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; pageNo </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="attr">changePage</span>: <span class="keyword">function</span>(<span class="params">pageNo</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pageInfo</span>.<span class="property">pageno</span> = pageNo;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadData</span>();</span><br><span class="line">            &#125;,</span><br><span class="line">           <span class="attr">edit</span>: <span class="keyword">function</span>(<span class="params">url,id</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">                 <span class="keyword">var</span> datas = <span class="variable language_">this</span>.<span class="title function_">_getSelectedData</span>();</span><br><span class="line">                 <span class="keyword">if</span>(datas.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                     <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;请选择要操作的记录&#x27;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                 <span class="keyword">if</span>(datas.<span class="property">length</span>&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;只能选择一条记录&#x27;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">                 id = datas[<span class="number">0</span>].<span class="property">id</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              url = url.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;id&#125;&#x27;</span>,id);</span><br><span class="line">              <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = url;</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">del</span>: <span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">var</span> ids = [];</span><br><span class="line">              </span><br><span class="line">              <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">                 <span class="keyword">var</span> datas = <span class="variable language_">this</span>.<span class="title function_">_getSelectedData</span>();</span><br><span class="line">                  <span class="keyword">if</span>(datas.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                     <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;请选择要删除的记录&#x27;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  datas.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                     ids.<span class="title function_">push</span>(obj.<span class="property">id</span>);</span><br><span class="line">                  &#125;);</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 ids=[id];</span><br><span class="line">              &#125;</span><br><span class="line">              </span><br><span class="line">              <span class="title function_">showConfrim</span>(<span class="string">&#x27;确定要删除吗?&#x27;</span>).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                  _this.<span class="title function_">exeDel</span>(ids.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>));</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">_getSelectedData</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> res = [];</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">datas</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                 <span class="keyword">if</span>(obj.<span class="property">selected</span>)&#123;</span><br><span class="line">                    res.<span class="title function_">push</span>(obj);</span><br><span class="line">                 &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">              <span class="keyword">return</span> res;</span><br><span class="line">           &#125;,</span><br><span class="line">            <span class="title function_">onClickCacheAllBus</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新所有业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">var</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache/all&#x27;</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&quot;任务提交成功&quot;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">onClickCacheBus</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache?username=&#x27;</span> + obj.<span class="property">userName</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&#x27;操作成功&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">cacheAdmBus</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache/adm&#x27;</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&#x27;任务提交成功&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">template</span>: tpl</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="6-4-MgrUserController"><a href="#6-4-MgrUserController" class="headerlink" title="6.4 MgrUserController"></a>6.4 MgrUserController</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.controller.JsonResult;</span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.exception.BusException;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.ListPageVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.MgrBaseController;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.model.RoleVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.model.UserVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.service.IMgrUserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/mgrapi/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MgrUserController</span> <span class="keyword">extends</span> <span class="title class_">MgrBaseController</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(MgrUserController.class);</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IMgrUserService iMgrUserService;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;读取用户列表&quot;, notes = &quot;读取用户列表&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/user-list&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">loadUserList</span><span class="params">(Integer pagesize, Integer pageno, String usrAcct)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         ListPageVo&lt;UserVo&gt; vo = iMgrUserService.loadUserList(pagesize, pageno, usrAcct);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(vo, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;添加用户&quot;, notes = &quot;添加用户&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/add&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">add</span><span class="params">(UserVo vo)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         iMgrUserService.addUser(vo);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;读取用户详细信息&quot;, notes = &quot;读取用户详细信息&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/detail&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">loadUserDetail</span><span class="params">(String id)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="type">UserVo</span> <span class="variable">vo</span> <span class="operator">=</span> iMgrUserService.loadUserDetail(id);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(vo,<span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;读取所有角色&quot;, notes = &quot;读取所有角色&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/load-all-user-role&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">loadAllUserRole</span><span class="params">(String userId)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         List&lt;RoleVo&gt; datas = iMgrUserService.loadAllUserRole(userId);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(datas, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;修改用户角色&quot;, notes = &quot;修改用户角色&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update-user-role&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">updateUserRole</span><span class="params">(String userId, String roles)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         iMgrUserService.updateUserRole(userId, roles);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;删除用户&quot;, notes = &quot;删除用户&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/del&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">deleteUser</span><span class="params">(String ids)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         iMgrUserService.deleteUser(ids);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;修改用户&quot;, notes = &quot;修改用户&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update-user&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">updateUser</span><span class="params">(UserVo vo)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         iMgrUserService.updateUser(vo);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//将某用户的标识业务id接入redis</span></span><br><span class="line">   <span class="meta">@PostMapping(path = &quot;/bus/cache&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">cacheBus</span><span class="params">(<span class="meta">@RequestParam</span> String username)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            iMgrUserService.cacheBus(username);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BusException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将admin的标识业务id接入redis</span></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/bus/cache/adm&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">cacheAllBusForAdm</span><span class="params">()</span>&#123;</span><br><span class="line">        iMgrUserService.cacheAdmBus();</span><br><span class="line">        <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将所有非admin用户的标识业务id接入redis</span></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/bus/cache/all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">cacheAllBus</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            iMgrUserService.cacheAllBus();</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BusException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-5-IMgrUserService"><a href="#6-5-IMgrUserService" class="headerlink" title="6.5 IMgrUserService"></a>6.5 IMgrUserService</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.exception.BusException;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.ListPageVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.model.RoleVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.model.UserVo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IMgrUserService</span></span><br></pre></td></tr></table></figure>

<h2 id="6-6-MgrUserServiceImpl"><a href="#6-6-MgrUserServiceImpl" class="headerlink" title="6.6 MgrUserServiceImpl"></a>6.6 MgrUserServiceImpl</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MgrUserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IMgrUserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">LOG</span> <span class="operator">=</span> LogFactory.getLog(MgrUserServiceImpl.class);</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssUserTeUserService iGdssUserTeUserService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssUserTsUserCompanyService iGdssUserTsUserCompanyService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IGdssUserTeCompanyService iGdssUserTeCompanyService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssCfgTeConfigService iGdssCfgTeConfigService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssAuthTeRoleService iGdssAuthTeRoleService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssAuthTsUserRoleService iGdssAuthTsUserRoleService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISecService iSecService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ICfgService iCfgService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor threadPoolExecutor;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IGdssSecTeKeyService iGdssSecTeKeyService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IGdssBusTeApiBusinessService iGdssBusTeApiBusinessService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IGdssStatTeHistoryAmountsDayMwService iGdssStatTeHistoryAmountsDayMwService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ListPageVo&lt;UserVo&gt; <span class="title function_">loadUserList</span><span class="params">(Integer pagesize, Integer pageno, String usrAcct)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="type">GdssUserTeUser</span> <span class="variable">params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTeUser</span>();</span><br><span class="line">      params.setOrderBy(<span class="string">&quot; CREATE_TIME DESC&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (!StringUtil.isEmpty(usrAcct))&#123;</span><br><span class="line">         params.setUserName(usrAcct);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      List&lt;GdssUserTeUser&gt; ls = iGdssUserTeUserService.searchEntity(params, pagesize, pageno);</span><br><span class="line">      </span><br><span class="line">      List&lt;UserVo&gt; datas = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;UserVo&gt;();</span><br><span class="line">      <span class="keyword">for</span>(GdssUserTeUser user : ls)&#123;</span><br><span class="line">         <span class="type">UserVo</span> <span class="variable">v</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVo</span>();</span><br><span class="line">         v.setId(user.getId());</span><br><span class="line">         v.setUserName(StringUtil.trim(user.getUserName()));</span><br><span class="line">         v.setNickname(StringUtil.trim(user.getNickname()));</span><br><span class="line">         v.setStatus(user.getStatus());</span><br><span class="line">         <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> v.getUserName();</span><br><span class="line">         v.setLanguage(<span class="built_in">this</span>.getLan(username));</span><br><span class="line"></span><br><span class="line">         v.setMobile(StringUtil.trim(user.getMobile()));</span><br><span class="line">         v.setEmail(StringUtil.trim(user.getEmail()));</span><br><span class="line">         v.setAuthMobile(user.getAuthMobile());</span><br><span class="line">         v.setAuthEmail(user.getAuthEmail());</span><br><span class="line">         v.setCreateTime(user.getCreateTime());</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//读取用户角色</span></span><br><span class="line">         List&lt;GdssAuthTeRoleDao&gt; roles = iGdssAuthTeRoleService.searchUserRoleByUserId(user.getId());</span><br><span class="line">         List&lt;String&gt; roleCodes = roles.stream().map(item -&gt; item.getCode()).collect(Collectors.toList());</span><br><span class="line">         List&lt;String&gt; roleNames = roles.stream().map(item -&gt; item.getName()).collect(Collectors.toList());</span><br><span class="line">         v.setRoleCodes(roleCodes);</span><br><span class="line">         v.setRoleNames(roleNames);</span><br><span class="line">         </span><br><span class="line">         datas.add(v);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="type">int</span> <span class="variable">recordTotal</span> <span class="operator">=</span> iGdssUserTeUserService.count(params);</span><br><span class="line">      <span class="comment">//绑定接入状态</span></span><br><span class="line">        bindAccessStatus(datas);</span><br><span class="line">      <span class="keyword">return</span> ListPageVo.create(datas, recordTotal);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span>  String <span class="title function_">getLan</span><span class="params">(String username)</span>&#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> username.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      String[] lanArr = <span class="string">&quot;Java,C++,Java,Java,C#,Java,PHP,Java,Java,Go,C++,Java,Java,Java,Java,Node.js,Java&quot;</span>.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (index &gt; <span class="number">0</span>)&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> username.substring(index+<span class="number">1</span>);</span><br><span class="line">         <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ToolUtil.parseInt(suffix,<span class="number">0</span>) % lanArr.length;</span><br><span class="line">         <span class="type">String</span> <span class="variable">lan</span> <span class="operator">=</span> lanArr[count];</span><br><span class="line">         <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.251&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.288&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.200&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;C#&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.313&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.263&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;PHP&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.352&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;C++&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> lan;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span>  <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//绑定接入状态</span></span><br><span class="line">   <span class="keyword">private</span> List&lt;UserVo&gt; <span class="title function_">bindAccessStatus</span><span class="params">(List&lt;UserVo&gt; datas)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">       <span class="keyword">if</span> (datas == <span class="literal">null</span> || datas.isEmpty()) <span class="keyword">return</span> datas;</span><br><span class="line"></span><br><span class="line">       Set&lt;String&gt; userIds = datas.stream().map(item -&gt; item.getId()).collect(Collectors.toSet());</span><br><span class="line">       <span class="comment">//查询关联企业</span></span><br><span class="line">        <span class="type">GdssUserTsUserCompany</span> <span class="variable">tsParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTsUserCompany</span>();</span><br><span class="line">        tsParam.setUserIdIn(userIds);</span><br><span class="line">        List&lt;GdssUserTsUserCompany&gt; tsList = iGdssUserTsUserCompanyService.searchEntity(tsParam, <span class="number">10_000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (tsList == <span class="literal">null</span> || tsList.isEmpty()) <span class="keyword">return</span> datas;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; companyIds = tsList.stream().map(item -&gt; item.getCompanyId()).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//查前缀</span></span><br><span class="line">        <span class="type">GdssUserTeCompany</span> <span class="variable">companyParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTeCompany</span>();</span><br><span class="line">        companyParam.setIdIn(companyIds);</span><br><span class="line">        List&lt;GdssUserTeCompany&gt; companyList = iGdssUserTeCompanyService.searchEntity(companyParam, <span class="number">10_000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (companyList == <span class="literal">null</span> || companyList.isEmpty()) <span class="keyword">return</span> datas;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; userTsMwCodeMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Set&lt;String&gt; allMwCodes = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="type">String</span> <span class="variable">appEnv</span> <span class="operator">=</span> SpringUtil.getEnvironment();</span><br><span class="line">        <span class="keyword">for</span> (UserVo userVo : datas) &#123;</span><br><span class="line">            List&lt;String&gt; companyIdList = tsList.stream().filter(item -&gt; item.getUserId().equals( userVo.getId() ))</span><br><span class="line">                    .map(item -&gt; item.getCompanyId()).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//筛选前缀</span></span><br><span class="line">            List&lt;String&gt; mwCodes = companyList.stream().filter(item -&gt; companyIdList.contains( item.getId() ))</span><br><span class="line">                    .map(item -&gt; HandleUtil.getMwCodeByPrefix(item.getHandle(), appEnv)).collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">if</span> ( !mwCodes.isEmpty() )&#123;</span><br><span class="line">                userTsMwCodeMap.put(userVo.getId(), mwCodes);</span><br><span class="line">                allMwCodes.addAll(mwCodes);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查统计信息</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">now</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        <span class="type">GdssStatTeHistoryAmountsDayMw</span> <span class="variable">statParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssStatTeHistoryAmountsDayMw</span>();</span><br><span class="line">        statParam.setYearer( now.get(Calendar.YEAR) );</span><br><span class="line">        statParam.setMonther( now.get(Calendar.MONTH) + <span class="number">1</span> );</span><br><span class="line">        statParam.setDateer( now.get(Calendar.DAY_OF_MONTH) );</span><br><span class="line">        statParam.setMwCodeIn(allMwCodes);</span><br><span class="line">        List&lt;GdssStatTeHistoryAmountsDayMw&gt; statList = iGdssStatTeHistoryAmountsDayMwService.searchEntity(statParam, <span class="number">10_000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (statList == <span class="literal">null</span> || statList.isEmpty()) <span class="keyword">return</span> datas;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (UserVo userVo : datas) &#123;</span><br><span class="line">            List&lt;String&gt; userMwCodes = userTsMwCodeMap.get( userVo.getId() );</span><br><span class="line">            <span class="keyword">if</span> (userMwCodes == <span class="literal">null</span> || userMwCodes.isEmpty()) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            List&lt;GdssStatTeHistoryAmountsDayMw&gt; tempStat = statList.stream().filter(item -&gt; userMwCodes.contains( item.getMwCode() )).collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">if</span> ( tempStat.isEmpty() ) <span class="keyword">continue</span>;</span><br><span class="line">            userVo.setAccessStatus(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> datas;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(UserVo vo)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 判断账号是否重复</span></span><br><span class="line">      <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> iGdssUserTeUserService.isRepeatUserName(vo.getUserName());</span><br><span class="line">      <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;00400013&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 从配置中心读取用户默认密码</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="built_in">this</span>.readDefaultPwd();</span><br><span class="line">      pwd = Base64Util.String2SHA256(pwd);</span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 创建用户</span></span><br><span class="line">      <span class="type">GdssUserTeUser</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTeUser</span>();</span><br><span class="line">      BeanUtils.copyProperties(vo, user);</span><br><span class="line"></span><br><span class="line">      user.setUserName(StringUtil.trim(user.getUserName()));</span><br><span class="line">      user.setMobile(StringUtil.trim(user.getMobile()));</span><br><span class="line">      user.setEmail(StringUtil.trim(user.getEmail()));</span><br><span class="line">      user.setNickname(StringUtil.trim(user.getNickname()));</span><br><span class="line">      user.setPwd(pwd);</span><br><span class="line">      user.setStatus(GdssUserTeUser.Info.STATUS_VALID);</span><br><span class="line">      user.setAuthMobile(<span class="number">0</span>);</span><br><span class="line">      user.setAuthEmail(<span class="number">0</span>);</span><br><span class="line">      user.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        user.setAlteredPwd( (<span class="type">byte</span>)<span class="number">0</span> );</span><br><span class="line">      user.setId( UUID.getUUID() );</span><br><span class="line">      </span><br><span class="line">      iGdssUserTeUserService.addEntity(user);</span><br><span class="line">      <span class="comment">//如果是系统管理员,则默认分配系统管理员角色</span></span><br><span class="line">      <span class="keyword">if</span>(user.getType()==GdssUserTeUser.Info.TYPE_SYSTEM)&#123;</span><br><span class="line">         <span class="type">GdssAuthTeRoleDao</span> <span class="variable">role</span> <span class="operator">=</span> iGdssAuthTeRoleService.getEntityByCode(<span class="string">&quot;system&quot;</span>);</span><br><span class="line">         <span class="type">GdssAuthTsUserRole</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssAuthTsUserRole</span>();</span><br><span class="line">         r.setRoleId(role.getId());</span><br><span class="line">         r.setUserId(user.getId());</span><br><span class="line">         iGdssAuthTsUserRoleService.addEntity(r);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//如果是一般用户，默认分配一般用户角色</span></span><br><span class="line">      <span class="keyword">if</span>(user.getType()==GdssUserTeUser.Info.TYPE_COMMON)&#123;</span><br><span class="line">         <span class="type">GdssAuthTeRoleDao</span> <span class="variable">role</span> <span class="operator">=</span> iGdssAuthTeRoleService.getEntityByCode(<span class="string">&quot;common&quot;</span>);</span><br><span class="line">         <span class="type">GdssAuthTsUserRole</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssAuthTsUserRole</span>();</span><br><span class="line">         r.setRoleId(role.getId());</span><br><span class="line">         r.setUserId(user.getId());</span><br><span class="line">         iGdssAuthTsUserRoleService.addEntity(r);</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span> 创建用户密钥</span></span><br><span class="line">        iSecService.createUserKeyPair(vo.getUserName(), user.getId());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> UserVo <span class="title function_">loadUserDetail</span><span class="params">(String id)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">GdssUserTeUser</span> <span class="variable">user</span> <span class="operator">=</span> iGdssUserTeUserService.getEntityById(id);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//读取用户账号关联的角色</span></span><br><span class="line">      List&lt;GdssAuthTeRoleDao&gt; roles = iGdssAuthTeRoleService.searchUserRoleByUserId(id);</span><br><span class="line">      List&lt;String&gt; roleCodes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt; (roles.size() );</span><br><span class="line">      List&lt;String&gt; roleNames = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;( roles.size() );</span><br><span class="line">      <span class="keyword">for</span>(GdssAuthTeRoleDao role : roles)&#123;</span><br><span class="line">         roleCodes.add(role.getCode());</span><br><span class="line">         roleNames.add(role.getName());</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="type">UserVo</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(user, vo);</span><br><span class="line">      vo.setRoleCodes(roleCodes);</span><br><span class="line">      vo.setRoleNames(roleNames);</span><br><span class="line">      <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> vo.getUserName();</span><br><span class="line">      vo.setLanguage(<span class="built_in">this</span>.getLan(username));</span><br><span class="line">      <span class="comment">//绑定</span></span><br><span class="line">        bindAccessStatus( Arrays.asList(vo) );</span><br><span class="line">      <span class="keyword">return</span> vo;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;RoleVo&gt; <span class="title function_">loadAllUserRole</span><span class="params">(String userId)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">GdssAuthTeRoleDao</span> <span class="variable">params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssAuthTeRoleDao</span>();</span><br><span class="line">      params.setOrderBy(<span class="string">&quot; CODE ASC&quot;</span>);</span><br><span class="line">      List&lt;GdssAuthTeRoleDao&gt; all = iGdssAuthTeRoleService.searchEntity(params,<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      </span><br><span class="line">      List&lt;GdssAuthTsUserRole&gt; roles = iGdssAuthTsUserRoleService.searchByUserId(userId);</span><br><span class="line">      </span><br><span class="line">      List&lt;RoleVo&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;RoleVo&gt;();</span><br><span class="line">      <span class="keyword">for</span>(GdssAuthTeRoleDao role : all)&#123;</span><br><span class="line">         <span class="type">RoleVo</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleVo</span>();</span><br><span class="line">         vo.setId(role.getId());</span><br><span class="line">         vo.setCode(role.getCode());</span><br><span class="line">         vo.setName(role.getName());</span><br><span class="line">         vo.setRemark(role.getRemark());</span><br><span class="line">         </span><br><span class="line">         <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">         <span class="keyword">for</span>(GdssAuthTsUserRole r : roles)&#123;</span><br><span class="line">            <span class="keyword">if</span>(r.getRoleId().equals(role.getId()))&#123;</span><br><span class="line">               flag = <span class="literal">true</span>;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            vo.setAuth(RoleVo.Info.AUTH_YES);</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            vo.setAuth(RoleVo.Info.AUTH_NO);</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         res.add(vo);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUserRole</span><span class="params">(String userId, String roles)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 删除账号所有角色</span></span><br><span class="line">      iGdssAuthTsUserRoleService.deleteByUserId(userId);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 添加关联的角色</span></span><br><span class="line">      String[] roleIds = roles.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;roleIds.length;i++)&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">roleId</span> <span class="operator">=</span> roleIds[i];</span><br><span class="line">         <span class="type">GdssAuthTsUserRole</span> <span class="variable">role</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssAuthTsUserRole</span>();</span><br><span class="line">         role.setUserId(userId);</span><br><span class="line">         role.setRoleId(roleId);</span><br><span class="line">         iGdssAuthTsUserRoleService.addEntity(role);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(String ids)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      String[] idArg = ids.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="comment">//如果包含超级管理员，则报错</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;idArg.length;i++)&#123;</span><br><span class="line">         <span class="keyword">if</span>(GdssUserTeUser.ID_ADMIN.equals(idArg[i]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;00400022&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> idArg[i];</span><br><span class="line">         List&lt;GdssUserTsUserCompany&gt; list = iGdssUserTsUserCompanyService.searchByUserId(id);</span><br><span class="line">         <span class="keyword">if</span>(list!=<span class="literal">null</span>&amp;&amp;list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;00430010&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;idArg.length;i++)&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> idArg[i];</span><br><span class="line">         <span class="comment">//删除相关的角色关系</span></span><br><span class="line">         iGdssAuthTsUserRoleService.deleteByUserId(id);</span><br><span class="line">            <span class="type">GdssUserTeUser</span> <span class="variable">thisUser</span> <span class="operator">=</span> iGdssUserTeUserService.getEntityById(id);</span><br><span class="line">         <span class="comment">//删除用户</span></span><br><span class="line">         iGdssUserTeUserService.delEntityById(id, <span class="literal">null</span>);</span><br><span class="line">         <span class="keyword">if</span> (thisUser != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//删除企业的密钥</span></span><br><span class="line">                iGdssSecTeKeyService.deleteByUsername(thisUser.getUserName());</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(UserVo vo)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">GdssUserTeUser</span> <span class="variable">user</span> <span class="operator">=</span> iGdssUserTeUserService.getEntityById(vo.getId());</span><br><span class="line">      <span class="keyword">if</span>(user==<span class="literal">null</span>)&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;00000005&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      user.setNickname(StringUtil.trim(vo.getNickname()));</span><br><span class="line">      user.setMobile(StringUtil.trim(vo.getMobile()));</span><br><span class="line">      user.setEmail(StringUtil.trim(vo.getEmail()));</span><br><span class="line">      user.setAuditPower( vo.getAuditPower() );</span><br><span class="line">      iGdssUserTeUserService.updateEntityById(user, user.getId(), user.getId());</span><br><span class="line">      </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String <span class="title function_">readDefaultPwd</span><span class="params">()</span> <span class="keyword">throws</span> BusException&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">cfgCode</span> <span class="operator">=</span> <span class="string">&quot;SSP_USER_DEFAULT_PWD&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> iCfgService.getCfgString(cfgCode);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtil.isEmpty(pwd))&#123;</span><br><span class="line">            <span class="keyword">return</span> pwd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">GdssCfgTeConfig</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssCfgTeConfig</span>();</span><br><span class="line">        cfg.setCode(cfgCode);</span><br><span class="line">        cfg.setCfgValue(<span class="string">&quot;gdxx688&quot;</span>);</span><br><span class="line">        cfg.setRemark(<span class="string">&quot;用户默认密码&quot;</span>);</span><br><span class="line">        cfg = iGdssCfgTeConfigService.addEntity(cfg);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> cfg.getCfgValue();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheBus</span><span class="params">(String username)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">       <span class="keyword">if</span> (GdssUserTeUser.Info.ADM_USERNAME.equals(username))&#123;</span><br><span class="line">           threadPoolExecutor.submit(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cacheBusByUser(username);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BusException e) &#123; LOG.error(<span class="string">&quot;&quot;</span>, e); &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cacheBusByUser(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cacheBusByUser</span><span class="params">(String username)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">       <span class="keyword">if</span> ( ToolUtil.isNull(username) ) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">       Map&lt;String, List&lt;String&gt;&gt; codeKeyMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        codeKeyMap.put(GdssBusTeApiBusiness.Info.CACHE_BUS_API2_CREATE_PREFIX, Arrays.asList(ApiCodeEnum.CREATE_IDENTIFIER.name()));</span><br><span class="line">        codeKeyMap.put(GdssBusTeApiBusiness.Info.CACHE_BUS_API2_MODIFY_PREFIX, Arrays.asList(ApiCodeEnum.ADD_IDENTIFIER_ATTR.name(), ApiCodeEnum.MODIFY_IDENTIFIER_ATTR.name(), ApiCodeEnum.REMOVE_IDENTIFIER_ATTR.name()) );</span><br><span class="line">        codeKeyMap.put(GdssBusTeApiBusiness.Info.CACHE_BUS_API2_DEL_PREFIX, Arrays.asList(ApiCodeEnum.REMOVE_IDENTIFIER.name()) );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;String&gt;&gt; entry : codeKeyMap.entrySet()) &#123;</span><br><span class="line">            List&lt;String&gt; codes = entry.getValue();</span><br><span class="line">            <span class="type">GdssBusTeApiBusiness</span> <span class="variable">param</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssBusTeApiBusiness</span>();</span><br><span class="line">            param.setUsername(username);</span><br><span class="line">            param.setApiCodeList(codes);</span><br><span class="line">            param.setOrderBy(<span class="string">&quot;CREATE_TIME desc&quot;</span>);</span><br><span class="line">            List&lt;GdssBusTeApiBusiness&gt; businessesList = iGdssBusTeApiBusinessService.searchEntity(param, GdssBusTeApiBusiness.Info.BUS_API_CACHE_LIMIT, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (businessesList == <span class="literal">null</span> || businessesList.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey() + username;</span><br><span class="line">            List&lt;List&lt;String&gt;&gt; idHandleList = businessesList.stream().map(item -&gt; Arrays.asList(item.getId(), item.getHandle())).collect(Collectors.toList());</span><br><span class="line">            saveBusToRedis(key, idHandleList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveBusToRedis</span><span class="params">(String key, List&lt;List&lt;String&gt;&gt; cacheList)</span>&#123;</span><br><span class="line">        redisTemplate.execute(<span class="keyword">new</span> <span class="title class_">SessionCallback</span>&lt;List&lt;Object&gt;&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">execute</span><span class="params">(RedisOperations operations)</span> <span class="keyword">throws</span> DataAccessException &#123;</span><br><span class="line">                operations.multi();</span><br><span class="line">                operations.delete(key);</span><br><span class="line">                <span class="keyword">if</span> ( !cacheList.isEmpty() )&#123;</span><br><span class="line">                    operations.opsForList().rightPushAll(key, cacheList);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> operations.exec();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheAdmBus</span><span class="params">()</span> &#123;</span><br><span class="line">       threadPoolExecutor.submit(() -&gt; &#123;</span><br><span class="line">           <span class="comment">//admin成功</span></span><br><span class="line">            <span class="type">GdssBusTeApiBusiness</span> <span class="variable">param</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssBusTeApiBusiness</span>();</span><br><span class="line">            param.setResult(ApiBusinessInstance.Info.RESULT_SUCCESS);</span><br><span class="line">            param.setOrderBy(<span class="string">&quot;CREATE_TIME desc&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                List&lt;GdssBusTeApiBusiness&gt; businessesList = iGdssBusTeApiBusinessService.searchEntity(param, GdssBusTeApiBusiness.Info.BUS_API_CACHE_LIMIT, <span class="number">1</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> GdssBusTeApiBusiness.Info.CACHE_BUS_API2_SUC_PREFIX + GdssUserTeUser.Info.ADM_USERNAME;</span><br><span class="line">                cacheAdminBusToRedis(businessesList, key);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">                LOG.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//admin错误业务</span></span><br><span class="line">            param.setResult(ApiBusinessInstance.Info.RESULT_FAILURE);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                List&lt;GdssBusTeApiBusiness&gt; businessesList = iGdssBusTeApiBusinessService.searchEntity(param, GdssBusTeApiBusiness.Info.BUS_API_CACHE_LIMIT, <span class="number">1</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> GdssBusTeApiBusiness.Info.CACHE_BUS_API2_ERROR_PREFIX + GdssUserTeUser.Info.ADM_USERNAME;</span><br><span class="line">                cacheAdminBusToRedis(businessesList, key);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">                LOG.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cacheAdminBusToRedis</span><span class="params">(List&lt;GdssBusTeApiBusiness&gt; businessesList, String key)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (businessesList != <span class="literal">null</span> &amp;&amp; !businessesList.isEmpty())&#123;</span><br><span class="line">            List&lt;List&lt;String&gt;&gt; idHandleList = businessesList.stream().map(item -&gt; Arrays.asList(item.getId(), item.getHandle())).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//先push，再清除</span></span><br><span class="line">            saveBusToRedis(key, idHandleList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheAllBus</span><span class="params">()</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">        <span class="comment">//查所有开通普通用户</span></span><br><span class="line">        <span class="type">GdssUserTeUser</span> <span class="variable">param</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTeUser</span>();</span><br><span class="line">        param.setType(GdssUserTeUser.Info.TYPE_COMMON);</span><br><span class="line">        param.setStatus(GdssUserTeUser.Info.STATUS_VALID);</span><br><span class="line">        List&lt;GdssUserTeUser&gt; userList = iGdssUserTeUserService.searchEntity(param, <span class="number">10_000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (userList == <span class="literal">null</span> || userList.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        threadPoolExecutor.submit(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (GdssUserTeUser user : userList) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cacheBusByUser( user.getUserName() );</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ex)&#123; LOG.error(<span class="string">&quot;&quot;</span>, ex); &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-7-IGdssUserTeUserService"><a href="#6-7-IGdssUserTeUserService" class="headerlink" title="6.7 IGdssUserTeUserService"></a>6.7 IGdssUserTeUserService</h2><p>usercenter-dao-service  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.user.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGdssUserTeUserService</span> <span class="keyword">extends</span> <span class="title class_">ILllDbRedisBaseService</span>&lt;GdssUserTeUser&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-8-GdssUserTeUserServiceImpl"><a href="#6-8-GdssUserTeUserServiceImpl" class="headerlink" title="6.8 GdssUserTeUserServiceImpl"></a>6.8 GdssUserTeUserServiceImpl</h2><p>usercenter-dao-service-impl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.user.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GdssUserTeUserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IGdssUserTeUserService</span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> IGdssUserTeUserMapper iGdssUserTeUserMapper;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6-9-IGdssUserTeUserMapper"><a href="#6-9-IGdssUserTeUserMapper" class="headerlink" title="6.9 IGdssUserTeUserMapper"></a>6.9 IGdssUserTeUserMapper</h2><p>usercenter-dao-mapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.user.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGdssUserTeUserMapper</span> <span class="keyword">extends</span> <span class="title class_">ILllBaseMapper</span>&lt;GdssUserTeUser&gt;</span><br></pre></td></tr></table></figure>



<h2 id="6-10-mybatis-GdssUserTeUser-xml"><a href="#6-10-mybatis-GdssUserTeUser-xml" class="headerlink" title="6.10 mybatis-GdssUserTeUser.xml"></a>6.10 mybatis-GdssUserTeUser.xml</h2><p>usercenter-dao-resource</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;cn.lll.iic.user.mapper.IGdssUserTeUserMapper&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;GdssUserTeUserMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;cn.lll.iic.user.model.GdssUserTeUser&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/24/filecenter/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/24/filecenter/" class="post-title-link" itemprop="url">filecenter</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-25 09:19:51" itemprop="dateCreated datePublished" datetime="2022-04-25T09:19:51+08:00">2022-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 15:26:20" itemprop="dateModified" datetime="2022-11-29T15:26:20+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>21k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>19 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-杂记"><a href="#1-杂记" class="headerlink" title="1. 杂记"></a>1. 杂记</h1><p>SSP: self-service platform<br>IDR: 标识解析展现 ID Read<br>API: </p>
<p>FileCenter</p>
<p>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</p>
<p>handle是通信协议</p>
<p>公共：上传-&gt;重新命名uuid 路径固定<br>加密：无法通过url直接访问，没有密码只是乱码<br>自定义：admin可以改路径 年月日uuid.jpg<br>临时：每天12点清空</p>
<p>有时，上传时，先去临时，再去公告&#x2F;加密<br>选择文件后，已经去服务器了</p>
<p>&#x2F;&#x2F;<br>uploadFile<br>&#x2F;&#x2F;按钮：选择加密或不加密 传到不同的区域 默认<br>全部传到公共区域,不考虑上传到自定义页面</p>
<p>1.控制上传文件的类型 图片&#x2F;视频&#x2F;文档<br>2.调filecenter时 需要先申请令牌？</p>
<p>文件中心是一个服务 下属多个服务器</p>
<p>&#x2F;&#x2F;<br>iic-table 实现了watch searchParams</p>
<h1 id="2-filecenter"><a href="#2-filecenter" class="headerlink" title="2. filecenter"></a>2. filecenter</h1><h2 id="2-1-iic-file-api"><a href="#2-1-iic-file-api" class="headerlink" title="2.1 iic-file-api"></a>2.1 iic-file-api</h2><p>api中的功能，调用web来实现</p>
<h3 id="2-1-1-proxy"><a href="#2-1-1-proxy" class="headerlink" title="2.1.1 proxy"></a>2.1.1 proxy</h3><h4 id="2-1-1-1-LllFileV2"><a href="#2-1-1-1-LllFileV2" class="headerlink" title="2.1.1.1 LllFileV2"></a>2.1.1.1 LllFileV2</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LllFileV2</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">TYPE_COMMON</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">TYPE_SECRET</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">TYPE_TEMP</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String fileId;</span><br><span class="line">   <span class="keyword">private</span> String userId;</span><br><span class="line">   <span class="keyword">private</span> Integer type;        <span class="comment">//COMMON,SECRET,TEMP</span></span><br><span class="line">   <span class="keyword">private</span> Date createTime;</span><br><span class="line">   <span class="keyword">private</span> String fileName;      <span class="comment">//文件名(包含后缀)</span></span><br><span class="line">   <span class="keyword">private</span> String savePath;      <span class="comment">//文件保存路径   (不包含文件名)</span></span><br><span class="line">   <span class="keyword">private</span> String fileSuffix;    <span class="comment">//文件后缀</span></span><br><span class="line">   <span class="keyword">private</span> String oldName;          <span class="comment">//文件原名</span></span><br><span class="line">   <span class="keyword">private</span> String url;             <span class="comment">//完整的URL访问地址(包含Https)</span></span><br><span class="line">   <span class="keyword">private</span> String secKey;       <span class="comment">//SM4密钥</span></span><br><span class="line">   <span class="keyword">private</span> String hash;         <span class="comment">//文件的Hash值</span></span><br><span class="line">   <span class="keyword">private</span> String appName;          <span class="comment">//系统账号名称,如：IIC</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">byte</span>[] cont;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> LllFileV2 <span class="title function_">create</span><span class="params">(JsonObject data)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="type">LllFileV2</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LllFileV2</span>();</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">_fileId</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;fileId&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_userId</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;userId&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_type</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;type&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_createTime</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;createTime&quot;</span>);</span><br><span class="line">      <span class="type">Date</span> <span class="variable">_time</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span>(!ToolUtil.isNull(_createTime)) &#123;</span><br><span class="line">         _time = <span class="keyword">new</span> <span class="title class_">Date</span>(Long.valueOf(_createTime));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">String</span> <span class="variable">_fileName</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;fileName&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_savePath</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;savePath&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_fileSuffix</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;fileSuffix&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_oldName</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;oldName&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_url</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;url&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_secKey</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;secKey&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_hash</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;hash&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_appName</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;appName&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">_cont64</span> <span class="operator">=</span> JsonUtil.getString(data, <span class="string">&quot;cont&quot;</span>);</span><br><span class="line">      <span class="type">byte</span>[] _cont = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">if</span>(!ToolUtil.isNull(_cont64)) &#123;</span><br><span class="line">         _cont = Base64Util.decode(_cont64);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      file.setFileId(_fileId);</span><br><span class="line">      file.setUserId(_userId);</span><br><span class="line">      file.setType(Integer.valueOf(_type));</span><br><span class="line">      file.setCreateTime(_time);</span><br><span class="line">      file.setFileName(_fileName);</span><br><span class="line">      file.setSavePath(_savePath);</span><br><span class="line">      file.setFileSuffix(_fileSuffix);</span><br><span class="line">      file.setOldName(_oldName);</span><br><span class="line">      file.setUrl(_url);</span><br><span class="line">      file.setSecKey(_secKey);</span><br><span class="line">      file.setHash(_hash);</span><br><span class="line">      file.setAppName(_appName);</span><br><span class="line">      file.setCont(_cont);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> file;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">fetchBase64Cont</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> Base64Util.encode(cont);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(Exception ex) &#123;&#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">fetchContToStr</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(cont, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getFileId</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> fileId;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFileId</span><span class="params">(String fileId)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.fileId = fileId;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> userId;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserId</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.userId = userId;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> Integer <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> type;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setType</span><span class="params">(Integer type)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.type = type;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> Date <span class="title function_">getCreateTime</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> createTime;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCreateTime</span><span class="params">(Date createTime)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.createTime = createTime;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getFileName</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> fileName;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFileName</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.fileName = fileName;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getSavePath</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> savePath;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSavePath</span><span class="params">(String savePath)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.savePath = savePath;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getFileSuffix</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> fileSuffix;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFileSuffix</span><span class="params">(String fileSuffix)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.fileSuffix = fileSuffix;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getOldName</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> oldName;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setOldName</span><span class="params">(String oldName)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.oldName = oldName;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> url;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUrl</span><span class="params">(String url)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.url = url;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getSecKey</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> secKey;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSecKey</span><span class="params">(String secKey)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.secKey = secKey;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getHash</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> hash;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHash</span><span class="params">(String hash)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.hash = hash;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getAppName</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> appName;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAppName</span><span class="params">(String appName)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.appName = appName;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">byte</span>[] getCont() &#123;</span><br><span class="line">      <span class="keyword">return</span> cont;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCont</span><span class="params">(<span class="type">byte</span>[] cont)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.cont = cont;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="2-1-1-2-FileV2Proxy"><a href="#2-1-1-2-FileV2Proxy" class="headerlink" title="2.1.1.2 FileV2Proxy"></a>2.1.1.2 FileV2Proxy</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileV2Proxy</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@description</span>:申请文件中心token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 11:13 2022/4/13</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> java.lang.String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getToken</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">authId</span> <span class="operator">=</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.authId&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getInSideUrlRoot() + <span class="string">&quot;/api/v2/token?authId=&quot;</span> + authId;</span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> HttpUtil2.sendGet(url);</span><br><span class="line">        <span class="type">JsonResult</span> <span class="variable">json</span> <span class="operator">=</span> JSON.parseObject(res, JsonResult.class);</span><br><span class="line">        <span class="keyword">if</span> ( !json.getSuccess() ) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>( String.format(<span class="string">&quot;token申请失败:%s&quot;</span>, res) );</span><br><span class="line">        <span class="keyword">return</span> String.valueOf( json.getData() );</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取普通文件</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> fileId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] readFile(String fileId) <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getOutSideUrlRoot() + <span class="string">&quot;/api/v2/ext/&quot;</span> + fileId;</span><br><span class="line">      </span><br><span class="line">      <span class="type">byte</span>[] file = visitUrl(url);</span><br><span class="line">      <span class="keyword">return</span> file;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取加密文件 </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> fileId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] readFile(String fileId, String key) <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>( getOutSideUrlRoot() )</span><br><span class="line">                .append(<span class="string">&quot;/api/v2/ext/&quot;</span>)</span><br><span class="line">                .append(fileId)</span><br><span class="line">                .append(<span class="string">&quot;?key=&quot;</span>)</span><br><span class="line">                .append(key).toString();</span><br><span class="line">      </span><br><span class="line">      <span class="type">byte</span>[] file = visitUrl(url);</span><br><span class="line">      <span class="keyword">return</span> file;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 上传文件</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> fileInfo    上传文件信息对象</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> cont       文件内容</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> LllFileV2 <span class="title function_">uploadFile</span><span class="params">(ULFileInfoVo fileInfo, <span class="type">byte</span>[] cont)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="keyword">if</span> (ToolUtil.isNull( fileInfo.getToken() ))&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> getToken();</span><br><span class="line">            fileInfo.setToken(token);</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getOutSideUrlRoot() + <span class="string">&quot;/api/v2/ext/uploadFile&quot;</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">base64Cont</span> <span class="operator">=</span> Base64Util.encode(cont);</span><br><span class="line">      Map&lt;String,String&gt; params = fileInfo.toMap();</span><br><span class="line">      params.put(<span class="string">&quot;base64Cont&quot;</span>, base64Cont);</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> HttpUtil2.sendPost(url, params);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//解析结果</span></span><br><span class="line">      <span class="type">LllFileV2</span> <span class="variable">file</span> <span class="operator">=</span> parseLllFileV2(res);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> file;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 转存临时文件,自动设置authId</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> fileId         临时文件ID</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> fileInfo       新的文件信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> LllFileV2 <span class="title function_">transferTempFile</span><span class="params">(String fileId, ULFileInfoVo fileInfo)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getInSideUrlRoot() + <span class="string">&quot;/api/v2/transfer-temp-file&quot;</span>;</span><br><span class="line">      <span class="comment">//设置authId</span></span><br><span class="line">        <span class="keyword">if</span> ( StringUtil.isNull( fileInfo.getToken() ) )&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">authId</span> <span class="operator">=</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.authId&quot;</span>);</span><br><span class="line">            fileInfo.setToken(authId);</span><br><span class="line">        &#125;</span><br><span class="line">      Map&lt;String,String&gt; params = fileInfo.toMap();</span><br><span class="line">      params.put(<span class="string">&quot;fileId&quot;</span>, fileId);</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> HttpUtil2.sendPost(url, params);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//解析结果</span></span><br><span class="line">      <span class="type">LllFileV2</span> <span class="variable">file</span> <span class="operator">=</span> parseLllFileV2(res);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> file;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取用户图片列表</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> authId      授权id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> params      查询参数</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> isCont      是否包含文件内容(true:包含，false:不包含)</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> List&lt;LllFileV2&gt; <span class="title function_">listFile</span><span class="params">(String authId, FileSearchParam params, <span class="type">boolean</span> isCont)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getInSideUrlRoot() + <span class="string">&quot;/api/v2/list&quot;</span>;</span><br><span class="line">      </span><br><span class="line">      Map&lt;String,String&gt; _params = params.toMap();</span><br><span class="line">      _params.put(<span class="string">&quot;authId&quot;</span>, authId);</span><br><span class="line"></span><br><span class="line">      <span class="type">int</span> <span class="variable">readContent</span> <span class="operator">=</span> isCont ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">      _params.put(<span class="string">&quot;cont&quot;</span>, String.valueOf(readContent));</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> HttpUtil2.sendPost(url, _params);</span><br><span class="line">      <span class="comment">//解析结果</span></span><br><span class="line">      List&lt;LllFileV2&gt; datas = parseLllFileV2List(res);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> datas;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> List&lt;LllFileV2&gt; <span class="title function_">listFile</span><span class="params">(String authId, FileSearchParam params)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="keyword">return</span> listFile(authId, params, <span class="literal">false</span>);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;LllFileV2&gt; <span class="title function_">listFile</span><span class="params">(FileSearchParam params, <span class="type">boolean</span> isCont)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">authId</span> <span class="operator">=</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.authId&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> listFile(authId, params, isCont);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 查询文件总数</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> authId         授权id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> params      查询参数</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">countFile</span><span class="params">(String authId, FileSearchParam params)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getInSideUrlRoot() + <span class="string">&quot;/api/v2/count&quot;</span>;</span><br><span class="line">      </span><br><span class="line">      Map&lt;String,String&gt; _params = params.toMap();</span><br><span class="line">      _params.put(<span class="string">&quot;authId&quot;</span>, authId);</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> HttpUtil2.sendPost(url, _params);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//解析结果</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">total</span> <span class="operator">=</span> parseLllFileV2Int(res);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> total;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">countFile</span><span class="params">(FileSearchParam params)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">authId</span> <span class="operator">=</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.authId&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> countFile(authId, params);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 读取文件信息</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> authId      授权id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> fileId      文件ID</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> cont       是否包含文件内容(true:包含，false:不包含)</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> LllFileV2 <span class="title function_">getFile</span><span class="params">(String authId, String fileId, <span class="type">boolean</span> cont)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getInSideUrlRoot() + <span class="string">&quot;/api/v2/getFileInfo&quot;</span>;</span><br><span class="line">      </span><br><span class="line">      Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">      params.put(<span class="string">&quot;authId&quot;</span>, authId);</span><br><span class="line">      params.put(<span class="string">&quot;fileId&quot;</span>, fileId);</span><br><span class="line"></span><br><span class="line">      <span class="type">int</span> <span class="variable">readContent</span> <span class="operator">=</span> cont ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">      params.put(<span class="string">&quot;cont&quot;</span>, String.valueOf(readContent));</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> HttpUtil2.sendPost(url, params);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//解析结果</span></span><br><span class="line">      <span class="type">LllFileV2</span> <span class="variable">file</span> <span class="operator">=</span> parseLllFileV2(res);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> file;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> LllFileV2 <span class="title function_">getFile</span><span class="params">(String authId, String fileId)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="keyword">return</span> getFile(authId, fileId, <span class="literal">false</span>);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LllFileV2 <span class="title function_">getFile</span><span class="params">(String fileId, <span class="type">boolean</span> cont)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">authId</span> <span class="operator">=</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.authId&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> getFile(authId, fileId, cont);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 删除文件</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> authId 授权id</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> fileIds</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeFile</span><span class="params">(String authId, List&lt;String&gt; fileIds)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> getInSideUrlRoot() + <span class="string">&quot;/api/v2/removeFile&quot;</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">_fileIds</span> <span class="operator">=</span> packFileIds(fileIds);</span><br><span class="line">      </span><br><span class="line">      Map&lt;String, String&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">      params.put(<span class="string">&quot;authId&quot;</span>, authId);</span><br><span class="line">      params.put(<span class="string">&quot;fileIds&quot;</span>, _fileIds);</span><br><span class="line">   </span><br><span class="line">      <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> HttpUtil2.sendPost(url, params);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//解析结果</span></span><br><span class="line">      parseResult(res);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeFile</span><span class="params">(List&lt;String&gt; fileIds)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">authId</span> <span class="operator">=</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.authId&quot;</span>);</span><br><span class="line">        removeFile(authId, fileIds);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeFile</span><span class="params">(String authId, String fileId)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      List&lt;String&gt; ls = Arrays.asList(fileId);</span><br><span class="line">      removeFile(authId, ls);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeFile</span><span class="params">(String fileId)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">authId</span> <span class="operator">=</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.authId&quot;</span>);</span><br><span class="line">        removeFile(authId, fileId);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">packFileIds</span><span class="params">(List&lt;String&gt; fileIds)</span> &#123;</span><br><span class="line">       <span class="type">StringJoiner</span> <span class="variable">joiner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringJoiner</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">       fileIds.forEach(s -&gt; joiner.add(s));</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> joiner.toString();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getOutSideUrlRoot</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.rootUrl.outside&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getInSideUrlRoot</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SpringUtil.getEvnProperty(<span class="string">&quot;file.rootUrl.inside&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] visitUrl(String url) <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="keyword">return</span> HttpUtil2.sendGet(url, <span class="literal">null</span>, <span class="literal">null</span>, content -&gt; content.asBytes());</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> LllFileV2 <span class="title function_">parseLllFileV2</span><span class="params">(String res)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">JsonObject</span> <span class="variable">data</span> <span class="operator">=</span> parseJsonObject(res);</span><br><span class="line">      </span><br><span class="line">      <span class="type">LllFileV2</span> <span class="variable">file</span> <span class="operator">=</span> LllFileV2.create(data);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> file;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> List&lt;LllFileV2&gt; <span class="title function_">parseLllFileV2List</span><span class="params">(String res)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">JsonArray</span> <span class="variable">datas</span> <span class="operator">=</span> parseJsonArray(res);</span><br><span class="line">      </span><br><span class="line">      List&lt;LllFileV2&gt; ls = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;LllFileV2&gt;();</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;datas.size();i++) &#123;</span><br><span class="line">         <span class="type">JsonObject</span> <span class="variable">json</span> <span class="operator">=</span> datas.get(i).getAsJsonObject();</span><br><span class="line">         <span class="type">LllFileV2</span> <span class="variable">file</span> <span class="operator">=</span> LllFileV2.create(json);</span><br><span class="line">         ls.add(file);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> ls;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">parseLllFileV2Int</span><span class="params">(String res)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> parseResult(res);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> Integer.valueOf(data);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">parseResultSucc</span><span class="params">(JsonObject json)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> JsonUtil.getBoolean(json, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>(!success) &#123;</span><br><span class="line">         <span class="type">JsonObject</span> <span class="variable">exJson</span> <span class="operator">=</span> JsonUtil.getJsonObject(json, <span class="string">&quot;ex&quot;</span>);</span><br><span class="line">         <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> JsonUtil.getString(exJson, <span class="string">&quot;code&quot;</span>);</span><br><span class="line">         <span class="type">String</span> <span class="variable">reason</span> <span class="operator">=</span> JsonUtil.getString(exJson, <span class="string">&quot;reason&quot;</span>);</span><br><span class="line">         <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="string">&quot;[&quot;</span>+code+<span class="string">&quot;]&quot;</span>+reason;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Exception</span>(msg);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">parseResult</span><span class="params">(String res)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">JsonObject</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtil.parseJsonObject(res);</span><br><span class="line">      </span><br><span class="line">      parseResultSucc(json);</span><br><span class="line">      </span><br><span class="line">      <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> JsonUtil.getString(json, <span class="string">&quot;data&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> JsonObject <span class="title function_">parseJsonObject</span><span class="params">(String res)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">JsonObject</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtil.parseJsonObject(res);</span><br><span class="line">      </span><br><span class="line">      parseResultSucc(json);</span><br><span class="line">      </span><br><span class="line">      <span class="type">JsonObject</span> <span class="variable">data</span> <span class="operator">=</span> JsonUtil.getJsonObject(json, <span class="string">&quot;data&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> JsonArray <span class="title function_">parseJsonArray</span><span class="params">(String res)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">      <span class="type">JsonObject</span> <span class="variable">json</span> <span class="operator">=</span> JsonUtil.parseJsonObject(res);</span><br><span class="line">      </span><br><span class="line">      parseResultSucc(json);</span><br><span class="line">      </span><br><span class="line">      <span class="type">JsonArray</span> <span class="variable">data</span> <span class="operator">=</span> JsonUtil.getJsonArray(json, <span class="string">&quot;data&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> data;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-2-iic-file-dao"><a href="#2-2-iic-file-dao" class="headerlink" title="2.2 iic-file-dao"></a>2.2 iic-file-dao</h2><p>mapper, model, service+mybatis-xxx.xml 经典四件套</p>
<p>操作GdssFileTeFile.xml和GdssFileTeWhitelist.xml两张表</p>
<h3 id="2-2-1-GdssFileTeFile-xml"><a href="#2-2-1-GdssFileTeFile-xml" class="headerlink" title="2.2.1 GdssFileTeFile.xml"></a>2.2.1 GdssFileTeFile.xml</h3><p>其中SAVE_PATH字段即为文件的保存路径，可以通过<a target="_blank" rel="noopener" href="https://test-static.gdsinsing.com/TEMP/83d48b7de7014fb48f427b7d1ee2214b.png%E7%9B%B4%E6%8E%A5%E8%AE%BF%E9%97%AE%E5%88%B0%E6%96%87%E4%BB%B6%EF%BC%8C%E5%8D%B3%E5%9F%9F%E5%90%8D+SAVE_PATH">https://test-static.gdsinsing.com/TEMP/83d48b7de7014fb48f427b7d1ee2214b.png直接访问到文件，即域名+SAVE_PATH</a></p>
<p><a target="_blank" rel="noopener" href="https://test-static.gdsinsing.com/">https://test-static.gdsinsing.com</a>即为文件中心的公网地址</p>
<h3 id="2-2-2-GdssFileTeWhitelist-xml"><a href="#2-2-2-GdssFileTeWhitelist-xml" class="headerlink" title="2.2.2 GdssFileTeWhitelist.xml"></a>2.2.2 GdssFileTeWhitelist.xml</h3><p>“ID”    “APP_NAME”    “PUBLIC_KEY”    “PRIVATE_KEY”</p>
<p>授予某应用调用http内部接口的权限</p>
<h2 id="2-3-iic-file-web"><a href="#2-3-iic-file-web" class="headerlink" title="2.3 iic-file-web"></a>2.3 iic-file-web</h2><h3 id="2-3-1-cache"><a href="#2-3-1-cache" class="headerlink" title="2.3.1 cache"></a>2.3.1 cache</h3><h3 id="2-3-2-controller"><a href="#2-3-2-controller" class="headerlink" title="2.3.2 controller"></a>2.3.2 controller</h3><h3 id="2-3-3-service"><a href="#2-3-3-service" class="headerlink" title="2.3.3 service"></a>2.3.3 service</h3><h4 id="2-3-3-1-component"><a href="#2-3-3-1-component" class="headerlink" title="2.3.3.1 component"></a>2.3.3.1 component</h4><h5 id="1-BaseUploadFileComponent"><a href="#1-BaseUploadFileComponent" class="headerlink" title="(1) BaseUploadFileComponent"></a>(1) BaseUploadFileComponent</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseUploadFileComponent</span> <span class="keyword">extends</span> <span class="title class_">BaseFileService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> ICfgService iCfgService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> IGdssFileTeFileService iGdssFileTeFileService;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">abstract</span> LllFileV2 <span class="title function_">upload</span><span class="params">(ULFileInfoVo fileInfo, String base64Cont)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">abstract</span> LllFileV2 <span class="title function_">upload</span><span class="params">(ULFileInfoVo fileInfo, <span class="type">byte</span>[] contents)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="2-UploadFileNormalComponent"><a href="#2-UploadFileNormalComponent" class="headerlink" title="(2) UploadFileNormalComponent"></a>(2) UploadFileNormalComponent</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传普通文件组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liangxinyi</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadFileNormalComponent</span> <span class="keyword">extends</span> <span class="title class_">BaseUploadFileComponent</span> &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(UploadFileNormalComponent.class);</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> LllFileV2 <span class="title function_">upload</span><span class="params">(ULFileInfoVo fileInfo, String base64Cont)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="comment">//解码</span></span><br><span class="line">        <span class="type">byte</span>[] contents = Base64Util.decode(base64Cont);</span><br><span class="line">        <span class="keyword">return</span> upload(fileInfo, contents);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> LllFileV2 <span class="title function_">upload</span><span class="params">(ULFileInfoVo fileInfo, <span class="type">byte</span>[] contents)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">       <span class="comment">//入库</span></span><br><span class="line">        <span class="type">GdssFileTeFile</span> <span class="variable">file</span> <span class="operator">=</span> saveToDb(fileInfo, contents);</span><br><span class="line">        <span class="comment">//写入硬盘</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">savePath</span> <span class="operator">=</span> iCfgService.getCfgString(<span class="string">&quot;FILE_ROOT_PATH&quot;</span>) + file.getSavePath();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">dirPath</span> <span class="operator">=</span> findDirectory(savePath);</span><br><span class="line">            <span class="comment">//创建文件夹，如果文件夹不存在</span></span><br><span class="line">            Files.createDirectories( Paths.get(dirPath) );</span><br><span class="line">            <span class="comment">//写入文件</span></span><br><span class="line">            Files.write(Paths.get(savePath), contents, StandardOpenOption.CREATE);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> buildLllFile(file);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">            log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> BusException) <span class="keyword">throw</span> (BusException) ex;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;01200002&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GdssFileTeFile <span class="title function_">saveToDb</span><span class="params">(ULFileInfoVo fileInfoVo, <span class="type">byte</span>[] contents)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">appName</span> <span class="operator">=</span> getAppName( fileInfoVo.getToken() );</span><br><span class="line">        <span class="type">GdssFileTeFile</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssFileTeFile</span>();</span><br><span class="line">        file.setPkidValue( UUID.getUUID() );</span><br><span class="line">        file.setAppName(appName);</span><br><span class="line">        file.setType(GdssFileTeFile.TYPE_COMMON);</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> FileUtil.getFileExt( fileInfoVo.getOldName() );</span><br><span class="line">        file.setFileSuffix(suffix);</span><br><span class="line">        file.setCreateTime( Calendar.getInstance().getTime() );</span><br><span class="line">        <span class="comment">//处理文件名</span></span><br><span class="line">        <span class="keyword">if</span> ( ToolUtil.isNull( fileInfoVo.getNewName() ) )&#123;</span><br><span class="line">            <span class="comment">//如果newName为空，则以ID作为文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">newName</span> <span class="operator">=</span> file.getId();</span><br><span class="line">            <span class="keyword">if</span>( !ToolUtil.isNull( file.getFileSuffix() ) ) &#123;</span><br><span class="line">                newName = newName + file.getFileSuffix();</span><br><span class="line">            &#125;</span><br><span class="line">            file.setFileName(newName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            file.setFileName( fileInfoVo.getNewName() );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">savePath</span> <span class="operator">=</span> packSavePath(fileInfoVo, file.getFileName());</span><br><span class="line">        file.setSavePath(savePath);</span><br><span class="line">        file.setOriginalName( fileInfoVo.getOldName() );</span><br><span class="line">        file.setUserId( fileInfoVo.getUserId() );</span><br><span class="line">        file.setEncrypt(LllBaseModel.NO);</span><br><span class="line">        <span class="comment">//预览url</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">domain</span> <span class="operator">=</span> iCfgService.getCfgString(<span class="string">&quot;FILE_ROOT_URL&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> domain + <span class="string">&quot;/&quot;</span> + savePath;</span><br><span class="line">        file.setUrl(url);</span><br><span class="line">        file.setHash( Base64Util.Byte2SHA256(contents) );</span><br><span class="line">        <span class="comment">//入库</span></span><br><span class="line">        iGdssFileTeFileService.addEntity(file);</span><br><span class="line">        <span class="keyword">return</span> file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-UploadFileEncryptComponent"><a href="#3-UploadFileEncryptComponent" class="headerlink" title="(3) UploadFileEncryptComponent"></a>(3) UploadFileEncryptComponent</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 上传加密文件组件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liangxinyi</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UploadFileEncryptComponent</span> <span class="keyword">extends</span> <span class="title class_">BaseUploadFileComponent</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(UploadFileEncryptComponent.class);</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> LllFileV2 <span class="title function_">upload</span><span class="params">(ULFileInfoVo fileInfo, String base64Cont)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="comment">// TODO 解密</span></span><br><span class="line">        <span class="type">byte</span>[] contents = Base64Util.decode(base64Cont);</span><br><span class="line">        <span class="comment">//TODO 保存</span></span><br><span class="line">        <span class="keyword">return</span> upload(fileInfo, contents);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> LllFileV2 <span class="title function_">upload</span><span class="params">(ULFileInfoVo fileInfo, <span class="type">byte</span>[] contents)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">GdssFileTeFile</span> <span class="variable">file</span> <span class="operator">=</span> saveToDb(fileInfo, contents);</span><br><span class="line">            <span class="comment">//加密</span></span><br><span class="line">            <span class="type">byte</span>[] encryptedBytes = SM4.encrypt(file.getEncryptKey(), contents);</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">savePath</span> <span class="operator">=</span> iCfgService.getCfgString(<span class="string">&quot;FILE_ROOT_PATH&quot;</span>) + file.getSavePath();</span><br><span class="line">            <span class="type">String</span> <span class="variable">dirPath</span> <span class="operator">=</span> findDirectory(savePath);</span><br><span class="line">            <span class="comment">//创建文件夹，如果文件夹不存在</span></span><br><span class="line">            Files.createDirectories( Paths.get(dirPath) );</span><br><span class="line">            <span class="comment">//写入文件</span></span><br><span class="line">            Files.write(Paths.get(savePath), encryptedBytes, StandardOpenOption.CREATE);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> buildLllFile(file);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;&quot;</span>, e);</span><br><span class="line">            <span class="keyword">if</span> (e <span class="keyword">instanceof</span> BusException) <span class="keyword">throw</span> (BusException) e;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;01200002&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> GdssFileTeFile <span class="title function_">saveToDb</span><span class="params">(ULFileInfoVo fileInfoVo, <span class="type">byte</span>[] contents)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">appName</span> <span class="operator">=</span> getAppName( fileInfoVo.getToken() );</span><br><span class="line">        <span class="type">GdssFileTeFile</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssFileTeFile</span>();</span><br><span class="line">        file.setPkidValue( UUID.getUUID() );</span><br><span class="line">        file.setAppName(appName);</span><br><span class="line">        file.setType(GdssFileTeFile.TYPE_SECRET);</span><br><span class="line">        <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> FileUtil.getFileExt( fileInfoVo.getOldName() );</span><br><span class="line">        file.setFileSuffix(suffix);</span><br><span class="line">        file.setCreateTime( Calendar.getInstance().getTime() );</span><br><span class="line">        <span class="comment">//处理文件名</span></span><br><span class="line">        <span class="keyword">if</span> ( ToolUtil.isNull( fileInfoVo.getNewName() ) )&#123;</span><br><span class="line">            <span class="comment">//如果newName为空，则以ID作为文件名</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">newName</span> <span class="operator">=</span> file.getId();</span><br><span class="line">            <span class="keyword">if</span>( !ToolUtil.isNull( file.getFileSuffix() ) ) &#123;</span><br><span class="line">                newName = newName + file.getFileSuffix();</span><br><span class="line">            &#125;</span><br><span class="line">            file.setFileName(newName);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            file.setFileName( fileInfoVo.getNewName() );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">savePath</span> <span class="operator">=</span> packSavePath(fileInfoVo, file.getFileName());</span><br><span class="line">        file.setSavePath(savePath);</span><br><span class="line">        file.setOriginalName( fileInfoVo.getOldName() );</span><br><span class="line">        file.setUserId( fileInfoVo.getUserId() );</span><br><span class="line">        <span class="comment">//密钥</span></span><br><span class="line">        file.setEncrypt(LllBaseModel.YES);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> SM4.generateBase64KeyStr();</span><br><span class="line">        file.setEncryptKey(key);</span><br><span class="line">        <span class="comment">//预览url</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">domain</span> <span class="operator">=</span> iCfgService.getCfgString(<span class="string">&quot;FILE_ROOT_URL&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> domain + <span class="string">&quot;/&quot;</span> + savePath;</span><br><span class="line">        file.setUrl(url);</span><br><span class="line">        file.setHash( Base64Util.Byte2SHA256(contents) );</span><br><span class="line">        <span class="comment">//入库</span></span><br><span class="line">        iGdssFileTeFileService.addEntity(file);</span><br><span class="line">        <span class="keyword">return</span> file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-UploadFileSpecifyPathComponent"><a href="#4-UploadFileSpecifyPathComponent" class="headerlink" title="(4) UploadFileSpecifyPathComponent"></a>(4) UploadFileSpecifyPathComponent</h5><h5 id="5-UploadFileTempComponent"><a href="#5-UploadFileTempComponent" class="headerlink" title="(5) UploadFileTempComponent"></a>(5) UploadFileTempComponent</h5><h3 id="2-3-4-resources"><a href="#2-3-4-resources" class="headerlink" title="2.3.4 resources"></a>2.3.4 resources</h3><h4 id="2-3-4-1-application-yml"><a href="#2-3-4-1-application-yml" class="headerlink" title="2.3.4.1 application.yml"></a>2.3.4.1 application.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8097</span></span><br><span class="line">    <span class="attr">tomcat:</span></span><br><span class="line">      <span class="attr">basedir:</span> <span class="string">/Users/wit/Desktop/temp</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">maxFileSize:</span> <span class="string">20MB</span></span><br><span class="line">      <span class="attr">maxRequestSize:</span> <span class="string">20MB</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">classpath:/templates/</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="comment"># config-location: classpath:mybatis-config.xml</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath*:**/mybatis-*.xml</span></span><br><span class="line">  <span class="comment">#type-aliases-package: cn.lll.tsp.model</span></span><br><span class="line">    <span class="attr">configuration:</span></span><br><span class="line">      <span class="attr">use-actual-param-name:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">cache-enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#标识业务统计</span></span><br><span class="line"><span class="attr">stat:</span></span><br><span class="line">  <span class="attr">redis-ip:</span> <span class="number">114.67</span><span class="number">.117</span><span class="number">.77</span></span><br><span class="line">  <span class="attr">redis-pwd:</span> <span class="string">y0aoQ67K62pHrPjp</span></span><br><span class="line">  <span class="attr">redis-key:</span> <span class="string">IIC_STAT_DEV</span></span><br><span class="line"><span class="comment">#  配置中心配置</span></span><br><span class="line"><span class="attr">cfg:</span></span><br><span class="line">  <span class="attr">FILE_ROOT_PATH:</span> <span class="string">/home/iic/STATIC_ROOT_PATH/</span></span><br><span class="line"><span class="comment">#  FILE_ROOT_URL: 启动命令传入</span></span><br></pre></td></tr></table></figure>



<h4 id="2-3-4-2-application-dao-prod-yml"><a href="#2-3-4-2-application-dao-prod-yml" class="headerlink" title="2.3.4.2 application-dao-prod.yml"></a>2.3.4.2 application-dao-prod.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">prod</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://mysql-cn-south-1-740dbfbd9a254713.rds.jdcloud.com:3306/iic-filecenter-db?characterEncoding=utf8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">gdxx_file</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">42RsHfmzOdr1eWaHlxo0OmTnTBGfnGSb</span></span><br><span class="line">        <span class="comment"># 使用druid数据源</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">        <span class="attr">test-while-idle:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">time-between-eviction-runs-millis:</span> <span class="number">3600000</span></span><br><span class="line">        <span class="attr">validation-query:</span> <span class="string">SELECT</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line">        <span class="attr">filters:</span> <span class="string">stat</span></span><br><span class="line">        <span class="attr">maxActive:</span> <span class="number">300</span></span><br><span class="line">        <span class="attr">initialSize:</span> <span class="number">20</span></span><br><span class="line">        <span class="attr">maxWait:</span> <span class="number">5000</span></span><br><span class="line">        <span class="attr">minIdle:</span> <span class="number">5</span></span><br><span class="line">        <span class="attr">poolPreparedStatements:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">maxOpenPreparedStatements:</span> <span class="number">20</span></span><br><span class="line">        <span class="comment"># 数据库备份使用</span></span><br><span class="line">        <span class="attr">databaseName:</span> <span class="string">eb_yunxin</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.4</span><span class="number">.159</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">4406</span></span><br><span class="line">        <span class="attr">mySqlPath:</span> <span class="string">/usr/local/mysql/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">tomcat:</span></span><br><span class="line">    <span class="attr">basedir:</span> <span class="string">/home/tomcat/dir/file</span></span><br></pre></td></tr></table></figure>



<h1 id="3-HTTP接口"><a href="#3-HTTP接口" class="headerlink" title="3.HTTP接口"></a>3.HTTP接口</h1><h2 id="3-1-HTTP外部接口"><a href="#3-1-HTTP外部接口" class="headerlink" title="3.1 HTTP外部接口"></a>3.1 HTTP外部接口</h2><p>上传文件：<a target="_blank" rel="noopener" href="https://static.gdsinsing.com/api/v2/ext/upload">https://static.gdsinsing.com/api/v2/ext/upload</a></p>
<p>查询文件信息：<a target="_blank" rel="noopener" href="https://static.gdsinsing.com/api/v2/ext/fileinfo/%7BfileId%7D">https://static.gdsinsing.com/api/v2/ext/fileinfo/{fileId}</a></p>
<p>读取文件：<a target="_blank" rel="noopener" href="https://static.gdsinsing.com/api/v2/ext/%7BfileId%7D?key=%7Bkey%7D">https://static.gdsinsing.com/api/v2/ext/{fileId}?key={key}</a></p>
<h2 id="3-2-HTTP内部接口"><a href="#3-2-HTTP内部接口" class="headerlink" title="3.2 HTTP内部接口"></a>3.2 HTTP内部接口</h2><p>申请临时权限令牌：https:&#x2F;&#x2F;{文件中心内网地址}&#x2F;api&#x2F;v2&#x2F;token?authId&#x3D;{authId}</p>
<p>转存临时文件：https:&#x2F;&#x2F;{文件中心内网地址}&#x2F;api&#x2F;v2&#x2F;transfer-temp-file</p>
<p>读取用户图片列表：https:&#x2F;&#x2F;{文件中心内网地址}&#x2F;api&#x2F;v2&#x2F;list</p>
<p>查询文件总数：https:&#x2F;&#x2F;{文件中心内网地址}&#x2F;api&#x2F;v2&#x2F;count</p>
<p>查询文件信息：https:&#x2F;&#x2F;{文件中心内网地址}&#x2F;api&#x2F;v2&#x2F;getFileInfo</p>
<p>删除文件：https:&#x2F;&#x2F;{文件中心内网地址}&#x2F;api&#x2F;v2&#x2F;removeFile</p>
<h2 id="3-3-附件"><a href="#3-3-附件" class="headerlink" title="3.3 附件"></a>3.3 附件</h2><p>LllFileV2</p>
<p>概述</p>
<blockquote>
<p>文件中心文件对象。</p>
</blockquote>
<p>文件类型</p>
<table>
<thead>
<tr>
<th>属性名</th>
<th>类型</th>
<th>值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LllFileV2.TYPE_COMMON</td>
<td>int</td>
<td>1</td>
<td>公共区文件</td>
</tr>
<tr>
<td>LllFileV2.TYPE_SECRET</td>
<td>int</td>
<td>2</td>
<td>加密区文件</td>
</tr>
<tr>
<td>LllFileV2.TYPE_TEMP</td>
<td>int</td>
<td>3</td>
<td>临时区文件</td>
</tr>
</tbody></table>
<p>属性说明</p>
<table>
<thead>
<tr>
<th>属性名</th>
<th>类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td>fileId</td>
<td>String</td>
<td align="left">文件ID</td>
</tr>
<tr>
<td>userId</td>
<td>String</td>
<td align="left">用户ID</td>
</tr>
<tr>
<td>type</td>
<td>Integer</td>
<td align="left">文件类型 (1:公共区 2:加密区 3:临时区)</td>
</tr>
<tr>
<td>createTime</td>
<td>Date</td>
<td align="left">上传时间</td>
</tr>
<tr>
<td>fileName</td>
<td>String</td>
<td align="left">文件名(包含后缀)</td>
</tr>
<tr>
<td>savePath</td>
<td>String</td>
<td align="left">文件保存路径 (不包含文件名)</td>
</tr>
<tr>
<td>fileSuffix</td>
<td>String</td>
<td align="left">文件后缀</td>
</tr>
<tr>
<td>oldName</td>
<td>String</td>
<td align="left">文件原名</td>
</tr>
<tr>
<td>url</td>
<td>String</td>
<td align="left">完整的URL访问地址(包含Https)</td>
</tr>
<tr>
<td>secKey</td>
<td>String</td>
<td align="left">SM4密钥</td>
</tr>
<tr>
<td>hash</td>
<td>String</td>
<td align="left">文件的Hash值</td>
</tr>
<tr>
<td>appName</td>
<td>String</td>
<td align="left">系统账号名称,如：IIC</td>
</tr>
<tr>
<td>cont</td>
<td>byte[]</td>
<td align="left">文件内容</td>
</tr>
</tbody></table>
<h1 id="4-SSP"><a href="#4-SSP" class="headerlink" title="4.SSP"></a>4.SSP</h1><h2 id="4-1-admin-file-controller"><a href="#4-1-admin-file-controller" class="headerlink" title="4.1 admin.file.controller"></a>4.1 admin.file.controller</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/mgrapi/admin/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminFileController</span> <span class="keyword">extends</span> <span class="title class_">MgrBaseController</span></span><br></pre></td></tr></table></figure>

<p>内有upload方法</p>
<h2 id="4-2-pages-filecenter-file-upload-js"><a href="#4-2-pages-filecenter-file-upload-js" class="headerlink" title="4.2 pages.filecenter.file-upload.js"></a>4.2 pages.filecenter.file-upload.js</h2><p>Vue组件 调controller中的upload方法</p>
<h2 id="4-3-pages-filecenter-file-upload-html"><a href="#4-3-pages-filecenter-file-upload-html" class="headerlink" title="4.3 pages.filecenter.file-upload.html"></a>4.3 pages.filecenter.file-upload.html</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/24/ssp%E5%89%8D%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/24/ssp%E5%89%8D%E7%AB%AF/" class="post-title-link" itemprop="url">ssp前端</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-25 09:19:27" itemprop="dateCreated datePublished" datetime="2022-04-25T09:19:27+08:00">2022-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 15:35:04" itemprop="dateModified" datetime="2022-11-29T15:35:04+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ssp-frontend"><a href="#ssp-frontend" class="headerlink" title="ssp frontend"></a>ssp frontend</h1><h2 id="file-upload前端原理"><a href="#file-upload前端原理" class="headerlink" title="file-upload前端原理"></a>file-upload前端原理</h2><h3 id="1-file-upload-html"><a href="#1-file-upload-html" class="headerlink" title="1. file-upload.html"></a>1. file-upload.html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iic-panel-top</span> <span class="attr">title</span>=<span class="string">&quot;上传文件&quot;</span> <span class="attr">chain</span>=<span class="string">&quot;文件管理&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-panel-top</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;upload-select-area&quot;</span> <span class="attr">class</span>=<span class="string">&quot;upload-select-area&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">h1</span> @<span class="attr">click</span>=<span class="string">&quot;onSelected()&quot;</span>&gt;</span>拖拽文件到这里<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload-btn-area&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;showBtnArea()&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-primary waves-effect waves-light&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onUploadAll()&quot;</span>&gt;</span>全部上传<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-secondary waves-effect waves-light&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onDelAll()&quot;</span>&gt;</span>全部清除<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;upload-preview-area&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;fileinfo in fileDatas&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;preview-item&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;preview-img&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;fileinfo.url&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;preview-cont&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">label</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;fileinfo.name&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>大小<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;fileinfo.size&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;fileinfo.status==1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;text-primary&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: 600;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">b</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-marked-circle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span>已上传<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;fileinfo.status==0&quot;</span> <span class="attr">class</span>=<span class="string">&quot;text-warning&quot;</span> <span class="attr">style</span>=<span class="string">&quot;font-weight: 600;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">b</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-information&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span>未上传<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;margin-top:15px;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">label</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onUpload(fileinfo)&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;showUploadBtn(fileinfo)&quot;</span>&gt;</span>上传<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-sm btn-danger&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onDelete(fileinfo)&quot;</span>&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;preview-loading&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;showLoading(fileinfo)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="comment">&lt;!-- end row --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>重点在于：</p>
<ol>
<li>&#96;&#96;&#96;html<li v-for="fileinfo in fileDatas"> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   负责展示用户上传的文件经整理后的fileinfo</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">2. ```html</span><br><span class="line">   &lt;a href=&quot;javascript:void(0)&quot; class=&quot;btn btn-sm btn-primary&quot; @click=&quot;onUpload(fileinfo)&quot; :class=&quot;showUploadBtn(fileinfo)&quot;&gt;上传&lt;/a&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​    </p>
<ol start="3">
<li>&#96;&#96;&#96;html<br>&lt;button class&#x3D;”btn btn-sm btn-primary waves-effect waves-light” @click&#x3D;”onUploadAll()”&gt;全部上传</button><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">用户拖拽一个文件进入上传框后，逻辑如下：</span><br><span class="line"></span><br><span class="line">0. 一进入该html页面，执行该Vue对象的 init 方法，oUpload 对象初始化一系列只与当前用户有关、与所选择上传文件无关的属性</span><br><span class="line"></span><br><span class="line">1. ```js</span><br><span class="line">   var dObj = new Dropzone(&quot;#upload-select-area&quot;, option);</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        通过Dropzone，绑定对象 option 和 id&#x3D;”upload-select-area” 的 div 组件，一旦拖拽&#x2F;选择文件，便执行 option 中的 addedfile: function(file) 方法</p>
<ol start="2">
<li>addedfile 方法传入用户选择上传的文件 file，进行类型判断，并增加了一些属性，和 file 本身，一起赋给Vue对象中 data 里的fileDatas: []</li>
</ol>
<p>​        若用户选择多个文件，则fileDatas数组中有多个经处理后规范的fileinfo文件对象</p>
<ol start="3">
<li><p>规范的fileinfo对象被页面展示</p>
<p>注意：通过Vue，并非直接操纵DOM树，而是先js操纵Vue组件，再由Vue实现对DOM树的操纵、即页面的展示的变化</p>
</li>
</ol>
<h3 id="2-file-upload-js"><a href="#2-file-upload-js" class="headerlink" title="2. file-upload.js"></a>2. file-upload.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;iic-panel-top&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&quot;../../assets/libs/dropzone/dropzone.css&quot;</span>);</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&quot;../../assets/libs/dropzone/dropzone.js&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> css = <span class="built_in">require</span>(<span class="string">&quot;./file-upload.css&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> tpl = <span class="built_in">require</span>(<span class="string">&quot;./file-upload.html&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">        <span class="attr">data</span>: <span class="keyword">function</span> <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">fileDatas</span>: [],  <span class="comment">//&#123;fileId:&#x27;&#x27;, name:&#x27;文件名&#x27;, size:&#x27;12345676&#x27;, url:&#x27;&#x27;, enc:0, status:0未上传1已上传, file:文件&#125;</span></span><br><span class="line">                <span class="attr">uploadUrl</span>: <span class="string">&#x27;/mgrapi/admin/file/upload&#x27;</span>,</span><br><span class="line"></span><br><span class="line">                <span class="attr">maxSize</span>: <span class="string">&#x27;2M&#x27;</span>,</span><br><span class="line">                <span class="attr">suffix</span>: [<span class="string">&#x27;.jpg&#x27;</span>,<span class="string">&#x27;.jpeg&#x27;</span>,<span class="string">&#x27;.png&#x27;</span>,<span class="string">&#x27;.gif&#x27;</span>,<span class="string">&#x27;.bmp&#x27;</span>],</span><br><span class="line"></span><br><span class="line">                <span class="attr">oUpload</span>: <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">mounted</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">initUpload</span>();</span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="attr">template</span>: tpl,</span><br><span class="line"></span><br><span class="line">        <span class="attr">methods</span>:&#123;</span><br><span class="line">            <span class="attr">initUpload</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">oUpload</span> = <span class="title class_">IICUpload</span>.<span class="title function_">create</span>(&#123;</span><br><span class="line">                    <span class="attr">token</span>: <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">                    <span class="attr">fileElId</span>: <span class="string">&#x27;&#x27;</span>,               <span class="comment">//file组件的ID</span></span><br><span class="line">                    <span class="attr">uploadUrl</span>: _this.<span class="property">uploadUrl</span>,              <span class="comment">//文件上传的后台处理路径</span></span><br><span class="line">                    <span class="attr">infoUrl</span>: <span class="string">&#x27;&#x27;</span>,                <span class="comment">//读取文件信息路径</span></span><br><span class="line">                    <span class="attr">params</span>: &#123;                   <span class="comment">//文件上传的其他参数</span></span><br><span class="line">                        <span class="attr">uploadType</span>: <span class="number">1</span>,         <span class="comment">//上传类型(0:上传一般文件，1:上传临时文件，2:加密上传文件, 3:指定路径上传文件)</span></span><br><span class="line">                        <span class="attr">newName</span>: <span class="string">&#x27;&#x27;</span>,            <span class="comment">//新文件名</span></span><br><span class="line">                        <span class="attr">oldName</span>: <span class="string">&#x27;&#x27;</span>,            <span class="comment">//旧文件名</span></span><br><span class="line">                        <span class="attr">savePath</span>: <span class="string">&#x27;&#x27;</span>            <span class="comment">//保存的目录路径</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">suffix</span>: _this.<span class="property">suffix</span>,                 <span class="comment">//后缀</span></span><br><span class="line">                    <span class="attr">maxsize</span>: _this.<span class="property">maxSize</span>,              <span class="comment">//文件大小</span></span><br><span class="line">                    <span class="attr">succFn</span>: showSuccAlert,               <span class="comment">//成功的回调方法</span></span><br><span class="line">                    <span class="attr">failFn</span>: showErrAlert                <span class="comment">//失败的回调方法</span></span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> option = &#123;</span><br><span class="line">                    <span class="attr">url</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                    <span class="attr">addedfile</span>: <span class="keyword">function</span>(<span class="params">file</span>)&#123;</span><br><span class="line">                        <span class="keyword">var</span> _size = _this.<span class="title function_">_getFileSize</span>(file);</span><br><span class="line">                        <span class="keyword">var</span> filename = file.<span class="property">name</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(!_this.<span class="title function_">_checkFileSize</span>(file)) <span class="keyword">return</span>;</span><br><span class="line">                        <span class="comment">//判断文件类型</span></span><br><span class="line">                        <span class="keyword">var</span> _type = $FileUtil.<span class="title function_">getFileType</span>(filename);</span><br><span class="line">                        <span class="keyword">if</span>(_type==<span class="string">&quot;Other&quot;</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(_type == <span class="string">&#x27;Image&#x27;</span>)&#123;</span><br><span class="line">                            <span class="keyword">var</span> reader = <span class="keyword">new</span> <span class="title class_">FileReader</span>();</span><br><span class="line">                            reader.<span class="title function_">readAsDataURL</span>(file);</span><br><span class="line">                            reader.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">                                _this.<span class="property">fileDatas</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">                                    <span class="attr">fileId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                                    <span class="attr">name</span>: filename,</span><br><span class="line">                                    <span class="attr">size</span>: _size,</span><br><span class="line">                                    <span class="attr">url</span>: e.<span class="property">target</span>.<span class="property">result</span>,</span><br><span class="line">                                    <span class="attr">enc</span>: <span class="number">0</span>,</span><br><span class="line">                                    <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">                                    <span class="attr">file</span>: file</span><br><span class="line">                                &#125;);</span><br><span class="line">                            &#125;;</span><br><span class="line">                            <span class="keyword">return</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">var</span> _srcUrl = <span class="string">&#x27;/assets/images/fileicon/file.png&#x27;</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(_type == <span class="string">&#x27;PDF&#x27;</span>) _srcUrl=<span class="string">&#x27;/assets/images/fileicon/pdf.png&#x27;</span>;</span><br><span class="line">                        <span class="keyword">if</span>(_type == <span class="string">&#x27;Word&#x27;</span>) _srcUrl=<span class="string">&#x27;/assets/images/fileicon/word.png&#x27;</span>;</span><br><span class="line">                        <span class="keyword">if</span>(_type == <span class="string">&#x27;Excel&#x27;</span>) _srcUrl=<span class="string">&#x27;/assets/images/fileicon/excel.png&#x27;</span>;</span><br><span class="line">                        <span class="keyword">if</span>(_type == <span class="string">&#x27;Video&#x27;</span>) _srcUrl=<span class="string">&#x27;/assets/images/fileicon/video.png&#x27;</span>;</span><br><span class="line">                        <span class="keyword">if</span>(_type == <span class="string">&#x27;Zip&#x27;</span>) _srcUrl=<span class="string">&#x27;/assets/images/fileicon/zip.png&#x27;</span>;</span><br><span class="line"></span><br><span class="line">                        _this.<span class="property">fileDatas</span>.<span class="title function_">push</span>(&#123;</span><br><span class="line">                            <span class="attr">fileId</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">                            <span class="attr">name</span>: filename,</span><br><span class="line">                            <span class="attr">size</span>: _size,</span><br><span class="line">                            <span class="attr">url</span>: _srcUrl,</span><br><span class="line">                            <span class="attr">enc</span>: <span class="number">0</span>,</span><br><span class="line">                            <span class="attr">status</span>: <span class="number">0</span>,</span><br><span class="line">                            <span class="attr">file</span>: file</span><br><span class="line">                        &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">var</span> dObj = <span class="keyword">new</span> <span class="title class_">Dropzone</span>(<span class="string">&quot;#upload-select-area&quot;</span>, option);</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">onUploadAll</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">                <span class="keyword">var</span> cycleFn = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                    <span class="keyword">var</span> _fileinfo = _this.<span class="title function_">_getNeedFileinfo</span>();</span><br><span class="line">                    <span class="keyword">if</span>(_fileinfo)&#123;</span><br><span class="line">                        _this.<span class="title function_">onUpload</span>(_fileinfo, cycleFn);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="title function_">cycleFn</span>();</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">onUpload</span>: <span class="keyword">function</span>(<span class="params">fileinfo, succFn, failFn</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">                succFn = succFn || showSuccAlert;</span><br><span class="line">                failFn = failFn || showErrAlert;</span><br><span class="line"></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">oUpload</span>.<span class="property">option</span>.<span class="property">params</span>.<span class="property">oldName</span> = fileinfo.<span class="property">name</span>;</span><br><span class="line">                <span class="comment">//如果指定了路径就是上传指定路径文件</span></span><br><span class="line">                <span class="keyword">if</span> (fileinfo.<span class="property">savePath</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">oUpload</span>.<span class="property">option</span>.<span class="property">params</span>.<span class="property">savePath</span> = fileinfo.<span class="property">savePath</span>;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">oUpload</span>.<span class="property">option</span>.<span class="property">params</span>.<span class="property">uploadType</span> = <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">oUpload</span>.<span class="property">option</span>.<span class="property">params</span>.<span class="property">uploadType</span> = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                fileinfo.<span class="property">loading</span> = <span class="number">1</span>;</span><br><span class="line">                _this.$forceUpdate();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> file = fileinfo.<span class="property">file</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">oUpload</span>.<span class="title function_">uploadFile</span>(file, <span class="keyword">function</span>(<span class="params">info</span>)&#123;</span><br><span class="line">                    fileinfo.<span class="property">fileId</span> = info.<span class="property">fileId</span>;</span><br><span class="line">                    fileinfo.<span class="property">status</span> = <span class="number">1</span>;</span><br><span class="line">                    fileinfo.<span class="property">loading</span> = <span class="number">0</span>;</span><br><span class="line">                    _this.$forceUpdate();</span><br><span class="line"></span><br><span class="line">                    <span class="title function_">succFn</span>(<span class="string">&quot;上传成功&quot;</span>);</span><br><span class="line">                &#125;, <span class="keyword">function</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">                    fileinfo.<span class="property">loading</span> = <span class="number">0</span>;</span><br><span class="line">                    _this.$forceUpdate();</span><br><span class="line">                    <span class="title function_">failFn</span>(msg);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">onDelAll</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">fileDatas</span> = [];</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">onDelete</span>: <span class="keyword">function</span>(<span class="params">fileinfo</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> index = -<span class="number">1</span>;</span><br><span class="line">                $.<span class="title function_">each</span>(<span class="variable language_">this</span>.<span class="property">fileDatas</span>, <span class="keyword">function</span>(<span class="params">i,obj</span>)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(obj==fileinfo)&#123;</span><br><span class="line">                        index = i;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">if</span>(index&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.$delete(<span class="variable language_">this</span>.<span class="property">fileDatas</span>, index);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">showUploadBtn</span>: <span class="keyword">function</span>(<span class="params">fileinfo</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(fileinfo.<span class="property">status</span>==<span class="number">1</span>) <span class="keyword">return</span> <span class="string">&#x27;disabled&#x27;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">showBtnArea</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">fileDatas</span>.<span class="property">length</span>==<span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">showLoading</span>: <span class="keyword">function</span>(<span class="params">fileinfo</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> fileinfo.<span class="property">loading</span>;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">onSelected</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                $(<span class="string">&#x27;#upload-select-area&#x27;</span>).<span class="title function_">click</span>();</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">_getNeedFileinfo</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,len=<span class="variable language_">this</span>.<span class="property">fileDatas</span>.<span class="property">length</span>;i&lt;len;i++)&#123;</span><br><span class="line">                    <span class="keyword">var</span> fileinfo = <span class="variable language_">this</span>.<span class="property">fileDatas</span>[i];</span><br><span class="line">                    <span class="keyword">if</span>(fileinfo.<span class="property">status</span> == <span class="number">0</span>) <span class="keyword">return</span> fileinfo;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">_getFileSize</span>: <span class="keyword">function</span>(<span class="params">file</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> _size = <span class="built_in">parseInt</span>(file.<span class="property">size</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(_size&lt;<span class="number">1024</span>) <span class="keyword">return</span> _size;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(_size&lt;<span class="number">1024</span>*<span class="number">1024</span>)&#123;</span><br><span class="line">                    _size = _size/<span class="number">1024</span>;</span><br><span class="line">                    _size = _size.<span class="title function_">toFixed</span>(<span class="number">1</span>)+<span class="string">&#x27;KB&#x27;</span></span><br><span class="line">                    <span class="keyword">return</span> _size;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                _size = _size/(<span class="number">1024</span>*<span class="number">1024</span>);</span><br><span class="line">                _size = _size.<span class="title function_">toFixed</span>(<span class="number">1</span>)+<span class="string">&#x27;M&#x27;</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> _size;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="attr">_checkFileSize</span>: <span class="keyword">function</span> (<span class="params">file</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> _size=<span class="built_in">parseInt</span>(file.<span class="property">size</span>);</span><br><span class="line">                <span class="keyword">if</span>(_size&lt;<span class="number">1024</span>*<span class="number">1024</span>*<span class="number">2</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>点击上传后，文件传到后端Controller的部分逻辑如下:</p>
<ol>
<li><p>向onUpload中传入fileinfo</p>
</li>
<li><p>onUpload 调用 this.oUpload.uploadFile方法，传入 var file &#x3D; fileinfo.file; 以及成功与失败的回调函数</p>
</li>
<li><p>通过this获取到option中的token和回调函数</p>
</li>
<li><p>判断token后通过AJAX POST发送fileData到后端Controller，其中fileData中包含fileinfo中的file属性，token属性以及所有其他属性</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">IICUpload</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">uploadFile</span> = <span class="keyword">function</span>(<span class="params">file, succFn, failFn</span>)&#123;</span><br><span class="line">   <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">succFn</span> = succFn || <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">succFn</span>;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">failFn</span> = failFn || <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">failFn</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//判断token</span></span><br><span class="line">   <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">token</span>)&#123;</span><br><span class="line">      _this.<span class="property">option</span>.<span class="title function_">failFn</span>(<span class="string">&#x27;token不能为空&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span>(!file)&#123;</span><br><span class="line">      _this.<span class="property">option</span>.<span class="title function_">failFn</span>(<span class="string">&#x27;文件不能为空&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">var</span> fileData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span><br><span class="line">   fileData.<span class="title function_">append</span>(<span class="string">&quot;file&quot;</span>, file);</span><br><span class="line">   fileData.<span class="title function_">append</span>(<span class="string">&quot;token&quot;</span>, <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">token</span>);</span><br><span class="line">   <span class="comment">//加入其他参数</span></span><br><span class="line">   fileData = <span class="variable language_">this</span>.<span class="title function_">__addParams</span>(fileData);</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//Ajax提交上传</span></span><br><span class="line">   <span class="keyword">var</span> url = <span class="variable language_">this</span>.<span class="property">option</span>.<span class="property">uploadUrl</span>;</span><br><span class="line">   $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">processData</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">data</span>: fileData,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">           <span class="keyword">var</span> success = res.<span class="property">success</span>;</span><br><span class="line">           <span class="keyword">if</span>(success)&#123;</span><br><span class="line">              <span class="keyword">var</span> fileinfo = res.<span class="property">data</span>;</span><br><span class="line">              _this.<span class="property">fileInfo</span> = fileinfo;</span><br><span class="line">              _this.<span class="property">option</span>.<span class="title function_">succFn</span>(fileinfo);</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">              <span class="keyword">var</span> msg = res.<span class="property">msg</span>;</span><br><span class="line">              _this.<span class="property">option</span>.<span class="title function_">failFn</span>(msg);</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">IICUpload</span>(<span class="params">option</span>)&#123;</span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">option</span> = &#123;</span><br><span class="line">      <span class="attr">token</span>: <span class="string">&#x27;&#x27;</span>,             <span class="comment">//上传权限令牌,必填</span></span><br><span class="line">      <span class="attr">fileElId</span>: <span class="string">&#x27;&#x27;</span>,           <span class="comment">//file组件的ID</span></span><br><span class="line">      <span class="attr">uploadUrl</span>: <span class="string">&#x27;&#x27;</span>,          <span class="comment">//文件上传的后台处理路径</span></span><br><span class="line">      <span class="attr">infoUrl</span>: <span class="string">&#x27;&#x27;</span>,            <span class="comment">//读取文件信息路径</span></span><br><span class="line">      <span class="attr">params</span>: &#123;              <span class="comment">//文件上传的其他参数</span></span><br><span class="line">         <span class="attr">uploadType</span>: <span class="string">&#x27;&#x27;</span>,          <span class="comment">//上传类型(1:上传一般文件, 2:指定路径上传文件, 3:加密上传文件, 4:上传临时文件)</span></span><br><span class="line">         <span class="attr">newName</span>: <span class="string">&#x27;&#x27;</span>,         <span class="comment">//新文件名</span></span><br><span class="line">         <span class="attr">oldName</span>: <span class="string">&#x27;&#x27;</span>,         <span class="comment">//旧文件名</span></span><br><span class="line">         <span class="attr">savePath</span>: <span class="string">&#x27;&#x27;</span>         <span class="comment">//保存的目录路径</span></span><br><span class="line">      &#125;,                </span><br><span class="line">      <span class="attr">suffix</span>: [],                <span class="comment">//后缀</span></span><br><span class="line">      <span class="attr">maxsize</span>: <span class="string">&#x27;2M&#x27;</span>,          <span class="comment">//文件大小</span></span><br><span class="line">      <span class="attr">succFn</span>: <span class="literal">null</span>,           <span class="comment">//成功的回调方法</span></span><br><span class="line">      <span class="attr">failFn</span>: <span class="literal">null</span>            <span class="comment">//失败的回调方法</span></span><br><span class="line">   &#125;;</span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">fileInfo</span> = &#123;&#125;;             <span class="comment">//文件信息</span></span><br><span class="line"></span><br><span class="line">   <span class="variable language_">this</span>.<span class="property">option</span> = <span class="title class_">IICUpload</span>.<span class="title function_">__initOption</span>(option);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ajax Post发送后，通过注解@RequestParam(value &#x3D; “file”)，Spring MVC将前端的”file”属性自动匹配地赋给对象MultipartFile file，前端”file”中多余属性则忽视，缺失属性则置为null; 其余属性则自动匹配地赋给对象ULFileInfoVo fileInfo，用于后端的后续业务逻辑。</p>
<p>Spring MVC:</p>
<ol>
<li><p>可以在SpringMVC的Controller中具体请求处理方法中，直接使用基本数据类型或者String类型的参数进行对映，只要前端页面和方法中指定的参数名称是完全一致的，这里包括大小写，那么前端这个参数名称所赋有的值，就会传递到后台的请求处理方法中。<br>由SpringMVC底层的拦截器实现</p>
<p>它会将请求中传来的所有参数，请求处理方法中的参数进行对比，如果发现是一模一样的，它就会从请求中把那个参数的值拿出来赋给处理方法中的那个变量，以供后端controller继续操作。</p>
</li>
<li><p>SpringMVC的过滤器不光接收映射同名的参数，而且还会将类型帮助我们转换成功。但是，类型的转换，存在着问题，比如:int类型是整数类型，刚才传来的参数id就是int类型，而值恰好是1，则不会出现问题，可是如果将值改成abc等非数字的内容呢？那肯定是会报错的，因为数字格式异常，无法进行转换。同时，还有传递的时候忘记传递id属性而只传了name属性，或者id属性只给了key，而没有value值，这些情况，都会导致错误的出现。</p>
</li>
<li><p>本例中，后端JavaBean来接收参数 并加入@RequestParam(value &#x3D; “file”)注解</p>
<p>@RequestParam 注解用来<strong>标注在控制器方法的参数上</strong>，springmvc 从 request 中获取请求的值赋值给方法的参数 @RequestParam 指定 name 时，可以获取 request 中指定参数的值，相当于 request.getParameter (name)或 request.getParameters (name)</p>
</li>
<li><p>restful风格传值方式：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/91600da4df95">使用RESTful风格开发Java Web - 简书 (jianshu.com)</a></p>
<p>REST是<strong>REpresentational State Transfer</strong>的缩写（一般中文翻译为表述性状态转移），REST 是一种体系结构，而 HTTP 是一种包含了 REST 架构属性的协议，为了便于理解，我们把它的首字母拆分成不同的几个部分：</p>
<ul>
<li><strong>表述性（REpresentational）：</strong> REST 资源实际上可以用各种形式来进行表述，包括 XML、JSON 甚至 HTML——最适合资源使用者的任意形式；</li>
<li><strong>状态（State）：</strong> 当使用 REST 的时候，我们更关注资源的状态而不是对资源采取的行为；</li>
<li><strong>转义（Transfer）：</strong> REST 涉及到转移资源数据，它以某种表述性形式从一个应用转移到另一个应用。</li>
</ul>
<p><strong>简单地说，REST 就是将资源的状态以适合客户端或服务端的形式从服务端转移到客户端（或者反过来）。</strong>在 REST 中，资源<strong>通过 URL 进行识别和定位</strong>，然后通过**行为(即 HTTP 方法)**来定义 REST 来完成怎样的功能。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_40437152/article/details/83270264">springMVC接收JSON参数详解_白面小生的博客-CSDN博客_springmvc如何接收json数据</a></p>
<p>GET请求想必大家都不陌生，它将参数以url?username&#x3D;”admin”&amp;password&#x3D;123这种方式发送到服务器，并且request.getParameter可以接收到这种参数，我们在浏览器地址栏上也可以看到这一点。而我们Ajax使用的POST，并且发送的是JSON对象，那么后台是如何获取到的呢？答案就在于这个Content-Type x-www-form-urlencoded的编码方式把JSON数据转换成一个字串,(username&#x3D;”admin”&amp;password&#x3D;123)然后把这个字串添加到url后面，用?分割，（是不是和GET方法很像），提交方式为POST时候，浏览器把数据封装到HTTP BODY中，然后发送到服务器。所以并不会显示在URL上。</p>
<p><strong>注意：</strong><br>（1）当Ajax以application&#x2F;x-www-form-urlencoded格式上传即使用JSON对象，后台需要使用@RequestParam 或者Servlet获取。<br>（2） 当Ajax以application&#x2F;json格式上传即使用JSON字符串，后台需要使用@RquestBody获取。</p>
</li>
<li><p>在 ajax 中 contentType 设置为 false 是为了避免 JQuery 对其操作，从而失去分界符，而使服务器不能正常解析文件。</p>
</li>
<li><p>ajax中<strong>processData:</strong> (默认: true) 默认情况下，发送的数据将被转换为对象(技术上讲并非字符串) 以配合默认内容类型 “application&#x2F;x-www-form-urlencoded”。如果要发送 DOM 树信息或其它不希望转换的信息，请设置为 false。</p>
</li>
</ol>
<h3 id="3-后端Controller"><a href="#3-后端Controller" class="headerlink" title="3. 后端Controller"></a>3. 后端Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/mgrapi/admin/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminFileController</span> <span class="keyword">extends</span> <span class="title class_">MgrBaseController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(AdminFileController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAdminFileService iAdminFileService;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;上传图片&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">   <span class="meta">@RequestMapping(path = &quot;/upload&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(value = &quot;file&quot;)</span> MultipartFile file, ULFileInfoVo fileInfo)</span> &#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">LllFileV2</span> <span class="variable">fileinfo</span> <span class="operator">=</span> iAdminFileService.uploadFile(file,fileInfo);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(fileinfo, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">          log.error(<span class="string">&quot;&quot;</span>,ex);</span><br><span class="line">          <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@GetMapping(path = &quot;/token&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">fetchToken</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> iAdminFileService.fetchToken();</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(token, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询文件列表&quot;, notes = &quot;查询文件列表&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/query&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">queryFileList</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">int</span> pageno, <span class="meta">@RequestParam</span> <span class="type">int</span> pagesize, String id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> <span class="built_in">this</span>.getCurrentSysUser();</span><br><span class="line">            ListPageVo&lt;AdminFileVo&gt; list = iAdminFileService.queryFilePage(pageno, pagesize, id, sysUser);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(list, <span class="string">&quot;OK&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(ex);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="杂记"><a href="#杂记" class="headerlink" title="杂记"></a>杂记</h2><p>SSP: self-service platform<br>IDR: 标识解析展现 ID Read<br>API: </p>
<p>FileCenter</p>
<p>工业互联网标识：国家制定的规范 统一的公共数据格式</p>
<p>88.168.100&#x2F;xxxxxxxx<br>标识前缀：中国.鑫兴.<br>    顶级节点.二级节点.企业节点</p>
<p><a target="_blank" rel="noopener" href="https://ssp.gdsinsing.com/#/statis/home/user-home">https://ssp.gdsinsing.com/#/statis/home/user-home</a></p>
<p><a target="_blank" rel="noopener" href="https://ssp.gdsinsing.com/index.html#/statis/home/user-home">https://ssp.gdsinsing.com/index.html#/statis/home/user-home</a></p>
<p>https默认端口443</p>
<p>http默认端口80</p>
<p>nginx 443 </p>
<p>ssp 8095</p>
<p>#&#x2F;statis&#x2F;home&#x2F;user-home&#x3D;&gt;#&#x2F;statis&#x2F;home&#x2F;user-home.js</p>
<p>require 异步加载</p>
<p><a target="_blank" rel="noopener" href="https://ssp.gdsinsing.com/statis/home/user-home.js">https://ssp.gdsinsing.com/statis/home/user-home.js</a></p>
<p><a target="_blank" rel="noopener" href="https://ssp.gdsinsing.com/statis/home/user-home.html">https://ssp.gdsinsing.com/statis/home/user-home.html</a></p>
<p>web页面 一般都是短连接</p>
<p>postman<br>form-data :上传文件<br>x-www-form-urlencoded  :普通post 键值对，表单数据<br>raw :数据写在body内 非键值对  RESTful 手机 流行 整个json传过去</p>
<p>authId对应应用白名单，并不对应每个用户</p>
<p>isCont为false则不读文件内容，只读文件路径等信息</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/19/%E8%AE%A1%E7%BD%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/19/%E8%AE%A1%E7%BD%91/" class="post-title-link" itemprop="url">计网学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-19 16:48:20" itemprop="dateCreated datePublished" datetime="2022-04-19T16:48:20+08:00">2022-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-28 16:09:46" itemprop="dateModified" datetime="2022-04-28T16:09:46+08:00">2022-04-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、"><a href="#一、" class="headerlink" title="一、"></a>一、</h1><h2 id="2-网络分类"><a href="#2-网络分类" class="headerlink" title="2. 网络分类"></a>2. 网络分类</h2><p><strong>个域网PAN（ Personal Area Network ）</strong></p>
<ul>
<li>能在便携式消费电器与通信设备之间进行短距离通信的网络</li>
<li>覆盖范围一般在10米半径以内，如蓝牙耳机等</li>
</ul>
<p><strong>局域网LAN（Local Area Network）</strong></p>
<ul>
<li>局部地区形成的区域网络，如企业网络</li>
<li>分布地区范围有限，可大可小，大到一栋建筑、小到办公室内的组网</li>
<li>电脑WLAN接入，打印机共享等等</li>
</ul>
<p><strong>城域网MAN（Metropolitan Area Network ）</strong></p>
<ul>
<li>范围覆盖一个城市的网络</li>
</ul>
<p><strong>广域网WAN（Wide Area Network）</strong></p>
<ul>
<li>覆盖很大地理区域，乃至覆盖地区和国家</li>
</ul>
<h2 id="3-接入网"><a href="#3-接入网" class="headerlink" title="3. 接入网"></a>3. 接入网</h2><p><strong>接入网的用途</strong></p>
<ul>
<li>接入网的用途是将主机连接到边缘路由器上</li>
<li>边缘路由器是端系统Host去往任何其他远程端系统的路径上的第一台路由器</li>
</ul>
<h2 id="4-网络核心两大功能"><a href="#4-网络核心两大功能" class="headerlink" title="4. 网络核心两大功能"></a>4. 网络核心两大功能</h2><ol>
<li>路由 确定数据分组从源到目标所使用的路径（全局操作）</li>
<li>转发 路由器或交换机将接收到的数据分组转发出去（即移动到该设备的某个输出接口）（本地操作）</li>
</ol>
<h1 id="二、物理层"><a href="#二、物理层" class="headerlink" title="二、物理层"></a>二、物理层</h1><ul>
<li>物理层考虑的是怎样才能<strong>在连接各种计算机的传输媒体上传输数据比特流</strong>，而不是指具体的传输媒体。</li>
<li>物理层的作用是要尽可能地<strong>屏蔽掉不同传输媒体和通信手段的差异</strong>。</li>
<li>用于物理层的协议也常称为<strong>物理层规程</strong> (procedure)。</li>
</ul>
<h2 id="1-物理介质"><a href="#1-物理介质" class="headerlink" title="1. 物理介质"></a>1. 物理介质</h2><ol>
<li><p>光纤 </p>
<p>高速点对点</p>
</li>
<li><p>双绞线 </p>
<p>电话线为1对双绞线，网线为4对双绞线，广泛用于计算机网络（以太网）双向传输</p>
</li>
<li><p>同轴电缆  </p>
<p>两根同心铜导线，双向传输</p>
</li>
<li><p>无线电（陆地无线电、卫星无线电信道) </p>
<ul>
<li><p>电磁频谱中各种“波段”携带的信号</p>
</li>
<li><p>半双工（发送方到接收方）</p>
<p>Half Duplex, 一个时间段内只有一个动作发生</p>
</li>
<li><p>无线局域网（WiFi）<br>10-100 Mbps；10米</p>
</li>
<li><p>广域（如3&#x2F;4&#x2F;5G蜂窝）<br>在~10公里范围内</p>
</li>
<li><p>蓝牙：短距离，有限速率</p>
</li>
</ul>
</li>
</ol>
<h2 id="2-数据交换方式"><a href="#2-数据交换方式" class="headerlink" title="2. 数据交换方式"></a>2. 数据交换方式</h2><ol>
<li><p>分组交换</p>
<p><strong>分组交换采用把一个个小的数据包存储转发传输来实现数据交换。</strong></p>
<p>不具有实时性</p>
<p>会丢包</p>
</li>
<li><p>电路交换</p>
<p>建立连接、数据传输、释放连接</p>
</li>
</ol>
<h1 id="三、数据链路层"><a href="#三、数据链路层" class="headerlink" title="三、数据链路层"></a>三、数据链路层</h1><h2 id="1-功能"><a href="#1-功能" class="headerlink" title="1. 功能"></a>1. 功能</h2><p><strong>成帧 （Framing）</strong><br>将比特流划分成“帧”的主要目的是为了检测和纠正物理层在比特传输中可能出现的错误，数据链路层功能需借助“帧”的各个域来实现</p>
<p><strong>差错控制 （Error Control）</strong><br>处理传输中出现的差错，如位错误、丢失等</p>
<p><strong>流量控制 （Flow Control）</strong><br>确保发送方的发送速率，不大于接收方的处理速率，避免接收缓冲区溢出</p>
<h2 id="2-数据链路层提供的服务"><a href="#2-数据链路层提供的服务" class="headerlink" title="2. 数据链路层提供的服务"></a>2. 数据链路层提供的服务</h2><p>1.无确认 无连接 服务（ Unacknowledged connectionless ）</p>
<ul>
<li>接收方不对收到的帧进行确认</li>
<li>适用场景：误码率低的可靠信道；实时通信；</li>
<li>网络实例：以太网</li>
</ul>
<p>2.有确认 无连接 服务（ Acknowledged connectionless ）</p>
<ul>
<li>每一帧都得到单独的确认</li>
<li>适用场景：不可靠的信道（无线信道）</li>
<li>网络实例：802.11</li>
</ul>
<p>3.有确认 有连接 服务（ Acknowledged connection-oriented ）</p>
<ul>
<li>适用场景：长延迟的不可靠信道</li>
</ul>
<h2 id="3-成帧（Framing）"><a href="#3-成帧（Framing）" class="headerlink" title="3. 成帧（Framing）"></a>3. 成帧（Framing）</h2><p>要解决的关键问题：如何标识一个帧的开始？</p>
<ul>
<li><p>接收方必须能从物理层接收的比特流中明确区分出一帧的开始和结束，这个问题被称为帧同步或帧定界</p>
</li>
<li><p>关键：选择何种定界符？定界符出现在数据部分如何处理？</p>
</li>
<li><p>framing方式包括：</p>
<ol>
<li><p>带比特填充的定界符法</p>
<p>定界符：两个0比特之间，连续6个1比特，即01111110，0x7E</p>
</li>
<li><p>物理层编码违例</p>
<p>核心思想：选择的定界符不会在数据部分出现</p>
</li>
</ol>
</li>
</ul>
<h2 id="4-媒体接入控制"><a href="#4-媒体接入控制" class="headerlink" title="4. 媒体接入控制"></a>4. 媒体接入控制</h2><p>数据链路层分为两个子层：<br>MAC子层：介质访问 紧挨物理层<br>LLC子层：承上启下（弱层）紧挨网络层</p>
<p>MAC (Medium Access Control)子层</p>
<h3 id="4-1-无线局域网WLAN"><a href="#4-1-无线局域网WLAN" class="headerlink" title="4.1 无线局域网WLAN"></a>4.1 无线局域网WLAN</h3><p>无线局域网（Wireless Local Area Network，WLAN)：指以无线信道作为传输介质的计算机局域网</p>
<h3 id="4-2-虚拟局域网VLAN"><a href="#4-2-虚拟局域网VLAN" class="headerlink" title="4.2 虚拟局域网VLAN"></a>4.2 虚拟局域网VLAN</h3><h4 id="4-2-1-广播域"><a href="#4-2-1-广播域" class="headerlink" title="4.2.1 广播域"></a>4.2.1 广播域</h4><p><strong>广播域（Broadcasting Domain）</strong></p>
<ul>
<li>广播域是广播帧能够到达的范围；</li>
<li>缺省情况下，交换机所有端口同属于一个广播域，无法隔离广播域；</li>
<li>广播帧在广播域中传播，占用资源，降低性能，且具有安全隐患。</li>
</ul>
<h4 id="4-2-2-概况"><a href="#4-2-2-概况" class="headerlink" title="4.2.2 概况"></a>4.2.2 概况</h4><p><strong>VLAN是一个在物理网络上根据用途，工作组、应用等来逻辑划分的局域网络，与用户的物理位置没有关系。</strong></p>
<p>将一个物理意义上的LAN划分为若干个VLAN，不同VLAN的成员不能直接进行二层通信。</p>
<p>不同VLAN成员需要通过三层设备，（通过路由器或三层交换机进行VLAN间路由，）实现VLAN间通信。</p>
<p>VLAN类型：</p>
<ol>
<li>基于端口的VLAN</li>
<li>基于MAC地址的VLAN</li>
<li>基于协议的VLAN</li>
<li>基于子网的VLAN</li>
</ol>
<h1 id="四、网络层"><a href="#四、网络层" class="headerlink" title="四、网络层"></a>四、网络层</h1><h2 id="1-网络层概述"><a href="#1-网络层概述" class="headerlink" title="1. 网络层概述"></a>1. 网络层概述</h2><p>网络层在数据链路层提供的两个相邻端点之间的数据帧的传送功能上，进一步管理网络中的数据通信，将数据设法从源端经过若干个中间节点传送到目的端，从而向运输层提供最基本的端到端的数据传送服务。</p>
<h2 id="2-网络层关键功能"><a href="#2-网络层关键功能" class="headerlink" title="2. 网络层关键功能"></a>2. 网络层关键功能</h2><ol>
<li>路由（控制面）<ul>
<li>选择数据报从源端到目的端的路径</li>
<li>核心：路由算法与协议</li>
</ul>
</li>
<li>转发（数据面）<ul>
<li>将数据报从路由器的输入接口传送到正确的输出接口</li>
</ul>
</li>
</ol>
<h2 id="3-Internet网际协议"><a href="#3-Internet网际协议" class="headerlink" title="3. Internet网际协议"></a>3. Internet网际协议</h2><h3 id="3-1-IPv4"><a href="#3-1-IPv4" class="headerlink" title="3.1 IPv4"></a>3.1 IPv4</h3><h4 id="3-1-1-概述"><a href="#3-1-1-概述" class="headerlink" title="3.1.1 概述"></a>3.1.1 概述</h4><p>IPv4协议，网际协议版本4，一种无连接的协议，是互联网的核心，也是使用最广泛的网际协议版本，其后继版本为IPv6</p>
<p>Internet协议执行<strong>两个基本功能</strong></p>
<ul>
<li>寻址(addressing)</li>
<li>分片(fragmentation)</li>
</ul>
<p>相关问题与解决思路：</p>
<ol>
<li>为解决IPv4数据报长度大于传输链路的MTU的问题，通过<strong>分片机制</strong>解决：<strong>标识、标志、片偏移</strong></li>
<li>防止循环转发浪费网络资源（路由错误、设备故障…），通过<strong>跳数限制</strong>解决：<strong>生存时间TTL</strong></li>
<li>IP报头错误导致无效传输，通过<strong>头部机校验</strong>解决：<strong>首部校验和</strong></li>
</ol>
<p>注意：</p>
<ol>
<li>分组packet是网络层的概念，帧frame是数据链路层的概念</li>
<li>帧由头标、有效载荷和尾标组成</li>
</ol>
<h4 id="3-1-2-IP数据报"><a href="#3-1-2-IP数据报" class="headerlink" title="3.1.2 IP数据报"></a>3.1.2 IP数据报</h4><p>IPv4数据报由首部和数据两部分组成，首部包含：</p>
<ul>
<li><strong>版本</strong>： 4bit ，表示采用的IP协议版本</li>
<li><strong>首部长度</strong>： 4bit，表示整个IP数据报首部的长度</li>
<li><strong>区分服务</strong>： 8bit ，该字段一般情况下不使用</li>
<li><strong>总长度</strong>： 16bit ，表示整个IP报文的长度,能表示的最大字节为2^16-1&#x3D;65535字节</li>
<li><strong>标识</strong>： 16bit ， IP软件通过计数器自动产生，每产生1个数据报计数器加1；在ip分片以后，用来标识同一片分片</li>
<li><strong>标志</strong>： 3bit，目前只有两位有意义。<br>MF，置1表示后面还有分片，置0表示这是数据报片的最后1个；<br>DF，不能分片标志，置0时表示允许分片</li>
<li><strong>片偏移</strong>： 13bit，表示IP分片后，相应的IP片在总的IP片的相对位置</li>
<li><strong>生存时间TTL(Time To Live)</strong> ：8bit,表示数据报在网络中的生命周期，用通过路由器的数量来计量，即跳数（每经过一个路由器会减1）</li>
<li><strong>协议</strong>：8bit，标识上层协议（TCP&#x2F;UDP&#x2F;ICMP…）</li>
<li><strong>首部校验和</strong>：16bit ，对数据报首部进行校验，不包括数据部分</li>
<li><strong>源地址</strong>：32bit，标识IP片的发送源IP地址</li>
<li><strong>目的地址</strong>：32bit，标识IP片的目的地IP地址</li>
<li><strong>选项</strong>：可扩充部分，具有可变长度，定义了安全性、严格源路由、松散源路由、记录路由、时间戳等选项</li>
<li><strong>填充</strong>：用全0的填充字段补齐为4字节的整数倍</li>
</ul>
<p>数据报分片的原因是数据报长度大于传输链路的MTU</p>
<p>MTU（Maximum Transmission Unit）, 最大传输单元</p>
<ul>
<li>链路MTU</li>
<li>路径MTU (Path MTU)</li>
</ul>
<h3 id="3-2-IP地址"><a href="#3-2-IP地址" class="headerlink" title="3.2 IP地址"></a>3.2 IP地址</h3><h4 id="3-2-1-概述"><a href="#3-2-1-概述" class="headerlink" title="3.2.1 概述"></a>3.2.1 概述</h4><ul>
<li><p><strong>IP地址</strong>，网络上的每一台主机（或路由器）的每一个接口都会分配一个全球唯一的32位的标识符</p>
</li>
<li><p>将IP地址划分为固定的类，每一类都由两个字段组成</p>
</li>
<li><p>网络号相同的这块连续IP地址空间称为地址的<strong>前缀</strong>，或<strong>网络前缀</strong></p>
</li>
<li><p>IP地址共分为A、B、C、D、E五类，A类、B类、C类为单播地址</p>
</li>
<li><p>IP地址的书写采用点分十进制记法，其中每一段取值范围为0到255</p>
</li>
</ul>
<p>A,B,C类单播地址由net-id和host-id构成</p>
<h4 id="3-2-2-子网划分"><a href="#3-2-2-子网划分" class="headerlink" title="3.2.2 子网划分"></a>3.2.2 子网划分</h4><ul>
<li>子网划分(subnetting)，在网络内部将一个网络块进行划分以供多个内部网络使用，对外仍是一个网络</li>
<li>子网(subnet )，一个网络进行子网划分后得到的一系列结果网络称为子网</li>
<li>子网掩码(subnet mask )，与 IP 地址一一对应，是32 bit 的二进制数，置1表示网络位，置0表示主机位</li>
<li>子网划分减少了 IP 地址的浪费、网络的组织更加灵活、便于维护和管理</li>
</ul>
<h3 id="3-3-DHCP动态主机配置协议"><a href="#3-3-DHCP动态主机配置协议" class="headerlink" title="3.3 DHCP动态主机配置协议"></a>3.3 DHCP动态主机配置协议</h3><p>DHCP ：<strong>动态主机配置协议</strong></p>
<ul>
<li><p>当主机加入IP网络，允许主机从DHCP服务器动态获取IP地址</p>
</li>
<li><p>可以有效利用IP地址，方便移动主机的地址获取</p>
</li>
</ul>
<p>工作模式：客户&#x2F;服务器模式（ C&#x2F;S ）<br>基于 UDP 工作，服务器运行在 67 号端口， 客户端运行在 68 号端口</p>
<p>DHCP服务不只返回客户机所需的IP地址，还包括缺省路由器IP地址，DNS服务器IP地址，网络掩码</p>
<h3 id="3-4-ARP地址解析协议"><a href="#3-4-ARP地址解析协议" class="headerlink" title="3.4 ARP地址解析协议"></a>3.4 ARP地址解析协议</h3><p>网络设备有数据要发送给另一台网络设备时，必须要知道对方的网络层地址（即IP地址）。</p>
<p>IP地址由网络层来提供，但是仅有IP地址是不够的，IP数据报文必须封装成帧才能通过数据链路进行发送。</p>
<p>数据帧必须要包含目的MAC地址，因此发送端还必须获取到目的MAC地址。</p>
<p>通过目的IP地址而获取的MAC地址的过程是由ARP（Address Resolution Protocol）协议来实现的。</p>
<p>IP地址放在IP数据报的首部，而硬件地址则放在MAC帧的首部</p>
<p>IP数据报经过不同链路时，IP数据报中封装的IP地址不发生改变，而MAC帧中的硬件地址发生改变</p>
<h4 id="3-4-1-路由到另一个局域网"><a href="#3-4-1-路由到另一个局域网" class="headerlink" title="3.4.1 路由到另一个局域网"></a>3.4.1 路由到另一个局域网</h4><p>由主机A经路由器R传输到E的部分过程如下：</p>
<ol>
<li>A创建IP数据包（源为A、目的为E）</li>
<li>在源主机A的路由表中找到路由器R的IP地址223.1.1.4</li>
<li>A根据R的IP地址223.1.1.4，使用ARP协议获得R的MAC地址</li>
<li>A创建数据帧（目的地址为R的MAC地址）</li>
<li>数据帧中封装A到E的IP数据包</li>
<li>A发送数据帧，R接收数据帧</li>
</ol>
<h4 id="3-4-2-工作过程"><a href="#3-4-2-工作过程" class="headerlink" title="3.4.2 工作过程"></a>3.4.2 工作过程</h4><p>ARP协议的工作过程如下：</p>
<ol>
<li><p>A已知B的IP地址，需要获得B的MAC地址（物理地址）</p>
</li>
<li><p>如果A的ARP表中缓存有B的IP地址与MAC地址的映射关系，则直接从ARP表获取</p>
</li>
<li><p>如果A的ARP表中未缓存有B的IP地址与MAC地址的映射关系，则A广播包含B的IP地址的ARP query分组</p>
<p>注意：在局域网上的所有节点都可以接收到ARP query</p>
</li>
<li><p>B接收到ARP query分组后，将自己的MAC地址发送给A</p>
</li>
<li><p>A在ARP表中缓存B的IP地址和MAC地址的映射关系</p>
<p>注意：超时时删除</p>
</li>
</ol>
<h3 id="3-5-网络地址转换（NAT）"><a href="#3-5-网络地址转换（NAT）" class="headerlink" title="3.5 网络地址转换（NAT）"></a>3.5 网络地址转换（NAT）</h3><p><strong>定义</strong><br>网络地址转换(NAT)用于解决IPv4地址不足的问题，是一种将私有（保留）地址转化为公有IP地址的转换技术</p>
<p><strong>NAT的优势</strong></p>
<ul>
<li>节省合法地址，减少地址冲突</li>
<li>灵活连接Internet</li>
<li>保护局域网的私密性</li>
</ul>
<h3 id="3-6-ICMP-互联网控制报文协议"><a href="#3-6-ICMP-互联网控制报文协议" class="headerlink" title="3.6 ICMP: 互联网控制报文协议"></a>3.6 ICMP: 互联网控制报文协议</h3><p><strong>ICMP: Internet Control Message Protocol</strong></p>
<ul>
<li>ICMP 允许主机或路由器报告差错情况和提供有关异常情况的报告</li>
<li>由主机和路由器用于网络层信息的通信</li>
<li>ICMP 报文携带在IP 数据报中： IP上层协议号为1</li>
</ul>
<p><strong>ICMP报文类型</strong></p>
<ul>
<li>ICMP 差错报告报文<ul>
<li>终点不可达：不可达主机、不可达网络，无效端口、协议</li>
</ul>
</li>
<li>ICMP 询问报文<ul>
<li>回送请求&#x2F;回答 (ping使用)</li>
</ul>
</li>
</ul>
<h2 id="4-路由算法"><a href="#4-路由算法" class="headerlink" title="4. 路由算法"></a>4. 路由算法</h2><p>距离向量路由</p>
<p>链路状态路由</p>
<p>层次路由</p>
<p>广播路由</p>
<h2 id="5-Internet路由协议"><a href="#5-Internet路由协议" class="headerlink" title="5. Internet路由协议"></a>5. Internet路由协议</h2><p>路由协议</p>
<ul>
<li>内部网关协议 IGP： 有 RIP 和、OSPF、ISIS 等多种具体的协议</li>
<li>外部网关协议 EGP：目前使用的协议就是 BGP</li>
</ul>
<h3 id="5-1-路由选择协议"><a href="#5-1-路由选择协议" class="headerlink" title="5.1 路由选择协议"></a>5.1 路由选择协议</h3><ul>
<li><p>路由选择协议RIP（ Routing Information Protocol）是基于距离矢量算法的协议</p>
</li>
<li><p>使用跳数衡量到达目的网络的距离</p>
<ul>
<li>RIP 认为一个<strong>好的路由</strong>就是它通过的路由器的数目少，即“<strong>距离短</strong>”</li>
<li>RIP 允许一条路径最多只能包含 15 个路由器</li>
</ul>
</li>
<li><p>RIP协议的基本思想</p>
<ul>
<li>仅和<strong>相邻路由器</strong>交换信息</li>
<li>路由器交换的内容是自己的<strong>路由表</strong></li>
<li>周期性更新：<strong>30s</strong></li>
</ul>
</li>
</ul>
<p>RIP协议的特点：</p>
<ul>
<li>算法简单，易于实现</li>
<li>收敛慢</li>
<li>需要交换的信息量较大</li>
</ul>
<p>RIP协议的适用场合：</p>
<ul>
<li>中小型网络</li>
</ul>
<h3 id="5-2-BGP-外部网关路由协议"><a href="#5-2-BGP-外部网关路由协议" class="headerlink" title="5.2 BGP 外部网关路由协议"></a>5.2 BGP 外部网关路由协议</h3><p>边界网关协议<strong>BGP (Border Gateway Protocol)</strong></p>
<ul>
<li>目前互联网中唯一实际运行的自治域间的路由协议</li>
</ul>
<h2 id="6-路由器的工作原理"><a href="#6-路由器的工作原理" class="headerlink" title="6. 路由器的工作原理"></a>6. 路由器的工作原理</h2><p>路由器是互联网最主要的网络设备，包含2个核心功能</p>
<ul>
<li>控制层：运行各种路由协议：BGP、OSPF、RIP，学习去往不同目的的转发路径：路由表</li>
<li>数据层：根据上述路由表，将收到的IP分组转发到正确的下一跳链路</li>
</ul>
<h2 id="7-拥塞控制"><a href="#7-拥塞控制" class="headerlink" title="7. 拥塞控制"></a>7. 拥塞控制</h2><p><strong>拥塞</strong><br>网络中存在太多的数据包导致数据包传输延迟或丢失，从而导致网络吞吐量下降</p>
<p><strong>拥塞控制（congestion control）</strong><br>需要确保通信子网能够承载用户提交的通信量，是一个全局性问题，涉及主机、路由器等多种因素</p>
<h2 id="8-服务质量"><a href="#8-服务质量" class="headerlink" title="8. 服务质量"></a>8. 服务质量</h2><p><strong>什么是网络服务质量？（QoS, Quality of Service）</strong></p>
<p>QoS是网络在传输数据流时要满足一系列服务请求，具体可以量化为<strong>带宽、时延、抖动、丢包率</strong>等性能指标</p>
<h2 id="9-三层交换"><a href="#9-三层交换" class="headerlink" title="9. 三层交换"></a>9. 三层交换</h2><h3 id="9-1-三层交换的技术背景"><a href="#9-1-三层交换的技术背景" class="headerlink" title="9.1 三层交换的技术背景"></a>9.1 三层交换的技术背景</h3><ol>
<li><p>二层交换网络中的广播，限制了网络规模的扩展</p>
<ul>
<li><p>交换机对目标地址无法匹配的数据帧进行广播转发</p>
</li>
<li><p>交换机对目标地址为广播地址的数据帧进行广播转发</p>
</li>
<li><p>交换机为维护生成树状态产生大量的桥协议数据单元(Bridge Protocol Data Unit，BPDU)</p>
</li>
<li><p>这些广播帧会大量消耗网络资源，并频繁影响用户的数据通信</p>
</li>
</ul>
</li>
<li><p>VLAN虽然可以将广播的影响限定在一定范围内，但同时也隔离了正常的用户间数据通信</p>
</li>
<li><p>传统路由器致力于解决VLAN间互联互通，但是其转发效率和拓扑复杂性带来的网络通信瓶颈无法有效应对规模扩展</p>
</li>
</ol>
<h3 id="9-2-三层交换的动机"><a href="#9-2-三层交换的动机" class="headerlink" title="9.2 三层交换的动机"></a>9.2 三层交换的动机</h3><ul>
<li>利用第三层协议中的信息来加强第二层交换功能，形成带有路由功能的交换</li>
<li>融合VLAN 间的二层隔离和三层互通，消除大规模网络中广播对性能的影响</li>
<li>简化网络配置，简化网络拓扑，优化网络管理，降低网络部署成本</li>
</ul>
<h2 id="10-VPN的原理"><a href="#10-VPN的原理" class="headerlink" title="10. VPN的原理"></a>10. VPN的原理</h2><ul>
<li>VPN指利用公用网络架设专用网络的远程访问技术</li>
<li>VPN通过隧道技术在公共网络上模拟出一条点到点的逻辑专线，从而达到安全数据传输的目的</li>
</ul>
<p>用户主机和被访问节点的网关必须都支持隧道协议</p>
<h2 id="11-IPv6协议"><a href="#11-IPv6协议" class="headerlink" title="11. IPv6协议"></a>11. IPv6协议</h2><p>初始动机：应付“32-bit地址空间耗尽”问题（CIDR和NAT都无法从根本上解决地址短缺问题），增加地址空间<br>IPv6 地址</p>
<ul>
<li><p>地址长度为128bit，是IPv4地址长度的4倍</p>
</li>
<li><p>IPv6地址空间数量约为3*1038</p>
<p>IPv6地址表示法，冒分十六进制，x : x : x : x : x : x : x : x</p>
<ul>
<li>简化方法：每个x前面的0可省略，可把连续的值为0的x表示为“::”, 且“::”只能出现1次</li>
<li>简化前地址，2001:0DA8:0000:0000:200C:0000:0000:00A5</li>
<li>简化后地址，2001:DA8:0000:0000:200C::A5</li>
</ul>
</li>
</ul>
<h1 id="五、传输层"><a href="#五、传输层" class="headerlink" title="五、传输层"></a>五、传输层</h1><h2 id="1-传输层概述"><a href="#1-传输层概述" class="headerlink" title="1. 传输层概述"></a>1. 传输层概述</h2><ul>
<li><p>传输层位于应用层和网络层之间：</p>
<ul>
<li>基于网络层提供的服务，向分布式应用程序提供通信服务</li>
</ul>
</li>
<li><p>按照因特网的“端到端”设计原则：</p>
<ul>
<li><strong>应用程序只运行在终端上</strong>，即不需要为网络设备编写程序</li>
</ul>
</li>
<li><p>站在应用程序的角度：</p>
<ul>
<li>传输层应提供<strong>进程之间本地通信的抽象</strong>：即运行在不同终端上的应用进程仿佛是直接连在一起的</li>
</ul>
</li>
</ul>
<h3 id="1-1-套接字"><a href="#1-1-套接字" class="headerlink" title="1.1 套接字"></a>1.1 套接字</h3><p>设想在应用程序和网络之间存在一扇“门”：</p>
<ul>
<li>需要发送报文时：发送进程将报文推到门外</li>
<li>门外的运输设施（因特网）将报文送到接收进程的门口</li>
<li>需要接收报文时：接收进程打开门，即可收到报文</li>
</ul>
<p>在TCP&#x2F;IP网络中，这扇“门”称为<strong>套接字（socket）</strong>，是<strong>应用层和传输层的接口</strong>，也是应用程序和网络之间的API</p>
<h3 id="1-2-传输层提供的服务"><a href="#1-2-传输层提供的服务" class="headerlink" title="1.2 传输层提供的服务"></a>1.2 传输层提供的服务</h3><p>因特网的网络层提供“<strong>尽力而为</strong>”的服务：</p>
<ul>
<li>网络层尽最大努力在终端间交付分组，但不提供任何承诺</li>
<li>具体来说，不保证交付，不保证按序交付，不保证数据完整，不保证延迟，不保证带宽等</li>
</ul>
<p>传输层的<strong>有所为、有所不为</strong>:</p>
<ul>
<li>传输层可以通过差错恢复、重排序等手段提供可靠、按序的交付服务</li>
<li>但传输层无法提供延迟保证、带宽保证等服务</li>
</ul>
<p>具体而言，传输层提供的服务有：</p>
<ol>
<li><p>最低限度的传输服务：</p>
<ul>
<li>将终端-终端的数据交付扩展到进程-进程的数据交付</li>
<li>报文检错</li>
</ul>
</li>
<li><p>增强服务：</p>
<ul>
<li>可靠数据传输</li>
<li>流量控制</li>
<li>拥塞控制</li>
</ul>
</li>
<li><p>因特网传输层通过UDP协议和TCP协议，向应用层提供两种不同的传输服务：</p>
<ul>
<li>UDP协议：仅提供最低限度的传输服务</li>
<li>TCP协议：提供基础服务和增强服务</li>
</ul>
</li>
</ol>
<h2 id="2-传输层基本服务：复用和分用"><a href="#2-传输层基本服务：复用和分用" class="headerlink" title="2. 传输层基本服务：复用和分用"></a>2. 传输层基本服务：复用和分用</h2><h3 id="2-1-概述"><a href="#2-1-概述" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><p>传输层基本服务：将主机间交付扩展到进程间交付，通过复用和分用实现。</p>
<ul>
<li><p><strong>发送端复用</strong>：<br>发送方传输层从多个套接字收集数据，将套接字标识置于数据（报文段）中，交给网络层发送</p>
</li>
<li><p><strong>接收端分用</strong>：<br>接收方传输层根据报文段中的套接字标识，将从网络层收到的数据（报文段）交付到正确的套接字</p>
</li>
</ul>
<h3 id="2-2-套接字标识与端口号"><a href="#2-2-套接字标识与端口号" class="headerlink" title="2.2 套接字标识与端口号"></a>2.2 套接字标识与端口号</h3><ol>
<li><p>端口号是套接字标识的一部分：</p>
<ul>
<li><p>每个套接字在本地关联一个端口号</p>
</li>
<li><p>端口号是一个16比特的数</p>
</li>
</ul>
</li>
<li><p>端口号的分类：</p>
<ul>
<li><p>熟知端口：0～1023，由公共域协议使用</p>
</li>
<li><p>注册端口：1024～49151，需要向IANA注册才能使用</p>
</li>
<li><p>动态和&#x2F;或私有端口：49152～65535，一般程序使用</p>
<ol start="3">
<li>报文段中有两个字段携带端口号：</li>
</ol>
<ul>
<li>源端口号(source port)：与发送进程关联的本地端口号</li>
<li>目的端口号(dest port)：与接收进程关联的本地端口号</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="2-3-TCP-x2F-UDP套接字"><a href="#2-3-TCP-x2F-UDP套接字" class="headerlink" title="2.3 TCP&#x2F;UDP套接字"></a>2.3 TCP&#x2F;UDP套接字</h3><p><strong>UDP套接字</strong></p>
<ul>
<li>使用&lt;IP地址，端口号&gt;二元组标识UDP套接字</li>
<li>服务器使用一个套接字服务所有客户</li>
</ul>
<p><strong>TCP套接字</strong></p>
<ul>
<li>使用&lt;源IP地址，目的IP地址，源端口号，目的端口号&gt; 四元组标识连接套接字</li>
<li>服务器使用一个监听套接字和多个连接套接字服务多个客户，每个连接套接字服务一个客户</li>
</ul>
<h2 id="3-无连接传输：UDP"><a href="#3-无连接传输：UDP" class="headerlink" title="3. 无连接传输：UDP"></a>3. 无连接传输：UDP</h2><p><strong>为什么需要UDP？</strong></p>
<ul>
<li>应用可以尽可能快地发送报文：<ul>
<li>无建立连接的延迟</li>
<li>不限制发送速率（不进行拥塞控制和流量控制）</li>
</ul>
</li>
<li>报头开销小</li>
<li>协议处理简单</li>
</ul>
<p><strong>UDP适合哪些应用？</strong></p>
<ul>
<li>容忍丢包但对延迟敏感的应用：<br>如流媒体</li>
<li>以单次请求&#x2F;响应为主的应用：<br>如DNS</li>
<li>若应用要求基于UDP进行可靠传输：<br>由应用层实现可靠性</li>
</ul>
<h2 id="4-面向连接的传输：TCP"><a href="#4-面向连接的传输：TCP" class="headerlink" title="4. 面向连接的传输：TCP"></a>4. 面向连接的传输：TCP</h2><h3 id="4-1-可靠传输"><a href="#4-1-可靠传输" class="headerlink" title="4.1 可靠传输"></a>4.1 可靠传输</h3><p>数据包<strong>有序、无差错</strong>到达接收端</p>
<p>如何实现可靠传输，基本原则是什么？</p>
<ul>
<li>利用ACK确认</li>
<li>重传机制</li>
<li>差错检测</li>
</ul>
<p>三次握手：确定双方都同意建立连接，并初始化连接参数(seq，ack等)</p>
<p>四次挥手：目的就是确保断开连接时双方都是确认结束的状态</p>
<h3 id="4-2-流水线技术"><a href="#4-2-流水线技术" class="headerlink" title="4.2 流水线技术"></a>4.2 流水线技术</h3><h3 id="4-3-TCP报文段结构"><a href="#4-3-TCP报文段结构" class="headerlink" title="4.3 TCP报文段结构"></a>4.3 TCP报文段结构</h3><p>U,A,P,R,S,F标志位：</p>
<ul>
<li><p>ACK表示确认序号有效</p>
</li>
<li><p>SYN用于建立连接</p>
</li>
<li><p>FIN用于终止连接</p>
</li>
</ul>
<p>发送序号：数据载荷中第一个字节在字节流中的序号</p>
<p>确认序号：期望接受的下一个字节的序号</p>
<h2 id="5-TCP流量控制"><a href="#5-TCP流量控制" class="headerlink" title="5. TCP流量控制"></a>5. TCP流量控制</h2><h2 id="6-拥塞控制"><a href="#6-拥塞控制" class="headerlink" title="6. 拥塞控制"></a>6. 拥塞控制</h2><h1 id="六、应用层"><a href="#六、应用层" class="headerlink" title="六、应用层"></a>六、应用层</h1><h2 id="1-应用层概述"><a href="#1-应用层概述" class="headerlink" title="1. 应用层概述"></a>1. 应用层概述</h2><ul>
<li><p>每个应用层协议都是为了解决某一应用问题，通过位于不同主机中的多个应用进程之间的通信和协同工作来完成</p>
<ul>
<li>两台主机通信实际是其对应的两个应用进程(process)在通信</li>
<li><strong>应用进程</strong>: 为解决具体应用问题而彼此通信的进程</li>
</ul>
</li>
<li><p>应用层的具体内容就是规定应用进程在通信时所遵循的协议</p>
<ul>
<li><p>客户&#x2F;服务器（C&#x2F;S, Client&#x2F;Server）方式</p>
<ul>
<li><p>C&#x2F;S方式可以是面向连接的，也可以是无连接的</p>
</li>
<li><p><strong>面向连接时，C&#x2F;S通信关系一旦建立，通信就是双向的</strong>，双方地位平等，都可发送和接收数据</p>
</li>
<li><p>客户进程在进行通信时临时成为客户，它也可在本地进行其它的计算；在打算通信时<strong>主动</strong>向远地服务器发起通信</p>
</li>
<li><p><strong>客户方必须知道服务器进程所在主机的IP地址才能发出服务请求</strong></p>
</li>
<li><p><strong>服务器进程</strong>被动等待并接受来自多个客户的通信请求, <strong>必须始终处于运行状态才有可能提供服务</strong></p>
</li>
</ul>
</li>
<li><p>对等（P2P，Peer to Peer）方式</p>
<ul>
<li><strong>对等方式</strong>是指两个进程在通信时并不区分服务的请求方和服务的提供方</li>
<li>只要两个主机都运行P2P软件，它们就可以进行平等、对等的通信</li>
<li>双方都可以下载对方存储在硬盘中的共享文档，如果权限允许的话</li>
<li>音频&#x2F;视频应用推动了P2P对等通信方式的发展（BitTorrent）</li>
<li>P2P方式从本质上看仍然是使用了C&#x2F;S方式，但强调的是通信过程中的对等，这时<strong>每一个P2P进程既是客户同时也是服务器</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-域名系统"><a href="#2-域名系统" class="headerlink" title="2. 域名系统"></a>2. 域名系统</h2><h3 id="2-1-概述-1"><a href="#2-1-概述-1" class="headerlink" title="2.1 概述"></a>2.1 概述</h3><ul>
<li><strong>域名系统</strong>（DNS，Domain Name System）是互联网重要的基础设施之一，向所有需要域名解析的应用提供服务，主要负责将<strong>可读性好的域名映射成IP地址</strong></li>
<li>Internet采用<strong>层次结构的命名树</strong>作为主机的名字，并使用<strong>分布式</strong>的域名系统 DNS。Internet的DNS是一个<strong>联机分布式数据库系统</strong></li>
<li>名字到域名的解析是由<strong>若干个</strong>域名服务器程序完成的。域名服务器程序在专设的结点上运行，相应的结点也称为<strong>名字服务器</strong>(Name Server)或<strong>域名服务器</strong>(Domain Name Server)</li>
</ul>
<h3 id="2-2-层次树状结构"><a href="#2-2-层次树状结构" class="headerlink" title="2.2 层次树状结构"></a>2.2 层次树状结构</h3><ul>
<li><p>顶级域名: com, cn, org, gov, edu</p>
</li>
<li><p>二级域名: edu</p>
</li>
<li><p>三级域名: fudan, pku</p>
</li>
<li><p>四级域名: www, cs, mail</p>
</li>
</ul>
<h3 id="2-3-域名解析过程"><a href="#2-3-域名解析过程" class="headerlink" title="2.3 域名解析过程"></a>2.3 域名解析过程</h3><ol>
<li>递归查询 “我不知道，直接帮你向上查” 较少使用</li>
<li>迭代查询 “我不知道，告诉你该找谁，你自己向上查” 通常使用</li>
</ol>
<h2 id="3-电子邮件"><a href="#3-电子邮件" class="headerlink" title="3. 电子邮件"></a>3. 电子邮件</h2><h3 id="3-1-邮件发送的常用协议"><a href="#3-1-邮件发送的常用协议" class="headerlink" title="3.1 邮件发送的常用协议"></a>3.1 邮件发送的常用协议</h3><ul>
<li><strong>简单邮件传输协议SMTP</strong>（Simple Mail Transfer Protocol）——邮件服务器之间传递邮件使用的协议</li>
<li>最终交付（邮件访问）协议:从邮件服务器的邮箱中获取邮件:<ul>
<li>POP3：Post Office Protocol-Version 3，第三版邮局协议</li>
<li>IMAP：Internet Message Access Protocol，Internet邮件访问协议</li>
<li>Webmail（HTTP）：基于Web的电子邮件</li>
</ul>
</li>
</ul>
<h3 id="3-2-Webmail"><a href="#3-2-Webmail" class="headerlink" title="3.2 Webmail"></a>3.2 Webmail</h3><p>Webmail——基于Web的电子邮件</p>
<ul>
<li>Webmail——基于Web的电子邮件</li>
<li>使用Web作为界面，用户代理就是普通的浏览器</li>
<li>用户及其远程邮箱之间的通信通过HTTP进行</li>
</ul>
<h2 id="4-WWW"><a href="#4-WWW" class="headerlink" title="4. WWW"></a>4. WWW</h2><h3 id="4-1-WWW体系结构与协议"><a href="#4-1-WWW体系结构与协议" class="headerlink" title="4.1 WWW体系结构与协议"></a>4.1 WWW体系结构与协议</h3><ul>
<li>WWW&#x3D;World Wide Web&#x3D;万维网</li>
<li>HTTP服务器和客户端，以及它们之间执行的HTTP协议</li>
</ul>
<p><strong>服务器</strong>:</p>
<ul>
<li>Web页面（HTML文档）：包含多种对象或链接</li>
<li>Web对象（包括：静态对象和动态对象）：可以是 HTML文档、 图像文件、视频文件、声音文件、脚本文件等</li>
<li>对象用URL（统一资源定位符）编址：协议类型:&#x2F;&#x2F;主机名:端口&#x2F;&#x2F;路径和文件名</li>
</ul>
<p><strong>客户端</strong>：</p>
<ul>
<li>发出请求、接收响应、解释HTML文档并显示</li>
<li>有些对象需要浏览器安装插件</li>
</ul>
<p><strong>统一资源定位器URL</strong>：</p>
<p>协议类型:&#x2F;&#x2F;主机名即服务器:端口&#x2F;路径和文件名</p>
<p>WWW协议:</p>
<h3 id="4-2-HTTP"><a href="#4-2-HTTP" class="headerlink" title="4.2 HTTP"></a>4.2 HTTP</h3><h4 id="4-2-1-概述"><a href="#4-2-1-概述" class="headerlink" title="4.2.1 概述"></a>4.2.1 概述</h4><ul>
<li>超文本传输协议HTTP（ HyperText Transfer Protocol）在传输层通常使用<strong>TCP</strong>协议，<strong>缺省使用TCP的80端口</strong></li>
<li>HTTP为<strong>无状态协议</strong>，服务器端不保留之前请求的状态信息<ul>
<li><strong>无状态协议</strong>：效率低、但简单</li>
<li><strong>有状态协议</strong>：维护状态相对复杂，需要维护历史信息，在客户端或服务器出现故障时，需要保持状态的一致性等</li>
</ul>
</li>
</ul>
<ul>
<li><strong>HTTP标准</strong><ul>
<li>HTTP&#x2F;1.0: RFC 1945（1996年）：<ul>
<li>无状态，非持久连接</li>
</ul>
</li>
<li>HTTP&#x2F;1.1: RFC 2616（1999年）：<ul>
<li>支持长连接和流水线机制</li>
<li>缓存策略优化、部分资源请求及断点续传</li>
</ul>
</li>
<li>HTTP&#x2F;2: RFC 7540（2015年）、RFC 8740（2020年）：<ul>
<li>增加SSL&#x2F;TLS（TLS 1.2）层，在TCP之上提供安全机制</li>
<li>目标：提高带宽利用率、降低延迟</li>
<li>增加二进制格式、TCP多路复用、头压缩、服务端推送等功能</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-2-2-Web安全与隐私-Cookie"><a href="#4-2-2-Web安全与隐私-Cookie" class="headerlink" title="4.2.2 Web安全与隐私: Cookie"></a>4.2.2 Web安全与隐私: Cookie</h4><p>HTTP <strong>无状态协议</strong>，服务器 <strong>用cookies保持用户状态</strong></p>
<ul>
<li><p>HTTP在响应的首部行里使用一个关键字头set-cookie：选择的cookie号具有唯一性</p>
</li>
<li><p>后继的HTTP请求中使用服务器响应分配的cookie</p>
</li>
<li><p>Cookie文件保存在用户的主机中，内容是服务器返回的一些附加信息，由用户主机中的浏览器管理</p>
</li>
<li><p>Web服务器建立后端数据库，记录用户信息，cookie作为关键字</p>
<p>例如：<br>Set-Cookie: SID&#x3D;31d4d96e407aad42; Path&#x3D;&#x2F;; Domain&#x3D;example.com<br>Cookie: SID&#x3D;31d4d96e407aad42</p>
</li>
</ul>
<p>Cookies一般包含5个字段:</p>
<ul>
<li>域指明Cookie来自何方，每个域为每个客户分配Cookie有数量限制</li>
<li>路径标明服务器的文件树中哪些部分可以使用该Cookie</li>
<li>内容采用“名字&#x3D;值”的形式，是Cookie存放内容的地方，可以达到4K容量，内容只是字符串，不是可执行程序</li>
<li>安全指示浏览器只向使用安全传输连接的服务器返回Cookie</li>
<li>过期时间</li>
</ul>
<ol>
<li><p>Cookie技术是把双刃剑，能分析用户喜好，向用户进行个性化推荐</p>
<ul>
<li><p>用Cookie在某网站标识用户信息，查找用户以前浏览网站记录</p>
</li>
<li><p>用Cookie记录用户购物清单</p>
</li>
<li><p>用Cookie可以保存4K内容，跟踪用户浏览网站的喜好</p>
</li>
<li><p>用Cookie跨站点跟踪用户点击广告</p>
</li>
</ul>
</li>
<li><p>Cookie技术是把双刃剑，也能跟踪用户网络浏览痕迹，泄露用户隐私</p>
<ul>
<li><p>Cookie跟踪用户以前浏览过哪些网站，跟踪用户频繁浏览哪类网站</p>
</li>
<li><p>Cookie收集用户信息，用户网络交互时关注的关键词</p>
</li>
</ul>
</li>
<li><p>Cookie容易嵌入间谍程序，这是个误区，Cookie文件保存的只是文本串，没有可执行程序</p>
<ul>
<li>用户可以设置浏览器限制使用Cookie</li>
</ul>
</li>
</ol>
<h2 id="5-流媒体"><a href="#5-流媒体" class="headerlink" title="5. 流媒体"></a>5. 流媒体</h2><h3 id="5-1-概述"><a href="#5-1-概述" class="headerlink" title="5.1 概述"></a>5.1 概述</h3><p>流媒体概念</p>
<ul>
<li>连续媒体（音视频）经压缩编码、数据打包后，经过网络发送给接收方</li>
<li>接收方对数据进行重组、解码和播放</li>
</ul>
<p>流媒体特性</p>
<ul>
<li>端到端时延约束</li>
<li>时序性约束：流媒体数据必须按照一定的顺序连续播放</li>
<li>具有一定程度的容错性：丢失部分数据包也可完成基本功能</li>
</ul>
<p>流媒体面临的挑战</p>
<ul>
<li>约束条件：网络特性（带宽有限、动态变化、延迟与抖动、丢失、异构性）</li>
<li>目标：流媒体服务质量要素（画质、启动延迟、平滑、交互性）</li>
<li>如何在“尽力服务”的网络传输条件下获得良好的视频质量？</li>
</ul>
<h3 id="5-2-DASH"><a href="#5-2-DASH" class="headerlink" title="5.2 DASH"></a>5.2 DASH</h3><p> DASH (Dynamic Adaptive Streaming over HTTP)</p>
<ul>
<li>动态自适应流媒体传输协议DASH，由MPEG组织制定的标准</li>
<li>类似协议：苹果HTTP Live Streaming（HLS）； Adobe的HTTP Dynamic Streaming（HDS）；微软的Microsoft Smooth Streaming</li>
</ul>
<p>DASH 基本思想</p>
<ul>
<li>完整视频被拆分为固定时长 (2s-10s) 的视频片段(segment)， 每段提供不同码率</li>
<li>视频片段与其对应的元文件（URL）一同存放于DASH服务器</li>
<li>客户端基于网络条件、缓冲大小等，对每个视频片段，自适应选择合适的视频码率来下</li>
<li>DASH中普遍使用的自适应码率ABR（Adaptive bitrate）</li>
</ul>
<h2 id="6-CDN"><a href="#6-CDN" class="headerlink" title="6. CDN"></a>6. CDN</h2><ul>
<li>Content Delivery Network，or Content Distribution Network 内容分发网络</li>
<li>一种Web缓存系统，<strong>靠近网络边缘（用户）提供内容服务</strong></li>
<li>目前提供更丰富的服务，包括静态内容、流媒体、用户上传视频等</li>
<li>主要优点<ul>
<li>降低响应时延，避免网络拥塞</li>
<li>避免原始服务器过载及防止DDoS攻击</li>
<li>分布式架构，具有良好的可扩展性</li>
<li>对用户透明，无需用户感知</li>
</ul>
</li>
</ul>
<p>关键问题： 怎样将内容（如从百万的视频中选定的内容）分发给同时发起访问的数百万用户？</p>
<p>解决机理：</p>
<ul>
<li><strong>DNS重定向实现CDN</strong><ul>
<li>将请求调度到较近或负载较轻的CDN服务器</li>
<li><strong>HTTP重定向请求内容</strong>，服务提供者返回清单CDN</li>
</ul>
</li>
<li><strong>DNS辅助实现CDN</strong><ul>
<li>负载均衡DNS负责决策CDN服务器选择</li>
<li>负载均衡DNS需要收集CDN服务器的位置和负载情况</li>
<li>如果找不到被请求的对象，需要从原始服务器获取</li>
</ul>
</li>
</ul>
<h2 id="7-P2P网络"><a href="#7-P2P网络" class="headerlink" title="7. P2P网络"></a>7. P2P网络</h2><p><strong>P2P文件分发协议：BitTorrent</strong></p>
<ul>
<li>文件被划分为256Kb大小的块</li>
<li>具有种子(torrents)的节点发送或接收文件</li>
<li>跟踪器tracker <ul>
<li>负责帮助节点获取其他节点的信息</li>
<li>用户从跟踪器获取节点列表</li>
</ul>
</li>
<li>种子torrent<ul>
<li>交换文件块的节点</li>
<li>用户同种子节点交换文件块</li>
</ul>
</li>
</ul>
<h2 id="8-远程登录Telnet"><a href="#8-远程登录Telnet" class="headerlink" title="8. 远程登录Telnet"></a>8. 远程登录Telnet</h2><ul>
<li>Telnet协议引入网络<strong>虚拟终端NVT</strong>（Network Virtual Terminal），使用一种专门的键盘定义来屏蔽不同计算机系统对键盘输入的差异性，同时定义客户进程与远程服务器进程之间的交互过程</li>
<li>NVT是Telnet协议定义的<strong>一组通用字符集</strong>，通过这种统一的数据表示方式，来保证不同硬件、软件与数据格式的终端与主机之间通信的兼容性</li>
<li>本地终端输入的字符首先由本地Telnet客户进程转换为NVT格式，通过网络将NVT格式的字符传输到远程主机，远程Telnet服务器进程再将NVT格式的字符转换为远程主机能够识别和处理的字符格式</li>
<li>使用Telnet协议在网络中传输的数据都是NVT格式，不同的用户终端与服务器进程均与本地终端格式无关</li>
</ul>
<p><strong>Telnet的工作过程</strong> (windows自带 默认关闭)  基于TCP连接</p>
<ul>
<li>本地Telnet客户进程与远程主机上的Telnet服务器进程建立TCP连接</li>
<li>将本地终端上输入的用户名和口令及以后输入的任何命令或字符以网络虚拟终端NVT格式传输给远程主机</li>
<li>将远程主机输出的NVT格式的数据转化为本地所接受的格式送回本地终端，包括输入命令回显和命令执行结果</li>
<li>本地终端对远程主机撤销连接，从而结束 Telnet远程登录过程</li>
</ul>
<h2 id="9-FTP"><a href="#9-FTP" class="headerlink" title="9. FTP"></a>9. FTP</h2><h3 id="9-1-概述"><a href="#9-1-概述" class="headerlink" title="9.1 概述"></a>9.1 概述</h3><p><strong>文件传输协议FTP(File Transfer Protocol)</strong> 是Internet上使用最广泛的应用层协议之一</p>
<ul>
<li>FTP提供交互式的访问，允许用户指明文件的类型与格式，并允许文件具有存取权限</li>
<li>FTP屏蔽了各计算机系统的细节，适用于在异构网络中任意计算机之间传送文件</li>
<li>RFC 959早在1985年就已经成为Internet的正式标准</li>
<li>FTP使用C&#x2F;S方式实现</li>
</ul>
<h3 id="9-2-工作过程"><a href="#9-2-工作过程" class="headerlink" title="9.2 工作过程"></a>9.2 工作过程</h3><ul>
<li>服务器主进程打开TCP21端口，等待客户进程发出的连接请求</li>
<li>客户可以用分配的任意一个本地端口号与服务器进程的TCP21端口进行连接</li>
<li>客户请求到来时，服务器主进程启动从属进程来处理客户进程发来的请求</li>
<li>服务器从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程</li>
<li>服务器主进程返回，继续等待接收其他客户进程发来的连接请求，服务器主进程与从属进程并行工作</li>
</ul>
<p><strong>FTP的两个端口与两个连接</strong></p>
<ul>
<li><strong>控制连接</strong>在整个会话期间一直保持，客户进程发出的文件传输请求通过控制连接发送给<strong>服务器控制进程（工作在TCP21端口）</strong>，但控制连接不用来传输文件</li>
<li>服务器控制进程在接收到客户进程发送来的文件传输请求后就创建<strong>数据传输进程（工作在TCP20端口）,数据连接</strong></li>
<li>数据连接用来连接客户进程和服务器数据传输进程，实际完成文件的传输。服务器数据传输进程在文件传输完毕后关闭数据连接并结束运行</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/19/Greedy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/19/Greedy/" class="post-title-link" itemprop="url">Greedy</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-19 16:48:08" itemprop="dateCreated datePublished" datetime="2022-04-19T16:48:08+08:00">2022-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-04-06 07:34:14" itemprop="dateModified" datetime="2023-04-06T07:34:14+08:00">2023-04-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Greedy-Algorithm选编"><a href="#Greedy-Algorithm选编" class="headerlink" title="Greedy Algorithm选编"></a>Greedy Algorithm选编</h1><h2 id="代码随想录"><a href="#代码随想录" class="headerlink" title="代码随想录"></a>代码随想录</h2><h3 id="贪心法原理"><a href="#贪心法原理" class="headerlink" title="贪心法原理"></a>贪心法原理</h3><p><strong>贪心的本质是选择每一阶段的局部最优，从而达到全局最优</strong>。</p>
<p>这么说有点抽象，来举一个例子：</p>
<p>例如，有一堆钞票，你可以拿走十张，如果想达到最大的金额，你要怎么拿？</p>
<p>指定每次拿最大的，最终结果就是拿走最大数额的钱。</p>
<p>每次拿最大的就是局部最优，最后拿走最大数额的钱就是推出全局最优。</p>
<p>再举一个例子如果是 有一堆盒子，你有一个背包体积为n，如何把背包尽可能装满，如果还每次选最大的盒子，就不行了。这时候就需要动态规划。</p>
<h3 id="55-Jump-Game"><a href="#55-Jump-Game" class="headerlink" title="55. Jump Game"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/jump-game/">55. Jump Game</a></h3><h4 id="法一：DP"><a href="#法一：DP" class="headerlink" title="法一：DP"></a>法一：DP</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canJump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="type">boolean</span>[] dp=<span class="keyword">new</span> <span class="title class_">boolean</span>[n];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n-<span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dp[i])&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= nums[i]; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i+j&gt;=n)&#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                dp[i+j]=<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n-<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="法二：Greedy"><a href="#法二：Greedy" class="headerlink" title="法二：Greedy"></a>法二：Greedy</h4><p><strong>贪心算法局部最优解：每次取最大跳跃步数（取最大覆盖范围），整体最优解：最后得到整体最大覆盖范围，看是否能到终点</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canJump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> cover=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= cover; i++) &#123;</span><br><span class="line">        cover=Math.max(cover,i+nums[i]);</span><br><span class="line">        <span class="keyword">if</span>(cover&gt;=nums.length-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="45-Jump-Game-II"><a href="#45-Jump-Game-II" class="headerlink" title="45. Jump Game II"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/jump-game-ii/">45. Jump Game II</a></h3><p>You can assume that you can always reach the last index.</p>
<h4 id="法一：DP-1"><a href="#法一：DP-1" class="headerlink" title="法一：DP"></a>法一：DP</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode45</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">jump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n=nums.length;</span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= nums[<span class="number">0</span>]; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;=n)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n-<span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(dp[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= nums[i]; j++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(i+j&gt;=n)&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(dp[i+j]==<span class="number">0</span>)&#123;<span class="comment">//第一次抵达则赋初值</span></span><br><span class="line">                        dp[i+j]=dp[i]+<span class="number">1</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;<span class="comment">//之前已抵达过则保留最小值（次数）</span></span><br><span class="line">                        dp[i+j]=Math.min(dp[i+j],dp[i]+<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="法二：Greedy-1"><a href="#法二：Greedy-1" class="headerlink" title="法二：Greedy"></a>法二：Greedy</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">jump</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 当前覆盖的最远距离下标</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 下一步覆盖的最远距离下标</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= end &amp;&amp; end &lt; nums.length - <span class="number">1</span>; ++i) &#123;</span><br><span class="line">            temp = Math.max(temp, i + nums[i]);	<span class="comment">//更新再跳一步的最远距离</span></span><br><span class="line">            <span class="comment">// 可达位置的改变次数就是跳跃次数</span></span><br><span class="line">            <span class="keyword">if</span> (i == end) &#123;	<span class="comment">//i已经到达当前范围极限，且当前范围还没覆盖到终点，必须再跳一步</span></span><br><span class="line">                end = temp;</span><br><span class="line">                result++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="135-Candy"><a href="#135-Candy" class="headerlink" title="135. Candy"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/candy/">135. Candy</a></h3><ul>
<li>Each child must have at least one candy.</li>
<li>Children with a higher rating get more candies than their neighbors.</li>
</ul>
<p>好题！</p>
<p>先从左向右，再从右向左</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode135</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">candy</span><span class="params">(<span class="type">int</span>[] ratings)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n=ratings.length;</span><br><span class="line">        <span class="type">int</span>[] arr=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        Arrays.fill(arr,<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//先满足大于左孩子，正序</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i-<span class="number">1</span>])&#123;</span><br><span class="line">                arr[i]=arr[i-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//在此基础上，再满足大于右孩子，逆序</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span>(ratings[i]&gt;ratings[i+<span class="number">1</span>])&#123;</span><br><span class="line">                arr[i]=Math.max(arr[i+<span class="number">1</span>]+<span class="number">1</span>,arr[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(arr).sum();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="860-Lemonade-Change"><a href="#860-Lemonade-Change" class="headerlink" title="860. Lemonade Change"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/lemonade-change/">860. Lemonade Change</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode860</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lemonadeChange</span><span class="params">(<span class="type">int</span>[] bills)</span> &#123;</span><br><span class="line">        <span class="type">int</span> five=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ten=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> bill : bills) &#123;</span><br><span class="line">            <span class="keyword">if</span>(bill==<span class="number">5</span>)&#123;</span><br><span class="line">                five++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(bill==<span class="number">10</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(five==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                five--;</span><br><span class="line">                ten++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//Greedy: 有ten优先找ten，因为five更万能</span></span><br><span class="line">                <span class="keyword">if</span>(ten&gt;=<span class="number">1</span>)&#123;</span><br><span class="line">                    ten--;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(five&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">                        five-=<span class="number">2</span>;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(five&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    five--;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="1005-Maximize-Sum-Of-Array-After-K-Negations"><a href="#1005-Maximize-Sum-Of-Array-After-K-Negations" class="headerlink" title="1005. Maximize Sum Of Array After K Negations"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/maximize-sum-of-array-after-k-negations/">1005. Maximize Sum Of Array After K Negations</a></h3><p>那么本题的解题步骤为：</p>
<ul>
<li>第一步：将数组按照绝对值大小从大到小排序，<strong>注意要按照绝对值的大小</strong></li>
<li>第二步：从前向后遍历，遇到负数将其变为正数，同时K–</li>
<li>第三步：如果K还大于0，那么反复转变数值最小的元素，将K用完</li>
<li>第四步：求和</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">largestSumAfterKNegations</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="comment">// 将数组按照绝对值大小从大到小排序，注意要按照绝对值的大小</span></span><br><span class="line">    nums = IntStream.of(nums)</span><br><span class="line">            .boxed()</span><br><span class="line">            .sorted((o1, o2) -&gt; Math.abs(o2) - Math.abs(o1))</span><br><span class="line">            .mapToInt(Integer::intValue).toArray();</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            nums[i]=-nums[i];</span><br><span class="line">            k--;</span><br><span class="line">            <span class="keyword">if</span>(k==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((k&amp;<span class="number">1</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">        nums[n-<span class="number">1</span>]=-nums[n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Arrays.stream(nums).sum();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="134-Gas-Station"><a href="#134-Gas-Station" class="headerlink" title="134. Gas Station"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/gas-station/">134. Gas Station</a></h3><h4 id="法一：暴力模拟"><a href="#法一：暴力模拟" class="headerlink" title="法一：暴力模拟"></a>法一：暴力模拟</h4><p>超时！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">canCompleteCircuit</span><span class="params">(<span class="type">int</span>[] gas, <span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=gas.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="type">int</span> rest=gas[i]-cost[i];</span><br><span class="line">        <span class="type">int</span> index=(i+<span class="number">1</span>)%n;</span><br><span class="line">        <span class="keyword">while</span>(rest&gt;=<span class="number">0</span> &amp;&amp; index!=i)&#123;</span><br><span class="line">            rest+=gas[index];</span><br><span class="line">            rest-=cost[index];</span><br><span class="line">            index=(index+<span class="number">1</span>)%n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(rest&gt;=<span class="number">0</span> &amp;&amp; index==i)&#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="法二：Greedy-2"><a href="#法二：Greedy-2" class="headerlink" title="法二：Greedy"></a>法二：Greedy</h4><ul>
<li><p><strong>局部最优：当前累加rest[j]的和curSum一旦小于0，起始位置至少要是j+1，因为从j开始一定不行。</strong></p>
</li>
<li><p><strong>全局最优：找到可以跑一圈的起始位置</strong>。</p>
</li>
</ul>
<p>[^心路历程]: 有一个环形路上有n个站点； 每个站点都有一个好人或一个坏人； 好人会给你钱，坏人会收你一定的过路费，如果你带的钱不够付过路费，坏人会跳起来把你砍死； 问：从哪个站点出发，能绕一圈活着回到出发点?首先考虑一种情况：如果全部好人给你 的钱加起来 小于 坏人收的过路费之和，那么总有一次你的钱不够付过路费，你的结局注定会被砍死。假如你随机选一点 start 出发，那么你肯定会选一个有好人的站点开始，因为开始的时候你没有钱，遇到坏人只能被砍死；现在你在start出发，走到了某个站点end，被end站点的坏人砍死了，说明你在 [start, end) 存的钱不够付 end点坏人的过路费，因为start站点是个好人，所以在 (start, end) 里任何一点出发，你存的钱会比现在还少，还是会被end站点的坏人砍死；于是你重新读档，聪明的选择从 end+1点出发，继续你悲壮的征程； 终于有一天，你发现自己走到了尽头（下标是n-1)的站点而没有被砍死； 此时你犹豫了一下，那我继续往前走，身上的钱够不够你继续走到出发点Start?当然可以，因为开始已经判断过，<strong>好人给你的钱数是大于等于坏人要的过路费的，你现在攒的钱完全可以应付 [0, start) 这一段坏人向你收的过路费。(此处存疑)</strong> 这时候你的嘴角微微上扬，眼眶微微湿润，因为你已经知道这个世界的终极奥秘：Start就是这个问题的答案。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">canCompleteCircuit</span><span class="params">(<span class="type">int</span>[] gas, <span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=gas.length;</span><br><span class="line">    <span class="type">int</span> cur=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> total=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> start=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        cur+=gas[i]-cost[i];</span><br><span class="line">        total+=gas[i]-cost[i];</span><br><span class="line">        <span class="keyword">if</span>(cur&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            start=i+<span class="number">1</span>;</span><br><span class="line">            cur=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(total&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> start;	<span class="comment">//If there exists a solution, it is guaranteed to be unique</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="376-Wiggle-Subsequence"><a href="#376-Wiggle-Subsequence" class="headerlink" title="376. Wiggle Subsequence"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/wiggle-subsequence/">376. Wiggle Subsequence</a></h3><h4 id="Greedy解法"><a href="#Greedy解法" class="headerlink" title="Greedy解法"></a>Greedy解法</h4><p><strong>局部最优：删除单调坡度上的节点（不包括单调坡度两端的节点），那么这个坡度就可以有两个局部峰值</strong>。</p>
<p><strong>整体最优：整个序列有最多的局部峰值，从而达到最长摆动序列</strong>。</p>
<p>局部最优推出全局最优，并举不出反例，那么试试贪心！</p>
<p>（为方便表述，以下说的峰值都是指局部峰值）</p>
<p><strong>实际操作上，其实连删除的操作都不用做，因为题目要求的是最长摆动子序列的长度，所以只需要统计数组的峰值数量就可以了（相当于是删除单一坡度上的节点，然后统计长度）</strong></p>
<p><strong>这就是贪心所贪的地方，让峰值尽可能的保持峰值，然后删除单一坡度上的节点</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">wiggleMaxLength</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.length &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> nums.length;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//当前差值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">curDiff</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//上一个差值</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">preDiff</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">//得到当前差值</span></span><br><span class="line">            curDiff = nums[i] - nums[i - <span class="number">1</span>];</span><br><span class="line">            <span class="comment">//直到当前差值和上一个差值为一正一负，此时wiggle sequence长度增加，更新preDiff和currDiff,并且count++</span></span><br><span class="line">            <span class="comment">//等于0的情况表示初始时的preDiff</span></span><br><span class="line">            <span class="keyword">if</span> ((curDiff &gt; <span class="number">0</span> &amp;&amp; preDiff &lt;= <span class="number">0</span>) || (curDiff &lt; <span class="number">0</span> &amp;&amp; preDiff &gt;= <span class="number">0</span>)) &#123;</span><br><span class="line">                count++;</span><br><span class="line">                preDiff = curDiff;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>时间复杂度：$O(n)$</li>
<li>空间复杂度：$O(1)$</li>
</ul>
<h4 id="Dynamic-Programming基础版"><a href="#Dynamic-Programming基础版" class="headerlink" title="Dynamic Programming基础版"></a>Dynamic Programming基础版</h4><p>考虑用动态规划的思想来解决这个问题。</p>
<p>很容易可以发现，对于我们当前考虑的这个数，要么是作为山峰（即nums[i] &gt; nums[i-1]），要么是作为山谷（即nums[i] &lt; nums[i - 1]）。</p>
<ul>
<li>设dp状态<code>dp[i][0]</code>，表示考虑前i个数，第i个数作为山峰的摆动子序列的最长长度</li>
<li>设dp状态<code>dp[i][1]</code>，表示考虑前i个数，第i个数作为山谷的摆动子序列的最长长度</li>
</ul>
<p>则转移方程为：</p>
<ul>
<li><code>dp[i][0] = max(dp[i][0], dp[j][1] + 1)</code>，其中<code>0 &lt; j &lt; i</code>且<code>nums[j] &lt; nums[i]</code>，表示将nums[i]接到前面某个山谷后面，作为山峰。</li>
<li><code>dp[i][1] = max(dp[i][1], dp[j][0] + 1)</code>，其中<code>0 &lt; j &lt; i</code>且<code>nums[j] &gt; nums[i]</code>，表示将nums[i]接到前面某个山峰后面，作为山谷。</li>
</ul>
<p>初始状态：</p>
<p>由于一个数可以接到前面的某个数后面，也可以以自身为子序列的起点，所以初始状态为：<code>dp[0][0] = dp[0][1] = 1</code>。</p>
<ul>
<li>时间复杂度：$O(n^2)$</li>
<li>空间复杂度：$O(n)$</li>
</ul>
<h4 id="Dynamic-Programming进阶版"><a href="#Dynamic-Programming进阶版" class="headerlink" title="Dynamic Programming进阶版"></a>Dynamic Programming进阶版</h4><p>可以用两棵线段树来维护区间的最大值</p>
<ul>
<li>每次更新<code>dp[i][0]</code>，则在<code>tree1</code>的<code>nums[i]</code>位置值更新为<code>dp[i][0]</code></li>
<li>每次更新<code>dp[i][1]</code>，则在<code>tree2</code>的<code>nums[i]</code>位置值更新为<code>dp[i][1]</code></li>
<li>则dp转移方程中就没有必要j从0遍历到i-1，可以直接在线段树中查询指定区间的值即可。</li>
</ul>
<p>时间复杂度：$O(n\log n)$</p>
<p>空间复杂度：$O(n)$</p>
<h3 id="53-Maximum-Subarray"><a href="#53-Maximum-Subarray" class="headerlink" title="53. Maximum Subarray"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/maximum-subarray/">53. Maximum Subarray</a></h3><h4 id="Greedy解法-1"><a href="#Greedy解法-1" class="headerlink" title="Greedy解法"></a>Greedy解法</h4><p>局部最优：当前“连续和”为负数的时候立刻放弃，从下一个元素重新计算“连续和”，因为负数加上下一个元素 “连续和”只会越来越小。</p>
<p>全局最优：选取最大“连续和”</p>
<p><strong>局部最优的情况下，并记录最大的“连续和”，可以推出全局最优</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        count+=nums[i];</span><br><span class="line">        <span class="keyword">if</span>(count&gt;max)&#123;</span><br><span class="line">            max=count;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            count=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="DP解法"><a href="#DP解法" class="headerlink" title="DP解法"></a>DP解法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n=nums.length;</span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        dp[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> max=dp[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;n; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(dp[i-<span class="number">1</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                dp[i]=dp[i-<span class="number">1</span>]+nums[i];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                dp[i]=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">            max=Math.max(max,dp[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="labuladong"><a href="#labuladong" class="headerlink" title="labuladong"></a>labuladong</h2><p>什么是贪心算法呢？贪心算法可以认为是动态规划算法的一个特例，相比动态规划，使用贪心算法需要满足更多的条件（贪心选择性质），但是效率比动态规划要高。</p>
<p>比如说一个算法问题使用暴力解法需要指数级时间，如果能使用动态规划消除重叠子问题，就可以降到多项式级别的时间，如果满足贪心选择性质，那么可以进一步降低时间复杂度，达到线性级别的。</p>
<p>什么是贪心选择性质呢，简单说就是：每一步都做出一个局部最优的选择，最终的结果就是全局最优。注意哦，这是一种特殊性质，其实只有一部分问题拥有这个性质。</p>
<p>比如你面前放着 100 张人民币，你只能拿十张，怎么才能拿最多的面额？显然每次选择剩下钞票中面值最大的一张，最后你的选择一定是最优的。</p>
<p>然而，大部分问题明显不具有贪心选择性质。比如打斗地主，对手出对儿三，按照贪心策略，你应该出尽可能小的牌刚好压制住对方，但现实情况我们甚至可能会出王炸。这种情况就不能用贪心算法，而得使用动态规划解决。</p>
<h3 id="435-Non-overlapping-Intervals"><a href="#435-Non-overlapping-Intervals" class="headerlink" title="435. Non-overlapping Intervals"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/non-overlapping-intervals/">435. Non-overlapping Intervals</a></h3><p>区间调度问题    Interval Scheduling</p>
<p>最多有几个不冲突的区间？</p>
<p>正确的思路其实很简单，可以分为以下三步：</p>
<ol>
<li><p>从区间集合 <code>intvs</code> 中选择一个区间 <code>x</code>，这个 <code>x</code> 是在当前所有区间中<strong>结束最早的</strong>（<code>end</code> 最小）。</p>
</li>
<li><p>把所有与 <code>x</code> 区间相交的区间从区间集合 <code>intvs</code> 中删除。</p>
</li>
<li><p>重复步骤 1 和 2，直到 <code>intvs</code> 为空为止。之前选出的那些 <code>x</code> 就是最大不相交子集。</p>
</li>
</ol>
<p><em>make the rest of the intervals non-overlapping</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode435</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">eraseOverlapIntervals</span><span class="params">(<span class="type">int</span>[][] intervals)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n=intervals.length;</span><br><span class="line">        Arrays.sort(intervals, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1, <span class="type">int</span>[] o2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> o1[<span class="number">1</span>]-o2[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">int</span> count=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> end=intervals[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] interval : intervals) &#123;</span><br><span class="line">            <span class="type">int</span> start=interval[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span>(start&gt;=end)&#123;<span class="comment">//已由end升序;若start&lt;end,则重叠,不选取(从集合中删去);否则选为新的区间x</span></span><br><span class="line">                count++;</span><br><span class="line">                end=interval[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n-count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>注意：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Arrays.sort(intvs, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span>[] b)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> a[<span class="number">1</span>] - b[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">//以上写法可能出现溢出</span></span><br><span class="line"><span class="comment">//以下写法更保险</span></span><br><span class="line">Arrays.sort(points, (o1,o2)-&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span>(o1[<span class="number">1</span>]&gt;o2[<span class="number">1</span>]) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(o1[<span class="number">1</span>]&lt;o2[<span class="number">1</span>]) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>





<h3 id="452-Minimum-Number-of-Arrows-to-Burst-Balloons"><a href="#452-Minimum-Number-of-Arrows-to-Burst-Balloons" class="headerlink" title="452. Minimum Number of Arrows to Burst Balloons"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-number-of-arrows-to-burst-balloons/">452. Minimum Number of Arrows to Burst Balloons</a></h3><p>依然是求最大不重叠区间数</p>
<p>每个不重叠区间都需要一个箭，每多一个不重叠区间，就多需要一根箭</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode452</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMinArrowShots</span><span class="params">(<span class="type">int</span>[][] points)</span> &#123;</span><br><span class="line">        Arrays.sort(points, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1, <span class="type">int</span>[] o2)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(o1[<span class="number">1</span>]&gt;o2[<span class="number">1</span>])&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(o1[<span class="number">1</span>]&lt;o2[<span class="number">1</span>])&#123;</span><br><span class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">int</span> count=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> end=points[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] point : points) &#123;</span><br><span class="line">            <span class="type">int</span> start=point[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span>(start&gt;end)&#123;</span><br><span class="line">                count++;</span><br><span class="line">                end=point[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="自选"><a href="#自选" class="headerlink" title="自选"></a>自选</h2><h3 id="605-Can-Place-Flowers"><a href="#605-Can-Place-Flowers" class="headerlink" title="605. Can Place Flowers"></a>605. Can Place Flowers</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canPlaceFlowers</span><span class="params">(<span class="type">int</span>[] flowerbed, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> len=flowerbed.length;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(flowerbed[i]==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span> leftPlanted=i&gt;<span class="number">0</span> &amp;&amp; flowerbed[i-<span class="number">1</span>]==<span class="number">1</span>;</span><br><span class="line">        <span class="type">boolean</span> rightPlanted=i&lt;len-<span class="number">1</span> &amp;&amp; flowerbed[i+<span class="number">1</span>]==<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!leftPlanted &amp;&amp; !rightPlanted)&#123;</span><br><span class="line">            flowerbed[i]=<span class="number">1</span>;</span><br><span class="line">            count++;</span><br><span class="line">            <span class="keyword">if</span>(count&gt;=n)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2340-Minimum-Adjacent-Swaps-to-Make-a-Valid-Array"><a href="#2340-Minimum-Adjacent-Swaps-to-Make-a-Valid-Array" class="headerlink" title="2340. Minimum Adjacent Swaps to Make a Valid Array"></a>2340. Minimum Adjacent Swaps to Make a Valid Array</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumSwaps</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="type">int</span> min=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> max=n-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i]&lt;nums[min])&#123;</span><br><span class="line">            min=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(nums[n-<span class="number">1</span>-i]&gt;nums[max])&#123;</span><br><span class="line">            max=n-<span class="number">1</span>-i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min-<span class="number">0</span>+n-<span class="number">1</span>-max-(min&gt;max ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="280-Wiggle-Sort"><a href="#280-Wiggle-Sort" class="headerlink" title="280. Wiggle Sort"></a>280. Wiggle Sort</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">wiggleSort</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n-<span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//even&lt;=odd&gt;=even</span></span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span> &amp;&amp; nums[i]&gt;nums[i+<span class="number">1</span>]</span><br><span class="line">                || i%<span class="number">2</span>==<span class="number">1</span> &amp;&amp; nums[i]&lt;nums[i+<span class="number">1</span>])&#123;</span><br><span class="line">            swap(nums,i,i+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">    <span class="type">int</span> temp=arr[i];</span><br><span class="line">    arr[i]=arr[j];</span><br><span class="line">    arr[j]=temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="1564-Put-Boxes-Into-the-Warehouse-I"><a href="#1564-Put-Boxes-Into-the-Warehouse-I" class="headerlink" title="1564. Put Boxes Into the Warehouse I"></a>1564. Put Boxes Into the Warehouse I</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxBoxesInWarehouse</span><span class="params">(<span class="type">int</span>[] boxes, <span class="type">int</span>[] warehouse)</span> &#123;</span><br><span class="line">    Arrays.sort(boxes);</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    stack.push(warehouse[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; warehouse.length; i++) &#123;</span><br><span class="line">        stack.push(Math.min(warehouse[i],stack.peek()));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> box : boxes) &#123;</span><br><span class="line">        <span class="keyword">if</span>(stack.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; stack.peek()&lt;box)&#123;</span><br><span class="line">            stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!stack.isEmpty())&#123;</span><br><span class="line">            res++;</span><br><span class="line">            stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>自己想的还不够贪！</p>
<p>思路：</p>
<ul>
<li>the edge is the largest space we can offer</li>
<li>if this box can’t fit at the edge, it can fit nowhere</li>
<li>try to fit from the largest box</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxBoxesInWarehouse</span><span class="params">(<span class="type">int</span>[] boxes, <span class="type">int</span>[] warehouse)</span> &#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> idx=<span class="number">0</span>;</span><br><span class="line">    Arrays.sort(boxes);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=boxes.length-<span class="number">1</span>; i&gt;=<span class="number">0</span>; i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(idx==warehouse.length)&#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(boxes[i]&lt;=warehouse[idx])&#123;</span><br><span class="line">            res++;</span><br><span class="line">            idx++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="1580-Put-Boxes-Into-the-Warehouse-II"><a href="#1580-Put-Boxes-Into-the-Warehouse-II" class="headerlink" title="1580. Put Boxes Into the Warehouse II"></a>1580. Put Boxes Into the Warehouse II</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxBoxesInWarehouse</span><span class="params">(<span class="type">int</span>[] boxes, <span class="type">int</span>[] warehouse)</span> &#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    Arrays.sort(boxes);</span><br><span class="line">    <span class="type">int</span> p1=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> p2=warehouse.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> boxes.length - <span class="number">1</span>; i &gt;= <span class="number">0</span> &amp;&amp; p1&lt;=p2; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span>(boxes[i]&lt;=warehouse[p1])&#123;</span><br><span class="line">            res++;</span><br><span class="line">            p1++;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(boxes[i]&lt;=warehouse[p2])&#123;</span><br><span class="line">            res++;</span><br><span class="line">            p2--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="2439-Minimize-Maximum-of-Array"><a href="#2439-Minimize-Maximum-of-Array" class="headerlink" title="2439. Minimize Maximum of Array"></a>2439. Minimize Maximum of Array</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimizeArrayValue</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="type">long</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        sum+=nums[i];</span><br><span class="line">        ans=Math.max(ans,(sum+i)/(i+<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">int</span>)ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/19/%E5%9B%9E%E6%BA%AF%E6%B3%95(1)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/19/%E5%9B%9E%E6%BA%AF%E6%B3%95(1)/" class="post-title-link" itemprop="url">回溯法(1)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-19 16:47:57" itemprop="dateCreated datePublished" datetime="2022-04-19T16:47:57+08:00">2022-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-04-21 09:43:54" itemprop="dateModified" datetime="2022-04-21T09:43:54+08:00">2022-04-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="backtracking-经典题选编-1"><a href="#backtracking-经典题选编-1" class="headerlink" title="backtracking 经典题选编(1)"></a>backtracking 经典题选编(1)</h1><h2 id="回溯法三部曲"><a href="#回溯法三部曲" class="headerlink" title="回溯法三部曲"></a>回溯法三部曲</h2><ol>
<li>递归函数的返回值及其参数 （是否定义全局变量来存放结果）</li>
<li>回溯函数终止条件（怎样是到达叶子节点）</li>
<li>单层搜索的过程（注意choose explore unchoose）</li>
</ol>
<h2 id="LeetCode-77-Combinations"><a href="#LeetCode-77-Combinations" class="headerlink" title="LeetCode 77. Combinations"></a>LeetCode 77. Combinations</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/combinations/">77. Combinations</a></p>
<h3 id="基础版（无剪枝）"><a href="#基础版（无剪枝）" class="headerlink" title="基础版（无剪枝）"></a>基础版（无剪枝）</h3><p>回溯法的搜索过程就是一个树型结构的遍历过程。</p>
<p>for循环用来横向遍历，递归的过程是纵向遍历。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;Integer&gt;&gt; res;</span><br><span class="line">LinkedList&lt;Integer&gt; list;</span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="built_in">this</span>.list=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    backtracking(n,k,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k, <span class="type">int</span> start)</span>&#123; <span class="comment">//回溯法用来解决k层for循环嵌套的问题</span></span><br><span class="line">    <span class="keyword">if</span>(list.size()==k)&#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(list));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt;= n; i++) &#123;<span class="comment">//每层内开启循环</span></span><br><span class="line">        list.add(i);</span><br><span class="line">        backtracking(n,k,i+<span class="number">1</span>);</span><br><span class="line">        list.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="加强版（有剪枝）"><a href="#加强版（有剪枝）" class="headerlink" title="加强版（有剪枝）"></a>加强版（有剪枝）</h3><p>例如，n &#x3D; 4，k &#x3D; 4的话，</p>
<ol>
<li>第一层for循环的时候，从元素2开始的遍历都没有意义了，因为第一层必须选择1；</li>
<li>在第二层for循环，从元素3开始的遍历都没有意义了，因为第二层必须选择2；</li>
</ol>
<p>一般而言，</p>
<ol>
<li>当前 list.size()&#x3D;&#x3D;size, 加上当前层 1 个元素后，后续递归层还需要 (k-size-1) 个元素</li>
<li>后续递归层的起点为 i+1, 终点为n, 共有 n-i 个元素</li>
<li>因此为满足后续递归层的元素数量要求，n-i &gt;&#x3D; k-size-1, 即 i &lt;&#x3D; n-k+size+1, 而不是i&lt;&#x3D;n</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode77</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res;</span><br><span class="line">    LinkedList&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combine</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="built_in">this</span>.list=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        backtracking(n,k,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span> k, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()==k)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> size=list.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt;= n-k+size+<span class="number">1</span>; i++) &#123; <span class="comment">//i &lt;= n-k+size+1</span></span><br><span class="line">            list.add(i);</span><br><span class="line">            backtracking(n,k,i+<span class="number">1</span>);</span><br><span class="line">            list.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="LeetCode-46-Permutations"><a href="#LeetCode-46-Permutations" class="headerlink" title="LeetCode 46. Permutations"></a>LeetCode 46. Permutations</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/permutations/">46. Permutations</a></p>
<p>Given an array <code>nums</code> of distinct integers, return <em>all the possible permutations</em>.</p>
<p>不包含重复元素，无需考虑去重</p>
<p>引入used数组来判断是否该考虑该元素</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">boolean</span>[] used=<span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length];</span><br><span class="line">    helper(res,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),nums,used);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">helper</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; list, <span class="type">int</span>[] nums, <span class="type">boolean</span>[] used)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==nums.length)&#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(used[i])&#123; <span class="comment">//该元素以进入list，直接跳过</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//choose;explore;unchoose</span></span><br><span class="line">        list.add(nums[i]); <span class="comment">//该元素还没进入list,应该加入进去</span></span><br><span class="line">        used[i]=<span class="literal">true</span>;</span><br><span class="line">        helper(res,list,nums,used);</span><br><span class="line">        list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        used[i]=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="LeetCode-47-Permutations-II"><a href="#LeetCode-47-Permutations-II" class="headerlink" title="LeetCode 47. Permutations II"></a>LeetCode 47. Permutations II</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/permutations-ii/">47. Permutations II</a></p>
<p>Given a collection of numbers, <code>nums</code>, that might contain duplicates, return <em>all possible unique permutations <strong>in any order</strong>.</em></p>
<p>同样的，排列问题引入used数组，来判断是否该考虑该元素</p>
<p>包含重复元素，需要考虑去重</p>
<p>如何去重：</p>
<ol>
<li><p>先数组排序</p>
</li>
<li><p>&#96;&#96;&#96;cpp<br>&#x2F;&#x2F; used[i - 1] &#x3D;&#x3D; true，说明同一树枝nums[i - 1]使用过<br>     &#x2F;&#x2F; used[i - 1] &#x3D;&#x3D; false，说明同一树层nums[i - 1]使用过<br>     &#x2F;&#x2F; 如果同一树层nums[i - 1]使用过则直接跳过<br>     if (i &gt; 0 &amp;&amp; nums[i] &#x3D;&#x3D; nums[i - 1] &amp;&amp; used[i - 1] &#x3D;&#x3D; false) {<br>         continue;<br>     }</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```java</span><br><span class="line">public List&lt;List&lt;Integer&gt;&gt; permuteUnique(int[] nums) &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=new ArrayList&lt;&gt;();</span><br><span class="line">    boolean[] visited=new boolean[nums.length];</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    backtracking(res,new ArrayList&lt;&gt;(),nums,visited);</span><br><span class="line">    return res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void backtracking(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; list, int[] nums, boolean[] visited)&#123;</span><br><span class="line">    if(list.size()==nums.length)&#123;</span><br><span class="line">        res.add(new ArrayList&lt;&gt;(list));</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    for (int i = 0; i &lt; nums.length; i++) &#123;</span><br><span class="line">        if(visited[i])&#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        if(i&gt;=1 &amp;&amp; nums[i]==nums[i-1] &amp;&amp; !visited[i-1])&#123;</span><br><span class="line">            continue;</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(nums[i]);</span><br><span class="line">        visited[i]=true;</span><br><span class="line">        backtracking(res,list,nums,visited);</span><br><span class="line">        list.remove(list.size()-1);</span><br><span class="line">        visited[i]=false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="LeetCode-39-Combination-Sum"><a href="#LeetCode-39-Combination-Sum" class="headerlink" title="LeetCode 39. Combination Sum"></a>LeetCode 39. Combination Sum</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/combination-sum/">39. Combination Sum</a></p>
<h3 id="基础版（无剪枝）-1"><a href="#基础版（无剪枝）-1" class="headerlink" title="基础版（无剪枝）"></a>基础版（无剪枝）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode39</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(res,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),candidates,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; list, <span class="type">int</span>[] candidates, <span class="type">int</span> target, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; candidates.length; i++) &#123; <span class="comment">//无剪枝</span></span><br><span class="line">            list.add(candidates[i]);</span><br><span class="line">            backtracking(res,list,candidates,target-candidates[i],i);</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="加强版（有剪枝）-1"><a href="#加强版（有剪枝）-1" class="headerlink" title="加强版（有剪枝）"></a>加强版（有剪枝）</h3><p><strong>在求和问题中，排序之后加剪枝是常见的套路！</strong></p>
<p><strong>对总集合排序之后，如果下一层的sum（就是本层的 sum + candidates[i]）已经大于target，就可以结束本轮for循环的遍历</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    Arrays.sort(candidates);</span><br><span class="line">    backtracking(res,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),candidates,target,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; list, <span class="type">int</span>[] candidates, <span class="type">int</span> target, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(target&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; candidates.length; i++) &#123;</span><br><span class="line">        list.add(candidates[i]);</span><br><span class="line">        <span class="keyword">if</span>(target-candidates[i]&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        backtracking(res,list,candidates,target-candidates[i],i);</span><br><span class="line">        list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="LeetCode-40-Combination-Sum-II"><a href="#LeetCode-40-Combination-Sum-II" class="headerlink" title="LeetCode 40. Combination Sum II"></a>LeetCode 40. Combination Sum II</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/combination-sum-ii/">40. Combination Sum II</a></p>
<p>去重+剪枝</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum2</span><span class="params">(<span class="type">int</span>[] candidates, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    Arrays.sort(candidates);</span><br><span class="line">    <span class="type">boolean</span>[] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[candidates.length];</span><br><span class="line">    backtracking(res,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),candidates,visited,target,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; list, <span class="type">int</span>[] candidates, <span class="type">boolean</span>[] visited,<span class="type">int</span> target, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(target&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; candidates.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;=<span class="number">1</span> &amp;&amp; candidates[i]==candidates[i-<span class="number">1</span>] &amp;&amp; !visited[i-<span class="number">1</span>])&#123; <span class="comment">//用排序+visited数组来去重</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(candidates[i]);</span><br><span class="line">        visited[i]=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span>(target-candidates[i]&lt;<span class="number">0</span>)&#123; <span class="comment">//剪枝，提前跳出循环</span></span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">            visited[i]=<span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        backtracking(res,list,candidates,visited,target-candidates[i],i+<span class="number">1</span>);</span><br><span class="line">        list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        visited[i]=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="LeetCode-216-Combination-Sum-III"><a href="#LeetCode-216-Combination-Sum-III" class="headerlink" title="LeetCode 216. Combination Sum III"></a>LeetCode 216. Combination Sum III</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/combination-sum-iii/">Combination Sum III</a></p>
<p>排序后剪枝判断</p>
<p>2个剪枝判断：</p>
<ol>
<li><p>元素总和不能超过target，若加上本元素总和超过target，则退出本层循环</p>
</li>
<li><p>元素总个数必须正好为k个，引入limit表示还要用的元素个数，当且仅当limit&#x3D;&#x3D;0时，满足题意</p>
<p>若满足limit-1&lt;0，则limit&#x3D;&#x3D;0，本层都不能再加元素，直接退出本层循环</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">combinationSum3</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(res,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),n,k,<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; list, <span class="type">int</span> target, <span class="type">int</span> limit, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(limit==<span class="number">0</span>)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//else limit&gt;0, 直接返回</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt;= <span class="number">9</span>; i++) &#123;</span><br><span class="line">        list.add(i);</span><br><span class="line">        <span class="keyword">if</span>(target-i&lt;<span class="number">0</span> || limit-<span class="number">1</span>&lt;<span class="number">0</span>)&#123; <span class="comment">//2个剪枝条件，满足1个即退出本层循环</span></span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        backtracking(res,list,target-i,limit-<span class="number">1</span>,i+<span class="number">1</span>);</span><br><span class="line">        list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="LeetCode-78-Subsets"><a href="#LeetCode-78-Subsets" class="headerlink" title="LeetCode 78. Subsets"></a>LeetCode 78. Subsets</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/subsets/">78. Subsets</a></p>
<h3 id="法一：间接法"><a href="#法一：间接法" class="headerlink" title="法一：间接法"></a>法一：间接法</h3><p>考虑长度为n的不包含重复元素的数组nums（集合）的子集（包括空集和本身）个数为2^n</p>
<p>2^n&#x3D;从nums[0]到nums[n-1],每一个元素都有两种情况，取或不取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; judge=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(); <span class="comment">//引入judge，judge.get(i)==0表示nums[i]不进入该子集，vice versa</span></span><br><span class="line">    backtracking(res,judge,nums);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; judge, <span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(judge.size()==nums.length)&#123;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; judge.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(judge.get(i)==<span class="number">1</span>)&#123;</span><br><span class="line">                list.add(nums[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.add(list);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    judge.add(<span class="number">0</span>);</span><br><span class="line">    backtracking(res,judge,nums);</span><br><span class="line">    judge.remove(judge.size()-<span class="number">1</span>);</span><br><span class="line">    judge.add(<span class="number">1</span>);</span><br><span class="line">    backtracking(res,judge,nums);</span><br><span class="line">    judge.remove(judge.size()-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="法二：直接法"><a href="#法二：直接法" class="headerlink" title="法二：直接法"></a>法二：直接法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsets</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(res,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),nums,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; list, <span class="type">int</span>[] nums, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">    res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));<span class="comment">//无需判断，见一个加一个，因为见到的都是子集</span></span><br><span class="line">    <span class="keyword">if</span>(start&gt;=nums.length)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">        list.add(nums[i]);</span><br><span class="line">        backtracking(res,list,nums,i+<span class="number">1</span>);</span><br><span class="line">        list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="LeetCode-90-Subsets-II"><a href="#LeetCode-90-Subsets-II" class="headerlink" title="LeetCode 90. Subsets II"></a>LeetCode 90. Subsets II</h2><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/subsets-ii/">90. Subsets II</a></p>
<p>子集直接法（见一个加一个）+排序去重</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">subsetsWithDup</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    Arrays.sort(nums);</span><br><span class="line">    <span class="type">boolean</span>[] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length];</span><br><span class="line">    backtracking(res,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),nums,visited,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, List&lt;Integer&gt; list, <span class="type">int</span>[] nums, <span class="type">boolean</span>[] visited,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">    res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">    <span class="keyword">if</span>(start&gt;=nums.length)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;=<span class="number">1</span> &amp;&amp; nums[i]==nums[i-<span class="number">1</span>] &amp;&amp; !visited[i-<span class="number">1</span>])&#123;<span class="comment">//经典 排序+visited去重</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(nums[i]);</span><br><span class="line">        visited[i]=<span class="literal">true</span>;</span><br><span class="line">        backtracking(res,list,nums,visited,i+<span class="number">1</span>);</span><br><span class="line">        list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        visited[i]=<span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/18/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E7%BB%9F%E4%B8%80%E9%A3%8E%E6%A0%BC%E8%BF%AD%E4%BB%A3%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/18/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E7%BB%9F%E4%B8%80%E9%A3%8E%E6%A0%BC%E8%BF%AD%E4%BB%A3%E6%B3%95/" class="post-title-link" itemprop="url">二叉树的统一风格迭代法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-04-19 09:19:48 / 修改时间：16:52:11" itemprop="dateCreated datePublished" datetime="2022-04-19T09:19:48+08:00">2022-04-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-统一风格迭代法原理"><a href="#1-统一风格迭代法原理" class="headerlink" title="1. 统一风格迭代法原理"></a>1. 统一风格迭代法原理</h1><h2 id="1-1-问题描述"><a href="#1-1-问题描述" class="headerlink" title="1.1 问题描述"></a>1.1 问题描述</h2><p>前序和后序本质一样： 根左右 -&gt; 根右左 -&gt; 左右根</p>
<p>只需改变前序遍历的左右子树处理顺序，再reverse最终结果，即得后序遍历</p>
<p>但是难以统一前序后序与中序</p>
<p>核心问题：节点访问顺序与处理顺序不同！</p>
<p>以中序遍历为例，先访问根节点，但此时不能处理（输出结果），必须等左子树处理完毕，才能处理根节点。</p>
<h2 id="1-2-解决思路"><a href="#1-2-解决思路" class="headerlink" title="1.2 解决思路"></a>1.2 解决思路</h2><p>preorder 根左右       进栈顺序应为右左根</p>
<p>inorder 左根右          进栈顺序应为右根左</p>
<p>postorder 左右根      进栈顺序应为根右左</p>
<p><strong>将访问的节点放入栈中，把要处理的节点也放入栈中但是要紧接着放入一个空指针作为标记。</strong></p>
<p>只有当遇到空指针时，才将栈顶下一个节点放进结果集</p>
<h2 id="1-3-前序遍历代码"><a href="#1-3-前序遍历代码" class="headerlink" title="1.3 前序遍历代码"></a>1.3 前序遍历代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">       Stack&lt;TreeNode&gt; st = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">       <span class="keyword">if</span> (root != <span class="literal">null</span>) st.push(root);</span><br><span class="line">       <span class="keyword">while</span> (!st.empty()) &#123;</span><br><span class="line">           <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> st.peek();</span><br><span class="line">           <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">               st.pop(); <span class="comment">// 将该节点弹出，避免重复操作，下面再将右左根节点添加到栈中</span></span><br><span class="line">               <span class="keyword">if</span> (node.right!=<span class="literal">null</span>) st.push(node.right);  <span class="comment">// 添加右节点（空节点不入栈）</span></span><br><span class="line">               <span class="keyword">if</span> (node.left!=<span class="literal">null</span>) st.push(node.left);    <span class="comment">// 添加左节点（空节点不入栈）</span></span><br><span class="line">               st.push(node);                          <span class="comment">// 添加中节点</span></span><br><span class="line">               st.push(<span class="literal">null</span>); <span class="comment">// 中节点访问过，但是还没有处理，加入空节点做为标记。</span></span><br><span class="line">               </span><br><span class="line">           &#125; <span class="keyword">else</span> &#123; <span class="comment">// 只有遇到空节点的时候，才将下一个节点放进结果集</span></span><br><span class="line">               st.pop();           <span class="comment">// 将空节点弹出</span></span><br><span class="line">               node = st.peek();    <span class="comment">// 重新取出栈中元素</span></span><br><span class="line">               st.pop();</span><br><span class="line">               result.add(node.val); <span class="comment">// 加入到结果集</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-4-中序遍历代码"><a href="#1-4-中序遍历代码" class="headerlink" title="1.4 中序遍历代码"></a>1.4 中序遍历代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    Stack&lt;TreeNode&gt; st = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (root != <span class="literal">null</span>) st.push(root);</span><br><span class="line">    <span class="keyword">while</span> (!st.empty()) &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> st.peek();</span><br><span class="line">        <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">            st.pop(); <span class="comment">// 将该节点弹出，避免重复操作，下面再将右根左节点添加到栈中</span></span><br><span class="line">            <span class="keyword">if</span> (node.right!=<span class="literal">null</span>) st.push(node.right);  <span class="comment">// 添加右节点（空节点不入栈）</span></span><br><span class="line">            st.push(node);                          <span class="comment">// 添加中节点</span></span><br><span class="line">            st.push(<span class="literal">null</span>); <span class="comment">// 中节点访问过，但是还没有处理，加入空节点做为标记。</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (node.left!=<span class="literal">null</span>) st.push(node.left);    <span class="comment">// 添加左节点（空节点不入栈）</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 只有遇到空节点的时候，才将下一个节点放进结果集</span></span><br><span class="line">            st.pop();           <span class="comment">// 将空节点弹出</span></span><br><span class="line">            node = st.peek();    <span class="comment">// 重新取出栈中元素</span></span><br><span class="line">            st.pop();</span><br><span class="line">            result.add(node.val); <span class="comment">// 加入到结果集</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-5-后序遍历代码"><a href="#1-5-后序遍历代码" class="headerlink" title="1.5 后序遍历代码"></a>1.5 后序遍历代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">       Stack&lt;TreeNode&gt; st = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">       <span class="keyword">if</span> (root != <span class="literal">null</span>) st.push(root);</span><br><span class="line">       <span class="keyword">while</span> (!st.empty()) &#123;</span><br><span class="line">           <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> st.peek();</span><br><span class="line">           <span class="keyword">if</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">               st.pop(); <span class="comment">// 将该节点弹出，避免重复操作，下面再将根右左节点添加到栈中</span></span><br><span class="line">               st.push(node);                          <span class="comment">// 添加中节点</span></span><br><span class="line">               st.push(<span class="literal">null</span>); <span class="comment">// 中节点访问过，但是还没有处理，加入空节点做为标记。</span></span><br><span class="line">               <span class="keyword">if</span> (node.right!=<span class="literal">null</span>) st.push(node.right);  <span class="comment">// 添加右节点（空节点不入栈）</span></span><br><span class="line">               <span class="keyword">if</span> (node.left!=<span class="literal">null</span>) st.push(node.left);    <span class="comment">// 添加左节点（空节点不入栈）         </span></span><br><span class="line">                              </span><br><span class="line">           &#125; <span class="keyword">else</span> &#123; <span class="comment">// 只有遇到空节点的时候，才将下一个节点放进结果集</span></span><br><span class="line">               st.pop();           <span class="comment">// 将空节点弹出</span></span><br><span class="line">               node = st.peek();    <span class="comment">// 重新取出栈中元素</span></span><br><span class="line">               st.pop();</span><br><span class="line">               result.add(node.val); <span class="comment">// 加入到结果集</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/unusable-index/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/unusable-index/">1</a><span class="space">&hellip;</span><a class="page-number" href="/unusable-index/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/unusable-index/page/9/">9</a><a class="extend next" rel="next" href="/unusable-index/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">invincible-nerd</p>
  <div class="site-description" itemprop="description">For explorer everywhere</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022-04 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">invincible-nerd</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">15:56</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
