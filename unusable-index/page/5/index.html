<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"invincible-nerd.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="For explorer everywhere">
<meta property="og:type" content="website">
<meta property="og:title" content="IVN">
<meta property="og:url" content="http://invincible-nerd.github.io/unusable-index/page/5/index.html">
<meta property="og:site_name" content="IVN">
<meta property="og:description" content="For explorer everywhere">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="invincible-nerd">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://invincible-nerd.github.io/unusable-index/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>IVN</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">IVN</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/05/12/DDIA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/12/DDIA/" class="post-title-link" itemprop="url">DDIA学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-12 15:41:23" itemprop="dateCreated datePublished" datetime="2022-05-12T15:41:23+08:00">2022-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-13 17:16:31" itemprop="dateModified" datetime="2022-05-13T17:16:31+08:00">2022-05-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>15k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>14 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="数据系统的基石"><a href="#数据系统的基石" class="headerlink" title="数据系统的基石"></a>数据系统的基石</h1><h2 id="可靠性、可伸缩性、可维护性"><a href="#可靠性、可伸缩性、可维护性" class="headerlink" title="可靠性、可伸缩性、可维护性"></a>可靠性、可伸缩性、可维护性</h2><h3 id="Reliability"><a href="#Reliability" class="headerlink" title="Reliability"></a>Reliability</h3><ul>
<li><p>系统在 <strong>困境</strong>（adversity，比如硬件故障、软件故障、人为错误）中仍可正常工作（正确完成功能，并能达到期望的性能水准）</p>
</li>
<li><p>造成错误的原因叫做 <strong>故障（fault）</strong>，能预料并应对故障的系统特性可称为 <strong>容错（fault-tolerant）</strong> 或 <strong>韧性（resilient）</strong></p>
</li>
<li><p>注意 <strong>故障（fault）</strong> 不同于 <strong>失效（failure）</strong>。<strong>故障</strong> 通常定义为系统的一部分状态偏离其标准，而 <strong>失效</strong> 则是系统作为一个整体停止向用户提供服务。故障的概率不可能降到零，因此最好设计容错机制以防因 <strong>故障</strong> 而导致 <strong>失效</strong></p>
</li>
<li><p><strong>硬件故障（hardware faults）</strong>:</p>
<ol>
<li><p>硬盘崩溃、内存出错、机房断电、有人拔错网线……</p>
</li>
<li><p>硬盘的 <strong>平均无故障时间（MTTF, mean time to failure）</strong> 约为 10 到 50 年</p>
</li>
<li><p>对策：</p>
<ul>
<li>增加单个硬件的冗余度</li>
<li>云平台的设计优先考虑 <strong>灵活性（flexibility）</strong> 和 <strong>弹性（elasticity）</strong>，而不是单机可靠性</li>
<li>在硬件冗余的基础上进一步引入软件容错机制</li>
</ul>
</li>
</ol>
</li>
<li><p><strong>软件错误 系统性错误（systematic error）</strong></p>
</li>
</ul>
<ol>
<li><p>例子：</p>
<ul>
<li>接受特定的错误输入，便导致所有应用服务器实例崩溃的 BUG。例如 2012 年 6 月 30 日的闰秒，由于 Linux 内核中的一个错误，许多应用同时挂掉了。</li>
<li>失控进程会用尽一些共享资源，包括 CPU 时间、内存、磁盘空间或网络带宽。</li>
<li>系统依赖的服务变慢，没有响应，或者开始返回错误的响应。</li>
</ul>
</li>
<li><p>导致这类软件故障的 BUG 通常会潜伏很长时间，直到被异常情况触发为止。这种情况意味着软件对其环境做出了某种假设 —— 虽然这种假设通常来说是正确的，但由于某种原因最后不再成立了</p>
</li>
<li><p>对策：</p>
<ul>
<li><p>仔细考虑系统中的假设和交互</p>
</li>
<li><p>彻底的测试</p>
</li>
<li><p>进程隔离；允许进程崩溃并重启</p>
</li>
<li><p>测量、监控并分析生产环境中的系统行为。如果系统能够提供一些保证（例如在一个消息队列中，进入与发出的消息数量相等），那么系统就可以在运行时不断自检，并在出现 <strong>差异（discrepancy）</strong> 时报警</p>
</li>
</ul>
</li>
</ol>
<ul>
<li><p><strong>人为错误</strong></p>
<ol>
<li><p>设计并构建了软件系统的工程师是人类，维持系统运行的运维也是人类。即使他们怀有最大的善意，人类也是不可靠的。</p>
</li>
<li><p>对策：</p>
<ul>
<li>以最小化犯错机会的方式设计系统。例如，精心设计的抽象、API 和管理后台使做对事情更容易，搞砸事情更困难。但如果接口限制太多，人们就会忽略它们的好处而想办法绕开。很难正确把握这种微妙的平衡。</li>
<li>将人们最容易犯错的地方与可能导致失效的地方 <strong>解耦（decouple）</strong>。特别是提供一个功能齐全的非生产环境 <strong>沙箱（sandbox）</strong>，使人们可以在不影响真实用户的情况下，使用真实数据安全地探索和实验。</li>
<li>在各个层次进行彻底的测试，从单元测试、全系统集成测试到手动测试。自动化测试易于理解，已经被广泛使用，特别适合用来覆盖正常情况中少见的 <strong>边缘场景（corner case）</strong>。</li>
<li>允许从人为错误中简单快速地恢复，以最大限度地减少失效情况带来的影响。 例如，快速回滚配置变更，分批发布新代码（以便任何意外错误只影响一小部分用户），并提供数据重算工具（以备旧的计算出错）。</li>
<li>配置详细和明确的监控，比如性能指标和错误率。 在其他工程学科中这指的是 <strong>遥测（telemetry）</strong>（一旦火箭离开了地面，遥测技术对于跟踪发生的事情和理解失败是至关重要的）。监控可以向我们发出预警信号，并允许我们检查是否有任何地方违反了假设和约束。当出现问题时，指标数据对于问题诊断是非常宝贵的。</li>
</ul>
</li>
</ol>
</li>
<li><p><strong>可靠性有多重要</strong></p>
<ol>
<li><p>即使在 “非关键” 应用中，我们也对用户负有责任。</p>
</li>
<li><p>我们偷工减料时，应该清楚意识到自己在做什么。</p>
</li>
</ol>
</li>
</ul>
<h3 id="Scalability"><a href="#Scalability" class="headerlink" title="Scalability"></a>Scalability</h3><ul>
<li><p>有合理的办法应对系统的增长（数据量、流量、复杂性）</p>
</li>
<li><p>系统今天能可靠运行，并不意味未来也能可靠运行。服务 <strong>降级（degradation）</strong> 的一个常见原因是负载增加，例如：系统负载已经从一万个并发用户增长到十万个并发用户，或者从一百万增长到一千万。也许现在处理的数据量级要比过去大得多。</p>
</li>
<li><p><strong>描述负载</strong></p>
<ol>
<li><p>负载可以用一些称为 <strong>负载参数（load parameters）</strong> 的数字来描述。参数的最佳选择取决于系统架构，它可能是每秒向 Web 服务器发出的请求、数据库中的读写比率、聊天室中同时活跃的用户数量、缓存命中率或其他东西。除此之外，也许平均情况对你很重要，也许你的瓶颈是少数极端场景。</p>
</li>
<li><p>例子：twitter业务:</p>
<ul>
<li><p>发布推文</p>
<p>用户可以向其粉丝发布新消息（平均 4.6k 请求 &#x2F; 秒，峰值超过 12k 请求 &#x2F; 秒）</p>
</li>
<li><p>主页时间线</p>
<p>用户可以查阅他们关注的人发布的推文（300k 请求 &#x2F; 秒）</p>
</li>
<li><p>方法一：全局推文集合，关系型数据库</p>
<p>发布推文时，只需将新推文插入全局推文集合即可。当一个用户请求自己的主页时间线时，首先查找他关注的所有人，查询这些被关注用户发布的推文并按时间顺序合并。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tweets.<span class="operator">*</span>, users.<span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> tweets</span><br><span class="line">  <span class="keyword">JOIN</span> users   <span class="keyword">ON</span> tweets.sender_id <span class="operator">=</span> users.id</span><br><span class="line">  <span class="keyword">JOIN</span> follows <span class="keyword">ON</span> follows.followee_id <span class="operator">=</span> users.id</span><br><span class="line">  <span class="keyword">WHERE</span> follows.follower_id <span class="operator">=</span> <span class="built_in">current_user</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>方法二：为每个用户的主页时间线维护一个缓存。</p>
<p>当一个用户发布推文时，查找所有关注该用户的人，并将新的推文插入到每个主页时间线缓存中。 因此读取主页时间线的请求开销很小，因为结果已经提前计算好了。</p>
</li>
<li><p>推特的第一个版本使用了方法 1，但系统很难跟上主页时间线查询的负载。所以公司转向了方法 2，方法 2 的效果更好，因为发推频率比查询主页时间线的频率几乎低了两个数量级，所以在这种情况下，最好在写入时做更多的工作，而在读取时做更少的工作。</p>
</li>
<li><p>然而方法 2 的缺点是，发推现在需要大量的额外工作。平均来说，一条推文会发往约 75 个关注者，所以每秒 4.6k 的发推写入，变成了对主页时间线缓存每秒 345k 的写入。但这个平均值隐藏了用户粉丝数差异巨大这一现实，一些用户有超过 3000 万的粉丝，这意味着一条推文就可能会导致主页时间线缓存的 3000 万次写入！及时完成这种操作是一个巨大的挑战 —— 推特尝试在 5 秒内向粉丝发送推文。</p>
</li>
<li><p>在推特的例子中，每个用户粉丝数的分布（可能按这些用户的发推频率来加权）是探讨可伸缩性的一个关键负载参数，因为它决定了扇出负载。你的应用程序可能具有非常不同的特征，但可以采用相似的原则来考虑它的负载。</p>
</li>
<li><p>推特轶事的最终转折：现在已经稳健地实现了方法 2，推特逐步转向了两种方法的混合。大多数用户发的推文会被扇出写入其粉丝主页时间线缓存中。但是少数拥有海量粉丝的用户（即名流）会被排除在外。当用户读取主页时间线时，分别地获取出该用户所关注的每位名流的推文，再与用户的主页时间线缓存合并，如方法 1 所示。这种混合方法能始终如一地提供良好性能。</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p><strong>描述性能</strong></p>
<ol>
<li><p>一旦系统的负载被描述好，就可以研究当负载增加会发生什么。我们可以从两种角度来看：</p>
<ul>
<li>增加负载参数并保持系统资源（CPU、内存、网络带宽等）不变时，系统性能将受到什么影响？</li>
<li>增加负载参数并希望保持性能不变时，需要增加多少系统资源？</li>
</ul>
</li>
<li><p>对于 Hadoop 这样的批处理系统，通常关心的是 <strong>吞吐量（throughput）</strong>，即每秒可以处理的记录数量，或者在特定规模数据集上运行作业的总时间 </p>
</li>
<li><p>对于在线系统，通常更重要的是服务的 <strong>响应时间（response time）</strong>，即客户端发送请求到接收响应之间的时间</p>
<ul>
<li><p><strong>延迟（latency）</strong> 和 <strong>响应时间（response time）</strong> 经常用作同义词，但实际上它们并不一样。</p>
</li>
<li><p>响应时间是客户所看到的，除了实际处理请求的时间（ <strong>服务时间（service time）</strong> ）之外，还包括网络延迟和排队延迟。</p>
</li>
<li><p>延迟是某个请求等待处理的 <strong>持续时长</strong>，在此期间它处于 <strong>休眠（latent）</strong> 状态，并等待服务</p>
</li>
<li><p>即使不断重复发送同样的请求，每次得到的响应时间也都会略有不同。现实世界的系统会处理各式各样的请求，响应时间可能会有很大差异。因此我们需要将响应时间视为一个可以测量的数值 <strong>分布（distribution）</strong>，而不是单个数值。</p>
</li>
<li><p>响应时间的高百分位点（也称为 <strong>尾部延迟</strong>，即 <strong>tail latencies</strong>）非常重要，因为它们直接影响用户的服务体验。例如亚马逊在描述内部服务的响应时间要求时是以 <strong>99.9 百分位点</strong>为准，即使它只影响一千个请求中的一个。这是因为<strong>请求响应最慢的客户往往也是数据最多的客户</strong>，也可以说是最有价值的客户 ——<strong>因为他们掏钱了</strong>。保证网站响应迅速对于保持客户的满意度非常重要，亚马逊观察到：响应时间增加 100 毫秒，销售量就减少 1%；而另一些报告说：慢 1 秒钟会让客户满意度指标减少 16%。</p>
<p>另一方面，优化第 99.99 百分位点（一万个请求中最慢的一个）被认为太昂贵了，不能为亚马逊的目标带来足够好处。减小高百分位点处的响应时间相当困难，因为它很容易受到随机事件的影响，这超出了控制范围，而且效益也很小。</p>
</li>
<li><p>百分位点通常用于 <strong>服务级别目标（SLO, service level objectives）</strong> 和 <strong>服务级别协议（SLA, service level agreements）</strong>，即定义服务预期性能和可用性的合同。 SLA 可能会声明，如果服务响应时间的中位数小于 200 毫秒，且 99.9 百分位点低于 1 秒，则认为服务工作正常（如果响应时间更长，就认为服务不达标）。这些指标为客户设定了期望值，并允许客户在 SLA 未达标的情况下要求退款。</p>
</li>
<li><p><strong>排队延迟（queueing delay）</strong> 通常占了高百分位点处响应时间的很大一部分。由于服务器只能并行处理少量的事务（如受其 CPU 核数的限制），所以只要有少量缓慢的请求就能阻碍后续请求的处理，这种效应有时被称为 <strong>头部阻塞（head-of-line blocking）</strong> 。即使后续请求在服务器上处理的非常迅速，由于需要等待先前请求完成，客户端最终看到的是缓慢的总体响应时间。因为存在这种效应，测量客户端的响应时间非常重要。</p>
</li>
<li><p>为测试系统的可伸缩性而人为产生负载时，产生负载的客户端要独立于响应时间不断发送请求。如果客户端在发送下一个请求之前等待先前的请求完成，这种行为会产生人为排队的效果，使得测试时的队列比现实情况更短，使测量结果产生偏差。</p>
</li>
</ul>
</li>
</ol>
</li>
<li><p><strong>应对负载的方法</strong></p>
<ol>
<li><p><strong>纵向伸缩</strong>（scaling up，也称为垂直伸缩，即 vertical scaling，转向更强大的机器）</p>
</li>
<li><p><strong>横向伸缩</strong>（scaling out，也称为水平伸缩，即 horizontal scaling，将负载分布到多台小机器上）</p>
</li>
<li><p>跨多台机器部署 <strong>无状态服务（stateless services）</strong> 非常简单，但将带状态的数据系统从单节点变为分布式配置则可能引入许多额外复杂度。出于这个原因，常识告诉我们应该将数据库放在单个节点上（纵向伸缩），直到伸缩成本或可用性需求迫使其改为分布式。</p>
</li>
<li><p>随着分布式系统的工具和抽象越来越好，至少对于某些类型的应用而言，这种常识可能会改变。可以预见分布式数据系统将成为未来的默认设置，即使对不处理大量数据或流量的场景也如此。本书的其余部分将介绍多种分布式数据系统，不仅讨论它们在可伸缩性方面的表现，还包括易用性和可维护性。</p>
</li>
<li><p>大规模的系统架构通常是应用特定的 —— 没有一招鲜吃遍天的通用可伸缩架构（不正式的叫法：<strong>万金油（magic scaling sauce）</strong> ）。应用的问题可能是读取量、写入量、要存储的数据量、数据的复杂度、响应时间要求、访问模式或者所有问题的大杂烩。</p>
<p>举个例子，用于处理每秒十万个请求（每个大小为 1 kB）的系统与用于处理每分钟 3 个请求（每个大小为 2GB）的系统看上去会非常不一样，尽管两个系统有同样的数据吞吐量。</p>
</li>
<li><p>一个良好适配应用的可伸缩架构，是围绕着 <strong>假设（assumption）</strong> 建立的：哪些操作是常见的？哪些操作是罕见的？这就是所谓负载参数。如果假设最终是错误的，那么为伸缩所做的工程投入就白费了，最糟糕的是适得其反。在早期创业公司或非正式产品中，通常支持产品快速迭代的能力，要比可伸缩至未来的假想负载要重要的多。</p>
</li>
</ol>
</li>
</ul>
<h3 id="Maintainability"><a href="#Maintainability" class="headerlink" title="Maintainability"></a>Maintainability</h3><ul>
<li><p>许多不同的人（工程师、运维）在不同的生命周期，都能高效地在系统上工作（使系统保持现有行为，并适应新的应用场景）</p>
</li>
<li><p>可操作性（Operability）</p>
<p>便于运维团队保持系统平稳运行</p>
</li>
<li><p>简单性（Simplicity）</p>
<p>从系统中消除尽可能多的 <strong>复杂度（complexity）</strong>，使新工程师也能轻松理解系统（注意这和用户接口的简单性不一样）</p>
<ol>
<li><p>简化系统并不一定意味着减少功能；它也可以意味着消除 <strong>额外的（accidental）</strong> 的复杂度。 Moseley 和 Marks把 <strong>额外复杂度</strong> 定义为：由具体实现中涌现，而非（从用户视角看，系统所解决的）问题本身固有的复杂度。</p>
</li>
<li><p>用于消除 <strong>额外复杂度</strong> 的最好工具之一是 <strong>抽象（abstraction）</strong>。一个好的抽象可以将大量实现细节隐藏在一个干净，简单易懂的外观下面。一个好的抽象也可以广泛用于各类不同应用。比起重复造很多轮子，重用抽象不仅更有效率，而且有助于开发高质量的软件。抽象组件的质量改进将使所有使用它的应用受益。</p>
<p>例如，高级编程语言是一种抽象，隐藏了机器码、CPU 寄存器和系统调用。 SQL 也是一种抽象，隐藏了复杂的磁盘 &#x2F; 内存数据结构、来自其他客户端的并发请求、崩溃后的不一致性。当然在用高级语言编程时，我们仍然用到了机器码；只不过没有 <strong>直接（directly）</strong> 使用罢了，正是因为编程语言的抽象，我们才不必去考虑这些实现细节。</p>
</li>
</ol>
</li>
<li><p>可演化性（evolvability）</p>
<p>使工程师在未来能轻松地对系统进行更改，当需求变化时为新应用场景做适配。也称为 <strong>可伸缩性（extensibility）</strong>、<strong>可修改性（modifiability）</strong> 或 <strong>可塑性（plasticity）</strong></p>
</li>
</ul>
<h2 id="数据模型与查询语言"><a href="#数据模型与查询语言" class="headerlink" title="数据模型与查询语言"></a>数据模型与查询语言</h2><p>多数应用使用层层叠加的数据模型构建。对于每层数据模型的关键问题是：它是如何用低一层数据模型来 <strong>表示</strong> 的？例如：</p>
<ol>
<li>作为一名应用开发人员，你观察现实世界（里面有人员、组织、货物、行为、资金流向、传感器等），并采用对象或数据结构，以及操控那些数据结构的 API 来进行建模。那些结构通常是特定于应用程序的。</li>
<li>当要存储那些数据结构时，你可以利用通用数据模型来表示它们，如 JSON 或 XML 文档、关系数据库中的表或图模型。</li>
<li>数据库软件的工程师选定如何以内存、磁盘或网络上的字节来表示 JSON &#x2F; XML&#x2F; 关系 &#x2F; 图数据。这类表示形式使数据有可能以各种方式来查询，搜索，操纵和处理。</li>
<li>在更低的层次上，硬件工程师已经想出了使用电流、光脉冲、磁场或者其他东西来表示字节的方法。</li>
</ol>
<p>一个复杂的应用程序可能会有更多的中间层次，比如基于 API 的 API，不过基本思想仍然是一样的：每个层都通过提供一个明确的数据模型来隐藏更低层次中的复杂性。这些抽象允许不同的人群有效地协作（例如数据库厂商的工程师和使用数据库的应用程序开发人员）。</p>
<h3 id="关系模型与文档模型"><a href="#关系模型与文档模型" class="headerlink" title="关系模型与文档模型"></a>关系模型与文档模型</h3><ul>
<li><p>NoSQL 被追溯性地重新解释为 <strong>不仅是 SQL（Not Only SQL）</strong>，其背后的驱动因素有：</p>
<ol>
<li>需要比关系数据库更好的可伸缩性，包括非常大的数据集或非常高的写入吞吐量</li>
<li>相比商业数据库产品，免费和开源软件更受偏爱</li>
<li>关系模型不能很好地支持一些特殊的查询操作</li>
<li>受挫于关系模型的限制性，渴望一种更具多动态性与表现力的数据模型</li>
</ol>
</li>
<li><p>新的非关系型 “NoSQL” 数据存储在两个主要方向上存在分歧：</p>
<ol>
<li><strong>文档数据库</strong> 的应用场景是：数据通常是自我包含的，而且文档之间的关系非常稀少。</li>
<li><strong>图形数据库</strong> 用于相反的场景：任意事物都可能与任何事物相关联。</li>
</ol>
</li>
<li><p>在可预见的未来，关系数据库似乎可能会继续与各种非关系数据库一起使用 - 这种想法有时也被称为 <strong>混合持久化（polyglot persistence）</strong>。</p>
</li>
<li><p>目前大多数应用程序开发都使用面向对象的编程语言来开发，这导致了对 SQL 数据模型的普遍批评：如果数据存储在关系表中，那么需要一个笨拙的转换层，处于应用程序代码中的对象和表，行，列的数据库模型之间。模型之间的不连贯有时被称为 <strong>阻抗不匹配（impedance mismatch）</strong></p>
<ol>
<li><p>像 ActiveRecord 和 Hibernate 这样的 <strong>对象关系映射（ORM object-relational mapping）</strong> 框架可以减少这个转换层所需的样板代码的数量，但是它们不能完全隐藏这两个模型之间的差异。</p>
</li>
<li><p>对于一个像简历这样自包含文档的数据结构而言，JSON 表示是非常合适的。JSON 比 XML 更简单。面向文档的数据库（如 MongoDB ，RethinkDB ，CouchDB 和 Espresso）支持这种数据模型。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;user_id&quot;</span><span class="punctuation">:</span> <span class="number">251</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;first_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bill&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;last_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Gates&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;summary&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Co-chair of the Bill &amp; Melinda Gates... Active blogger.&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;region_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;us:91&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;industry_id&quot;</span><span class="punctuation">:</span> <span class="number">131</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;photo_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/p/7/000/253/05b/308dd6e.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;positions&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;job_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Co-chair&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;organization&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Bill &amp; Melinda Gates Foundation&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;job_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Co-founder, Chairman&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;organization&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Microsoft&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;education&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;school_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Harvard University&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="number">1973</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="number">1975</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;school_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lakeside School, Seattle&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;end&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;contact_info&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;blog&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://thegatesnotes.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;twitter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://twitter.com/BillGates&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
<h3 id="数据查询语言"><a href="#数据查询语言" class="headerlink" title="数据查询语言"></a>数据查询语言</h3><ul>
<li><p>SQL 是一种 <strong>声明式</strong> 查询语言</p>
</li>
<li><p>许多常用的编程语言是命令式的。</p>
</li>
<li><p>web上的声明式查询：用css选择器</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">li</span><span class="selector-class">.selected</span> &gt; <span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>web上的命令式查询：在 Javascript 中，使用 <strong>文档对象模型（DOM）</strong> API</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> liElements = <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;li&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; liElements.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (liElements[i].<span class="property">className</span> === <span class="string">&quot;selected&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> children = liElements[i].<span class="property">childNodes</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; children.<span class="property">length</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">var</span> child = children[j];</span><br><span class="line">            <span class="keyword">if</span> (child.<span class="property">nodeType</span> === <span class="title class_">Node</span>.<span class="property">ELEMENT_NODE</span> &amp;&amp; child.<span class="property">tagName</span> === <span class="string">&quot;P&quot;</span>) &#123;</span><br><span class="line">                child.<span class="title function_">setAttribute</span>(<span class="string">&quot;style&quot;</span>, <span class="string">&quot;background-color: blue&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>MapReduce 是一个由 Google 推广的编程模型，用于在多台机器上批量处理大规模的数据。一些 NoSQL 数据存储（包括 MongoDB 和 CouchDB）支持有限形式的 MapReduce，作为在多个文档中执行只读查询的机制。</p>
<p>MapReduce 既不是一个声明式的查询语言，也不是一个完全命令式的查询 API，而是处于两者之间：查询的逻辑用代码片段来表示，这些代码片段会被处理框架重复性调用。它基于 <code>map</code>（也称为 <code>collect</code>）和 <code>reduce</code>（也称为 <code>fold</code> 或 <code>inject</code>）函数，两个函数存在于许多函数式编程语言中。</p>
</li>
</ul>
<h3 id="图数据模型"><a href="#图数据模型" class="headerlink" title="图数据模型"></a>图数据模型</h3><p>一个图由两种对象组成：<strong>顶点</strong>（vertices，也称为 <strong>节点</strong>，即 nodes，或 <strong>实体</strong>，即 entities），和 <strong>边</strong>（edges，也称为 <strong>关系</strong>，即 relationships，或 <strong>弧</strong>，即 arcs）。多种数据可以被建模为一个图形。典型的例子包括：</p>
<ul>
<li><p>社交图谱</p>
<p>顶点是人，边指示哪些人彼此认识。</p>
</li>
<li><p>网络图谱</p>
<p>顶点是网页，边缘表示指向其他页面的 HTML 链接。</p>
</li>
<li><p>公路或铁路网络</p>
<p>顶点是交叉路口，边线代表它们之间的道路或铁路线。</p>
</li>
</ul>
<p>可以将那些众所周知的算法运用到这些图上：例如，汽车导航系统搜索道路网络中两点之间的最短路径，PageRank 可以用在网络图上来确定网页的流行程度，从而确定该网页在搜索结果中的排名。</p>
<p>在刚刚给出的例子中，图中的所有顶点代表了相同类型的事物（人、网页或交叉路口）。不过，图并不局限于这样的同类数据：同样强大地是，图提供了一种一致的方式，用来在单个数据存储中存储完全不同类型的对象。例如，Facebook 维护一个包含许多不同类型的顶点和边的单个图：顶点表示人，地点，事件，签到和用户的评论；边缘表示哪些人是彼此的朋友，哪个签到发生在何处，谁评论了哪条消息，谁参与了哪个事件，等等。</p>
<h2 id="存储与检索"><a href="#存储与检索" class="headerlink" title="存储与检索"></a>存储与检索</h2><ul>
<li><p>数据模型和查询语言:</p>
<p>程序员将数据录入数据库的格式，以及再次要回数据的机制。</p>
</li>
<li><p>存储与检索:</p>
<p>数据库如何存储程序员提供的数据，以及如何在程序员需要时重新找到数据。</p>
</li>
</ul>
<h3 id="驱动数据库的数据结构"><a href="#驱动数据库的数据结构" class="headerlink" title="驱动数据库的数据结构"></a>驱动数据库的数据结构</h3><ul>
<li><p>bash: set与get</p>
</li>
<li><p><strong>日志（log）</strong> 这个词通常指应用日志：即应用程序输出的描述正在发生的事情的文本。本书在更普遍的意义下使用 <strong>日志</strong> 这一词：一个<strong>仅追加（append-only）</strong>的记录序列。它可能压根就不是给人类看的，它可以使用二进制格式，并仅能由其他程序读取。</p>
</li>
<li><p>为了高效查找数据库中特定键的值，我们需要一个数据结构：<strong>索引（index）</strong>。索引背后的大致思想是通过保存一些额外的元数据作为路标来帮助你找到想要的数据。如果你想以几种不同的方式搜索同一份数据，那么你也许需要在数据的不同部分上建立多个索引。</p>
</li>
<li><p>索引是从主数据衍生的 <strong>额外的（additional）</strong> 结构。许多数据库允许添加与删除索引，这不会影响数据的内容，而只会影响查询的性能。维护额外的结构会产生开销，特别是在写入时。写入性能很难超过简单地追加写入文件，因为追加写入是最简单的写入操作。任何类型的索引通常都会减慢写入速度，因为每次写入数据时都需要更新索引。</p>
</li>
</ul>
<h4 id="散列索引"><a href="#散列索引" class="headerlink" title="散列索引"></a>散列索引</h4><ol>
<li><p><strong>键值数据（key-value Data）</strong> 的索引。</p>
</li>
<li><p>键值存储与在大多数编程语言中可以找到的 <strong>字典（dictionary）</strong> 类型非常相似，通常字典都是用 <strong>散列映射（hash map）</strong> 或 <strong>散列表（hash table）</strong> 实现的。既然我们已经可以用散列映射来表示 <strong>内存中</strong> 的数据结构，为什么不使用它来索引 <strong>硬盘上</strong> 的数据呢？</p>
</li>
<li><p>假设我们的数据存储只是一个追加写入的文件，就像前面的例子一样，那么最简单的索引策略就是：保留一个内存中的散列映射，其中每个键都映射到数据文件中的一个字节偏移量，指明了可以找到对应值的位置。当你将新的键值对追加写入文件中时，还要更新散列映射，以反映刚刚写入的数据的偏移量（这同时适用于插入新键与更新现有键）。当你想查找一个值时，使用散列映射来查找数据文件中的偏移量，<strong>寻找（seek）</strong> 该位置并读取该值即可。</p>
</li>
<li><p>现实中，Bitcask 实际上就是这么做的（Riak 中默认的存储引擎）</p>
<p>像 Bitcask 这样的存储引擎非常适合每个键的值经常更新的情况。例如，键可能是某个猫咪视频的网址（URL），而值可能是该视频被播放的次数（每次有人点击播放按钮时递增）。在这种类型的工作负载中，有很多写操作，但是没有太多不同的键 —— 每个键有很多的写操作，但是将所有键保存在内存中是可行的。</p>
</li>
<li><p>直到现在，我们只是追加写入一个文件 —— 所以如何避免最终用完硬盘空间？一种好的解决方案是，将日志分为特定大小的段（segment），当日志增长到特定尺寸时关闭当前段文件，并开始写入一个新的段文件。然后，我们就可以对这些段进行 <strong>压缩（compaction）</strong>。这里的压缩意味着在日志中丢弃重复的键，只保留每个键的最近更新。</p>
</li>
<li><p>可以同时执行压缩和分段合并</p>
</li>
<li><p>每个段现在都有自己的内存散列表，将键映射到文件偏移量。为了找到一个键的值，我们首先检查最近的段的散列映射；如果键不存在，我们就检查第二个最近的段，依此类推。合并过程将保持段的数量足够小，所以查找过程不需要检查太多的散列映射。</p>
</li>
<li><p>值得考虑的问题：</p>
<ul>
<li><p>文件格式</p>
<p>CSV 不是日志的最佳格式。使用二进制格式更快，更简单：首先以字节为单位对字符串的长度进行编码，然后是原始的字符串（不需要转义）。</p>
</li>
<li><p>删除记录</p>
<p>如果要删除一个键及其关联的值，则必须在数据文件中追加一个特殊的删除记录（逻辑删除，有时被称为墓碑，即 tombstone）。当日志段被合并时，合并过程会通过这个墓碑知道要将被删除键的所有历史值都丢弃掉。</p>
</li>
<li><p>崩溃恢复</p>
<p>如果数据库重新启动，则内存散列映射将丢失。原则上，你可以通过从头到尾读取整个段文件并记录下来每个键的最近值来恢复每个段的散列映射。但是，如果段文件很大，可能需要很长时间，这会使服务的重启比较痛苦。 Bitcask 通过将每个段的散列映射的快照存储在硬盘上来加速恢复，可以使散列映射更快地加载到内存中。</p>
</li>
<li><p>部分写入记录</p>
<p>数据库随时可能崩溃，包括在将记录追加到日志的过程中。 Bitcask 文件包含校验和，允许检测和忽略日志中的这些损坏部分。</p>
</li>
<li><p>并发控制</p>
<p>由于写操作是以严格的顺序追加到日志中的，所以常见的实现是只有一个写入线程。也因为数据文件段是仅追加的或者说是不可变的，所以它们可以被多个线程同时读取。</p>
</li>
</ul>
</li>
<li><p>append-only的优势：</p>
<ul>
<li>追加和分段合并都是顺序写入操作，通常比随机写入快得多，尤其是在磁性机械硬盘上。在某种程度上，顺序写入在基于闪存的 <strong>固态硬盘（SSD）</strong> 上也是好的选择。</li>
<li>如果段文件是仅追加的或不可变的，并发和崩溃恢复就简单多了。例如，当一个数据值被更新的时候发生崩溃，你不用担心文件里将会同时包含旧值和新值各自的一部分。</li>
<li>合并旧段的处理也可以避免数据文件随着时间的推移而碎片化的问题。</li>
</ul>
</li>
<li><p>散列表索引也有其局限性：</p>
<ul>
<li>散列表必须能放进内存。如果你有非常多的键，那真是倒霉。原则上可以在硬盘上维护一个散列映射，不幸的是硬盘散列映射很难表现优秀。它需要大量的随机访问 I&#x2F;O，当它用满时想要再增长是很昂贵的，并且散列冲突的处理也需要很烦琐的逻辑。</li>
<li>范围查询效率不高。例如，你无法轻松扫描 kitty00000 和 kitty99999 之间的所有键 —— 你必须在散列映射中单独查找每个键。</li>
</ul>
</li>
</ol>
<h4 id="SSTable和LSM树"><a href="#SSTable和LSM树" class="headerlink" title="SSTable和LSM树"></a>SSTable和LSM树</h4><ol>
<li><p><strong>排序字符串表（Sorted String Table）</strong>，简称 SSTable</p>
<ul>
<li>对段文件的格式做一个简单的改变：要求键值对的序列按键排序</li>
<li>还要求每个键只在每个合并的段文件中出现一次（压缩过程已经保证）</li>
</ul>
</li>
<li><p>现在我们可以让我们的存储引擎以如下方式工作：</p>
<ul>
<li>有新写入时，将其添加到内存中的平衡树数据结构（例如红黑树）。这个内存树有时被称为 <strong>内存表（memtable）</strong>。</li>
<li>当 <strong>内存表</strong> 大于某个阈值（通常为几兆字节）时，将其作为 SSTable 文件写入硬盘。这可以高效地完成，因为树已经维护了按键排序的键值对。新的 SSTable 文件将成为数据库中最新的段。当该 SSTable 被写入硬盘时，新的写入可以在一个新的内存表实例上继续进行。</li>
<li>收到读取请求时，首先尝试在内存表中找到对应的键，如果没有就在最近的硬盘段中寻找，如果还没有就在下一个较旧的段中继续寻找，以此类推。</li>
<li>时不时地，在后台运行一个合并和压缩过程，以合并段文件并将已覆盖或已删除的值丢弃掉。</li>
</ul>
</li>
<li><p>用SSTables制作LSM树（日志结构合并树）</p>
<p>LSM 树的基本思想 —— 保存一系列在后台合并的 SSTables —— 简单而有效。即使数据集比可用内存大得多，它仍能继续正常工作。由于数据按排序顺序存储，你可以高效地执行范围查询（扫描所有从某个最小值到某个最大值之间的所有键），并且因为硬盘写入是连续的，所以 LSM 树可以支持非常高的写入吞吐量。</p>
</li>
</ol>
<h4 id="B树"><a href="#B树" class="headerlink" title="B树"></a>B树</h4><ol>
<li><p>像 SSTables 一样，B 树保持按键排序的键值对，这允许高效的键值查找和范围查询。但这也就是所有的相似之处了：B 树有着非常不同的设计理念。</p>
</li>
<li><p>日志结构索引将数据库分解为可变大小的段，通常是几兆字节或更大的大小，并且总是按顺序写入段。相比之下，B 树将数据库分解成固定大小的块（block）或页面（page），传统上大小为 4KB（有时会更大），并且一次只能读取或写入一个页面。这种设计更接近于底层硬件，因为硬盘空间也是按固定大小的块来组织的。</p>
</li>
<li><p>每个页面都可以使用地址或位置来标识，这允许一个页面引用另一个页面 —— 类似于指针，但在硬盘而不是在内存中。我们可以使用这些页面引用来构建一个<strong>页面树</strong></p>
<p>一个页面会被指定为 B 树的根；在索引中查找一个键时，就从这里开始。该页面包含几个键和对子页面的引用。每个子页面负责一段连续范围的键，引用之间的键，指明了引用子页面的键范围。</p>
</li>
<li><p>在 B 树的一个页面中对子页面的引用的数量称为分支因子。在实践中，分支因子取决于存储页面引用和范围边界所需的空间量，但通常是几百个。</p>
</li>
<li><p>如果要更新 B 树中现有键的值，需要搜索包含该键的叶子页面，更改该页面中的值，并将该页面写回到硬盘（对该页面的任何引用都将保持有效）。如果你想添加一个新的键，你需要找到其范围能包含新键的页面，并将其添加到该页面。如果页面中没有足够的可用空间容纳新键，则将其分成两个半满页面，并更新父页面以反映新的键范围分区</p>
</li>
<li><p>这个算法可以确保树保持平衡：具有 n 个键的 B 树总是具有 O (log n)的深度。大多数数据库可以放入一个三到四层的 B 树，所以你不需要追踪多个页面引用来找到你正在查找的页面（分支因子为 500 的 4KB 页面的四层树可以存储多达 256TB 的数据）。</p>
</li>
<li><p>让B树更可靠:</p>
<ul>
<li>B 树的基本底层写操作是用新数据覆写硬盘上的页面，并假定覆写不改变页面的位置：即，当页面被覆写时，对该页面的所有引用保持完整。这与日志结构索引（如 LSM 树）形成鲜明对比，后者只追加到文件（并最终删除过时的文件），但从不修改文件中已有的内容。</li>
<li>你可以把覆写硬盘上的页面对应为实际的硬件操作。在磁性硬盘驱动器上，这意味着将磁头移动到正确的位置，等待旋转盘上的正确位置出现，然后用新的数据覆写适当的扇区。在固态硬盘上，由于 SSD 必须一次擦除和重写相当大的存储芯片块，所以会发生更复杂的事情</li>
<li>注意，一些操作需要覆写几个不同的页面。例如，如果因为插入导致页面过满而拆分页面，则需要写入新拆分的两个页面，并覆写其父页面以更新对两个子页面的引用。这是一个危险的操作，因为如果数据库在仅有部分页面被写入时崩溃，那么最终将导致一个损坏的索引（例如，可能有一个孤儿页面不是任何父项的子项） 。</li>
<li>为了使数据库能处理异常崩溃的场景，B 树实现通常会带有一个额外的硬盘数据结构：<strong>预写式日志</strong>（WAL，即 write-ahead log，也称为 <strong>重做日志</strong>，即 redo log）。这是一个仅追加的文件，每个 B 树的修改在其能被应用到树本身的页面之前都必须先写入到该文件。当数据库在崩溃后恢复时，这个日志将被用来使 B 树恢复到一致的状态</li>
<li>另外还有一个更新页面的复杂情况是，如果多个线程要同时访问 B 树，则需要仔细的并发控制 —— 否则线程可能会看到树处于不一致的状态。这通常是通过使用 <strong>锁存器</strong>（latches，轻量级锁）保护树的数据结构来完成。日志结构化的方法在这方面更简单，因为它们在后台进行所有的合并，而不会干扰新接收到的查询，并且能够时不时地将旧的段原子交换为新的段。</li>
</ul>
</li>
<li><p>B树的优化：</p>
<ul>
<li><p>一些数据库（如 LMDB）使用写时复制方案，而不是覆盖页面并维护 WAL 以支持崩溃恢复。修改的页面被写入到不同的位置，并且还在树中创建了父页面的新版本，以指向新的位置。这种方法对于并发控制也很有用</p>
</li>
<li><p>B+树</p>
<p>我们可以通过不存储整个键，而是缩短其大小，来节省页面空间。特别是在树内部的页面上，键只需要提供足够的信息来充当键范围之间的边界。在页面中包含更多的键允许树具有更高的分支因子，因此也就允许更少的层级 </p>
</li>
<li><p>额外的指针已被添加到树中。例如，每个叶子页面可以引用其左边和右边的兄弟页面，使得不用跳回父页面就能按顺序对键进行扫描。</p>
</li>
</ul>
</li>
</ol>
<ul>
<li><p><strong>比较LSM树和B树</strong></p>
<ol>
<li><p>根据经验，通常 LSM 树的写入速度更快，而 B 树的读取速度更快。 LSM 树上的读取通常比较慢，因为它们必须检查几种不同的数据结构和不同压缩（Compaction）层级的 SSTables。</p>
</li>
<li><p>LSM树的优点：</p>
<ul>
<li><p>B 树索引中的每块数据都必须至少写入两次：一次写入预先写入日志（WAL），一次写入树页面本身（如果有分页还需要再写入一次）。即使在该页面中只有几个字节发生了变化，也需要接受写入整个页面的开销。有些存储引擎甚至会覆写同一个页面两次，以免在电源故障的情况下导致页面部分更新</p>
</li>
<li><p>由于反复压缩和合并 SSTables，日志结构索引也会多次重写数据。这种影响 —— 在数据库的生命周期中每次写入数据库导致对硬盘的多次写入 —— 被称为 <strong>写放大（write amplification）</strong>。需要特别注意的是固态硬盘，固态硬盘的闪存寿命在覆写有限次数后就会耗尽。</p>
</li>
<li><p>LSM 树通常能够比 B 树支持更高的写入吞吐量，部分原因是它们有时具有较低的写放大（尽管这取决于存储引擎的配置和工作负载），部分是因为它们顺序地写入紧凑的 SSTable 文件而不是必须覆写树中的几个页面。这种差异在磁性硬盘驱动器上尤其重要，其顺序写入比随机写入要快得多。</p>
</li>
<li><p>LSM 树可以被压缩得更好，因此通常能比 B 树在硬盘上产生更小的文件。B 树存储引擎会由于碎片化（fragmentation）而留下一些未使用的硬盘空间：当页面被拆分或某行不能放入现有页面时，页面中的某些空间仍未被使用。由于 LSM 树不是面向页面的，并且会通过定期重写 SSTables 以去除碎片，所以它们具有较低的存储开销，特别是当使用分层压缩（leveled compaction）时。</p>
</li>
<li><p>在许多固态硬盘上，固件内部使用了日志结构化算法，以将随机写入转变为顺序写入底层存储芯片，因此存储引擎写入模式的影响不太明显。但是，<strong>较低的写入放大率</strong>和<strong>减少的碎片</strong>仍然对固态硬盘更有利：更紧凑地表示数据允许在可用的 I&#x2F;O 带宽内处理更多的读取和写入请求。</p>
</li>
</ul>
</li>
<li><p>LSM树的缺点:</p>
<ul>
<li><p>日志结构存储的缺点是压缩过程有时会干扰正在进行的读写操作。尽管存储引擎尝试增量地执行压缩以尽量不影响并发访问，但是硬盘资源有限，所以很容易发生某个请求需要等待硬盘先完成昂贵的压缩操作。对吞吐量和平均响应时间的影响通常很小，但是日志结构化存储引擎在更高百分位的响应时间有时会相当长，而 B 树的行为则相对更具有可预测性。</p>
</li>
<li><p>压缩的另一个问题出现在高写入吞吐量时：硬盘的有限写入带宽需要在初始写入（记录日志和刷新内存表到硬盘）和在后台运行的压缩线程之间共享。写入空数据库时，可以使用全硬盘带宽进行初始写入，但数据库越大，压缩所需的硬盘带宽就越多。</p>
</li>
<li><p>如果写入吞吐量很高，并且压缩没有仔细配置好，有可能导致压缩跟不上写入速率。在这种情况下，硬盘上未合并段的数量不断增加，直到硬盘空间用完，读取速度也会减慢，因为它们需要检查更多的段文件。通常情况下，即使压缩无法跟上，基于 SSTable 的存储引擎也不会限制传入写入的速率，所以你需要进行明确的监控来检测这种情况。</p>
</li>
<li><p>B 树的一个优点是每个键只存在于索引中的一个位置，而日志结构化的存储引擎可能在不同的段中有相同键的多个副本。这个方面使得 B 树在想要提供强大的事务语义的数据库中很有吸引力：在许多关系数据库中，事务隔离是通过在键范围上使用锁来实现的，在 B 树索引中，这些锁可以直接附加到树上。</p>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="事务处理还是分析"><a href="#事务处理还是分析" class="headerlink" title="事务处理还是分析"></a>事务处理还是分析</h3><p><strong>在线事务处理（OLTP, OnLine Transaction Processing）</strong></p>
<ul>
<li><p>博客文章的评论，游戏中的动作，地址簿中的联系人，处理商业交易</p>
</li>
<li><p>应用程序通常使用索引通过某个键查找少量记录。根据用户的输入插入或更新记录。</p>
</li>
</ul>
<p> <strong>在线分析处理（OLAP, OnLine Analytice Processing）</strong></p>
<ul>
<li><p>哪个牌子的婴儿食品最常与 X 品牌的尿布同时购买？一月份每个商店的总收入是多少？</p>
</li>
<li><p>通常，分析查询需要扫描大量记录，每个记录只读取几列，并计算汇总统计信息（如计数、总和或平均值），而不是将原始数据返回给用户。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">属性</th>
<th align="center">事务处理系统 OLTP</th>
<th align="center">分析系统 OLAP</th>
</tr>
</thead>
<tbody><tr>
<td align="center">主要读取模式</td>
<td align="center">查询少量记录，按键读取</td>
<td align="center">在大批量记录上聚合</td>
</tr>
<tr>
<td align="center">主要写入模式</td>
<td align="center">随机访问，写入要求低延时</td>
<td align="center">批量导入（ETL）或者事件流</td>
</tr>
<tr>
<td align="center">主要用户</td>
<td align="center">终端用户，通过 Web 应用</td>
<td align="center">内部数据分析师，用于决策支持</td>
</tr>
<tr>
<td align="center">处理的数据</td>
<td align="center">数据的最新状态（当前时间点）</td>
<td align="center">随时间推移的历史事件</td>
</tr>
<tr>
<td align="center">数据集尺寸</td>
<td align="center">GB ~ TB</td>
<td align="center">TB ~ PB</td>
</tr>
</tbody></table>
<h4 id="数据仓库"><a href="#数据仓库" class="headerlink" title="数据仓库"></a>数据仓库</h4><ol>
<li><p>在二十世纪八十年代末和九十年代初期，企业有停止使用 OLTP 系统进行分析的趋势，转而在单独的数据库上运行分析。这个单独的数据库被称为 <strong>数据仓库（data warehouse）</strong>。</p>
</li>
<li><p>将数据存入仓库的过程称为 “<strong>抽取 - 转换 - 加载（ETL）</strong>”</p>
<p>extract, transform, load</p>
</li>
<li><p>事实表</p>
</li>
<li><p>维度表</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/05/11/%E5%B2%9B%E5%B1%BF%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/11/%E5%B2%9B%E5%B1%BF%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">岛屿问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-12 12:01:10" itemprop="dateCreated datePublished" datetime="2022-05-12T12:01:10+08:00">2022-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-15 13:56:35" itemprop="dateModified" datetime="2022-11-15T13:56:35+08:00">2022-11-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="岛屿问题选编"><a href="#岛屿问题选编" class="headerlink" title="岛屿问题选编"></a>岛屿问题选编</h1><h2 id="1254-Number-of-Closed-Islands"><a href="#1254-Number-of-Closed-Islands" class="headerlink" title="1254. Number of Closed Islands"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/number-of-closed-islands/">1254. Number of Closed Islands</a></h2><p>在LeetCode200基础上，把靠边岛屿排除即可，即先把靠边的岛屿全部淹没</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode1254</span> &#123;</span><br><span class="line">    <span class="type">int</span> row;</span><br><span class="line">    <span class="type">int</span> col;</span><br><span class="line">    <span class="type">int</span>[][] grid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">closedIsland</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.row=grid.length;</span><br><span class="line">        <span class="built_in">this</span>.col=grid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="built_in">this</span>.grid=grid;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            dfs(i,<span class="number">0</span>);</span><br><span class="line">            dfs(i,col-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            dfs(<span class="number">0</span>,j);</span><br><span class="line">            dfs(row-<span class="number">1</span>,j);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;=row-<span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j&lt;=col-<span class="number">1</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(grid[i][j]==<span class="number">0</span>)&#123;</span><br><span class="line">                    count++;</span><br><span class="line">                    dfs(i,j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;<span class="number">0</span> || i&gt;=row || j&lt;<span class="number">0</span> || j&gt;=col || grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        grid[i][j]=<span class="number">1</span>;</span><br><span class="line">        dfs(i+<span class="number">1</span>,j);</span><br><span class="line">        dfs(i-<span class="number">1</span>,j);</span><br><span class="line">        dfs(i,j+<span class="number">1</span>);</span><br><span class="line">        dfs(i,j-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1020-Number-of-Enclaves"><a href="#1020-Number-of-Enclaves" class="headerlink" title="1020. Number of Enclaves"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/number-of-enclaves/">1020. Number of Enclaves</a></h2><p>把靠边岛屿淹没后，对不靠边的岛屿无需再dfs，直接count即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode1020</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> row;</span><br><span class="line">    <span class="type">int</span> col;</span><br><span class="line">    <span class="type">int</span>[][] grid;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numEnclaves</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.row=grid.length;</span><br><span class="line">        <span class="built_in">this</span>.col=grid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="built_in">this</span>.grid=grid;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            dfs(i,<span class="number">0</span>);</span><br><span class="line">            dfs(i,col-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            dfs(<span class="number">0</span>,j);</span><br><span class="line">            dfs(row-<span class="number">1</span>,j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;<span class="number">0</span> || i&gt;=row || j&lt;<span class="number">0</span> || j&gt;=col || grid[i][j]==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        grid[i][j]=<span class="number">0</span>;</span><br><span class="line">        dfs(i-<span class="number">1</span>,j);</span><br><span class="line">        dfs(i+<span class="number">1</span>,j);</span><br><span class="line">        dfs(i,j-<span class="number">1</span>);</span><br><span class="line">        dfs(i,j+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="695-Max-Area-of-Island"><a href="#695-Max-Area-of-Island" class="headerlink" title="695. Max Area of Island"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/max-area-of-island/">695. Max Area of Island</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode695</span> &#123;</span><br><span class="line">    <span class="type">int</span> row;</span><br><span class="line">    <span class="type">int</span> col;</span><br><span class="line">    <span class="type">int</span>[][] grid;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxAreaOfIsland</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.row=grid.length;</span><br><span class="line">        <span class="built_in">this</span>.col=grid[<span class="number">0</span>].length;</span><br><span class="line">        <span class="built_in">this</span>.grid=grid;</span><br><span class="line">        <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="type">int</span> count=dfs(i,j);</span><br><span class="line">                    max=Math.max(count,max);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max==Integer.MIN_VALUE ? <span class="number">0</span> : max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;<span class="number">0</span> || i&gt;=row || j&lt;<span class="number">0</span> || j&gt;=col || grid[i][j]==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        grid[i][j]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>+dfs(i-<span class="number">1</span>,j)+dfs(i+<span class="number">1</span>,j)+dfs(i,j-<span class="number">1</span>)+dfs(i,j+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1905-Count-Sub-Islands"><a href="#1905-Count-Sub-Islands" class="headerlink" title="1905. Count Sub Islands"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/count-sub-islands/">1905. Count Sub Islands</a></h2><p>先flood不可能为sub island的岛屿</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode1905</span> &#123;</span><br><span class="line">    <span class="type">int</span> row;</span><br><span class="line">    <span class="type">int</span> col;</span><br><span class="line">    <span class="type">int</span>[][] grid2;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countSubIslands</span><span class="params">(<span class="type">int</span>[][] grid1, <span class="type">int</span>[][] grid2)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.row=grid2.length;</span><br><span class="line">        <span class="built_in">this</span>.col=grid2[<span class="number">0</span>].length;</span><br><span class="line">        <span class="built_in">this</span>.grid2=grid2;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(grid2[i][j]==<span class="number">1</span> &amp;&amp; grid1[i][j]==<span class="number">0</span>)&#123;</span><br><span class="line">                    dfs(i,j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(grid2[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                    count++;</span><br><span class="line">                    dfs(i,j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;<span class="number">0</span> || i&gt;=row || j&lt;<span class="number">0</span> || j&gt;=col || grid2[i][j]==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        grid2[i][j]=<span class="number">0</span>;</span><br><span class="line">        dfs(i-<span class="number">1</span>,j);</span><br><span class="line">        dfs(i+<span class="number">1</span>,j);</span><br><span class="line">        dfs(i,j-<span class="number">1</span>);</span><br><span class="line">        dfs(i,j+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="694-Number-of-Distinct-Islands"><a href="#694-Number-of-Distinct-Islands" class="headerlink" title="694. Number of Distinct Islands"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/number-of-distinct-islands/">694. Number of Distinct Islands</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> StringBuffer path;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[][] grid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numDistinctIslands</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.grid = grid;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> grid.length, n = grid[<span class="number">0</span>].length;</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; m; i ++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j ++)&#123;</span><br><span class="line">                <span class="comment">// 从当前点开始dfs遍历完所有相连的1的路径（1234分别表示上下左右）</span></span><br><span class="line">                <span class="keyword">if</span>(grid[i][j] == <span class="number">1</span>)&#123;</span><br><span class="line">                    path = <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">                    dfs(i, j, <span class="number">0</span>);</span><br><span class="line">                    set.add(path.toString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> set.size();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> curr)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i &lt; <span class="number">0</span> || j &lt; <span class="number">0</span> || i &gt;= grid.length || j &gt;= grid[<span class="number">0</span>].length || grid[i][j] == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        grid[i][j] = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// 记录走到当前点的方式：0初始1234分别表示上下左右</span></span><br><span class="line">        path.append(curr);</span><br><span class="line">        dfs(i - <span class="number">1</span>, j, <span class="number">1</span>);</span><br><span class="line">        dfs(i + <span class="number">1</span>, j, <span class="number">2</span>);</span><br><span class="line">        dfs(i, j - <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">        dfs(i, j + <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 每个子递归结束后(跳至上层递归前)添加相应分隔符</span></span><br><span class="line">        path.append(<span class="string">&#x27;|&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="463-Island-Perimeter"><a href="#463-Island-Perimeter" class="headerlink" title="463. Island Perimeter"></a>463. Island Perimeter</h2><p>判断四条边是否是边界</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">islandPerimeter</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> row=grid.length;</span><br><span class="line">    <span class="type">int</span> col=grid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="type">int</span> up;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                    up=<span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    up=grid[i-<span class="number">1</span>][j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> down;</span><br><span class="line">                <span class="keyword">if</span>(i==row-<span class="number">1</span>)&#123;</span><br><span class="line">                    down=<span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    down=grid[i+<span class="number">1</span>][j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> left;</span><br><span class="line">                <span class="keyword">if</span>(j==<span class="number">0</span>)&#123;</span><br><span class="line">                    left=<span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    left=grid[i][j-<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">int</span> right;</span><br><span class="line">                <span class="keyword">if</span>(j==col-<span class="number">1</span>)&#123;</span><br><span class="line">                    right=<span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    right=grid[i][j+<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">                res+=<span class="number">4</span>-(up+down+left+right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="419-Battleships-in-a-Board"><a href="#419-Battleships-in-a-Board" class="headerlink" title="419. Battleships in a Board"></a>419. Battleships in a Board</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countBattleships</span><span class="params">(<span class="type">char</span>[][] board)</span> &#123;</span><br><span class="line">    <span class="type">int</span> row=board.length;</span><br><span class="line">    <span class="type">int</span> col=board[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            <span class="comment">//only the most top-left X counts</span></span><br><span class="line">            <span class="keyword">if</span>(board[i][j]==<span class="string">&#x27;X&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i&gt;<span class="number">0</span> &amp;&amp; board[i-<span class="number">1</span>][j]==<span class="string">&#x27;X&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(j&gt;<span class="number">0</span> &amp;&amp; board[i][j-<span class="number">1</span>]==<span class="string">&#x27;X&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                res++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/05/11/%E6%9D%82%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/11/%E6%9D%82%E9%A2%98/" class="post-title-link" itemprop="url">杂题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-12 11:51:46" itemprop="dateCreated datePublished" datetime="2022-05-12T11:51:46+08:00">2022-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-06-06 19:48:30" itemprop="dateModified" datetime="2022-06-06T19:48:30+08:00">2022-06-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="杂题小记"><a href="#杂题小记" class="headerlink" title="杂题小记"></a>杂题小记</h1><h2 id="剑指-Offer-57-II-和为s的连续正数序列"><a href="#剑指-Offer-57-II-和为s的连续正数序列" class="headerlink" title="剑指 Offer 57 - II. 和为s的连续正数序列"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/he-wei-sde-lian-xu-zheng-shu-xu-lie-lcof/">剑指 Offer 57 - II. 和为s的连续正数序列</a></h2><p>题目要求返回一个二维数组，且每行元素个数不定</p>
<p>无法由List&lt;List<Integer>&gt;转变</p>
<p>可以由List&lt;int[]&gt;转变：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] findContinuousSequence(<span class="type">int</span> target) &#123;</span><br><span class="line">        List&lt;<span class="type">int</span>[]&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=target/<span class="number">2</span>; i++)&#123;</span><br><span class="line">            backtracking(res,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),target,i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.toArray(<span class="keyword">new</span> <span class="title class_">int</span>[res.size()][]); <span class="comment">//List&lt;int[]&gt; 转变为int[][]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;<span class="type">int</span>[]&gt; res, List&lt;Integer&gt; list, <span class="type">int</span> target, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(target&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="comment">//List&lt;Integer&gt;转变为int[]，无法直接toArray</span></span><br><span class="line">                <span class="type">int</span>[] arr=<span class="keyword">new</span> <span class="title class_">int</span>[list.size()];</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;arr.length; i++)&#123;</span><br><span class="line">                    arr[i]=list.get(i);</span><br><span class="line">                &#125;</span><br><span class="line">                res.add(arr);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(start);</span><br><span class="line">        backtracking(res,list,target-start,start+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="49-Group-Anagrams"><a href="#49-Group-Anagrams" class="headerlink" title="49. Group Anagrams"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/group-anagrams/">49. Group Anagrams</a></h2><h3 id="法一：排序"><a href="#法一：排序" class="headerlink" title="法一：排序"></a>法一：排序</h3><p>注意注意注意：</p>
<ul>
<li>new String（）一般使用字符转码的时候,byte[]数组的时候</li>
<li>toString（）将对象打印的时候使用</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode49</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">groupAnagrams</span><span class="params">(String[] strs)</span> &#123;</span><br><span class="line">        Map&lt;String,List&lt;String&gt;&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String str : strs) &#123;</span><br><span class="line">            <span class="type">char</span>[] chars = str.toCharArray();</span><br><span class="line">            Arrays.sort(chars);</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(chars);	<span class="comment">//这样可以</span></span><br><span class="line">            <span class="keyword">if</span>(!map.containsKey(s))&#123;</span><br><span class="line">                map.put(s,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">            &#125;</span><br><span class="line">            map.get(s).add(str);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>(map.values());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">groupAnagrams</span><span class="params">(String[] strs)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.stream(strs)</span><br><span class="line">            .collect(Collectors.groupingBy(str -&gt; &#123;</span><br><span class="line">                <span class="comment">// 返回 str 排序后的结果。</span></span><br><span class="line">                <span class="comment">// 按排序后的结果来grouping by，算子类似于 sql 里的 group by。</span></span><br><span class="line">                <span class="type">char</span>[] array = str.toCharArray();</span><br><span class="line">                Arrays.sort(array);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(array);</span><br><span class="line">            &#125;)).values());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="法二：计数"><a href="#法二：计数" class="headerlink" title="法二：计数"></a>法二：计数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">groupAnagrams</span><span class="params">(String[] strs)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.stream(strs)</span><br><span class="line">            .collect(Collectors.groupingBy(str -&gt; &#123;</span><br><span class="line">                <span class="type">int</span>[] counter = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">                    counter[str.charAt(i) - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;</span><br><span class="line">                    <span class="comment">// 这里的 if 是可省略的，但是加上 if 以后，生成的 sb 更短，后续 groupingBy 会更快。</span></span><br><span class="line">                    <span class="keyword">if</span> (counter[i] != <span class="number">0</span>) &#123;</span><br><span class="line">                        sb.append((<span class="type">char</span>) (<span class="string">&#x27;a&#x27;</span> + i));</span><br><span class="line">                        sb.append(counter[i]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> sb.toString();</span><br><span class="line">            &#125;)).values());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="71-Simplify-Path"><a href="#71-Simplify-Path" class="headerlink" title="71. Simplify Path"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/simplify-path/">71. Simplify Path</a></h2><p>注意：</p>
<ul>
<li><code>/</code>代表当前路径</li>
<li><code>//</code>代表根路径</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode71</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">simplifyPath</span><span class="params">(String path)</span> &#123;</span><br><span class="line">        String[] split = path.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        LinkedList&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String s : split) &#123;</span><br><span class="line">            <span class="keyword">if</span>(s.length()==<span class="number">0</span> || s.equals(<span class="string">&quot;.&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(s.equals(<span class="string">&quot;..&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">if</span>(!list.isEmpty())&#123;</span><br><span class="line">                    list.removeLast();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                list.add(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> size=list.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            sb.append(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">            sb.append(list.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">        String s=sb.toString();</span><br><span class="line">        <span class="keyword">return</span> s.length()==<span class="number">0</span> ? <span class="string">&quot;/&quot;</span> : s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>














      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/05/11/%E5%8C%BA%E9%97%B4%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/11/%E5%8C%BA%E9%97%B4%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">区间问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-11 16:18:48" itemprop="dateCreated datePublished" datetime="2022-05-11T16:18:48+08:00">2022-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-12 10:50:07" itemprop="dateModified" datetime="2022-05-12T10:50:07+08:00">2022-05-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="区间问题选编"><a href="#区间问题选编" class="headerlink" title="区间问题选编"></a>区间问题选编</h1><h2 id="maximum-number-of-non-overlapping-intervals"><a href="#maximum-number-of-non-overlapping-intervals" class="headerlink" title="maximum number of non-overlapping intervals:"></a>maximum number of non-overlapping intervals:</h2><ol>
<li>按interval的end升序排序 </li>
<li>选中集合中end最小的interval</li>
<li>删去所有与该interval重叠的interval(s)</li>
<li>重复2、3, 直到集合为空</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">eraseOverlapIntervals</span><span class="params">(<span class="type">int</span>[][] intervals)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n=intervals.length;</span><br><span class="line">        Arrays.sort(intervals, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1, <span class="type">int</span>[] o2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> o1[<span class="number">1</span>]-o2[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">int</span> count=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> end=intervals[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] interval : intervals) &#123;</span><br><span class="line">            <span class="type">int</span> start=interval[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span>(start&gt;=end)&#123;</span><br><span class="line">                count++;</span><br><span class="line">                end=interval[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n-count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1288-Remove-Covered-Intervals"><a href="#1288-Remove-Covered-Intervals" class="headerlink" title="1288. Remove Covered Intervals"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/remove-covered-intervals/">1288. Remove Covered Intervals</a></h2><p>start升序、end降序</p>
<p>对于两个起点相同的区间，需要保证长的那个区间在上面（按照终点降序），这样才会被判定为覆盖，否则会被错误地判定为相交，少算一个覆盖区间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode1288</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeCoveredIntervals</span><span class="params">(<span class="type">int</span>[][] intervals)</span> &#123;</span><br><span class="line">        Arrays.sort(intervals, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1, <span class="type">int</span>[] o2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> o1[<span class="number">0</span>]!=o2[<span class="number">0</span>] ? o1[<span class="number">0</span>]-o2[<span class="number">0</span>] : o2[<span class="number">1</span>]-o1[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">int</span> start=intervals[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> end=intervals[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> count=-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> n=intervals.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] interval : intervals) &#123;</span><br><span class="line">            <span class="type">int</span> left=interval[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> right=interval[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(right&lt;=end)&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(left&lt;end)&#123;</span><br><span class="line">                end=right;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                start=left;</span><br><span class="line">                end=right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n-count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="56-Merge-Intervals"><a href="#56-Merge-Intervals" class="headerlink" title="56. Merge Intervals"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/merge-intervals/">56. Merge Intervals</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode56</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] merge(<span class="type">int</span>[][] intervals) &#123;</span><br><span class="line">        Arrays.sort(intervals, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1, <span class="type">int</span>[] o2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> o1[<span class="number">0</span>]!=o2[<span class="number">0</span>] ? o1[<span class="number">0</span>]-o2[<span class="number">0</span>] : o2[<span class="number">1</span>]-o1[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        List&lt;<span class="type">int</span>[]&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> start=intervals[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> end=intervals[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; intervals.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> left=intervals[i][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> right=intervals[i][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(right&lt;=end)&#123;<span class="comment">//contains</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(left&lt;=end)&#123;<span class="comment">//overlap</span></span><br><span class="line">                end=right;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">//non-overlapping</span></span><br><span class="line">                res.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;start,end&#125;);</span><br><span class="line">                start=left;</span><br><span class="line">                end=right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;start,end&#125;);</span><br><span class="line">        <span class="type">int</span>[][] array=<span class="keyword">new</span> <span class="title class_">int</span>[res.size()][<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">            array[i][<span class="number">0</span>]=res.get(i)[<span class="number">0</span>];</span><br><span class="line">            array[i][<span class="number">1</span>]=res.get(i)[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="986-Interval-List-Intersections"><a href="#986-Interval-List-Intersections" class="headerlink" title="986. Interval List Intersections"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/interval-list-intersections/">986. Interval List Intersections</a></h2><p>两个区间集合已升序</p>
<p>找交集：双指针i , j </p>
<ul>
<li>a1, a2, b1, b2</li>
<li>无交集：</li>
<li>有交集：</li>
<li>无论有无交集，指针都要后移：</li>
<li>一旦某一集合遍历完毕，则退出</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode986</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] intervalIntersection(<span class="type">int</span>[][] firstList, <span class="type">int</span>[][] secondList) &#123;</span><br><span class="line">        <span class="type">int</span> n1=firstList.length;</span><br><span class="line">        <span class="type">int</span> n2=secondList.length;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        List&lt;<span class="type">int</span>[]&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(i&lt;n1 &amp;&amp; j&lt;n2)&#123;</span><br><span class="line">            <span class="type">int</span> a1=firstList[i][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> a2=firstList[i][<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> b1=secondList[j][<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> b2=secondList[j][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(b1&lt;=a2 &amp;&amp; a1&lt;=b2)&#123;</span><br><span class="line">                <span class="type">int</span> c1=Math.max(a1,b1);</span><br><span class="line">                <span class="type">int</span> c2=Math.min(a2,b2);</span><br><span class="line">                list.add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;c1,c2&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(a2&lt;b2)&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[][] res=<span class="keyword">new</span> <span class="title class_">int</span>[list.size()][<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; res.length; i++) &#123;</span><br><span class="line">            res[i][<span class="number">0</span>]=list.get(i)[<span class="number">0</span>];</span><br><span class="line">            res[i][<span class="number">1</span>]=list.get(i)[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/05/06/%E5%8F%8C%E6%8C%87%E9%92%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/05/06/%E5%8F%8C%E6%8C%87%E9%92%88/" class="post-title-link" itemprop="url">双指针</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-05-06 15:34:20" itemprop="dateCreated datePublished" datetime="2022-05-06T15:34:20+08:00">2022-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-07-29 16:21:34" itemprop="dateModified" datetime="2022-07-29T16:21:34+08:00">2022-07-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Two-Pointers选编"><a href="#Two-Pointers选编" class="headerlink" title="Two Pointers选编"></a>Two Pointers选编</h1><h2 id="接雨水问题"><a href="#接雨水问题" class="headerlink" title="接雨水问题"></a>接雨水问题</h2><h3 id="42-Trapping-Rain-Water"><a href="#42-Trapping-Rain-Water" class="headerlink" title="42. Trapping Rain Water"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/trapping-rain-water/">42. Trapping Rain Water</a></h3><p>对每根柱子，求它的左侧和右侧的greatest element，探讨是否能在这根柱子上蓄水</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="type">int</span> area=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n=height.length;</span><br><span class="line">        <span class="type">int</span>[] findLeft=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;n-<span class="number">1</span>; i++)&#123;</span><br><span class="line">            findLeft[i]=Math.max(findLeft[i-<span class="number">1</span>],height[i-<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] findRight=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=n-<span class="number">2</span>; i&gt;=<span class="number">1</span>; i--)&#123;</span><br><span class="line">            findRight[i]=Math.max(findRight[i+<span class="number">1</span>],height[i+<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;n-<span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> left=findLeft[i];</span><br><span class="line">            <span class="type">int</span> right=findRight[i];</span><br><span class="line">            <span class="type">int</span> h=Math.min(left,right);</span><br><span class="line">            <span class="keyword">if</span>(h&lt;=height[i])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            area+=h-height[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> area;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="11-Container-With-Most-Water"><a href="#11-Container-With-Most-Water" class="headerlink" title="11. Container With Most Water"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/container-with-most-water/">11. Container With Most Water</a></h3><p>由大缩小</p>
<p>双指针技巧：移动较低的一边，因为只有这样才可能使矩形面积增大：</p>
<ul>
<li>矩形面积由较短边和两边间距决定</li>
<li>移动指针，两边间距必定缩小</li>
<li>若移动较长边，则矩形面积必定缩小！无意义</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxArea</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line">        <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right= height.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(left&lt;right)&#123;</span><br><span class="line">            <span class="type">int</span> area=(right-left)*Math.min(height[left],height[right]);</span><br><span class="line">            max=Math.max(area,max);</span><br><span class="line">            <span class="keyword">if</span>(height[left]&lt;=height[right])&#123;<span class="comment">//移动较短边，使面积可能扩大</span></span><br><span class="line">                left++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="数组移除元素"><a href="#数组移除元素" class="headerlink" title="数组移除元素"></a>数组移除元素</h2><p>双指针，i 遍历数组，j 保留有效值</p>
<h3 id="26-Remove-Duplicates-from-Sorted-Array"><a href="#26-Remove-Duplicates-from-Sorted-Array" class="headerlink" title="26. Remove Duplicates from Sorted Array"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array/">26. Remove Duplicates from Sorted Array</a></h3><p>注意数组已排序，只需比较当前数组元素与最后一个有效项</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeDuplicates</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]!=nums[j])&#123;</span><br><span class="line">                nums[++j]=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> j+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="27-Remove-Element"><a href="#27-Remove-Element" class="headerlink" title="27. Remove Element"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/remove-element/">27. Remove Element</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeElement</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]!=val)&#123;</span><br><span class="line">                nums[j++]=nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> j;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="283-Move-Zeroes"><a href="#283-Move-Zeroes" class="headerlink" title="283. Move Zeroes"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/move-zeroes/">283. Move Zeroes</a></h3><p>注意要求：maintaining the relative order</p>
<p>直接左右双指针不满足</p>
<p>转换思路：</p>
<ol>
<li>i 初始化为第一个0, 用于和非零元素交换</li>
<li>j 从 i 开始遍历，每找到一个非零元素，就与 i 交换</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(j&lt;nums.length &amp;&amp; nums[j]!=<span class="number">0</span>)&#123;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=j+<span class="number">1</span>; i&lt;nums.length; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]!=<span class="number">0</span>)&#123;</span><br><span class="line">                nums[j]=nums[i];</span><br><span class="line">                nums[i]=<span class="number">0</span>;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="75-Sort-Colors"><a href="#75-Sort-Colors" class="headerlink" title="75. Sort Colors"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/sort-colors/">75. Sort Colors</a></h3><p>双指针，直到 <strong>i&gt;right</strong></p>
<ul>
<li>遇到0，换，i++</li>
<li>遇到2，换，<strong>循环</strong>，直到nums[i]!&#x3D;2</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode75</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sortColors</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right=nums.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= right; i++) &#123;	<span class="comment">//必须&lt;=，不能换成&lt;</span></span><br><span class="line">            <span class="keyword">while</span>(i&lt;=right &amp;&amp; nums[i]==<span class="number">2</span>)&#123;</span><br><span class="line">                swap(nums,i,right--);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(nums[i]==<span class="number">0</span>)&#123;</span><br><span class="line">                swap(nums,i,left++);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i==j)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> temp=nums[i];</span><br><span class="line">        nums[i]=nums[j];</span><br><span class="line">        nums[j]=temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><h3 id="844-Backspace-String-Compare"><a href="#844-Backspace-String-Compare" class="headerlink" title="844. Backspace String Compare"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/backspace-string-compare/">844. Backspace String Compare</a></h3><p>solve it in <code>O(n)</code> time and <code>O(1)</code> space ?</p>
<p>考虑 backspacing, 从后向前比较</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">backspaceCompare</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="type">int</span> i=s.length()-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> j=t.length()-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> b1=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> b2=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&gt;=<span class="number">0</span> || j&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">while</span>(i&gt;=<span class="number">0</span> &amp;&amp; (s.charAt(i)==<span class="string">&#x27;#&#x27;</span> || b1!=<span class="number">0</span>))&#123;</span><br><span class="line">                <span class="keyword">if</span>(s.charAt(i)==<span class="string">&#x27;#&#x27;</span>)&#123;</span><br><span class="line">                    b1++;</span><br><span class="line">                    i--;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(b1!=<span class="number">0</span>)&#123;</span><br><span class="line">                    b1--;</span><br><span class="line">                    i--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span>(j&gt;=<span class="number">0</span> &amp;&amp; (t.charAt(j)==<span class="string">&#x27;#&#x27;</span> || b2!=<span class="number">0</span>))&#123;</span><br><span class="line">                <span class="keyword">if</span>(t.charAt(j)==<span class="string">&#x27;#&#x27;</span>)&#123;</span><br><span class="line">                    b2++;</span><br><span class="line">                    j--;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(b2!=<span class="number">0</span>)&#123;</span><br><span class="line">                    b2--;</span><br><span class="line">                    j--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;<span class="number">0</span> || j&lt;<span class="number">0</span> || s.charAt(i)!=t.charAt(j))&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            i--;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i&gt;=<span class="number">0</span> || j&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/28/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/28/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/" class="post-title-link" itemprop="url">动态规划</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-28 17:11:20" itemprop="dateCreated datePublished" datetime="2022-04-28T17:11:20+08:00">2022-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-12 14:59:28" itemprop="dateModified" datetime="2022-05-12T14:59:28+08:00">2022-05-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>25k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>23 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Dynamic-Programming-选编"><a href="#Dynamic-Programming-选编" class="headerlink" title="Dynamic Programming 选编"></a>Dynamic Programming 选编</h1><p>算法的优化就是这么一个过程:</p>
<ol>
<li><p>先写出可读性很好的暴力递归算法  </p>
</li>
<li><p>然后尝试运用动态规划技巧优化重叠子问题</p>
</li>
<li><p>最后尝试用空间压缩技巧优化空间复杂度</p>
</li>
</ol>
<h2 id="代码随想录"><a href="#代码随想录" class="headerlink" title="代码随想录"></a>代码随想录</h2><h3 id="746-Min-Cost-Climbing-Stairs"><a href="#746-Min-Cost-Climbing-Stairs" class="headerlink" title="746. Min Cost Climbing Stairs"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/min-cost-climbing-stairs/">746. Min Cost Climbing Stairs</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode746</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCostClimbingStairs</span><span class="params">(<span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="comment">//dp[n]=min(dp[n-1]+cost[n-1],dp[n-2]+cost[n-2])</span></span><br><span class="line">        <span class="type">int</span> a=<span class="number">0</span>; <span class="comment">//dp[0]</span></span><br><span class="line">        <span class="type">int</span> b=<span class="number">0</span>; <span class="comment">//dp[1]</span></span><br><span class="line">        <span class="type">int</span> c=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= cost.length; i++) &#123;</span><br><span class="line">            c=Math.min(a+cost[i-<span class="number">2</span>],b+cost[i-<span class="number">1</span>]);</span><br><span class="line">            a=b;</span><br><span class="line">            b=c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="343-Integer-Break"><a href="#343-Integer-Break" class="headerlink" title="343. Integer Break"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/integer-break/">343. Integer Break</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode343</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">integerBreak</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">2</span>; j &lt; i; j++) &#123;</span><br><span class="line">                dp[i]=Math.max(dp[i],Math.max(dp[j]*(i-j),j*(i-j)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="96-Unique-Binary-Search-Trees"><a href="#96-Unique-Binary-Search-Trees" class="headerlink" title="96. Unique Binary Search Trees"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/unique-binary-search-trees/">96. Unique Binary Search Trees</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode96</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numTrees</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i-<span class="number">1</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">                dp[i]+=dp[j]*dp[i-<span class="number">1</span>-j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="01背包问题"><a href="#01背包问题" class="headerlink" title="01背包问题"></a>01背包问题</h3><p><a target="_blank" rel="noopener" href="https://programmercarl.com/%E8%83%8C%E5%8C%85%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%8001%E8%83%8C%E5%8C%85-1.html">https://programmercarl.com/%E8%83%8C%E5%8C%85%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%8001%E8%83%8C%E5%8C%85-1.html</a></p>
<p>先遍历物品还是先遍历背包容量？</p>
<h2 id="labuladong"><a href="#labuladong" class="headerlink" title="labuladong"></a>labuladong</h2><p><a target="_blank" rel="noopener" href="https://labuladong.github.io/algo/3/23/68/">https://labuladong.github.io/algo/3/23/68/</a></p>
<p>dp关键词：</p>
<ul>
<li>核心思想：穷举求最值</li>
<li>存在重叠子问题：引入备忘录或dp数组，避免不必要的计算</li>
<li>具备最优子结构：<ul>
<li><strong>要符合「最优子结构」，子问题间必须互相独立</strong></li>
</ul>
</li>
<li><strong>明确 base case -&gt; 明确「状态」-&gt; 明确「选择」 -&gt; 定义 dp 数组&#x2F;函数的含义</strong></li>
</ul>
<h3 id="322-Coin-Change"><a href="#322-Coin-Change" class="headerlink" title="322. Coin Change"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/coin-change/">322. Coin Change</a></h3><p>那么，既然知道了这是个动态规划问题，就要思考<strong>如何列出正确的状态转移方程</strong>？</p>
<p>1、<strong>确定 base case</strong>，这个很简单，显然目标金额 <code>amount</code> 为 0 时算法返回 0，因为不需要任何硬币就已经凑出目标金额了。</p>
<p>2、<strong>确定「状态」，也就是原问题和子问题中会变化的变量</strong>。由于硬币数量无限，硬币的面额也是题目给定的，只有目标金额会不断地向 base case 靠近，所以唯一的「状态」就是目标金额 <code>amount</code>。</p>
<p>3、<strong>确定「选择」，也就是导致「状态」产生变化的行为</strong>。目标金额为什么变化呢，因为你在选择硬币，你每选择一枚硬币，就相当于减少了目标金额。所以说所有硬币的面值，就是你的「选择」。</p>
<p>4、<strong>明确 <code>dp</code> 函数&#x2F;数组的定义</strong>。我们这里讲的是自顶向下的解法，所以会有一个递归的 <code>dp</code> 函数，一般来说函数的参数就是状态转移中会变化的量，也就是上面说到的「状态」；函数的返回值就是题目要求我们计算的量。就本题来说，状态只有一个，即「目标金额」，题目要求我们计算凑出目标金额所需的最少硬币数量。</p>
<p><strong>所以我们可以这样定义 <code>dp</code> 函数：<code>dp(n)</code> 表示，输入一个目标金额 <code>n</code>，返回凑出目标金额 <code>n</code> 所需的最少硬币数量</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode322</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">coinChange</span><span class="params">(<span class="type">int</span>[] coins, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="comment">//dp[n]表示amount=n时，所需最少coin数</span></span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[amount+<span class="number">1</span>]; <span class="comment">//0~amount</span></span><br><span class="line">        Arrays.fill(dp,amount+<span class="number">1</span>);</span><br><span class="line">        dp[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; dp.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> coin : coins) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i&lt;coin)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                dp[i]=Math.min(dp[i],dp[i-coin]+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[amount]==amount+<span class="number">1</span> ? -<span class="number">1</span> : dp[amount];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="300-Longest-Increasing-Subsequence"><a href="#300-Longest-Increasing-Subsequence" class="headerlink" title="300. Longest Increasing Subsequence"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/longest-increasing-subsequence/">300. Longest Increasing Subsequence</a></h3><h4 id="法一：brute-force-O-N-2"><a href="#法一：brute-force-O-N-2" class="headerlink" title="法一：brute force  O(N^2)"></a>法一：brute force  O(N^2)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="comment">//dp[i] 以i结尾的increasing subsequence的最大长度</span></span><br><span class="line">    <span class="comment">//dp[i]=max(dp[j])+1,if j&lt;i &amp;&amp; nums[i]&gt;nums[j]</span></span><br><span class="line">    <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> max=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        dp[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span> ; j &lt; i ; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[j]&lt;nums[i])&#123;</span><br><span class="line">                dp[i]=Math.max(dp[j]+<span class="number">1</span>,dp[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        max=Math.max(max,dp[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="法二：binary-serach-O-NlogN"><a href="#法二：binary-serach-O-NlogN" class="headerlink" title="法二：binary serach O(NlogN)"></a>法二：binary serach O(NlogN)</h4><p>patience sort</p>
<p>牌的堆数就是最长递增子序列的长度</p>
<p><a target="_blank" rel="noopener" href="https://labuladong.github.io/algo/3/23/69/">https://labuladong.github.io/algo/3/23/69/</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLIS</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="comment">//寻找左侧边界的二分搜索 [left,right)左闭右开区间搜索</span></span><br><span class="line">    <span class="type">int</span>[] top=<span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">    top[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">    <span class="type">int</span> pile=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right=pile;</span><br><span class="line">        <span class="keyword">while</span>(left&lt;right)&#123;<span class="comment">//[left,right)</span></span><br><span class="line">            <span class="type">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(top[mid]&gt;nums[i])&#123;</span><br><span class="line">                right=mid;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(top[mid]&lt;nums[i])&#123;</span><br><span class="line">                left=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;<span class="comment">//注意此处逻辑，midVal==target不停止，继续缩小右侧边界，直到left==right</span></span><br><span class="line">                right=mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//退出循环时,leftVal==target(查找)或left是第一个比target大的元素</span></span><br><span class="line">        top[left]=nums[i];</span><br><span class="line">        <span class="keyword">if</span>(left==pile)&#123;</span><br><span class="line">            pile++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pile;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="354-Russian-Doll-Envelopes"><a href="#354-Russian-Doll-Envelopes" class="headerlink" title="354. Russian Doll Envelopes"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/russian-doll-envelopes/">354. Russian Doll Envelopes</a></h3><p><strong>先对宽度 <code>w</code> 进行升序排序，如果遇到 <code>w</code> 相同的情况，则按照高度 <code>h</code> 降序排序；之后把所有的 <code>h</code> 作为一个数组，在这个数组上计算 LIS 的长度就是答案</strong>。</p>
<p>注意：暴力搜索会超时，必须二分搜索！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxEnvelopes</span><span class="params">(<span class="type">int</span>[][] envelopes)</span> &#123;</span><br><span class="line">    Arrays.sort(envelopes, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1, <span class="type">int</span>[] o2)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> o1[<span class="number">0</span>]!=o2[<span class="number">0</span>] ? o1[<span class="number">0</span>]-o2[<span class="number">0</span>] : o2[<span class="number">1</span>]-o1[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">int</span>[] top=<span class="keyword">new</span> <span class="title class_">int</span>[envelopes.length];</span><br><span class="line">    top[<span class="number">0</span>]=envelopes[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">    <span class="type">int</span> pile=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; envelopes.length; i++) &#123;</span><br><span class="line">        <span class="type">int</span> target=envelopes[i][<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right=pile;</span><br><span class="line">        <span class="keyword">while</span>(left&lt;right)&#123;</span><br><span class="line">            <span class="type">int</span> mid=left+(right-left)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(top[mid]&gt;target)&#123;</span><br><span class="line">                right=mid;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(top[mid]&lt;target)&#123;</span><br><span class="line">                left=mid+<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                right=mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        top[left]=target;</span><br><span class="line">        <span class="keyword">if</span>(left==pile)&#123;</span><br><span class="line">            pile++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pile;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="494-Target-Sum"><a href="#494-Target-Sum" class="headerlink" title="494. Target Sum"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/target-sum/">494. Target Sum</a></h3><h4 id="法一：backtracking"><a href="#法一：backtracking" class="headerlink" title="法一：backtracking"></a>法一：backtracking</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode494</span> &#123;</span><br><span class="line">    <span class="type">int</span> count;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findTargetSumWays</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">        backtracking(nums,target,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target, <span class="type">int</span> i)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i==nums.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(target==<span class="number">0</span>)&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        backtracking(nums,target-nums[i],i+<span class="number">1</span>); <span class="comment">//+i</span></span><br><span class="line">        backtracking(nums,target+nums[i],i+<span class="number">1</span>); <span class="comment">//-i</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注意：可以用memo优化</p>
<h4 id="法二：dp"><a href="#法二：dp" class="headerlink" title="法二：dp"></a>法二：dp</h4><p>动态规划之所以比暴力算法快，是因为动态规划技巧消除了重叠子问题。</p>
<p>其实，这个问题可以转化为一个子集划分问题，而子集划分问题又是一个典型的背包问题。</p>
<p>首先，如果我们把 <code>nums</code> 划分成两个子集 <code>A</code> 和 <code>B</code>，分别代表分配 <code>+</code> 的数和分配 <code>-</code> 的数，那么他们和 <code>target</code> 存在如下关系：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sum(A) - sum(B) = target</span><br><span class="line">sum(A) = target + sum(B)</span><br><span class="line">sum(A) + sum(A) = target + sum(B) + sum(A)</span><br><span class="line">2 * sum(A) = target + sum(nums)</span><br></pre></td></tr></table></figure>

<p>综上，可以推出 <code>sum(A) = (target + sum(nums)) / 2</code>，也就是把原问题转化成：**<code>nums</code> 中存在几个子集 <code>A</code>，使得 <code>A</code> 中元素的和为 <code>(target + sum(nums)) / 2</code>**？</p>
<p>注意base case与416的不同！</p>
<ul>
<li><p>只问存不存在子集（划分）时:</p>
<ul>
<li><p>dp[i] [0] &#x3D; true, 用任意物品都能塞满0空间 </p>
</li>
<li><p>j&gt;0时，dp[0] [j] &#x3D;false，用0个物品塞满大于0的空间，不可能</p>
</li>
<li><p>至此 i&#x3D;0 和 j&#x3D;0 时都讨论完毕，i 和 j 都从 1 开始 dp</p>
</li>
</ul>
</li>
<li><p>问存在多少个子集（划分）时：</p>
<ul>
<li><p>j&#x3D;0 时 , 虽然用任意物品都能塞满0空间， 但不能确定总共有多少种可能， 除非同时 i&#x3D;0</p>
<ul>
<li>dp[0] [0] &#x3D; 1, 用0个物品可以塞满0空间，有1种可能</li>
</ul>
</li>
<li><p>j&gt;0时，dp[0] [j] &#x3D;0，用0个物品塞满大于0的空间，有0种可能</p>
</li>
<li><p>至此，i&#x3D;0 时讨论完毕，但 j&#x3D;0 时未讨论完毕，i 从 1 开始，j 从 0 开始 dp</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findTargetSumWays</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="comment">//sumA-sumB=target</span></span><br><span class="line">    <span class="comment">//sumA=target+sumB</span></span><br><span class="line">    <span class="comment">//sumA+sumA=target+sumB+sumA</span></span><br><span class="line">    <span class="comment">//sumA=(target+sum)/2</span></span><br><span class="line">    <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        sum+=num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(sum&lt;Math.abs(target) ||  ((target+sum)&amp;<span class="number">1</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> subsetSum(nums,(target+sum)/<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">subsetSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> sum)</span>&#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>][sum+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>; <span class="comment">//base case: 没有物品可选，有一种情况能塞满0空间</span></span><br><span class="line">    <span class="comment">//base case: j&gt;0时,dp[0][j]=0，因为没有物品可选，有0种情况能塞满j空间</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123; <span class="comment">//由于i=0时已讨论完毕，可以从i=1开始</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= sum; j++) &#123; <span class="comment">//j=0时并未讨论，j从0开始</span></span><br><span class="line">            <span class="keyword">if</span>(j-nums[i-<span class="number">1</span>]&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j]+dp[i-<span class="number">1</span>][j-nums[i-<span class="number">1</span>]];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                dp[i][j]=dp[i-<span class="number">1</span>][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[n][sum];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="72-Edit-Distance"><a href="#72-Edit-Distance" class="headerlink" title="72. Edit Distance"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/edit-distance/">72. Edit Distance</a></h3><ul>
<li><em>minimum number of operations</em> </li>
<li><em>convert <code>word1</code> to <code>word2</code></em></li>
</ul>
<p><strong>解决两个字符串的动态规划问题，一般都是用两个指针 <code>i, j</code> 分别指向两个字符串的最后，然后一步步往前移动，缩小问题的规模</strong>。</p>
<ul>
<li>若字符相等，则skip</li>
<li>若字符不等，则三选一：<ul>
<li>insert </li>
<li>delete</li>
<li>replace</li>
</ul>
</li>
</ul>
<p><strong>递归解法是自顶向下求解，DP table 是自底向上求解</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode72</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDistance</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> s1=word1.length();</span><br><span class="line">        <span class="type">int</span> s2=word2.length();</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[s1+<span class="number">1</span>][s2+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= s2; i++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][i]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= s1; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= s1; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= s2; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(word1.charAt(i-<span class="number">1</span>)==word2.charAt(j-<span class="number">1</span>))&#123;</span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j]=Math.min(Math.min(dp[i-<span class="number">1</span>][j]+<span class="number">1</span>,dp[i][j-<span class="number">1</span>]+<span class="number">1</span>),dp[i-<span class="number">1</span>][j-<span class="number">1</span>]+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[s1][s2];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="174-Dungeon-Game"><a href="#174-Dungeon-Game" class="headerlink" title="174. Dungeon Game"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/dungeon-game/">174. Dungeon Game</a></h3><p> <em>minimum initial health</em></p>
<p>这道题的dp是倒序的，这点很重要，为什么不能像【最小路径和】一样是正序的？因为【最小路径和】是无状态的，你会发现【最小路径和】倒序dp也是可以的，这道题由于有“加血”的过程，只能依赖后面的值判断需要的血量。所以这里的dp [i] [j]表达的意思是：“从（i，j）出发，到达终点需要最少的血量”。因此，正序的含义为“从起点出发，到达位置（i，j）所需要的最少血量”；倒序的含义是“从（i，j）出发，到达终点需要最少的血量”。初始血量本来就是要求的，所以只能倒序dp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode174</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">calculateMinimumHP</span><span class="params">(<span class="type">int</span>[][] dungeon)</span> &#123;</span><br><span class="line">        <span class="type">int</span> row=dungeon.length;</span><br><span class="line">        <span class="type">int</span> col=dungeon[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[row][col];</span><br><span class="line">        <span class="comment">//dp[i][j]表示从i,j出发到达终点所需的最少血量</span></span><br><span class="line">        dp[row-<span class="number">1</span>][col-<span class="number">1</span>]=dungeon[row-<span class="number">1</span>][col-<span class="number">1</span>]&gt;=<span class="number">0</span> ? <span class="number">1</span> : <span class="number">1</span>-dungeon[row-<span class="number">1</span>][col-<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> row-<span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            dp[i][col-<span class="number">1</span>]=dp[i+<span class="number">1</span>][col-<span class="number">1</span>]-dungeon[i][col-<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(dp[i][col-<span class="number">1</span>]&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                dp[i][col-<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> col-<span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            dp[row-<span class="number">1</span>][i]=dp[row-<span class="number">1</span>][i+<span class="number">1</span>]-dungeon[row-<span class="number">1</span>][i];</span><br><span class="line">            <span class="keyword">if</span>(dp[row-<span class="number">1</span>][i]&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                dp[row-<span class="number">1</span>][i]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> row-<span class="number">2</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> col-<span class="number">2</span>; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">                dp[i][j]=Math.min(dp[i+<span class="number">1</span>][j],dp[i][j+<span class="number">1</span>])-dungeon[i][j];</span><br><span class="line">                <span class="keyword">if</span>(dp[i][j]&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                    dp[i][j]=<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="514-Freedom-Trail"><a href="#514-Freedom-Trail" class="headerlink" title="514. Freedom Trail"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/freedom-trail/">514. Freedom Trail</a></h3><p><strong>「状态」就是「当前需要输入的字符」和「当前圆盘指针的位置」</strong>。</p>
<p><strong>「选择」就是「如何拨动指针得到待输入的字符」</strong>。</p>
<h4 id="法一："><a href="#法一：" class="headerlink" title="法一："></a>法一：</h4><pre><code>     * 定义转移方程：
     * dp[i][j] 代表到key[i]为止拼接所需要的最少步数，
     * 并且这个key[i]是第j个在圆盘上出现的key[i]
</code></pre>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findRotateSteps</span><span class="params">(String ring, String key)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 贪心的算法：-&gt;举出了反例，是不正确的</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 最直观的转移方程：</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * dp[i]: 代表到key[i]为止，拼接所需要的最少步数</span></span><br><span class="line"><span class="comment">         * dp[i-1]: 到key[i - 1]为止，拼接所需要的最少步数</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * dp[i] = dp[i - 1] + (从key[i-1]到key[i]在圆盘上所要走的最短距离) + 1 （按button需要的步数为1）</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 下标x和下标y在圆盘上的最短距离： |x - y| 或者 n - |x - y|</span></span><br><span class="line"><span class="comment">         * 即Math.min(Math.abs(x - y), n - Math.abs(x - y))</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 但是，</span></span><br><span class="line"><span class="comment">         * key[i-1] 在圆盘上可以出现多次</span></span><br><span class="line"><span class="comment">         * key[i] 在圆盘上可以出现多次</span></span><br><span class="line"><span class="comment">         * 因此一个维度是不够的，再增加一个维度</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 定义转移方程：</span></span><br><span class="line"><span class="comment">         * dp[i][j] 代表到key[i]为止拼接所需要的最少步数，</span></span><br><span class="line"><span class="comment">         * 并且这个key[i]是第j个在圆盘上出现的key[i]</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 比如说key[i] = &#x27;d&#x27;，在ring圆盘上出现位置的下标：2, 7, 8</span></span><br><span class="line"><span class="comment">         * dp[i][0] 代表到key[i]为止拼接所需要的最少步数，并且这个key[i]是位于下标位置为2的key[i]</span></span><br><span class="line"><span class="comment">         * dp[i][1] 代表到key[i]为止拼接所需要的最少步数，并且这个key[i]是位于下标位置为7的key[i]</span></span><br><span class="line"><span class="comment">         * ...以此类推</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * 上一个字符是key[i-1] = &#x27;a&#x27;，在ring圆盘上出现的位置下标是: 4, 9</span></span><br><span class="line"><span class="comment">         * dp[i][0] 代表到key[i - 1]为止拼接所需要的最少步数，并且这个key[i - 1]是位于下标位置为4的key[i]</span></span><br><span class="line"><span class="comment">         * dp[i][1] 代表到key[i - 1]为止拼接所需要的最少步数，并且这个key[i - 1]是位于下标位置为9的key[i]</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * dp[i][j] =</span></span><br><span class="line"><span class="comment">         * Math.min(</span></span><br><span class="line"><span class="comment">         * dp[i-1][0] + 上一个字符key[i-1]（第0个出现的key[i - 1]）到这一个字符key[i]（第j个出现的key[i]）的最短距离,</span></span><br><span class="line"><span class="comment">         * dp[i-1][1] + 上一个字符key[i-1]（第1个出现的key[i - 1]）到这一个字符key[i]（第j个出现的key[i]）的最短距离,</span></span><br><span class="line"><span class="comment">         * ....</span></span><br><span class="line"><span class="comment">         * dp[i-1][k] + 上一个字符key[i-1]（第k个出现的key[i - 1]）到这一个字符key[i]（第j个出现的key[i]）的最短距离,</span></span><br><span class="line"><span class="comment">         * )  + 1 (按button的步数为1)</span></span><br><span class="line"><span class="comment">         * */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">char</span>[] ringChar = ring.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] keyChar = key.toCharArray();</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Integer&gt;[] lists = <span class="keyword">new</span> <span class="title class_">ArrayList</span>[<span class="number">26</span>];<span class="comment">// an array of ArrayList&lt;Integer&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">26</span>; i++) &#123;<span class="comment">//[0,25], represents every lowercase letter </span></span><br><span class="line">            lists[i] = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历ring，存储每个字符出现的位置，即下标</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> ringChar.length, m = keyChar.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> ringChar[i];</span><br><span class="line">            <span class="comment">// 找到对应的arraylist，存储下标</span></span><br><span class="line">            lists[c - <span class="string">&#x27;a&#x27;</span>].add(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ring 和 key的长度最多100，所以定个101很安全</span></span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m][<span class="number">101</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// dp[0][j] 只需要计算从12点方向到key[0]所需要走的最短距离</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; lists[keyChar[<span class="number">0</span>] - <span class="string">&#x27;a&#x27;</span>].size(); j++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 每一个key[0]字符所在的下标</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> lists[keyChar[<span class="number">0</span>] - <span class="string">&#x27;a&#x27;</span>].get(j);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 第一个12点方向的字符的下标，其实就是0</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> lists[ringChar[<span class="number">0</span>] - <span class="string">&#x27;a&#x27;</span>].get(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            dp[<span class="number">0</span>][j] = Math.min(Math.abs(x - y), n - Math.abs(x - y)) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; keyChar.length; i++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 列出当前的字符，和上一个的字符分别是什么</span></span><br><span class="line">            <span class="type">char</span> <span class="variable">cur</span> <span class="operator">=</span> keyChar[i], pre = keyChar[i - <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; lists[cur - <span class="string">&#x27;a&#x27;</span>].size(); j++) &#123;</span><br><span class="line">                <span class="comment">// 当前字符cur出现在ring圆盘上每一个位置的下标</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> lists[cur - <span class="string">&#x27;a&#x27;</span>].get(j);</span><br><span class="line"></span><br><span class="line">                <span class="type">int</span> <span class="variable">minSteps</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; lists[pre - <span class="string">&#x27;a&#x27;</span>].size(); k++) &#123;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 上一个字符pre出现在ring圆盘上每一个位置的下标</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> lists[pre - <span class="string">&#x27;a&#x27;</span>].get(k);</span><br><span class="line"></span><br><span class="line">                    <span class="type">int</span> <span class="variable">steps</span> <span class="operator">=</span> dp[i - <span class="number">1</span>][k] + Math.min(Math.abs(x - y), n - Math.abs(x - y)) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                    minSteps = Math.min(minSteps, steps);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                dp[i][j] = minSteps;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// dp[keyChar.length - 1][0], .... dp[keyChar.length - 1][k] 中的最小值，就是最终拼接key所需要的最少步数</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">101</span>; k++) &#123;</span><br><span class="line">            <span class="comment">// 当等于0时，说明已经越界了，直接跳出循环</span></span><br><span class="line">            <span class="keyword">if</span> (dp[keyChar.length - <span class="number">1</span>][k] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            ans = Math.min(ans, dp[keyChar.length - <span class="number">1</span>][k]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode514</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findRotateSteps</span><span class="params">(String ring, String key)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n1=ring.length();</span><br><span class="line">        <span class="type">int</span> n2=key.length();</span><br><span class="line">        List&lt;Integer&gt;[] lists=<span class="keyword">new</span> <span class="title class_">ArrayList</span>[<span class="number">26</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; lists.length; i++) &#123;</span><br><span class="line">            lists[i]=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span>[] rings = ring.toCharArray();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n1; i++) &#123;</span><br><span class="line">            <span class="type">char</span> c=rings[i];</span><br><span class="line">            lists[c-<span class="string">&#x27;a&#x27;</span>].add(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span>[] keys = key.toCharArray();</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n2][<span class="number">101</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; lists[keys[<span class="number">0</span>] - <span class="string">&#x27;a&#x27;</span>].size(); i++) &#123;</span><br><span class="line">            <span class="type">int</span> pre=<span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> cur=lists[keys[<span class="number">0</span>]-<span class="string">&#x27;a&#x27;</span>].get(i);</span><br><span class="line">            dp[<span class="number">0</span>][i]=dist(n1,pre,cur)+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n2; i++) &#123;</span><br><span class="line">            <span class="type">char</span> curKey=keys[i];</span><br><span class="line">            <span class="type">char</span> preKey=keys[i-<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; lists[curKey - <span class="string">&#x27;a&#x27;</span>].size(); j++) &#123;</span><br><span class="line">                <span class="type">int</span> cur=lists[curKey-<span class="string">&#x27;a&#x27;</span>].get(j);</span><br><span class="line">                <span class="type">int</span> min=Integer.MAX_VALUE;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; lists[preKey - <span class="string">&#x27;a&#x27;</span>].size(); k++) &#123;</span><br><span class="line">                    <span class="type">int</span> pre=lists[preKey-<span class="string">&#x27;a&#x27;</span>].get(k);</span><br><span class="line">                    <span class="type">int</span> cost=dp[i-<span class="number">1</span>][k]+dist(n1,pre,cur)+<span class="number">1</span>;</span><br><span class="line">                    min=Math.min(min,cost);</span><br><span class="line">                &#125;</span><br><span class="line">                dp[i][j]=min;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> res=Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">101</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(dp[n2-<span class="number">1</span>][i]==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res=Math.min(res,dp[n2-<span class="number">1</span>][i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">dist</span><span class="params">(<span class="type">int</span> n1,<span class="type">int</span> pre,<span class="type">int</span> cur)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.min(Math.abs(pre-cur),n1-Math.abs(pre-cur));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="House-Robber"><a href="#House-Robber" class="headerlink" title="House Robber"></a>House Robber</h2><h3 id="198-House-Robber"><a href="#198-House-Robber" class="headerlink" title="198. House Robber"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/house-robber/">198. House Robber</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(nums.length==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">    dp[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">    dp[<span class="number">1</span>]=Math.max(nums[<span class="number">0</span>],nums[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        dp[i]=Math.max(dp[i-<span class="number">1</span>],dp[i-<span class="number">2</span>]+nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[nums.length-<span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>优化空间复杂度后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(nums.length==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nums.length==<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.max(nums[<span class="number">0</span>],nums[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> a=nums[<span class="number">0</span>];</span><br><span class="line">    <span class="type">int</span> b=Math.max(nums[<span class="number">0</span>],nums[<span class="number">1</span>]);</span><br><span class="line">    <span class="type">int</span> c=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        c=Math.max(b,a+nums[i]);</span><br><span class="line">        a=b;</span><br><span class="line">        b=c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="213-House-Robber-II"><a href="#213-House-Robber-II" class="headerlink" title="213. House Robber II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/house-robber-ii/">213. House Robber II</a></h3><p>由于0和n-1不可以同时取，只需取 0 ~ n-2 和 1 ~ n-1 的结果的最大值即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode213</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n=nums.length;</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> nums[<span class="number">0</span>];</span><br><span class="line">        &#125;<span class="keyword">if</span>(n==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Math.max(nums[<span class="number">0</span>],nums[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.max(helper(nums,<span class="number">0</span>,n-<span class="number">2</span>),helper(nums,<span class="number">1</span>,n-<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">helper</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> start,<span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(end-start==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> Math.max(nums[start],nums[end]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> a=nums[start];</span><br><span class="line">        <span class="type">int</span> b=Math.max(nums[start],nums[start+<span class="number">1</span>]);</span><br><span class="line">        <span class="type">int</span> c=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start+<span class="number">2</span>; i &lt;= end; i++) &#123;</span><br><span class="line">            c=Math.max(a+nums[i],b);</span><br><span class="line">            a=b;</span><br><span class="line">            b=c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="337-House-Robber-III"><a href="#337-House-Robber-III" class="headerlink" title="337. House Robber III"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/house-robber-iii/">337. House Robber III</a></h3><p>有意思：懂binary tree的小偷~</p>
<p>The thief has found himself a new place for his thievery again. There is only one entrance to this area, called root.</p>
<p>Besides the root, each house has one and only one parent house. After a tour, the smart thief realized that all houses in this place form a binary tree. It will automatically contact the police if two directly-linked houses were broken into on the same night.</p>
<p>Given the root of the binary tree, return the maximum amount of money the thief can rob without alerting the police.</p>
<h4 id="法一：用memo记录"><a href="#法一：用memo记录" class="headerlink" title="法一：用memo记录"></a>法一：用memo记录</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode337</span> &#123;</span><br><span class="line">    Map&lt;TreeNode,Integer&gt; memo;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rob</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(memo==<span class="literal">null</span>)&#123;</span><br><span class="line">            memo=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(memo.containsKey(root))&#123;</span><br><span class="line">            <span class="keyword">return</span> memo.get(root);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> rob_it=root.val+</span><br><span class="line">                (root.left==<span class="literal">null</span> ? <span class="number">0</span> : rob(root.left.left)+rob(root.left.right))+</span><br><span class="line">                (root.right==<span class="literal">null</span> ? <span class="number">0</span> : rob(root.right.left)+rob(root.right.right));</span><br><span class="line">        <span class="type">int</span> rob_it_not=rob(root.left)+rob(root.right);</span><br><span class="line">        <span class="type">int</span> result=Math.max(rob_it,rob_it_not);</span><br><span class="line">        memo.put(root,result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="法二：不用memo记录"><a href="#法二：不用memo记录" class="headerlink" title="法二：不用memo记录"></a>法二：不用memo记录</h4><h2 id="Best-Time-to-Buy-and-Sell-Stock"><a href="#Best-Time-to-Buy-and-Sell-Stock" class="headerlink" title="Best Time to Buy and Sell Stock"></a>Best Time to Buy and Sell Stock</h2><p>有限状态机 finite state machine</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">base <span class="keyword">case</span>：</span><br><span class="line">dp[<span class="number">0</span>][j][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">dp[<span class="number">0</span>][j][<span class="number">1</span>] = -prices[<span class="number">0</span>]</span><br><span class="line">dp[i][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">dp[i][<span class="number">0</span>][<span class="number">1</span>] = -infinity  <span class="comment">//不可能！</span></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">状态转移方程：</span><br><span class="line">dp[i][k][<span class="number">0</span>] = max(dp[i-<span class="number">1</span>][k][<span class="number">0</span>], dp[i-<span class="number">1</span>][k][<span class="number">1</span>] + prices[i])</span><br><span class="line">dp[i][k][<span class="number">1</span>] = max(dp[i-<span class="number">1</span>][k][<span class="number">1</span>], dp[i-<span class="number">1</span>][k-<span class="number">1</span>][<span class="number">0</span>] - prices[i])</span><br></pre></td></tr></table></figure>



<h3 id="188-Best-Time-to-Buy-and-Sell-Stock-IV"><a href="#188-Best-Time-to-Buy-and-Sell-Stock-IV" class="headerlink" title="188. Best Time to Buy and Sell Stock IV"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iv/">188. Best Time to Buy and Sell Stock IV</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">解法1 动态规划</span></span><br><span class="line"><span class="comment">状态定义:</span></span><br><span class="line"><span class="comment">1. dp[i][k][0 or 1]</span></span><br><span class="line"><span class="comment">0 &lt;= i &lt;= n - 1, 1 &lt;= k &lt;= K</span></span><br><span class="line"><span class="comment">n 为天数，大 K 为交易数的上限，0 和 1 代表是否持有股票。</span></span><br><span class="line"><span class="comment">比如说 dp[3][2][1] 的含义就是：今天是第三天，我现在手上持有着股票，至今最多进行 2 次交易。</span></span><br><span class="line"><span class="comment">再比如 dp[2][3][0] 的含义：今天是第二天，我现在手上没有持有股票，至今最多进行 3 次交易</span></span><br><span class="line"><span class="comment">2. 最终要求的答案是 dp[n - 1][K][0]因为 dp[n - 1][K][1] 代表到最后一天手上还持有股票，</span></span><br><span class="line"><span class="comment">dp[n - 1][K][0] 表示最后一天手上的股票已经卖出去了，很显然后者得到的利润一定大于前者</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">basecase:</span></span><br><span class="line"><span class="comment">dp[0][j][0] = 0</span></span><br><span class="line"><span class="comment">解释：第0天不持有股票,不管交易次数限制多少次,同一天内交易与否,利润都为0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">dp[0][j][1] = -prices[0]</span></span><br><span class="line"><span class="comment">解释：第0天持有股票,不管交易次数限制多少,最终利润都为-prices[0]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">dp[i][0][0] = 0</span></span><br><span class="line"><span class="comment">解释：因为 k 是从 1 开始的，所以 k = 0 意味着根本不允许交易，这时候利润当然是 0。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">dp[i][0][1] = -infinity</span></span><br><span class="line"><span class="comment">解释：不允许交易的情况下，是不可能持有股票的。</span></span><br><span class="line"><span class="comment">因为我们的算法要求一个最大值，所以初始值设为一个最小值，方便取最大值。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">状态转移:</span></span><br><span class="line"><span class="comment">注意 k 的限制，在选择 buy 的时候相当于开启了一次交易，那么对于昨天来说，交易次数的上限 k 应该减小 1。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i])</span></span><br><span class="line"><span class="comment">              max( 今天选择 reset,        今天选择 sell       )</span></span><br><span class="line"><span class="comment">解释：今天我没有持有股票，有两种可能，我从这两种可能中求最大利润：</span></span><br><span class="line"><span class="comment">1. 我昨天就没有持有，且截至昨天最大交易次数限制为 k；然后我今天选择 rest，</span></span><br><span class="line"><span class="comment">所以我今天还是没有持有，最大交易次数限制依然为 k。</span></span><br><span class="line"><span class="comment">2. 我昨天持有股票，且截至昨天最大交易次数限制为 k；但是今天我 sell 了，</span></span><br><span class="line"><span class="comment">所以我今天没有持有股票了，最大交易次数限制依然为 k。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i])</span></span><br><span class="line"><span class="comment">              max( 今天选择 reset,         今天选择 buy         )</span></span><br><span class="line"><span class="comment">解释：今天我持有着股票，最大交易次数限制为 k，那么对于昨天来说，有两种可能，</span></span><br><span class="line"><span class="comment">我从这两种可能中求最大利润</span></span><br><span class="line"><span class="comment">1. 我昨天就持有着股票，且截至昨天最大交易次数限制为 k；然后今天选择 rest，</span></span><br><span class="line"><span class="comment">所以我今天还持有着股票，最大交易次数限制依然为 k。</span></span><br><span class="line"><span class="comment">2. 我昨天本没有持有，且截至昨天最大交易次数限制为 k - 1；但今天我选择 buy，</span></span><br><span class="line"><span class="comment">所以今天我就持有股票了，最大交易次数限制为 k。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode188</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span> k, <span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="comment">//dp[i][j][0 or 1]</span></span><br><span class="line">        <span class="comment">//0&lt;=i&lt;=n-1 , 0&lt;=j&lt;=k</span></span><br><span class="line">        <span class="comment">//第i天，交易上限为j时的最大利润</span></span><br><span class="line">        <span class="type">int</span> n=prices.length;</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[][][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n][k+<span class="number">1</span>][<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n ; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">1</span>]=Integer.MIN_VALUE; <span class="comment">//允许交易次数为0，却持有股票，不可能!</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= k; j++) &#123;<span class="comment">//交易上限从1开始</span></span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                    dp[i][j][<span class="number">0</span>]=<span class="number">0</span>; <span class="comment">//不持有</span></span><br><span class="line">                    dp[i][j][<span class="number">1</span>]=-prices[<span class="number">0</span>]; <span class="comment">//持有</span></span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][j][<span class="number">0</span>],dp[i-<span class="number">1</span>][j][<span class="number">1</span>]+prices[i]);</span><br><span class="line">                    dp[i][j][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][j][<span class="number">1</span>],dp[i-<span class="number">1</span>][j-<span class="number">1</span>][<span class="number">0</span>]-prices[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>][k][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">解法2 解法1的状态压缩</span></span><br><span class="line"><span class="comment">dp[i][j][0] = max(dp[i-1][j][0], dp[i-1][j][1]+prices[i])</span></span><br><span class="line"><span class="comment">dp[i][j][1] = max(dp[i-1][j][1], dp[i-1][j-1][0]-prices[i])</span></span><br><span class="line"><span class="comment">1. 根据状态转移方程可以发现如果不关心dp三维数组的第2和第3维,</span></span><br><span class="line"><span class="comment">其实dp[i]只和dp[i-1]相关.所以可以考虑将第1维优化掉</span></span><br><span class="line"><span class="comment">2. 第3维只有0和1两种状态也可以考虑把第3维和第2维互换,</span></span><br><span class="line"><span class="comment">然后用2个变量优化掉</span></span><br><span class="line"><span class="comment">最后只用2个长度为k+1的1维数组表示 dp</span></span><br><span class="line"><span class="comment">3. 本题中的k最大值可以达到10^9,因为n天最多只能进行n/2次交易</span></span><br><span class="line"><span class="comment">因此可以取k和n/2中的较小值作为k然后再进行动态规划</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h3 id="121-Best-Time-to-Buy-and-Sell-Stock"><a href="#121-Best-Time-to-Buy-and-Sell-Stock" class="headerlink" title="121. Best Time to Buy and Sell Stock"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock/">121. Best Time to Buy and Sell Stock</a></h3><p>由于只允许1次交易（一买一卖）,无需考虑交易维度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dp[i][1][0] = max(dp[i-1][1][0], dp[i-1][1][1] + prices[i])</span><br><span class="line">dp[i][1][1] = max(dp[i-1][1][1], dp[i-1][0][0] - prices[i]) </span><br><span class="line">            = max(dp[i-1][1][1], -prices[i])</span><br><span class="line">解释：k = 0 的 base case，所以 dp[i-1][0][0] = 0。</span><br><span class="line"></span><br><span class="line">现在发现 k 都是 1，不会改变，即 k 对状态转移已经没有影响了。</span><br><span class="line">可以进行进一步化简去掉所有 k：</span><br><span class="line">dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])</span><br><span class="line">dp[i][1] = max(dp[i-1][1], -prices[i])</span><br></pre></td></tr></table></figure>



<h4 id="写法一：统一风格"><a href="#写法一：统一风格" class="headerlink" title="写法一：统一风格"></a>写法一：统一风格</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode121</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="comment">//dp[n][k][0/1]</span></span><br><span class="line">        <span class="comment">//k=1</span></span><br><span class="line">        <span class="type">int</span> n=prices.length;</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n][<span class="number">2</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>]=-prices[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i]); <span class="comment">//手头没股票，可能前一天就没股票，也可能当天卖了，</span></span><br><span class="line">            dp[i][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>],-prices[i]); <span class="comment">//手头有股票，可能前一天就有股票，也可能当天买了</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>本质上是记录截至今日的最低买价，并每天判断是否更新最大利润</p>
<h4 id="写法二：特殊情况"><a href="#写法二：特殊情况" class="headerlink" title="写法二：特殊情况"></a>写法二：特殊情况</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=prices.length;</span><br><span class="line">    <span class="type">int</span> profit=Integer.MIN_VALUE;</span><br><span class="line">    <span class="type">int</span> min=prices[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        profit=Math.max(profit,prices[i]-min);</span><br><span class="line">        min=Math.min(min,prices[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> profit&gt;<span class="number">0</span> ? profit : <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="122-Best-Time-to-Buy-and-Sell-Stock-II"><a href="#122-Best-Time-to-Buy-and-Sell-Stock-II" class="headerlink" title="122. Best Time to Buy and Sell Stock II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-ii/">122. Best Time to Buy and Sell Stock II</a></h3><p>允许无穷次交易，无需考虑交易次数维度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dp[i][k][0] = max(dp[i-1][k][0], dp[i-1][k][1] + prices[i])</span><br><span class="line">dp[i][k][1] = max(dp[i-1][k][1], dp[i-1][k-1][0] - prices[i])</span><br><span class="line">            = max(dp[i-1][k][1], dp[i-1][k][0] - prices[i])</span><br><span class="line"></span><br><span class="line">我们发现数组中的 k 已经不会改变了，也就是说不需要记录 k 这个状态了：</span><br><span class="line">dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])</span><br><span class="line">dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i])</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode122</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="comment">//交易次数无限制</span></span><br><span class="line">        <span class="type">int</span> n=prices.length;</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n][<span class="number">2</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>]=-prices[<span class="number">0</span>];</span><br><span class="line">        <span class="comment">//dp[i][j][0]=Math.max(dp[i-1][j][0],dp[i-1][j][1]+prices[i])</span></span><br><span class="line">        <span class="comment">//dp[i][j][1]=Math.max(dp[i-1][j][1],dp[i-1][j-1][0]-prices[i])</span></span><br><span class="line">        <span class="comment">//dp[i-1][j][0]=dp[i-1][j-1][0]</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i]);</span><br><span class="line">            dp[i][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>],dp[i-<span class="number">1</span>][<span class="number">0</span>]-prices[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="123-Best-Time-to-Buy-and-Sell-Stock-III"><a href="#123-Best-Time-to-Buy-and-Sell-Stock-III" class="headerlink" title="123. Best Time to Buy and Sell Stock III"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iii/">123. Best Time to Buy and Sell Stock III</a></h3><p>k&#x3D;2时的情况</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode123</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n= prices.length;</span><br><span class="line">        <span class="type">int</span>[][][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n][<span class="number">3</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">            dp[i][<span class="number">0</span>][<span class="number">1</span>]=Integer.MIN_VALUE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= <span class="number">2</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(i==<span class="number">0</span>)&#123;</span><br><span class="line">                    dp[i][j][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">                    dp[i][j][<span class="number">1</span>]=-prices[i];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][j][<span class="number">0</span>],dp[i-<span class="number">1</span>][j][<span class="number">1</span>]+prices[i]);</span><br><span class="line">                    dp[i][j][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][j][<span class="number">1</span>],dp[i-<span class="number">1</span>][j-<span class="number">1</span>][<span class="number">0</span>]-prices[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>][<span class="number">2</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown"><a href="#309-Best-Time-to-Buy-and-Sell-Stock-with-Cooldown" class="headerlink" title="309. Best Time to Buy and Sell Stock with Cooldown"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/">309. Best Time to Buy and Sell Stock with Cooldown</a></h3><ul>
<li>卖了后不能第二天立刻买</li>
<li>无限次买卖</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[i][0] = max(dp[i-1][0], dp[i-1][1] + prices[i])</span><br><span class="line">dp[i][1] = max(dp[i-1][1], dp[i-2][0] - prices[i])</span><br><span class="line">解释：第 i 天选择 buy 的时候，要从 i-2 的状态转移，而不是 i-1 。</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode309</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">        <span class="comment">//dp[i][j][0]=Math.max(dp[i-1][j][0],dp[i-1][j][1]+prices[i]);</span></span><br><span class="line">        <span class="comment">//dp[i][j][1]=Math.max(dp[i-1][j][1],dp[i-1][j-1][0]-prices[i]);</span></span><br><span class="line">        <span class="type">int</span> n= prices.length;</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n][<span class="number">2</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>]=-prices[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i==<span class="number">1</span>)&#123;</span><br><span class="line">                dp[i][<span class="number">1</span>]=Math.max(-prices[<span class="number">0</span>],-prices[<span class="number">1</span>]);</span><br><span class="line">                dp[i][<span class="number">0</span>]=Math.max(<span class="number">0</span>,prices[<span class="number">1</span>]-prices[<span class="number">0</span>]);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                dp[i][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>],dp[i-<span class="number">2</span>][<span class="number">0</span>]-prices[i]); <span class="comment">//第i天选择buy，要从i-2转移</span></span><br><span class="line">                dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="714-Best-Time-to-Buy-and-Sell-Stock-with-Transaction-Fee"><a href="#714-Best-Time-to-Buy-and-Sell-Stock-with-Transaction-Fee" class="headerlink" title="714. Best Time to Buy and Sell Stock with Transaction Fee"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-with-transaction-fee/">714. Best Time to Buy and Sell Stock with Transaction Fee</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode714</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices, <span class="type">int</span> fee)</span> &#123;</span><br><span class="line">        <span class="comment">//dp[i][j][0]=Math.max(dp[i-1][j][0],dp[i-1][j][1]+prices[i]);</span></span><br><span class="line">        <span class="comment">//dp[i][j][1]=Math.max(dp[i-1][j][1],dp[i-1][j-1][0]-prices[i]);</span></span><br><span class="line">        <span class="type">int</span> n=prices.length;</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n][<span class="number">2</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">1</span>]=-prices[<span class="number">0</span>]-fee;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">0</span>],dp[i-<span class="number">1</span>][<span class="number">1</span>]+prices[i]);</span><br><span class="line">            dp[i][<span class="number">1</span>]=Math.max(dp[i-<span class="number">1</span>][<span class="number">1</span>],dp[i-<span class="number">1</span>][<span class="number">0</span>]-prices[i]-fee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n-<span class="number">1</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="背包问题"><a href="#背包问题" class="headerlink" title="背包问题"></a>背包问题</h2><p>状态：</p>
<ol>
<li><p>背包容量w</p>
</li>
<li><p>可选择的物品n</p>
</li>
</ol>
<p><code>dp[i][w]</code> 的定义如下：对于前 <code>i</code> 个物品，当前背包的容量为 <code>w</code>，这种情况下可以装的最大价值是 <code>dp[i][w]</code>。</p>
<p>比如说，如果 <code>dp[3][5] = 6</code>，其含义为：对于给定的一系列物品中，若只对前 3 个物品进行选择，当背包容量为 5 时，最多可以装下的价值为 6。</p>
<p><code>dp[i][w]</code> 表示：对于前 <code>i</code> 个物品（从 1 开始计数），当前背包的容量为 <code>w</code> 时，这种情况下可以装下的最大价值是 <code>dp[i][w]</code>。</p>
<ul>
<li><p><strong>如果你没有把这第 <code>i</code> 个物品装入背包</strong>，那么很显然，最大价值 <code>dp[i][w]</code> 应该等于 <code>dp[i-1][w]</code>，继承之前的结果。</p>
</li>
<li><p><strong>如果你把这第 <code>i</code> 个物品装入了背包</strong>，那么 <code>dp[i][w]</code> 应该等于 <code>val[i-1] + dp[i-1][w - wt[i-1]]</code>。</p>
</li>
</ul>
<h3 id="416-Partition-Equal-Subset-Sum"><a href="#416-Partition-Equal-Subset-Sum" class="headerlink" title="416. Partition Equal Subset Sum"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/partition-equal-subset-sum/">416. Partition Equal Subset Sum</a></h3><p><strong>给一个可装载重量为 <code>sum / 2</code> 的背包和 <code>N</code> 个物品，每个物品的重量为 <code>nums[i]</code>。现在让你装物品，是否存在一种装法，能够恰好将背包装满</strong>？</p>
<p>根据这个定义，我们想求的最终答案就是 <code>dp[N][sum/2]</code>，base case 就是 <code>dp[..][0] = true</code> 和 <code>dp[0][..] = false</code>，因为背包没有空间的时候，就相当于装满了，而当没有物品可选择的时候，肯定没办法装满背包。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode416</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canPartition</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">            sum+=num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>((sum&amp;<span class="number">1</span>)==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        sum/=<span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> n=nums.length;</span><br><span class="line">        <span class="type">boolean</span>[][] dp=<span class="keyword">new</span> <span class="title class_">boolean</span>[n+<span class="number">1</span>][sum+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123; <span class="comment">//base case: 什么物品都不选，都能塞满0空间，dp[i][0]恒为true</span></span><br><span class="line">            dp[i][<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//base case: j&gt;0时,dp[0][j]恒为false,因为什么物品都没有却想塞满大于0的空间，不可能</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= sum; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(j-nums[i-<span class="number">1</span>]&lt;<span class="number">0</span>)&#123;<span class="comment">//不可能塞满负数大小的背包，第二项必定为false，值只取决于第一项</span></span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">1</span>][j];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">1</span>][j] || dp[i-<span class="number">1</span>][j-nums[i-<span class="number">1</span>]];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n][sum]; <span class="comment">//可否用前n个物品塞满sum</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="518-Coin-Change-2"><a href="#518-Coin-Change-2" class="headerlink" title="518. Coin Change 2"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/coin-change-2/">518. Coin Change 2</a></h3><p>注意：</p>
<ul>
<li>先 coin 后 amount，行！</li>
<li>先 amount 后 coin，不行！</li>
</ul>
<p>why? :</p>
<ul>
<li><p>纯完全背包是能凑成总和就行，不用管怎么凑的。</p>
<p>本题是求凑出来的方案个数，是组合数，不允许重复。</p>
</li>
<li><p>先 amount 后 coin, dp[0]至dp[i-1]都允许使用所有coin</p>
</li>
<li><p>先 coin 后 amount, 每一层外层循环增加由新增的coin带来的新的组合方法数，可以避免重复！</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span> amount, <span class="type">int</span>[] coins)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[amount+<span class="number">1</span>];</span><br><span class="line">    dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> coin : coins)&#123; </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=amount; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i&lt;coin)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i]+=dp[i-coin];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[amount];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="子序列问题"><a href="#子序列问题" class="headerlink" title="子序列问题"></a>子序列问题</h2><h3 id="1143-Longest-Common-Subsequence"><a href="#1143-Longest-Common-Subsequence" class="headerlink" title="1143. Longest Common Subsequence"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/longest-common-subsequence/">1143. Longest Common Subsequence</a></h3><p>当字符相等时：</p>
<p>当字符不等时：其中一个字符必定不在LCS中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode1143</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestCommonSubsequence</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n1=text1.length();</span><br><span class="line">        <span class="type">int</span> n2=text2.length();</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n1+<span class="number">1</span>][n2+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n1; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n2; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(text1.charAt(i-<span class="number">1</span>)==text2.charAt(j-<span class="number">1</span>))&#123;</span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j]=Math.max(dp[i-<span class="number">1</span>][j],dp[i][j-<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n1][n2];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="583-Delete-Operation-for-Two-Strings"><a href="#583-Delete-Operation-for-Two-Strings" class="headerlink" title="583. Delete Operation for Two Strings"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/delete-operation-for-two-strings/">583. Delete Operation for Two Strings</a></h3><p>法一：直接法，参考<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/edit-distance/">72. Edit Distance</a></p>
<p>删除s1中某一“冲突”字符，相当于在s2中插入该字符，都可以使s1、s2趋于相等</p>
<p>允许在s1、s2中删除字符，等价于：</p>
<ul>
<li>允许在s1中delete</li>
<li>允许在s1中insert</li>
</ul>
<p>使得s1与s2相等</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode583</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDistance</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n1=word1.length();</span><br><span class="line">        <span class="type">int</span> n2=word2.length();</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n1+<span class="number">1</span>][n2+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n1; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt;= n2; j++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][j]=j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n1; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n2; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(word1.charAt(i-<span class="number">1</span>)==word2.charAt(j-<span class="number">1</span>))&#123;</span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j]=Math.min(dp[i-<span class="number">1</span>][j]+<span class="number">1</span>,dp[i][j-<span class="number">1</span>]+<span class="number">1</span>); <span class="comment">//不能replace</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n1][n2];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>法二：间接法，参考<a target="_blank" rel="noopener" href="https://leetcode.cn/problems/longest-common-subsequence/">1143. Longest Common Subsequence</a></p>
<p>只能删不能换的话，两字符串最终变为它们的LCS时相等，只需得到它们的LCS的长度即可</p>
<h3 id="712-Minimum-ASCII-Delete-Sum-for-Two-Strings"><a href="#712-Minimum-ASCII-Delete-Sum-for-Two-Strings" class="headerlink" title="712. Minimum ASCII Delete Sum for Two Strings"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-ascii-delete-sum-for-two-strings/">712. Minimum ASCII Delete Sum for Two Strings</a></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode712</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumDeleteSum</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n1=s1.length();</span><br><span class="line">        <span class="type">int</span> n2=s2.length();</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n1+<span class="number">1</span>][n2+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n1; i++) &#123;</span><br><span class="line">            dp[i][<span class="number">0</span>]=dp[i-<span class="number">1</span>][<span class="number">0</span>]+s1.charAt(i-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n2; j++) &#123;</span><br><span class="line">            dp[<span class="number">0</span>][j]=dp[<span class="number">0</span>][j-<span class="number">1</span>]+s2.charAt(j-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n1; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= n2; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(s1.charAt(i-<span class="number">1</span>)==s2.charAt(j-<span class="number">1</span>))&#123;</span><br><span class="line">                    dp[i][j]=dp[i-<span class="number">1</span>][j-<span class="number">1</span>];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j]=Math.min(dp[i-<span class="number">1</span>][j]+s1.charAt(i-<span class="number">1</span>),dp[i][j-<span class="number">1</span>]+s2.charAt(j-<span class="number">1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n1][n2];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="Palindrome问题"><a href="#Palindrome问题" class="headerlink" title="Palindrome问题"></a>Palindrome问题</h2><h3 id="516-Longest-Palindromic-Subsequence"><a href="#516-Longest-Palindromic-Subsequence" class="headerlink" title="516. Longest Palindromic Subsequence"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/longest-palindromic-subsequence/">516. Longest Palindromic Subsequence</a></h3><p>想求 <code>dp[i][j]</code> 需要知道 <code>dp[i+1][j-1]</code>，<code>dp[i+1][j]</code>，<code>dp[i][j-1]</code> 这三个位置</p>
<p>最终结果在右上角</p>
<p>只需要填右上部分即可（对角线为base case, 1）</p>
<p><strong>为了保证每次计算 <code>dp[i][j]</code>，左下方向的位置已经被计算出来，选择反着遍历</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode516</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestPalindromeSubseq</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> n=s.length();</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            dp[i][i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>; j &lt; n; j++) &#123;<span class="comment">//只需考虑右上部分即可</span></span><br><span class="line">                <span class="keyword">if</span>(s.charAt(i)==s.charAt(j))&#123;</span><br><span class="line">                    dp[i][j]=dp[i+<span class="number">1</span>][j-<span class="number">1</span>]+<span class="number">2</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j]=Math.max(dp[i+<span class="number">1</span>][j],dp[i][j-<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">0</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1312-Minimum-Insertion-Steps-to-Make-a-String-Palindrome"><a href="#1312-Minimum-Insertion-Steps-to-Make-a-String-Palindrome" class="headerlink" title="1312. Minimum Insertion Steps to Make a String Palindrome"></a><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/minimum-insertion-steps-to-make-a-string-palindrome/">1312. Minimum Insertion Steps to Make a String Palindrome</a></h3><p>本题属于516. 最长回文子序列的子题，求的是将 s 变成回文串需要添加的最少字符数，所以我们只用求最长回文子序列长度即可，然后字符串 s 中除去最长回文子序列，剩下的字符就是不构成回文子序列的字符，添加与其同等数量的字符，将 s 构成回文串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode1312</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minInsertions</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">//n - longest palindromic subsequence</span></span><br><span class="line">        <span class="type">int</span> n=s.length();</span><br><span class="line">        <span class="type">int</span>[][] dp=<span class="keyword">new</span> <span class="title class_">int</span>[n][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            dp[i][i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(s.charAt(i)==s.charAt(j))&#123;</span><br><span class="line">                    dp[i][j]=dp[i+<span class="number">1</span>][j-<span class="number">1</span>]+<span class="number">2</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j]=Math.max(dp[i+<span class="number">1</span>][j],dp[i][j-<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n-dp[<span class="number">0</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/28/%E5%8D%95%E8%B0%83%E6%A0%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/28/%E5%8D%95%E8%B0%83%E6%A0%88/" class="post-title-link" itemprop="url">单调栈</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-28 17:09:24" itemprop="dateCreated datePublished" datetime="2022-04-28T17:09:24+08:00">2022-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-05-05 11:53:35" itemprop="dateModified" datetime="2022-05-05T11:53:35+08:00">2022-05-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Monotonic-Stack选编"><a href="#Monotonic-Stack选编" class="headerlink" title="Monotonic Stack选编"></a>Monotonic Stack选编</h1><p><strong>通常是一维数组，要寻找任一个元素的右边或者左边第一个比自己大或者小的元素的位置，此时就要想到可以用单调栈了</strong>。</p>
<p>时间复杂度为O(n)。</p>
<p>单调栈的本质是空间换时间，因为在遍历的过程中需要用一个栈来记录右边第一个比当前元素大&#x2F;小的元素，优点是只需要遍历一次。</p>
<p>在使用单调栈的时候首先要明确如下几点：</p>
<ol>
<li>单调栈里存放的元素是什么？</li>
</ol>
<p>单调栈里只需要存放元素的下标i就可以了，如果需要使用对应的元素，直接T[i]就可以获取。</p>
<ol>
<li>单调栈里元素是递增呢？ 还是递减呢？</li>
</ol>
<p><strong>注意一下顺序为 从栈顶到栈底的顺序</strong></p>
<p>使用单调栈主要有三个判断条件。</p>
<ul>
<li>当前遍历的元素T[i]小于栈顶元素T[st.top()]的情况</li>
<li>当前遍历的元素T[i]等于栈顶元素T[st.top()]的情况</li>
<li>当前遍历的元素T[i]大于栈顶元素T[st.top()]的情况</li>
</ul>
<p>经典模板：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">nextGreaterElement</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">res</span><span class="params">(nums.size())</span></span>; <span class="comment">// 存放答案的数组</span></span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    <span class="comment">// 倒着往栈里放</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = nums.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// 判定个子高矮</span></span><br><span class="line">        <span class="keyword">while</span> (!s.<span class="built_in">empty</span>() &amp;&amp; s.<span class="built_in">top</span>() &lt;= nums[i]) &#123;</span><br><span class="line">            <span class="comment">// 矮个起开，反正也被挡着了。。。can never be the &quot;next great number&quot;!</span></span><br><span class="line">            s.<span class="built_in">pop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// nums[i] 身后的 next great number</span></span><br><span class="line">        res[i] = s.<span class="built_in">empty</span>() ? <span class="number">-1</span> : s.<span class="built_in">top</span>();</span><br><span class="line">        s.<span class="built_in">push</span>(nums[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>for 循环要从后往前扫描元素，因为我们借助的是栈的结构，倒着入栈，其实是正着出栈。while 循环是把两个「个子高」元素之间的元素排除，因为他们的存在没有意义，前面挡着个「更高」的元素，所以他们不可能被作为后续进来的元素的 Next Great Number 了。</li>
<li>分析它的时间复杂度，要从整体来看：总共有 <code>n</code> 个元素，每个元素都被 <code>push</code> 入栈了一次，而最多会被 <code>pop</code> 一次，没有任何冗余操作。所以总的计算规模是和元素规模 <code>n</code> 成正比的，也就是 <code>O(n)</code> 的复杂度。</li>
</ol>
<h2 id="739-Daily-Temperatures"><a href="#739-Daily-Temperatures" class="headerlink" title="739. Daily Temperatures"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/daily-temperatures/">739. Daily Temperatures</a></h2><p>单调栈图解详见：</p>
<p><a target="_blank" rel="noopener" href="https://programmercarl.com/0739.%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6.html#%E6%80%9D%E8%B7%AF">https://programmercarl.com/0739.%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6.html#%E6%80%9D%E8%B7%AF</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] dailyTemperatures(<span class="type">int</span>[] temperatures) &#123;</span><br><span class="line">    <span class="comment">//monotonic stack</span></span><br><span class="line">    <span class="comment">//find the next greater element</span></span><br><span class="line">    <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[temperatures.length];</span><br><span class="line">    Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> temperatures.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; temperatures[stack.peek()]&lt;=temperatures[i])&#123;</span><br><span class="line">            stack.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        res[i]=stack.peek()==<span class="literal">null</span> ? <span class="number">0</span> : stack.peek()-i;</span><br><span class="line">        stack.push(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="496-Next-Greater-Element-I"><a href="#496-Next-Greater-Element-I" class="headerlink" title="496. Next Greater Element I"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/next-greater-element-i/">496. Next Greater Element I</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] nextGreaterElement(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">        Map&lt;Integer,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums2.length; i++) &#123;</span><br><span class="line">            map.put(nums2[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] list=<span class="keyword">new</span> <span class="title class_">int</span>[nums2.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> nums2.length-<span class="number">1</span>; i &gt;=<span class="number">0</span> ; i--) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; nums2[stack.peek()]&lt;=nums2[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            list[i]=stack.isEmpty()? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[nums1.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; res.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> index=map.get(nums1[i]);</span><br><span class="line">            res[i]=list[index]==-<span class="number">1</span> ? -<span class="number">1</span> : nums2[list[index]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h2 id="503-Next-Greater-Element-II"><a href="#503-Next-Greater-Element-II" class="headerlink" title="503. Next Greater Element II"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/next-greater-element-ii/">503. Next Greater Element II</a></h2><p>circular integer array <code>nums</code></p>
<p>对于循环数组：考虑用mod运算模拟在nums后再加一个nums</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode503</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] nextGreaterElements(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>*(nums.length - <span class="number">1</span>)+<span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; stack.peek()&lt;=nums[i%nums.length])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            res[i%nums.length]=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            stack.push(nums[i%nums.length]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="84-Largest-Rectangle-in-Histogram"><a href="#84-Largest-Rectangle-in-Histogram" class="headerlink" title="84. Largest Rectangle in Histogram"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/largest-rectangle-in-histogram/">84. Largest Rectangle in Histogram</a></h2><p>我们归纳一下枚举「高」的方法：</p>
<p>首先我们枚举某一根柱子 i 作为高  <em>h</em>&#x3D;<em>heights</em>[<em>i</em>]；</p>
<p>随后我们需要进行向左右两边扩展，使得扩展到的柱子的高度均不小于 h。换句话说，我们需要找到左右两侧最近的高度小于 h 的柱子，这样这两根柱子之间（不包括其本身）的所有柱子高度均不小于 h，并且就是 i 能够扩展到的最远范围。</p>
<p>笨方法：用两个单调栈</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode84</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">largestRectangleArea</span><span class="params">(<span class="type">int</span>[] heights)</span> &#123;</span><br><span class="line">        Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] right=<span class="keyword">new</span> <span class="title class_">int</span>[heights.length]; <span class="comment">//记录右边第一个比它小的 不存在则存入length</span></span><br><span class="line">        <span class="type">int</span>[] left=<span class="keyword">new</span> <span class="title class_">int</span>[heights.length]; <span class="comment">//记录左边第一个比它小的  不存在则存入-1</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> heights.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; heights[stack.peek()]&gt;=heights[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            right[i]=stack.isEmpty() ? heights.length : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; heights.length; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; heights[stack.peek()]&gt;=heights[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            left[i]=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> res=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; heights.length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> r=right[i];</span><br><span class="line">            <span class="type">int</span> l=left[i];</span><br><span class="line">            <span class="type">int</span> area=(r-l-<span class="number">1</span>)*heights[i];</span><br><span class="line">            res=Math.max(res,area);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="42-Trapping-Rain-Water"><a href="#42-Trapping-Rain-Water" class="headerlink" title="42. Trapping Rain Water"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/trapping-rain-water/">42. Trapping Rain Water</a></h2><h3 id="法一：单调栈"><a href="#法一：单调栈" class="headerlink" title="法一：单调栈"></a>法一：单调栈</h3><h3 id="法二：双指针-dp优化"><a href="#法二：双指针-dp优化" class="headerlink" title="法二：双指针+dp优化"></a>法二：双指针+dp优化</h3><p>largest rectangle area是要找一根柱子的左右两边的next greater element</p>
<p>trapping rain water是要找一根柱子的左右两边的greastet element，并加以判断：若两边的greatest element都比这根柱子高，则可以在这根柱子上蓄水</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>[] height)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span>[] maxLeft=<span class="keyword">new</span> <span class="title class_">int</span>[height.length];</span><br><span class="line">    <span class="type">int</span>[] maxRight=<span class="keyword">new</span> <span class="title class_">int</span>[height.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; maxLeft.length-<span class="number">1</span>; i++) &#123;</span><br><span class="line">        maxLeft[i]=Math.max(maxLeft[i-<span class="number">1</span>],height[i-<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> maxRight.length - <span class="number">2</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        maxRight[i]=Math.max(maxRight[i+<span class="number">1</span>],height[i+<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> start=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> end= height.length-<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=start; i&lt;=end; i++)&#123;</span><br><span class="line">        <span class="type">int</span> left=maxLeft[i];</span><br><span class="line">        <span class="type">int</span> right=maxRight[i];</span><br><span class="line">        <span class="keyword">if</span>(left&lt;=height[i] || right&lt;=height[i])&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> h=Math.min(left,right)-height[i];</span><br><span class="line">        res+=h;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="85-Maximal-Rectangle"><a href="#85-Maximal-Rectangle" class="headerlink" title="85. Maximal Rectangle"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/maximal-rectangle/">85. Maximal Rectangle</a></h2><p>就是largest rectangle area的应用</p>
<p>把矩阵的每一行看成一个底面，迭代计算每一行的largest recatangle area</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode85</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximalRectangle</span><span class="params">(<span class="type">char</span>[][] matrix)</span> &#123;</span><br><span class="line">        <span class="type">int</span> row=matrix.length;</span><br><span class="line">        <span class="type">int</span> col=matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="type">int</span>[] dp=<span class="keyword">new</span> <span class="title class_">int</span>[col];</span><br><span class="line">        <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">                dp[j]=matrix[i][j]==<span class="string">&#x27;0&#x27;</span> ? <span class="number">0</span> : dp[j]+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            max=Math.max(max,largestArea(dp));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">largestArea</span><span class="params">(<span class="type">int</span>[] dp)</span>&#123;</span><br><span class="line">        <span class="comment">//largest rectangle</span></span><br><span class="line">        <span class="comment">//monotonic stack</span></span><br><span class="line">        <span class="comment">//next &quot;greater&quot; element, in this case, next smaller element</span></span><br><span class="line">        <span class="type">int</span> n=dp.length;</span><br><span class="line">        Deque&lt;Integer&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] rightSmall=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; dp[stack.peek()]&gt;=dp[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            rightSmall[i]=stack.isEmpty() ? n : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span>[] leftSmall=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack.isEmpty() &amp;&amp; dp[stack.peek()]&gt;=dp[i])&#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            leftSmall[i]=stack.isEmpty() ? -<span class="number">1</span> : stack.peek();</span><br><span class="line">            stack.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="type">int</span> height=dp[i];</span><br><span class="line">            <span class="type">int</span> area=height*(rightSmall[i]-leftSmall[i]-<span class="number">1</span>);</span><br><span class="line">            max=Integer.max(max,area);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/28/%E5%9B%9E%E6%BA%AF%E6%B3%95(2)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/28/%E5%9B%9E%E6%BA%AF%E6%B3%95(2)/" class="post-title-link" itemprop="url">回溯法(2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-28 17:08:02" itemprop="dateCreated datePublished" datetime="2022-04-28T17:08:02+08:00">2022-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-09-07 02:31:29" itemprop="dateModified" datetime="2022-09-07T02:31:29+08:00">2022-09-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="backtracking经典题选编-2"><a href="#backtracking经典题选编-2" class="headerlink" title="backtracking经典题选编(2)"></a>backtracking经典题选编(2)</h1><h2 id="51-N-Queens"><a href="#51-N-Queens" class="headerlink" title="51. N-Queens"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/n-queens/">51. N-Queens</a></h2><p>思路：</p>
<ol>
<li>从上往下，一行一行填</li>
<li>某一行元素逐个判断，valid则填入并继续探索下一行（，否则跳过，直接探索该行下一个元素）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode51</span> &#123;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; res;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">solveNQueens</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">char</span>[][] board=<span class="keyword">new</span> <span class="title class_">char</span>[n][n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                board[i][j]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        backtracking(board,n,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    List&lt;String&gt; <span class="title function_">toList</span><span class="params">(<span class="type">char</span>[][] board)</span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; board.length; i++) &#123;</span><br><span class="line">            StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; board[<span class="number">0</span>].length; j++) &#123;</span><br><span class="line">                sb.append(board[i][j]);</span><br><span class="line">            &#125;</span><br><span class="line">            list.add(sb.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">char</span>[][] board,<span class="type">int</span> n, <span class="type">int</span> row)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(row==n)&#123;</span><br><span class="line">            List&lt;String&gt; list=toList(board);</span><br><span class="line">            <span class="built_in">this</span>.res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(valid(board,n,row,i))&#123;</span><br><span class="line">                board[row][i]=<span class="string">&#x27;Q&#x27;</span>;</span><br><span class="line">                backtracking(board,n,row+<span class="number">1</span>);</span><br><span class="line">                board[row][i]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">valid</span><span class="params">(<span class="type">char</span>[][] board,<span class="type">int</span> n,<span class="type">int</span> row,<span class="type">int</span> col)</span>&#123;</span><br><span class="line">        <span class="comment">//从上往下填的，只需考察上方元素，下方都是空</span></span><br><span class="line">        <span class="comment">//正上方不能有Q</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(board[i][col]==<span class="string">&#x27;Q&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//左上不能有Q</span></span><br><span class="line">        <span class="type">int</span> r=row-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> c=col-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(r&gt;=<span class="number">0</span> &amp;&amp; c&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(board[r][c]==<span class="string">&#x27;Q&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            r--;</span><br><span class="line">            c--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//右上不能有Q</span></span><br><span class="line">        r=row-<span class="number">1</span>;</span><br><span class="line">        c=col+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(r&gt;=<span class="number">0</span> &amp;&amp; c&lt;n)&#123;</span><br><span class="line">            <span class="keyword">if</span>(board[r][c]==<span class="string">&#x27;Q&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            r--;</span><br><span class="line">            c++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="131-Palindrome-Partitioning"><a href="#131-Palindrome-Partitioning" class="headerlink" title="131. Palindrome Partitioning"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/palindrome-partitioning/">131. Palindrome Partitioning</a></h2><p>本题难点：</p>
<ul>
<li>切割问题可以抽象为组合问题</li>
<li>如何模拟那些切割线</li>
<li>切割问题中递归如何终止</li>
<li>在递归循环中如何截取子串</li>
<li>如何判断回文</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">List&lt;List&lt;String&gt;&gt; res;</span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">partition</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(),s,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(String s, <span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(start&lt;end)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s.charAt(start)!=s.charAt(end))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        start++;</span><br><span class="line">        end--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;String&gt; list,String s,<span class="type">int</span> start)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start&gt;=s.length())&#123;</span><br><span class="line">        <span class="built_in">this</span>.res.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(isPalindrome(s,start,i))&#123;</span><br><span class="line">            list.add(s.substring(start,i+<span class="number">1</span>)); <span class="comment">//s[start,i]加进去了</span></span><br><span class="line">            backtracking(list,s,i+<span class="number">1</span>); <span class="comment">//继续探索s[i+1,length-1]</span></span><br><span class="line">            list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="93-Restore-IP-Addresses"><a href="#93-Restore-IP-Addresses" class="headerlink" title="93. Restore IP Addresses"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/restore-ip-addresses/">93. Restore IP Addresses</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode93</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">restoreIpAddresses</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        List&lt;String&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        backtracking(res,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(),s,<span class="number">3</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s, <span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start&lt;end &amp;&amp; s.charAt(start)==<span class="string">&#x27;0&#x27;</span> || end-start&gt;=<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> digit=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(start&lt;=end)&#123;</span><br><span class="line">            sum+=(s.charAt(end)-<span class="string">&#x27;0&#x27;</span>)*digit;</span><br><span class="line">            digit*=<span class="number">10</span>;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum&lt;=<span class="number">255</span> ? <span class="literal">true</span> : <span class="literal">false</span>; <span class="comment">//注意int溢出 2147483647</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;String&gt; res, LinkedList&lt;String&gt; list, String s, <span class="type">int</span> dot, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(start&gt;=s.length())&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(dot==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(isValid(s,start,s.length()-<span class="number">1</span>))&#123;</span><br><span class="line">                StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                <span class="keyword">for</span> (String s1 : list) &#123;</span><br><span class="line">                    sb.append(s1);</span><br><span class="line">                &#125;</span><br><span class="line">                sb.append(s.substring(start,s.length()));</span><br><span class="line">                res.add(<span class="keyword">new</span> <span class="title class_">String</span>(sb));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(isValid(s,start,i))&#123;</span><br><span class="line">                list.add(s.substring(start,i+<span class="number">1</span>));</span><br><span class="line">                list.add(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">                backtracking(res,list,s,dot-<span class="number">1</span>,i+<span class="number">1</span>);</span><br><span class="line">                list.removeLast();</span><br><span class="line">                list.removeLast();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="37-Sudoku-Solver"><a href="#37-Sudoku-Solver" class="headerlink" title="37. Sudoku Solver"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sudoku-solver/">37. Sudoku Solver</a></h2><p>思考：为什么这种void写法不行，一定要将helper设为boolean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wrong answer!</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">char</span>[][] board,<span class="type">int</span> row,<span class="type">int</span> col,<span class="type">int</span> index)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(index&gt;=row*col)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> i=index/row;</span><br><span class="line">    <span class="type">int</span> j=index%row;</span><br><span class="line">    <span class="keyword">if</span>(board[i][j]!=<span class="string">&#x27;.&#x27;</span>)&#123;</span><br><span class="line">        backtracking(board,row,col,index+<span class="number">1</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>; c &lt;= <span class="string">&#x27;9&#x27;</span>; c++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(valid(board,c,i,j))&#123;</span><br><span class="line">                board[i][j]=c;</span><br><span class="line">                backtracking(board,row,col,index+<span class="number">1</span>);</span><br><span class="line">                board[i][j]=<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">solveSudoku</span><span class="params">(<span class="type">char</span>[][] board)</span> &#123;</span><br><span class="line">        solveSudokuHelper(board);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">solveSudokuHelper</span><span class="params">(<span class="type">char</span>[][] board)</span>&#123;</span><br><span class="line">        <span class="comment">//「一个for循环遍历棋盘的行，一个for循环遍历棋盘的列，</span></span><br><span class="line">        <span class="comment">// 一行一列确定下来之后，递归遍历这个位置放9个数字的可能性！」</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123; <span class="comment">// 遍历行</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">9</span>; j++)&#123; <span class="comment">// 遍历列</span></span><br><span class="line">                <span class="keyword">if</span> (board[i][j] != <span class="string">&#x27;.&#x27;</span>)&#123; <span class="comment">// 跳过原始数字</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">char</span> <span class="variable">k</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>; k &lt;= <span class="string">&#x27;9&#x27;</span>; k++)&#123; <span class="comment">// (i, j) 这个位置放k是否合适</span></span><br><span class="line">                    <span class="keyword">if</span> (isValidSudoku(i, j, k, board))&#123;</span><br><span class="line">                        board[i][j] = k;</span><br><span class="line">                        <span class="keyword">if</span> (solveSudokuHelper(board))&#123; <span class="comment">// 如果找到合适一组立刻返回</span></span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        board[i][j] = <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 9个数都试完了，都不行，那么就返回false</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// 因为如果一行一列确定下来了，这里尝试了9个数都不行，说明这个棋盘找不到解决数独问题的解！</span></span><br><span class="line">                <span class="comment">// 那么会直接返回， 「这也就是为什么没有终止条件也不会永远填不满棋盘而无限递归下去！」</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 遍历完没有返回false，说明找到了合适棋盘位置了</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断棋盘是否合法有如下三个维度:</span></span><br><span class="line"><span class="comment">     *     同行是否重复</span></span><br><span class="line"><span class="comment">     *     同列是否重复</span></span><br><span class="line"><span class="comment">     *     9宫格里是否重复</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isValidSudoku</span><span class="params">(<span class="type">int</span> row, <span class="type">int</span> col, <span class="type">char</span> val, <span class="type">char</span>[][] board)</span>&#123;</span><br><span class="line">        <span class="comment">// 同行是否重复</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">9</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (board[row][i] == val)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 同列是否重复</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">9</span>; j++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (board[j][col] == val)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 9宫格里是否重复</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">startRow</span> <span class="operator">=</span> (row / <span class="number">3</span>) * <span class="number">3</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">startCol</span> <span class="operator">=</span> (col / <span class="number">3</span>) * <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startRow; i &lt; startRow + <span class="number">3</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> startCol; j &lt; startCol + <span class="number">3</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (board[i][j] == val)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h2 id="491-Increasing-Subsequences"><a href="#491-Increasing-Subsequences" class="headerlink" title="491. Increasing Subsequences"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/increasing-subsequences/">491. Increasing Subsequences</a></h2><p>注意去重逻辑：不能对原数组排序，所以排序+visited数组老方法不行！</p>
<p>不仅是和该元素前一个相比较，而是和该元素之前的全部元素相比较</p>
<p>新去重思路：在每一层开一个map，每一层的相同元素只有第一个元素保留，其余都剪枝</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">findSubsequences</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(res,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(),nums,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(List&lt;List&lt;Integer&gt;&gt; res, LinkedList&lt;Integer&gt; list, <span class="type">int</span>[] nums,<span class="type">int</span> start )</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start&gt;=nums.length)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;Integer,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!list.isEmpty() &amp;&amp; list.getLast()&gt;nums[i])&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(map.getOrDefault(nums[i],<span class="number">0</span>)&gt;=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        list.add(nums[i]);</span><br><span class="line">        map.put(nums[i],map.getOrDefault(nums[i],<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(list.size()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(list));</span><br><span class="line">        &#125;</span><br><span class="line">        backtracking(res,list,nums,i+<span class="number">1</span>);</span><br><span class="line">        list.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>优化思路：由于元素范围有限，可用数组代替map</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode491</span> &#123;</span><br><span class="line">    List&lt;List&lt;Integer&gt;&gt; res;</span><br><span class="line">    LinkedList&lt;Integer&gt; list;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">findSubsequences</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        backtracking(nums,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">(<span class="type">int</span>[] nums,  <span class="type">int</span> start)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(list.size()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">            res.add(<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(list));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(start==nums.length)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">boolean</span>[] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[<span class="number">201</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(visited[nums[i]+<span class="number">100</span>])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(list.size()==<span class="number">0</span> || nums[i]&gt;=list.getLast())&#123;</span><br><span class="line">                list.add(nums[i]);</span><br><span class="line">                visited[nums[i]+<span class="number">100</span>]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(nums,i+<span class="number">1</span>);</span><br><span class="line">                list.removeLast();</span><br><span class="line">                <span class="comment">//注意，某一个值visited过了，就一直标记，这一层再也不选用</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="332-Reconstruct-Itinerary"><a href="#332-Reconstruct-Itinerary" class="headerlink" title="332. Reconstruct Itinerary"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/reconstruct-itinerary/">332. Reconstruct Itinerary</a></h2><p>You must use all the tickets once and only once.</p>
<p>list.get(0)&#x3D;”JFK” 起点给定</p>
<p>回溯终止条件：所有票都used， 即 list.length&#x3D;&#x3D;tickets.length+1</p>
<p>哪些票valid: used&#x3D;&#x3D;false &amp;&amp; 起点.equals(list.getLast())</p>
<p>结果itineray不止一条：取字典序最小的一条</p>
<p>超时的笨方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; res;</span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(list,tickets,<span class="keyword">new</span> <span class="title class_">boolean</span>[tickets.size()]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">( List&lt;String&gt; list, List&lt;List&lt;String&gt;&gt; tickets, <span class="type">boolean</span>[] used)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==tickets.size()+<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(res.size()==<span class="number">0</span> || better(list,res))&#123;</span><br><span class="line">            res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tickets.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(tickets.get(i).get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>))&#123;</span><br><span class="line">                list.add(<span class="string">&quot;JFK&quot;</span>);</span><br><span class="line">                list.add(tickets.get(i).get(<span class="number">1</span>));</span><br><span class="line">                used[i]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(list,tickets,used);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                used[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; used.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(used[i])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String last=list.get(list.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(tickets.get(i).get(<span class="number">0</span>).equals(last))&#123;</span><br><span class="line">                list.add(tickets.get(i).get(<span class="number">1</span>));</span><br><span class="line">                used[i]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(list,tickets,used);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                used[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">better</span><span class="params">(List&lt;String&gt; l1,List&lt;String&gt; l2)</span>&#123;</span><br><span class="line">    StringBuilder sb1=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    StringBuilder sb2=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (String s : l1) &#123;</span><br><span class="line">        sb1.append(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String s : l2) &#123;</span><br><span class="line">        sb2.append(s);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(sb1.toString().compareTo(sb2.toString())&lt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>笨方法不行，考虑先排序，再backtracking, 保证“小”票先被used</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; res;</span><br><span class="line"><span class="type">boolean</span> found;</span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findItinerary</span><span class="params">(List&lt;List&lt;String&gt;&gt; tickets)</span> &#123;</span><br><span class="line">    tickets.sort(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;List&lt;String&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(List&lt;String&gt; o1, List&lt;String&gt; o2)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> !o1.get(<span class="number">0</span>).equals(o2.get(<span class="number">0</span>)) ? o1.get(<span class="number">0</span>).compareTo(o2.get(<span class="number">0</span>)) : o1.get(<span class="number">1</span>).compareTo(o2.get(<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    backtracking(list,tickets,<span class="keyword">new</span> <span class="title class_">boolean</span>[tickets.size()]);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">backtracking</span><span class="params">( List&lt;String&gt; list, List&lt;List&lt;String&gt;&gt; tickets, <span class="type">boolean</span>[] used)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==tickets.size()+<span class="number">1</span>)&#123;</span><br><span class="line">        res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(list);</span><br><span class="line">        found=<span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(list.size()==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; tickets.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(tickets.get(i).get(<span class="number">0</span>).equals(<span class="string">&quot;JFK&quot;</span>))&#123;</span><br><span class="line">                list.add(<span class="string">&quot;JFK&quot;</span>);</span><br><span class="line">                list.add(tickets.get(i).get(<span class="number">1</span>));</span><br><span class="line">                used[i]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(list,tickets,used);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                used[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; used.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(found)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(used[i])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String last=list.get(list.size()-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(tickets.get(i).get(<span class="number">0</span>).equals(last))&#123;</span><br><span class="line">                list.add(tickets.get(i).get(<span class="number">1</span>));</span><br><span class="line">                used[i]=<span class="literal">true</span>;</span><br><span class="line">                backtracking(list,tickets,used);</span><br><span class="line">                list.remove(list.size()-<span class="number">1</span>);</span><br><span class="line">                used[i]=<span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/28/sliding-window/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/28/sliding-window/" class="post-title-link" itemprop="url">sliding window</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-28 16:10:32" itemprop="dateCreated datePublished" datetime="2022-04-28T16:10:32+08:00">2022-04-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-23 11:46:27" itemprop="dateModified" datetime="2022-11-23T11:46:27+08:00">2022-11-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="sliding-window选编"><a href="#sliding-window选编" class="headerlink" title="sliding window选编"></a>sliding window选编</h1><h2 id="76-Minimum-Window-Substring"><a href="#76-Minimum-Window-Substring" class="headerlink" title="76. Minimum Window Substring"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/minimum-window-substring/">76. Minimum Window Substring</a></h2><p>难点：</p>
<ol>
<li>如何判断window满足要求</li>
<li>window满足要求后，如何优化window (start尽可能右移)</li>
</ol>
<p>目标：</p>
<ol>
<li>找start</li>
<li>找len</li>
</ol>
<p>写法一：用HashMap</p>
<p>PS：理论上你可以设计两端都开或者两端都闭的区间，但设计为左闭右开区间是最方便处理的。因为这样初始化 <code>left = right = 0</code> 时区间 <code>[0, 0)</code> 中没有元素，但只要让 <code>right</code> 向右移动（扩大）一位，区间 <code>[0, 1)</code> 就包含一个元素 <code>0</code> 了。如果你设置为两端都开的区间，那么让 <code>right</code> 向右移动一位后开区间 <code>(0, 1)</code> 仍然没有元素；如果你设置为两端都闭的区间，那么初始区间 <code>[0, 0]</code> 就包含了一个元素。这两种情况都会给边界处理带来不必要的麻烦。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">minWindow</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">    HashMap&lt;Character,Integer&gt; need = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();<span class="comment">//用来存储匹配串的字符以及其频率</span></span><br><span class="line">    HashMap&lt;Character,Integer&gt; window = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();<span class="comment">//目前窗口中的字符和其出现的频率</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">t_length</span> <span class="operator">=</span> t.length();<span class="comment">//匹配串的长度</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 统计 匹配串t的字符 和 其出现的频率</span></span><br><span class="line"><span class="comment">     * */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; t_length; i++) &#123;</span><br><span class="line">        need.put(t.charAt(i),need.getOrDefault(t.charAt(i),<span class="number">0</span>)+<span class="number">1</span>);<span class="comment">//获取指定的key对应的 value 如果找不到key 则返回设置的默认值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span><span class="number">0</span>;<span class="comment">//初始化左指针</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//初始化右指针</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">valid</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//窗口中 满足need条件的字符个数，如果valid和need.size 大小相同 说明 窗口完全满足条件了 可以选择收缩了</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;<span class="comment">//记录最小覆盖子串的起使索引</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> Integer.MAX_VALUE;<span class="comment">//记录最小覆盖字串的长度</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//右指针到达 目标串s的末尾的时候停止</span></span><br><span class="line">    <span class="keyword">while</span>(right &lt; s.length())&#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(right);<span class="comment">//获取右指针所在位置的char</span></span><br><span class="line">        right++;<span class="comment">//右指针右移 窗口扩大</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (need.containsKey(c))&#123;<span class="comment">//如果need中包含当前指针所在的字符c</span></span><br><span class="line">            window.put(c,window.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);<span class="comment">//将当前char c 存入对应的window位置</span></span><br><span class="line">            <span class="keyword">if</span> (window.get(c).equals(need.get(c)))&#123;<span class="comment">//如果目标map 中的 相对应的 字符数量符 和 当前window中的 对应的字符数量相同 则 符合的valid++</span></span><br><span class="line">                valid++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (valid == need.size())&#123;<span class="comment">//如果 window中符合need中的char数量则说明确实找到了可行解</span></span><br><span class="line">            <span class="keyword">if</span> (right - left &lt; len)&#123;<span class="comment">//说明现在的子串的长度比 之前记录的长度还要小</span></span><br><span class="line">                len = right - left;<span class="comment">//更新字串长度记录</span></span><br><span class="line">                start = left;<span class="comment">//更新起使索引到left</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//将当前left位置的字符移除窗口</span></span><br><span class="line">            <span class="type">char</span> <span class="variable">d</span> <span class="operator">=</span> s.charAt(left);</span><br><span class="line">            <span class="comment">//左移窗口</span></span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">if</span> (need.containsKey(d))&#123;<span class="comment">//如果当前移除的字符 存在于 need中 需要对窗口内的数据进行一系列更新</span></span><br><span class="line">                <span class="keyword">if</span> (window.get(d).equals(need.get(d)))&#123;<span class="comment">//如果当前需要移除的字符数量 和 need中需要移除的字符数量相同 则将 匹配的字符个数 -1</span></span><br><span class="line">                    valid--;</span><br><span class="line">                &#125;</span><br><span class="line">                window.put(d,window.get(d)-<span class="number">1</span>);<span class="comment">//将当前的</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//right到达了字符串的末尾</span></span><br><span class="line">    <span class="type">return</span> <span class="variable">len</span> <span class="operator">=</span>= Integer.MAX_VALUE ? <span class="string">&quot;&quot;</span> : s.substring(start,start+len);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>写法二：用数组</p>
<p>to be continued</p>
<h2 id="567-Permutation-in-String"><a href="#567-Permutation-in-String" class="headerlink" title="567. Permutation in String"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/permutation-in-string/">567. Permutation in String</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkInclusion</span><span class="params">(String s1, String s2)</span> &#123;</span><br><span class="line">    Map&lt;Character,Integer&gt; need=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s1.length(); i++) &#123;</span><br><span class="line">        need.put(s1.charAt(i),need.getOrDefault(s1.charAt(i),<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> valid=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    Map&lt;Character,Integer&gt; window=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span>(right&lt;s2.length())&#123; <span class="comment">//[left,right)</span></span><br><span class="line">        <span class="type">char</span> c=s2.charAt(right);</span><br><span class="line">        window.put(c,window.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        right++;</span><br><span class="line">        <span class="keyword">if</span>(need.containsKey(c)&amp;&amp;need.get(c).equals(window.get(c)))&#123;</span><br><span class="line">            valid++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(valid==need.size())&#123; <span class="comment">//找到包含permutation的substring后开始缩，直到满足条件返回true</span></span><br><span class="line">            <span class="keyword">if</span>(right-left==s1.length())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">char</span> d=s2.charAt(left);</span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">if</span>(need.containsKey(d))&#123;</span><br><span class="line">                <span class="keyword">if</span>(need.get(d).equals(window.get(d)))&#123;</span><br><span class="line">                    valid--;</span><br><span class="line">                &#125;</span><br><span class="line">                window.put(d,window.get(d)-<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="3-Longest-Substring-Without-Repeating-Characters"><a href="#3-Longest-Substring-Without-Repeating-Characters" class="headerlink" title="3. Longest Substring Without Repeating Characters"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">3. Longest Substring Without Repeating Characters</a></h2><p>sliding window 模板：</p>
<p><strong>现在开始套模板，只需要思考以下四个问题</strong>：</p>
<p>1、当移动 <code>right</code> 扩大窗口，即加入字符时，应该更新哪些数据？</p>
<p>2、什么条件下，窗口应该暂停扩大，开始移动 <code>left</code> 缩小窗口？</p>
<p>3、当移动 <code>left</code> 缩小窗口，即移出字符时，应该更新哪些数据？</p>
<p>4、我们要的结果应该在扩大窗口时还是缩小窗口时进行更新？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    Map&lt;Character,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">while</span>(right&lt;s.length())&#123;</span><br><span class="line">        <span class="type">char</span> c=s.charAt(right);</span><br><span class="line">        map.put(c,map.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        right++;</span><br><span class="line">        <span class="keyword">while</span>(map.get(c)!=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="type">char</span> d=s.charAt(left);</span><br><span class="line">            map.put(d,map.get(d)-<span class="number">1</span>);</span><br><span class="line">            left++;</span><br><span class="line">        &#125;</span><br><span class="line">        max=Math.max(max,right-left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max==Integer.MIN_VALUE ? <span class="number">0</span> : max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="438-Find-All-Anagrams-in-a-String"><a href="#438-Find-All-Anagrams-in-a-String" class="headerlink" title="438. Find All Anagrams in a String"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-all-anagrams-in-a-string/">438. Find All Anagrams in a String</a></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findAnagrams</span><span class="params">(String s, String p)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    Map&lt;Character,Integer&gt; need=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    Map&lt;Character,Integer&gt; window=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; p.length(); i++) &#123;</span><br><span class="line">        need.put(p.charAt(i),need.getOrDefault(p.charAt(i),<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> left=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> right=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> start=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> valid=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(right&lt;s.length())&#123; <span class="comment">//[left,right)</span></span><br><span class="line">        <span class="type">char</span> c=s.charAt(right);</span><br><span class="line">        right++;</span><br><span class="line">        <span class="keyword">if</span>(need.containsKey(c))&#123;</span><br><span class="line">            window.put(c,window.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(need.get(c).equals(window.get(c)))&#123;</span><br><span class="line">                valid++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(valid==need.size())&#123;</span><br><span class="line">            <span class="keyword">if</span>(right-left==p.length())&#123;<span class="comment">//[left,right)</span></span><br><span class="line">                res.add(left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">char</span> d=s.charAt(left);</span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">if</span>(window.containsKey(d))&#123;</span><br><span class="line">                window.put(d,window.get(d)-<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(need.get(d)&gt;window.get(d))&#123;</span><br><span class="line">                    valid--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="159-Longest-Substring-with-At-Most-Two-Distinct-Characters"><a href="#159-Longest-Substring-with-At-Most-Two-Distinct-Characters" class="headerlink" title="159. Longest Substring with At Most Two Distinct Characters"></a>159. Longest Substring with At Most Two Distinct Characters</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstringTwoDistinct</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=s.length();</span><br><span class="line">    <span class="type">int</span> res=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> r=<span class="number">0</span>;</span><br><span class="line">    Map&lt;Character,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span>(r&lt;n)&#123;</span><br><span class="line">        <span class="comment">//[l,r)</span></span><br><span class="line">        <span class="type">char</span> c=s.charAt(r++);</span><br><span class="line">        map.put(c,map.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(map.keySet().size()&gt;<span class="number">2</span>)&#123;</span><br><span class="line">            c=s.charAt(l++);</span><br><span class="line">            map.put(c,map.get(c)-<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(map.get(c)==<span class="number">0</span>)&#123;</span><br><span class="line">                map.remove(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res=Math.max(res,r-l);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/04/24/ssp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/04/24/ssp/" class="post-title-link" itemprop="url">ssp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-04-25 09:20:03" itemprop="dateCreated datePublished" datetime="2022-04-25T09:20:03+08:00">2022-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 15:25:01" itemprop="dateModified" datetime="2022-11-29T15:25:01+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>81k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:14</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-cfgcenter"><a href="#1-cfgcenter" class="headerlink" title="1. cfgcenter"></a>1. cfgcenter</h1><h2 id="1-1-cfg-api"><a href="#1-1-cfg-api" class="headerlink" title="1.1 cfg-api"></a>1.1 cfg-api</h2><p>理论上，给gdsinsing的其它地方直接使用，只需要调用接口，无需重复实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICfgService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//根据编号查找一个配置</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getCfgString</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Integer <span class="title function_">getCfgInteger</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> Date <span class="title function_">getCfgDate</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-2-cfg-provider"><a href="#1-2-cfg-provider" class="headerlink" title="1.2 cfg-provider"></a>1.2 cfg-provider</h2><h3 id="1-2-1-CfgServiceImpl-java"><a href="#1-2-1-CfgServiceImpl-java" class="headerlink" title="1.2.1 CfgServiceImpl.java"></a>1.2.1 CfgServiceImpl.java</h3><p>理论上，provider实现api的接口，用于分布式，其它模块直接调用api即可</p>
<p>目前没用上，还是必须在其它模块的pom里<dependency>provider</dependency></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CfgServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ICfgService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssCfgTeConfigService iGdssCfgTeConfigService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getCfgString</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">GdssCfgTeConfig</span> <span class="variable">value</span> <span class="operator">=</span> iGdssCfgTeConfigService.getEntityByCode(code);</span><br><span class="line">      <span class="keyword">if</span> (value == <span class="literal">null</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value.getCfgValue();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Integer <span class="title function_">getCfgInteger</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> <span class="built_in">this</span>.getCfgString(code);</span><br><span class="line">      <span class="keyword">return</span> Integer.valueOf(val);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Date <span class="title function_">getCfgDate</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> <span class="built_in">this</span>.getCfgString(code);</span><br><span class="line">         <span class="keyword">return</span> DateUtil.string2Date(val);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">         ex.printStackTrace();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="1-2-2-CfgcenterProviderApp"><a href="#1-2-2-CfgcenterProviderApp" class="headerlink" title="1.2.2 CfgcenterProviderApp"></a>1.2.2 CfgcenterProviderApp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.lll.**.mapper&quot;)</span></span><br><span class="line"><span class="meta">@ServletComponentScan(value = &#123;&quot;cn.lll.cfgcenter&quot; &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CfgcenterProviderApp</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(CfgcenterProviderApp.class);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">      <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(CfgcenterProviderApp.class, args);</span><br><span class="line">      SpringUtil.setApplicationContext(context);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">      log.info(<span class="string">&quot;************************************************************* CfgcenterProviderApp 启动完成!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>Spring boot 框架注解</li>
</ol>
<h3 id="1-2-3-TestCfgService-java"><a href="#1-2-3-TestCfgService-java" class="headerlink" title="1.2.3 TestCfgService.java"></a>1.2.3 TestCfgService.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = CfgcenterProviderApp.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCfgService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(TestCfgService.class);</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> ICfgService iCfgService;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Before</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;开始&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@After</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">end</span><span class="params">()</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;结束&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCfgString</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> <span class="string">&quot;001&quot;</span>;</span><br><span class="line">         </span><br><span class="line">         <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> iCfgService.getCfgString(code);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">if</span>(val.equals(<span class="string">&quot;测试&quot;</span>))&#123;</span><br><span class="line">            Assert.assertTrue(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         Assert.assertTrue(<span class="literal">false</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         Assert.assertTrue(<span class="literal">false</span>);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>Spring boot 框架注解</li>
</ol>
<h2 id="1-3-cfg-dao"><a href="#1-3-cfg-dao" class="headerlink" title="1.3 cfg-dao"></a>1.3 cfg-dao</h2><p>一张数据库表，一个xml，一个mapper，一个model，一个service，一个serviceImpl</p>
<p>​                        </p>
<h3 id="1-3-1-xml-mybatis-GdssCfgTeConfig-xml"><a href="#1-3-1-xml-mybatis-GdssCfgTeConfig-xml" class="headerlink" title="1.3.1 xml    mybatis-GdssCfgTeConfig.xml"></a>1.3.1 xml    mybatis-GdssCfgTeConfig.xml</h3><p>1.主体是个<mapper> </mapper>, namespace指定sql功能对应的mapper接口，每个sql功能和接口中的方法一一对应</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;cn.lll.cfgcenter.mapper.IGdssCfgTeConfigMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>常用的CRUD操作由<insert></insert>,  <select></select>, <update></update>,<delete></delete>定义好以备试用，id和mapper接口中的方法名对应</p>
<p><parameterType> 输入参数类型</p>
<p><resultType> <resultMap> 输出参数类型</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delEntity&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">   DELETE FROM</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   WHERE ID = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.<resultMap></resultMap>指定sql操作的结果集，由type指定路径，将数据库表中的记录ORM映射到model中定义的java bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;GdssCfgTeConfigMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;cn.lll.cfgcenter.model.GdssCfgTeConfig&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;ID&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;CHAR&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!--      &lt;result column=&quot;ID&quot; property=&quot;id&quot; jdbcType=&quot;CHAR&quot; javaType=&quot;String&quot; /&gt;--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;CODE&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;CFG_VALUE&quot;</span> <span class="attr">property</span>=<span class="string">&quot;cfgValue&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;REMARK&quot;</span> <span class="attr">property</span>=<span class="string">&quot;remark&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">javaType</span>=<span class="string">&quot;String&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>3.<sql></sql>自定义可重用的sql语句，减少重复工作</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;TableName&quot;</span>&gt;</span>GDSS_CFG_TE_CONFIG<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delEntity&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span>&gt;</span></span><br><span class="line">   DELETE FROM</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   WHERE ID = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;Base_Column_List&quot;</span>&gt;</span></span><br><span class="line">   ID,CODE,CFG_VALUE,REMARK</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEntity&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;cn.lll.cfgcenter.model.GdssCfgTeConfig&quot;</span>&gt;</span></span><br><span class="line">   INSERT INTO</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   (</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;Base_Column_List&quot;</span> /&gt;</span></span><br><span class="line">   )</span><br><span class="line">   VALUES</span><br><span class="line">   (#&#123;id,jdbcType=CHAR&#125;,#&#123;code,jdbcType=VARCHAR&#125;,#&#123;cfgValue,jdbcType=VARCHAR&#125;,#&#123;remark,jdbcType=VARCHAR&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>这个id&#x3D;”condition”的可重用sql语句较长：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;condition&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span>AND ID = #&#123;id&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;code != null&quot;</span>&gt;</span>AND CODE = #&#123;code&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cfgValue != null&quot;</span>&gt;</span>AND CFG_VALUE = #&#123;cfgValue&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark != null&quot;</span>&gt;</span>AND REMARK = #&#123;remark&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id_like != null&quot;</span>&gt;</span>AND ID LIKE &quot;%&quot;#&#123;id_like&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;code_like != null&quot;</span>&gt;</span>AND CODE LIKE &quot;%&quot;#&#123;code_like&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cfgValue_like != null&quot;</span>&gt;</span>AND CFG_VALUE LIKE &quot;%&quot;#&#123;cfgValue_like&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark_like != null&quot;</span>&gt;</span>AND REMARK LIKE &quot;%&quot;#&#123;remark_like&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>但需要使用时可大大减轻工作量：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delEntityByParam&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;cn.lll.cfgcenter.model.GdssCfgTeConfig&quot;</span>&gt;</span></span><br><span class="line">   DELETE FROM</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;condition&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li><p>id_like等like没什么用</p>
</li>
<li><p>ID LIKE “%”#{id_like}”%”，左右加百分号，表示左右都可有0-无穷个字符，用于模糊查询</p>
</li>
</ol>
<p>自定义查询, id&#x3D;”vagueCondition”    &#x2F;&#x2F;没什么用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;vagueCondition&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span>AND ID LIKE &quot;%&quot;#&#123;id&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;code != null&quot;</span>&gt;</span>AND CODE LIKE &quot;%&quot;#&#123;code&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;cfgValue != null&quot;</span>&gt;</span>AND CFG_VALUE LIKE &quot;%&quot;#&#123;cfgValue&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;remark != null&quot;</span>&gt;</span>AND REMARK LIKE &quot;%&quot;#&#123;remark&#125;&quot;%&quot;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;vagueCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span></span></span><br><span class="line"><span class="tag">   <span class="attr">parameterType</span>=<span class="string">&quot;cn.lll.cfgcenter.model.param.GdssCfgTeConfigParam&quot;</span>&gt;</span></span><br><span class="line">   SELECT COUNT(0) FROM</span><br><span class="line">   <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;TableName&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;vagueCondition&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-3-2-mapper-IGdssCfgTeConfigMapper-java"><a href="#1-3-2-mapper-IGdssCfgTeConfigMapper-java" class="headerlink" title="1.3.2 mapper    IGdssCfgTeConfigMapper.java"></a>1.3.2 mapper    IGdssCfgTeConfigMapper.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGdssCfgTeConfigMapper</span> <span class="keyword">extends</span> <span class="title class_">ILllBaseMapper</span>&lt;GdssCfgTeConfig&gt; &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">vagueCount</span><span class="params">(GdssCfgTeConfigParam param)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> List&lt;GdssCfgTeConfig&gt; <span class="title function_">vagueSearch</span><span class="params">(GdssCfgTeConfigParam param)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@description</span>:根据id数组，批量删除</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> idList</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@exception</span> </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="type">int</span> <span class="title function_">batchDelete</span><span class="params">(<span class="meta">@Param(&quot;idList&quot;)</span> List&lt;String&gt; idList)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ILllBaseMapper</span>&lt;T&gt; &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">addEntity</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delEntity</span><span class="params">(String id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delEntityByParam</span><span class="params">(T params)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">updateEntity</span><span class="params">(T entity)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> T <span class="title function_">getEntityById</span><span class="params">(String id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   <span class="keyword">public</span> T <span class="title function_">getEntity</span><span class="params">(T params)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> List&lt;T&gt; <span class="title function_">searchEntity</span><span class="params">(T params)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span> <span class="keyword">throws</span> Exception; </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countByParam</span><span class="params">(T params)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>在Springboot, mybatis中，mapper无需手动写实现类</li>
<li>mapper接口中的方法名需要与xml中的CRUD标签的id保持一致，mybatis才能自动对应上</li>
<li>mapper只用于数据库表ORM映射到model，为mybatis专用，别无他用！</li>
</ol>
<h3 id="1-3-3-model-GdssCfgConfig-java"><a href="#1-3-3-model-GdssCfgConfig-java" class="headerlink" title="1.3.3 model    GdssCfgConfig.java"></a>1.3.3 model    GdssCfgConfig.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LllBaseModel</span> <span class="keyword">implements</span> <span class="title class_">IAbleJson</span>,Cloneable</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GdssCfgTeConfig</span> <span class="keyword">extends</span> <span class="title class_">LllBaseModel</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> String id;</span><br><span class="line">   <span class="keyword">private</span> String code;</span><br><span class="line">   <span class="keyword">private</span> String cfgValue;</span><br><span class="line">   <span class="keyword">private</span> String remark;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String id_like;</span><br><span class="line">   <span class="keyword">private</span> String code_like;</span><br><span class="line">   <span class="keyword">private</span> String cfgValue_like;</span><br><span class="line">   <span class="keyword">private</span> String remark_like;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getCode</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.code;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(String code)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.code = code;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getCfgValue</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.cfgValue;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCfgValue</span><span class="params">(String cfgValue)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.cfgValue = cfgValue;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getRemark</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.remark;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRemark</span><span class="params">(String remark)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.remark = remark;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIdLike</span><span class="params">(String id)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.id_like = id;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCodeLike</span><span class="params">(String code)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.code_like = code;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCfgValueLike</span><span class="params">(String cfgValue)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.cfgValue_like = cfgValue;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRemarkLike</span><span class="params">(String remark)</span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.remark_like = remark;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getPkidValue</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPkidValue</span><span class="params">(String id)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>model里的java bean中的参数可以包含数据库表中没有的字段， 但数据库表中的每个字段model里的java bean都必须一一对应！</li>
<li>model里的java bean中基本数据类型字段要用包装类，不要用int，用Integer，和mybatis中定义相一致！</li>
</ol>
<h3 id="1-3-4-service-IGdssCfgConfigService-java-GdssCfgTeConfigServiceImpl-java"><a href="#1-3-4-service-IGdssCfgConfigService-java-GdssCfgTeConfigServiceImpl-java" class="headerlink" title="1.3.4 service    IGdssCfgConfigService.java, GdssCfgTeConfigServiceImpl.java"></a>1.3.4 service    IGdssCfgConfigService.java, GdssCfgTeConfigServiceImpl.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ILllDbRedisBaseService</span>&lt;T&gt; &#123;</span><br><span class="line">    T <span class="title function_">addEntity</span><span class="params">(T entity)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">    <span class="comment">//arg依照业务，可为usrId,account等</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">delEntityById</span><span class="params">(String id, String arg)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateEntityById</span><span class="params">(T t, String id, String arg)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">    T <span class="title function_">getEntityById</span><span class="params">(String id)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">    T <span class="title function_">getEntity</span><span class="params">(T params)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">    List&lt;T&gt; <span class="title function_">searchEntity</span><span class="params">(<span class="type">int</span> pagesize, <span class="type">int</span> pageno)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">    List&lt;T&gt; <span class="title function_">searchEntity</span><span class="params">(T params,<span class="type">int</span> pagesize,<span class="type">int</span> pageno)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">count</span><span class="params">()</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">count</span><span class="params">(T params)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGdssCfgTeConfigService</span> <span class="keyword">extends</span> <span class="title class_">ILllDbRedisBaseService</span>&lt;GdssCfgTeConfig&gt; &#123;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">vagueCount</span><span class="params">(GdssCfgTeConfigParam param)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> List&lt;GdssCfgTeConfig&gt; <span class="title function_">vagueSearch</span><span class="params">(GdssCfgTeConfigParam param, <span class="type">int</span> pagesize, <span class="type">int</span> pageno)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> GdssCfgTeConfig <span class="title function_">getEntityByCode</span><span class="params">(String code)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">   <span class="type">int</span> <span class="title function_">batchDelete</span><span class="params">(List&lt;String&gt; idList)</span> <span class="keyword">throws</span> BusException;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">reloadAllConfCache</span><span class="params">()</span> <span class="keyword">throws</span> BusException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>MVC 是一种使用 MVC（Model View Controller 模型-视图-控制器）设计创建 Web 应用程序的模式：</p>
<ul>
<li>Model（模型）表示应用程序核心（如数据库）。</li>
<li>View（视图）显示效果（HTML页面）。</li>
<li>Controller（控制器）处理输入（业务逻辑）。</li>
</ul>
<p><strong>Model（模型）</strong>是应用程序中用于处理应用程序数据逻辑的部分。<br> 　通常模型对象负责在数据库中存取数据。</p>
<p><strong>View（视图）</strong>是应用程序中处理数据显示的部分。<br> 　通常视图是依据模型数据创建的。</p>
<p><strong>Controller（控制器）</strong>是应用程序中处理用户交互的部分。<br> 　通常控制器负责从视图读取数据，控制用户输入，并向模型发送数据。</p>
<p>注意：</p>
<ol>
<li>虽然本package名为service，但是仍然属于dao层&#x2F;持久层&#x2F;Model层，而不是业务层&#x2F;Controller层！</li>
<li>serviceImpl中@Autowired自动装载了mapper：<code>private IGdssCfgTeConfigMapper iGdssCfgTeConfigMapper;</code></li>
<li>serviceImpl中的方法实现，直接调用mapper接口中的方法，mybatis自动对应到xml中相应的sql语句：例如delEntityById中调用了mapper接口里的delEntity</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">delEntityById</span><span class="params">(String id, String code)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">   <span class="keyword">if</span> (StringUtil.isEmpty(id))&#123;</span><br><span class="line">      log.error(<span class="string">&quot;id can not be empty&quot;</span>);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;DaoService&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">rows</span> <span class="operator">=</span> iGdssCfgTeConfigMapper.delEntity(id);</span><br><span class="line">      <span class="keyword">if</span> (rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">         flushCache(<span class="literal">null</span>, id, <span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> rows;</span><br><span class="line">   &#125;<span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">      log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;DaoService&quot;</span>,ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h1 id="2-app-ssp-mgr-module-conf"><a href="#2-app-ssp-mgr-module-conf" class="headerlink" title="2. app-ssp-mgr-module-conf"></a>2. app-ssp-mgr-module-conf</h1><h2 id="2-1-controller"><a href="#2-1-controller" class="headerlink" title="2.1 controller"></a>2.1 controller</h2><p>ConfController调用ConfService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ConfService confService;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-model"><a href="#2-2-model" class="headerlink" title="2.2 model"></a>2.2 model</h2><h2 id="2-3-service"><a href="#2-3-service" class="headerlink" title="2.3 service"></a>2.3 service</h2><p>ConfServiceImpl调用cfg-dao-service里的IGdssCfgTeConfigService:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> IGdssCfgTeConfigService iGdssCfgTeConfigService;</span><br></pre></td></tr></table></figure>





<h1 id="3-Spring-boot注解-amp-配置"><a href="#3-Spring-boot注解-amp-配置" class="headerlink" title="3. Spring boot注解&amp;配置"></a>3. Spring boot注解&amp;配置</h1><h2 id="3-1-常用注解"><a href="#3-1-常用注解" class="headerlink" title="3.1 常用注解"></a>3.1 常用注解</h2><h3 id="3-1-1-Configuration"><a href="#3-1-1-Configuration" class="headerlink" title="3.1.1 @Configuration"></a>3.1.1 @Configuration</h3><p>用来标记类可以当做一个bean的定义，被Spring IOC容器使用。</p>
<h3 id="3-1-2-Bean"><a href="#3-1-2-Bean" class="headerlink" title="3.1.2 @Bean"></a>3.1.2 @Bean</h3><p>表示此方法将要返回一个对象，作为一个bean注册进Spring应用上下文。</p>
<h3 id="3-1-3-Component"><a href="#3-1-3-Component" class="headerlink" title="3.1.3 @Component"></a>3.1.3 @Component</h3><p>将 java 类标记为 bean。它是任何 Spring 管理组件的通用构造型。spring 的组件扫描机制现在可以将其拾取并将其拉入应用程序环境中。</p>
<h3 id="3-1-4-Controller"><a href="#3-1-4-Controller" class="headerlink" title="3.1.4 @Controller"></a>3.1.4 @Controller</h3><p>将一个类标记为 Spring Web MVC 控制器。标有它的 Bean 会自动导入到 IoC 容器中。</p>
<h3 id="3-1-5-Service"><a href="#3-1-5-Service" class="headerlink" title="3.1.5 @Service"></a>3.1.5 @Service</h3><p>此注解是组件注解的特化。它不会对 @Component 注解提供任何其他行为。您可以在服务层类中使用 @Service 而不是 @Component，因为它以更好的方式指定了意图。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span>  <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">        System.out.println(<span class="string">&quot;执行service中的保存逻辑&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">    context.register(SpringConfig.class);</span><br><span class="line">    context.refresh();</span><br><span class="line">    <span class="comment">//获取接口实例</span></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">    <span class="comment">//创建实例的代理</span></span><br><span class="line">    <span class="type">UserServiceProxy</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceProxy</span>(service);</span><br><span class="line">    <span class="comment">//执行方法</span></span><br><span class="line">    proxy.saveUser();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>context.getBean(Interface.class) 自动装配</li>
</ol>
<h3 id="3-1-6-Repository"><a href="#3-1-6-Repository" class="headerlink" title="3.1.6 @Repository"></a>3.1.6 @Repository</h3><p>表示使用注解实例化此类，并交给 Spring 的容器管理。</p>
<p>这个注解是具有类似用途和功能的 @Component 注解的特化。它为 DAO 提供了额外的好处。它将 DAO 导入 IoC 容器，并使未经检查的异常有资格转换为 Spring DataAccessException。</p>
<h3 id="3-1-7-Required"><a href="#3-1-7-Required" class="headerlink" title="3.1.7 @Required"></a>3.1.7 @Required</h3><p>这个注解表明bean的属性必须在配置的时候设置，通过一个bean定义的显式的属性值或通过自动装配，若@Required注解的bean属性未被设置，容器将抛出BeanInitializationException。</p>
<h3 id="3-1-8-Autowired和-Resource"><a href="#3-1-8-Autowired和-Resource" class="headerlink" title="3.1.8 @Autowired和@Resource"></a>3.1.8 @Autowired和@Resource</h3><p>@Autowired默认是按照类型装配注入的，默认情况下它要求依赖对象必须存在（可以设置它required属性为false）。@Autowired 注解提供了更细粒度的控制，包括在何处以及如何完成自动装配。它的用法和@Required一样，修饰 setter方法、构造器、属性或者具有任意名称和&#x2F;或多个参数的PN方法。</p>
<p>注意：</p>
<ol>
<li>@Autowired可用于：构造函数、成员变量、Setter方法</li>
<li>@Autowired和@Resource之间的区别</li>
<li>@Autowired默认是按照类型装配注入的，默认情况下它要求依赖对象必须存在（可以设置它required<br>属性为false）。</li>
<li>@Resource默认是按照名称来装配注入的，只有当找不到与名称匹配的bean才会按照类型来装配注入。</li>
</ol>
<h3 id="3-1-9-Qualifier"><a href="#3-1-9-Qualifier" class="headerlink" title="3.1.9 @Qualifier"></a>3.1.9 @Qualifier</h3><p>当您创建多个相同类型的 bean 并希望仅使用属性装配其中一个 bean 时，您可以使用@Qualifier 注解和 @Autowired 通过指定应该装配哪个确切的 bean 来消除歧义。</p>
<h3 id="3-1-10-RequestMapping"><a href="#3-1-10-RequestMapping" class="headerlink" title="3.1.10 @RequestMapping"></a>3.1.10 @RequestMapping</h3><p>@RequestMapping 注解用于将特定 HTTP 请求方法映射到将处理相应请求的控制器中的特定类&#x2F;方法。<br>此注释可应用于两个级别：</p>
<ol>
<li>类级别：映射请求的 URL</li>
<li>方法级别：映射 URL 以及 HTTP 请求方法</li>
</ol>
<h3 id="3-1-11-RestController"><a href="#3-1-11-RestController" class="headerlink" title="3.1.11 @RestController"></a>3.1.11 @RestController</h3><p>RestController用于传json数据</p>
<p>@RequestParam(value &#x3D; “file”) 指定拿前端的file属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.file.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.ListPageVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.file.model.AdminFileVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.login.model.SysUser;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.controller.JsonResult;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.file.proxy.modle.LllFileV2;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.file.proxy.modle.ULFileInfoVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.MgrBaseController;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.file.service.IAdminFileService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@time</span>:2020/6/5</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@function</span>:文件控制器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(path = &quot;/mgrapi/admin/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AdminFileController</span> <span class="keyword">extends</span> <span class="title class_">MgrBaseController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(AdminFileController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IAdminFileService iAdminFileService;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;上传文件&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">   <span class="meta">@RequestMapping(path = &quot;/upload&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">uploadFile</span><span class="params">(<span class="meta">@RequestParam(value = &quot;file&quot;)</span> MultipartFile file, ULFileInfoVo fileInfo)</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">LllFileV2</span> <span class="variable">fileinfo</span> <span class="operator">=</span> iAdminFileService.uploadFile(file,fileInfo);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(fileinfo, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">          log.error(<span class="string">&quot;&quot;</span>,ex);</span><br><span class="line">          <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* @GetMapping(path = &quot;/token&quot;)</span></span><br><span class="line"><span class="comment">    public JsonResult fetchToken()&#123;</span></span><br><span class="line"><span class="comment">        try&#123;</span></span><br><span class="line"><span class="comment">            String token = iAdminFileService.fetchToken();</span></span><br><span class="line"><span class="comment">            return JsonResult.createSuccess(token, &quot;&quot;);</span></span><br><span class="line"><span class="comment">        &#125;catch (Exception ex)&#123;</span></span><br><span class="line"><span class="comment">            return JsonResult.createFail(ex);</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;查询文件列表&quot;, notes = &quot;查询文件列表&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/query&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">queryFileList</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">int</span> pageno, <span class="meta">@RequestParam</span> <span class="type">int</span> pagesize, String id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> <span class="built_in">this</span>.getCurrentSysUser();</span><br><span class="line">            ListPageVo&lt;AdminFileVo&gt; list = iAdminFileService.queryFilePage(pageno, pagesize, id, sysUser);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(list, <span class="string">&quot;OK&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            log.error(ex);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;获取文件详情&quot;, httpMethod = &quot;GET&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(path = &quot;/query/detail&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">queryFileDetailById</span><span class="params">(<span class="meta">@RequestParam</span> String id)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">AdminFileVo</span> <span class="variable">vo</span> <span class="operator">=</span> iAdminFileService.queryFileDetail(id);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(vo, <span class="string">&quot;获取成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;get file detail msg error&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(<span class="string">&quot;公共服务平台未知异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(value = &quot;通过文件id删除文件&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/delete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">deleteFileById</span><span class="params">(<span class="meta">@RequestParam</span> String ids)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            iAdminFileService.deleteFileByFileId(ids);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>, <span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;delete file error&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-2-启动类注解-SpringBootApplication"><a href="#3-2-启动类注解-SpringBootApplication" class="headerlink" title="3.2 启动类注解@SpringBootApplication"></a>3.2 启动类注解@SpringBootApplication</h2><h3 id="3-2-1-SpringBootConfiguration"><a href="#3-2-1-SpringBootConfiguration" class="headerlink" title="3.2.1 @SpringBootConfiguration"></a>3.2.1 @SpringBootConfiguration</h3><p>组合了 @Configuration 注解，实现配置文件的功能。</p>
<h3 id="3-2-2-EnableAutoConfiguration"><a href="#3-2-2-EnableAutoConfiguration" class="headerlink" title="3.2.2 @EnableAutoConfiguration"></a>3.2.2 @EnableAutoConfiguration</h3><p>打开自动配置的功能，也可以关闭某个自动配置的选项，如关闭数据源自动配置功能： </p>
<p>@SpringBootApplication(exclude&#x3D; { DataSourceAutoConfiguration.class })</p>
<h3 id="3-2-3-EnableTransactionManagement"><a href="#3-2-3-EnableTransactionManagement" class="headerlink" title="3.2.3 @EnableTransactionManagement"></a>3.2.3 @EnableTransactionManagement</h3><p>事务处理</p>
<p>proxyTargetClass设置为true表示使用基于子类实现的代理(<code>CGLIB</code>)</p>
<h3 id="3-2-4-ComponentScan"><a href="#3-2-4-ComponentScan" class="headerlink" title="3.2.4 @ComponentScan*"></a>3.2.4 @ComponentScan*</h3><p>Spring组件扫描。</p>
<p>例如：</p>
<ol>
<li>@MapperScan(“cn.lll.**.mapper”)</li>
<li>@ServletComponentScan(value &#x3D; {“cn.lll.iic”})</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.util.SpringUtil;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.compile.handler.HandlerFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.spring.annotation.MapperScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationArguments;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.ApplicationContextEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.lll.**.mapper&quot;)</span></span><br><span class="line"><span class="meta">@ServletComponentScan(value = &#123;&quot;cn.lll.iic&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement(proxyTargetClass = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IICAppSspApp</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span>, ApplicationListener&lt;ApplicationContextEvent&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(IICAppSspApp.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//修复logback bug</span></span><br><span class="line">        HandlerFactory.getLogbackHandler().execute( IICAppSspApp.class.getClassLoader() );</span><br><span class="line"></span><br><span class="line">        SpringApplication.run(IICAppSspApp.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        log.info(<span class="string">&quot;************************************************************* IICAppSspApp 启动完成!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationContextEvent event)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> event.getApplicationContext();</span><br><span class="line">        SpringUtil.setApplicationContext(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-3-yml配置"><a href="#3-3-yml配置" class="headerlink" title="3.3 yml配置"></a>3.3 yml配置</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8095</span></span><br><span class="line">    <span class="attr">compression:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">mime-types:</span> <span class="string">text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json,application/xml</span></span><br><span class="line">    <span class="attr">session:</span></span><br><span class="line">      <span class="attr">timeout:</span> <span class="number">1800</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">http:</span></span><br><span class="line">    <span class="attr">multipart:</span></span><br><span class="line">      <span class="attr">maxFileSize:</span> <span class="string">20MB</span></span><br><span class="line">      <span class="attr">maxRequestSize:</span> <span class="string">20MB</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">date-format:</span> <span class="string">yyyy-MM-dd</span> <span class="string">HH:mm:ss</span></span><br><span class="line">    <span class="attr">time-zone:</span> <span class="string">GMT+8</span></span><br><span class="line">  <span class="attr">thymeleaf:</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">classpath:/templates/</span></span><br><span class="line">    <span class="attr">suffix:</span> <span class="string">.html</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">    <span class="comment"># config-location: classpath:mybatis-config.xml</span></span><br><span class="line">    <span class="attr">mapper-locations:</span> <span class="string">classpath*:**/mybatis-*.xml</span></span><br><span class="line">  <span class="comment">#type-aliases-package: cn.lll.tsp.model</span></span><br><span class="line">    <span class="attr">configuration:</span></span><br><span class="line">      <span class="attr">cache-enabled:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">use-actual-param-name:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#标识业务统计</span></span><br><span class="line"><span class="attr">stat:</span></span><br><span class="line">  <span class="attr">redis-ip:</span> <span class="number">114.67</span><span class="number">.117</span><span class="number">.77</span></span><br><span class="line">  <span class="attr">redis-pwd:</span> <span class="string">y0aoQ67K62pHrPjp</span></span><br><span class="line">  <span class="attr">redis-key:</span> <span class="string">IIC_STAT_SSP</span></span><br></pre></td></tr></table></figure>





<h1 id="4-AOP"><a href="#4-AOP" class="headerlink" title="4. AOP"></a>4. AOP</h1><p>动态代理实现：相比静态代理，同样需要target类实现接口，但无需手动定义proxy类实现同样的接口，而是定义动态代理器implements InvocationHandler</p>
<ol>
<li>动态处理器</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicProxy</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object object;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DynamicProxy</span><span class="params">(<span class="keyword">final</span> Object object)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                  System.out.println(<span class="string">&quot;执行前逻辑&quot;</span>);</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(object, args);</span><br><span class="line">                  System.out.println(<span class="string">&quot;执行后逻辑&quot;</span>);</span><br><span class="line">                   <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>测试类代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AnnotationConfigApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">        context.register(SpringConfig.class);</span><br><span class="line">        context.refresh();</span><br><span class="line">        <span class="comment">//获取接口实例</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">        <span class="comment">//动态创建实例的代理</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService)Proxy.newProxyInstance(UserService.class.getClassLoader(),</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;UserService.class&#125;, <span class="keyword">new</span> <span class="title class_">DynamicProxy</span>(service));</span><br><span class="line">        <span class="comment">//proxy执行方法</span></span><br><span class="line">        proxy.saveUser();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Proxy.newProxyInstance()的参数：</p>
<ul>
<li><strong>ClassLoader loader</strong>: 指定当前目标对象使用的类加载器，获取加载器的方法是固定的</li>
<li><strong>Class&lt;?&gt;[] interfaces</strong>: 指定目标对象实现的接口的类型，使用泛型方式确认类型</li>
<li><strong>InvocationHandler</strong>: 指定动态处理器，执行目标对象的方法时，会触发事件处理器的方法</li>
</ul>
<h1 id="5-IOC"><a href="#5-IOC" class="headerlink" title="5. IOC"></a>5. IOC</h1><h1 id="6-user-list-从html到mysql"><a href="#6-user-list-从html到mysql" class="headerlink" title="6. user-list 从html到mysql"></a>6. user-list 从html到mysql</h1><h2 id="6-1-router-cfg-js"><a href="#6-1-router-cfg-js" class="headerlink" title="6.1 router-cfg.js"></a>6.1 router-cfg.js</h2><p>vue.js 配置文件</p>
<p>第一部分：path与jsFile对应，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-list.js&quot;</span>&#125;,</span><br></pre></td></tr></table></figure>

<p>第二部分：组件的alias与component中的js对应，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;iic-table&quot;</span>: <span class="string">&quot;/components/iic-table/iic-table.js&quot;</span>,</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">RouterCfg</span> = [</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/home/home.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/home&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/home/home.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/update-pwd&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/home/update-pwd.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/account&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/home/account.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/account/manage-company-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/home/manage-company-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/type/usermod-type-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/type/usermod-type-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/type/usermod-type-add/:parentId&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/type/usermod-type-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/type/usermod-type-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/type/usermod-type-edit.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/datamod/usermod-datamod-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/datamod/usermod-datamod-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/datamod/usermod-datamod-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/datamod/usermod-datamod-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/datamod/usermod-datamod-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/datamod/usermod-datamod-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/datamod/usermod-datamod-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/datamod/usermod-datamod-info.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/detail&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-detail/han-handle-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/encrypt/detail&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/encrypt-handle/encrypt-handle-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/middleware/detail&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/middleware-handle/middleware-handle-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/user-handle&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/user-handle/han-user-handle.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/admin/user-handle/:account&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/user-handle/han-user-handle-admin.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/edit&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-edit/handle-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/create&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-create/handle-create.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/admin/create/:prefix&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-create/handle-create-admin.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/admin/create&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/han/handle-create/handle-create-admin.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-create-bus&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-create-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-delete-bus&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-delete-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-edit-bus&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-edit-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-detail-bus/:hanId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-detail-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-batch-create-process&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/admin-batch-create-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-batch-create/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-create-batch-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-batch-create/detail/:busId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-create-batch-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-bus.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/bus/han-error-bus&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/bus/han-error-bus.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/middleware/middleware-add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middleware/middleware-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/middleware/middleware-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middleware/middleware-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/middleware/middleware-detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middleware/middleware-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/middleware/bus-type-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middleware/handle-bus-type-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/usystem/usystem-add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/usystem/usystem-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/usystem/usystem-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/usystem/usystem-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/usystem/usystem-info/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/usystem/usystem-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/usystem/usystem-edit/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/usystem/usystem-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/system-api-add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/system-api/system-api-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/system-api-edit/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/system-api/system-api-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/system-api-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/system-api/system-api-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/system-api-info/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/system-api/system-api-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/:apiId/api-method-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/api-method/api-method-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/:apiId/api-method-add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/api-method/api-method-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/:apiId/api-method-edit/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/api-method/api-method-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/api/system-api/:apiId/api-method-info/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/api/api-method/api-method-info.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/file/upload&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/file/file-upload.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/file/mine&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/file/file-mine.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/file/detail/:fileId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/file/file-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-manage.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/record&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-record.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/record/detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-record-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/add&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/conf/edit/:confId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/conf/conf-edit.js&quot;</span>&#125;,</span><br><span class="line">    <span class="comment">//废弃开始 2021.3.31</span></span><br><span class="line">    <span class="comment">// &#123;path: &quot;/assit/sdk/home/&quot;, jsFile: &quot;/pages/assist/sdk-home.js&quot;&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;path: &quot;/assit/sdk/download/&quot;, jsFile: &quot;/pages/assist/sdk-download.js&quot;&#125;,</span></span><br><span class="line">    <span class="comment">// &#123;path: &quot;/assit/demo/download/&quot;, jsFile: &quot;/pages/assist/demo-download.js&quot;&#125;,</span></span><br><span class="line">    <span class="comment">//废弃结束</span></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/user/sdk-config/record&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-user-config.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/user/sdk-config/detail/:recordId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-user-config-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/user/sdk/renew-record&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-renew-record.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/sdk/edit/:sdkId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/sdk/detail/:sdkId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/sdk/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/sdk/sdk-manage.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#123;path: &quot;/assit/sdk-demo/download/&quot;, jsFile: &quot;/pages/assist/sdk-download.js&quot;&#125;,</span></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/middleware/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middlewareadmin/middleware-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/middleware/detail&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/middlewareadmin/middleware-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/user-system/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/user-system/usystem-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/user-system/detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/user-system/usystem-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/system-api/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/sapi-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/http-api/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/hapi-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/system-api/manage&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/sapi-manage.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/system-api/detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/sapi-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/http-api/detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/system-api/hapi-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/api-method/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/api-method/method-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/system-api/:apiId/api-method-info/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/apiadmin/api-method/method-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/log/login-log/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/logcenter/login-log-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/audit/user-action/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auditcenter/user-action-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/log/login-log/list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/log/login-log-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/audit/apply-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/apply-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/audit/apply-detail/:id&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/apply-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/audit/apply-edit/:id&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/apply-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/audit/audited-list&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/audited-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/audit/audited-record-detail/:id&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/audit/audited-record-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/admin/file/mine&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/filecenter/file-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&#x27;/admin/file/upload&#x27;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/filecenter/file-upload.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/file/detail/:fileId&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/filecenter/file-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/admin/auth/menu/menu-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auth/menu/menu-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/handle-data-type/handle-data-type-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/han/handle-data-type/handle-data-type-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/han/handle-extrainfo/handle-extrainfo-edit&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/han/handle-extrainfo/handle-extrainfo-edit.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-role/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-role.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/bind-company/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/user/user-bind-company.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/user/user-prefix&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/user/user/user-prefix.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/company-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/company-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/company-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/company-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/user/company/bind-user/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/user/company/company-bind-user.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/goods/goods-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/goods/goods-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/goods/goods/goods-detail/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/goods/goods/goods-detail.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/singlegoods/singlegoods-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/singlegoods/singlegoods-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/singlegoods/singlegoods-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/singlegoods/singlegoods-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/singlegoods/singlegoods-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/singlegoods/singlegoods-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/singlegoods/singlegoods-detail/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/singlegoods/singlegoods-detail.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/saleorder/saleorder-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/saleorder/saleorder-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/pay/pay-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/pay/pay-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>: <span class="string">&quot;/goods/pay/pay-saleorder/:id&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/goods/pay/pay-saleorder.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/goods/recharge/recharge-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/goods/recharge/recharge-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/system-viewmode-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/system-viewmode-list.js&quot;</span>&#125;,</span><br><span class="line">    <span class="comment">// &#123;path:&quot;/usermod/viewmod/viewmode-create&quot;, jsFile:&quot;/pages/usermod/viewmod/viewmode-create.js&quot;&#125;,</span></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/viewmode-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/viewmode-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-datacfg-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-datacfg-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-datacfg-create&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-datacfg-create.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-datacfg-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-datacfg-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-datacfg-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-datacfg-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-pageinfo-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-pageinfo-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-pageinfo-add&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-pageinfo-add.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/:vmId/viewmode-pageinfo-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/viewmod/viewmode-pageinfo-edit.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/system-staticfile-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/staticfile/system-staticfile-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/staticfile/staticfile-create&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/staticfile/staticfile-create.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/staticfile/staticfile-info/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/staticfile/staticfile-info.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/staticfile/staticfile-edit/:id&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/usermod/staticfile/staticfile-edit.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/usermod/viewmod/user/viewmod-market&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/usermod/viewmod-user/viewmod-market.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/admin/auth/menu/menu-list&quot;</span>, <span class="attr">jsFile</span>:<span class="string">&quot;/pages/auth/menu/menu-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/admin/auth/role/role-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auth/role/role-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/admin/auth/url/url-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auth/url/url-list.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/admin/auth/api/api-list&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/auth/api/api-list.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/home/admin-home&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/home/admin-home.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/home/user-home&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/home/user-home.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/admin/user-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/admin/user-statis.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/user/order-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/user/order-statis.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/user/body-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/user/body-statis.js&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/user/msg-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/user/msg-statis.js&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/statis/user/other-statis&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/statis/user/other-statis.js&quot;</span>&#125;,</span><br><span class="line">    </span><br><span class="line">    &#123;<span class="attr">path</span>:<span class="string">&quot;/error/403&quot;</span>, <span class="attr">jsFile</span>: <span class="string">&quot;/pages/error/403.js&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">//组件cfg</span></span><br><span class="line">seajs.<span class="title function_">config</span>(&#123;</span><br><span class="line">    <span class="attr">alias</span>:&#123;</span><br><span class="line">        <span class="string">&quot;iic-checkbox&quot;</span>: <span class="string">&quot;/components/iic-checkbox/iic-checkbox.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-radio&quot;</span>: <span class="string">&quot;/components/iic-radio/iic-radio.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-html&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-html.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-image&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-image.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-imagebig&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-imagebig.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-text&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-text.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-url&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-url.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-video&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-video.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamod-mgr&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-datamod-mgr.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-relateinfo-edit&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/iic-relateinfo-edit.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ri-index-select&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/el/ri-index-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ri-type-select&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/el/ri-type-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ri-row-btn&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/el/ri-row-btn.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ri-dm-win&quot;</span>: <span class="string">&quot;/components/iic-relateinfo-edit/el/ri-dm-win.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;dmr-index&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/dmr-index/dmr-index.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-dm-detail-win&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-dm-detail-win.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-relateinfo-type&quot;</span>: <span class="string">&quot;/components/iic-datamod-mgr/type/iic-relateinfo-type.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-file-upload&quot;</span>: <span class="string">&quot;/components/iic-file-upload/iic-file-upload.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-img-upload&quot;</span>: <span class="string">&quot;/components/iic-img-upload/iic-img-upload.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-date&quot;</span>: <span class="string">&quot;/components/iic-input-date/iic-input-date.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-datetime&quot;</span>: <span class="string">&quot;/components/iic-input-datetime/iic-input-datetime.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-email&quot;</span>: <span class="string">&quot;/components/iic-input-email/iic-input-email.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-int&quot;</span>: <span class="string">&quot;/components/iic-input-int/iic-input-int.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-number&quot;</span>: <span class="string">&quot;/components/iic-input-number/iic-input-number.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-mobile&quot;</span>: <span class="string">&quot;/components/iic-input-mobile/iic-input-mobile.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-text&quot;</span>: <span class="string">&quot;/components/iic-input-text/iic-input-text.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-code&quot;</span>: <span class="string">&quot;/components/iic-input-code/iic-input-code.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-search&quot;</span>: <span class="string">&quot;/components/iic-input-search/iic-input-search.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-page-split&quot;</span>: <span class="string">&quot;/components/iic-page-split/iic-page-split.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select&quot;</span>: <span class="string">&quot;/components/iic-select/iic-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select-input&quot;</span>: <span class="string">&quot;/components/iic-select-input/iic-select-input.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select-tree&quot;</span>: <span class="string">&quot;/components/iic-select-tree/iic-select-tree.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select-area&quot;</span>: <span class="string">&quot;/components/iic-select-area/iic-select-area.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-user-dmtype-tree&quot;</span>: <span class="string">&quot;/components/iic-user-dmtype-tree/iic-user-dmtype-tree.js&quot;</span>,</span><br><span class="line">        <span class="comment">//使用此组件需要引入 iic-vmod-list</span></span><br><span class="line">        <span class="string">&quot;iic-vmod-select&quot;</span>: <span class="string">&quot;/components/iic-vmod-select/iic-vmod-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-panel-top&quot;</span>: <span class="string">&quot;/components/iic-panel-top/iic-panel-top.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-table&quot;</span>: <span class="string">&quot;/components/iic-table/iic-table.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-tabs&quot;</span>: <span class="string">&quot;/components/iic-tabs/iic-tabs.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-tool-bars&quot;</span>: <span class="string">&quot;/components/iic-tool-bars/iic-tool-bars.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-form&quot;</span>: <span class="string">&quot;/components/iic-form/iic-form.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-select&quot;</span>: <span class="string">&quot;/components/iic-select/iic-input-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-html&quot;</span>: <span class="string">&quot;/components/iic-input-html/iic-input-html.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-textarea&quot;</span>: <span class="string">&quot;/components/iic-textarea/iic-input-textarea.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-readonly&quot;</span>: <span class="string">&quot;/components/iic-readonly/iic-readonly.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-file&quot;</span>: <span class="string">&quot;/components/iic-input-file/iic-input-file.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-apimethod-tree&quot;</span>: <span class="string">&quot;/components/iic-apimethod-tree/iic-apimethod-tree.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-apimethod-header&quot;</span>: <span class="string">&quot;/components/iic-apimethod-header/iic-apimethod-header.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-page-menu&quot;</span>: <span class="string">&quot;/components/iic-page-menu/iic-page-menu.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-other&quot;</span>: <span class="string">&quot;/components/iic-other/iic-other.js&quot;</span>,<span class="comment">//无法归类的杂组件</span></span><br><span class="line">        <span class="string">&quot;iic-file&quot;</span>: <span class="string">&quot;/components/iic-file/iic-file.js&quot;</span>,<span class="comment">//文件相关的杂组件</span></span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;iic-handle-detail-item&quot;</span>: <span class="string">&quot;/components/iic-handle-detail-item/iic-handle-detail-item.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-datamodel-select&quot;</span>: <span class="string">&quot;/components/iic-datamodel-select/iic-datamodel-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-viewmodel-select&quot;</span>: <span class="string">&quot;/components/iic-viewmodel-select/iic-viewmodel-select.js&quot;</span>,</span><br><span class="line">        <span class="comment">//此组件需要require(&#x27;iic-select-tree&#x27;); require(&#x27;iic-vmod-type-select&#x27;); require(&#x27;iic-table&#x27;);</span></span><br><span class="line">        <span class="string">&quot;iic-vmod-list&quot;</span>: <span class="string">&quot;/components/iic-vmod-list/iic-vmod-list.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-vmod-type-select&quot;</span>: <span class="string">&quot;/components/iic-vmod-type-select/iic-vmod-type-select.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-input-handle&quot;</span>: <span class="string">&quot;/components/iic-input-handle/iic-input-handle.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-admin-input-handle&quot;</span>: <span class="string">&quot;/components/iic-input-handle/iic-admin-input-handle.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iic-select-checktree&quot;</span>: <span class="string">&quot;/components/iic-select-checktree/iic-select-checktree.js&quot;</span>,</span><br><span class="line"></span><br><span class="line">        <span class="string">&quot;statis-base&quot;</span>: <span class="string">&quot;/pages/statis/statis-base.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256&quot;</span>: <span class="string">&quot;/assets/js/common/sha256.js&quot;</span>,</span><br><span class="line">        <span class="string">&quot;math&quot;</span>: <span class="string">&quot;/assets/libs/math/math.min.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





<h2 id="6-2-user-list-html"><a href="#6-2-user-list-html" class="headerlink" title="6.2 user-list.html"></a>6.2 user-list.html</h2><p>只展示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- start page title --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-12&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-title-box d-flex align-items-center justify-content-between&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">&quot;mb-0 font-size-18&quot;</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;page-title-right&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb m-0&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb-item&quot;</span>&gt;</span>用户中心<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;breadcrumb-item active&quot;</span>&gt;</span>用户管理<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- end page title --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-12&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-body&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 工具栏 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-6&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-toolbar&quot;</span> <span class="attr">role</span>=<span class="string">&quot;toolbar&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;go(&#x27;/user/user/user-add&#x27;)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        新增</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;edit(&#x27;/user/user/user-edit/&#123;id&#125;&#x27;)&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-edit&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        编辑</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;del()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-trash-alt&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        删除</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;refresh()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-recycle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                        刷新</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onClickCacheAllBus&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-recycle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>刷新所有业务</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;cacheAdmBus&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-recycle&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>刷新admin业务</span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-6&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;btn-group&quot;</span> <span class="attr">style</span>=<span class="string">&quot;float: right;&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-control form-control-sm&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;keyword&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;输入用户账户&quot;</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0)&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;queryByAcct()&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-primary waves-effect waves-light btn-sm&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 40px;&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fas fa-search&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">                                <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                                &lt;a href=&quot;javascript:void(0)&quot; class=&quot;btn btn-primary waves-effect waves-light btn-sm&quot; style=&quot;width: 100px; border-left-color:#ced4da;&quot;&gt;</span></span><br><span class="line"><span class="comment">                                    高级查询</span></span><br><span class="line"><span class="comment">                                &lt;/a&gt;</span></span><br><span class="line"><span class="comment">                                --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-responsive mt-3&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table mb-0 table-striped&quot;</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span> <span class="attr">scope</span>=<span class="string">&quot;col&quot;</span>  <span class="attr">style</span>=<span class="string">&quot;width: 50px;&quot;</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;custom-control custom-checkbox&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-input&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;selectAll&quot;</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-label&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onSelectAll()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>账号<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>昵称<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>账号状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>接入状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>接入语言<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>角色权限<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span>&gt;</span>注册时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">th</span> <span class="attr">width</span>=<span class="string">&quot;240&quot;</span>&gt;</span>操作<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                               <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;obj in datas&quot;</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;custom-control custom-checkbox&quot;</span>&gt;</span></span><br><span class="line">                                           <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-input&quot;</span> <span class="attr">:checked</span>=<span class="string">&quot;obj.selected&quot;</span> &gt;</span></span><br><span class="line">                                           <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;custom-control-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;customCheck1&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;onSelectOne(obj)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                                       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.userName&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.nickname&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                                      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;obj.status==1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-blank-circle text-success mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 有效<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                                      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;obj.status==-1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-blank-circle text-danger mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> 无效<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-if</span>=<span class="string">&quot;obj.accessStatus==1&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-blank-circle text-success mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>已接入<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-else</span>&gt;</span><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;mdi mdi-checkbox-blank-circle text-danger mr-1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span>未接入<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.language&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.roleNames | ls-string&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                                   <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;obj.createTime&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                   &lt;td&gt;--&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;<span class="name">iic-table-buttons</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">iic-table-button</span> <span class="attr">label</span>=<span class="string">&quot;查看&quot;</span> <span class="attr">cls</span>=<span class="string">&quot;btn btn-outline-info btn-sm&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickView(obj,&#x27;/user/user/user-info/&#x27;+obj.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">iic-table-button</span> <span class="attr">label</span>=<span class="string">&quot;编辑&quot;</span> <span class="attr">cls</span>=<span class="string">&quot;btn btn-outline-success btn-sm&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickEdit(obj,&#x27;/user/user/user-edit/&#x27;+obj.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;<span class="name">iic-table-button-more</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">iic-table-button-more-item</span> <span class="attr">label</span>=<span class="string">&quot;分配权限&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickView(obj,&#x27;/user/user/user-role/&#x27;+obj.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button-more-item</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">iic-table-button-more-item</span> <span class="attr">label</span>=<span class="string">&quot;关联企业&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickView(obj,&#x27;/user/user/bind-company/&#x27;+obj.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button-more-item</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">iic-table-button-more-item</span> <span class="attr">label</span>=<span class="string">&quot;删除&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickDel(obj,&#x27;/mgrapi/user/del&#x27;)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button-more-item</span>&gt;</span></span><br><span class="line">                                                <span class="tag">&lt;<span class="name">iic-table-button-more-item</span> <span class="attr">label</span>=<span class="string">&quot;刷新业务缓存&quot;</span> @<span class="attr">click.native</span>=<span class="string">&quot;onClickCacheBus(obj)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-button-more-item</span>&gt;</span></span><br><span class="line">                                            <span class="tag">&lt;/<span class="name">iic-table-button-more</span>&gt;</span></span><br><span class="line">                                        <span class="tag">&lt;/<span class="name">iic-table-buttons</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                      &lt;button type=&quot;button&quot; @click=&quot;go(&#x27;/user/user/user-info/&#123;id&#125;&#x27;,obj.id)&quot; class=&quot;btn btn-outline-info btn-sm&quot;&gt;查看&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                      &lt;button type=&quot;button&quot; @click=&quot;go(&#x27;/user/user/user-edit/&#123;id&#125;&#x27;,obj.id)&quot; class=&quot;btn btn-outline-success btn-sm&quot;&gt;编辑&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                      &lt;button type=&quot;button&quot; @click=&quot;go(&#x27;/user/user/user-role/&#123;id&#125;&#x27;,obj.id)&quot; class=&quot;btn btn-outline-info btn-sm&quot;&gt;分配权限&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                        &lt;button type=&quot;button&quot; @click=&quot;go(&#x27;/user/user/bind-company/&#123;id&#125;&#x27;,obj.id)&quot; class=&quot;btn btn-outline-success btn-sm&quot;&gt;关联企业&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                        &lt;button type=&quot;button&quot; @click=&quot;del(obj.id)&quot; class=&quot;btn btn-outline-danger btn-sm&quot;&gt;删除&lt;/button&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                                   &lt;/td&gt;--&gt;</span></span><br><span class="line">                               <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--分页--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">iic-table-page-split</span> <span class="attr">:totalRows</span>=<span class="string">&quot;pageInfo.recordTotal&quot;</span> <span class="attr">:pageSize</span>=<span class="string">&quot;pageInfo.pagesize&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;pageInfo.pageno&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;changePage&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iic-table-page-split</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- end row --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="6-3-user-list-js"><a href="#6-3-user-list-js" class="headerlink" title="6.3 user-list.js"></a>6.3 user-list.js</h2><p>通过template将js传入html</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tpl = <span class="built_in">require</span>(<span class="string">&#x27;./user-list.html&#x27;</span>); <span class="attr">template</span>: tpl</span><br></pre></td></tr></table></figure>



<p>SeaJs: CMD模块化</p>
<ol>
<li><p>通过require引入依赖，调用其他js模块(接口)</p>
</li>
<li><p>通过module.exports提供接口</p>
</li>
<li><p>Vue.extend创建Vue, 有参数: extends, props, data(function), watch, methods, template</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>,<span class="built_in">exports</span>,<span class="variable language_">module</span></span>)&#123;</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-panel-top&quot;</span>);</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-tool-bars&quot;</span>);</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-table&quot;</span>);</span><br><span class="line">   <span class="keyword">var</span> tpl = <span class="built_in">require</span>(<span class="string">&#x27;./user-list.html&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">      <span class="attr">extends</span>: <span class="title class_">IICBaseTable</span>,</span><br><span class="line">      <span class="attr">props</span>: [],</span><br><span class="line">        <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">datas</span>: [],</span><br><span class="line">            <span class="attr">pageInfo</span>: &#123;</span><br><span class="line">               <span class="attr">pagesize</span>: <span class="number">10</span>,</span><br><span class="line">               <span class="attr">pageno</span>: <span class="number">1</span>,</span><br><span class="line">               <span class="attr">recordTotal</span>: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">               <span class="attr">typeId</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">selectAll</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">watch</span>: &#123;</span><br><span class="line">         <span class="string">&#x27;$route&#x27;</span>: <span class="string">&#x27;initCom&#x27;</span>,</span><br><span class="line">         <span class="attr">keyword</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">//删除了查找关键字，回到第一页数据</span></span><br><span class="line">            <span class="keyword">if</span> ( !<span class="variable language_">this</span>.<span class="property">keyword</span>.<span class="title function_">trim</span>() ) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">changePage</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;</span><br><span class="line">           <span class="attr">initCom</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">loadData</span>();</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="title function_">queryByAcct</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">keyword</span>.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">               <span class="title class_">Iic</span>.<span class="title function_">showMessage</span>(<span class="string">&quot;请输入用户账号&quot;</span>);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pageInfo</span>.<span class="property">pageno</span> = <span class="number">1</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadData</span>(<span class="literal">true</span>);</span><br><span class="line">         &#125;,</span><br><span class="line">           <span class="attr">loadData</span>: <span class="keyword">function</span>(<span class="params">searchByAcct</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">            <span class="keyword">var</span> url = <span class="string">&#x27;./mgrapi/user/user-list&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (searchByAcct) &#123;</span><br><span class="line">               url += <span class="string">&quot;?usrAcct=&quot;</span> + <span class="title function_">encodeUrl</span>(<span class="variable language_">this</span>.<span class="property">keyword</span>);</span><br><span class="line">            &#125;</span><br><span class="line">              <span class="keyword">var</span> params = &#123;</span><br><span class="line">                 <span class="attr">pagesize</span>: _this.<span class="property">pageInfo</span>.<span class="property">pagesize</span>,</span><br><span class="line">                 <span class="attr">pageno</span>: _this.<span class="property">pageInfo</span>.<span class="property">pageno</span></span><br><span class="line">              &#125;;</span><br><span class="line">              <span class="title function_">ajaxPost</span>(url,params).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">                 _this.<span class="property">datas</span> = data.<span class="property">datas</span>;</span><br><span class="line">               _this.<span class="property">pageInfo</span>.<span class="property">recordTotal</span> = data.<span class="property">recordTotal</span>;</span><br><span class="line">               _this.<span class="property">selectAll</span> = <span class="literal">false</span>;</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">exeDel</span>: <span class="keyword">function</span>(<span class="params">ids</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">var</span> url = <span class="string">&#x27;./mgrapi/user/del&#x27;</span>;</span><br><span class="line">              <span class="keyword">var</span> params = &#123;<span class="attr">ids</span>:ids&#125;;</span><br><span class="line">              <span class="title function_">ajaxPost</span>(url,params).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                 _this.<span class="title function_">loadData</span>();</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           </span><br><span class="line">           <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">           <span class="comment">///////////////////////////////////  默认方法  //////////////////////////////////////////</span></span><br><span class="line">           <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">           <span class="attr">onSelectAll</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              _this.<span class="property">selectAll</span> = !_this.<span class="property">selectAll</span>;</span><br><span class="line">              _this.<span class="property">datas</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                 obj.<span class="property">selected</span> = _this.<span class="property">selectAll</span>;</span><br><span class="line">              &#125;);</span><br><span class="line">              _this.<span class="property">datas</span> = _this.<span class="property">datas</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">onSelectOne</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">              obj.<span class="property">selected</span> = !obj.<span class="property">selected</span>;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">datas</span> = <span class="variable language_">this</span>.<span class="property">datas</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">isSelected</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(obj.<span class="property">selected</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">go</span>: <span class="keyword">function</span>(<span class="params">url,id</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(id)&#123;</span><br><span class="line">                 url = url.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;id&#125;&#x27;</span>,id);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = url;</span><br><span class="line">         &#125;,</span><br><span class="line">          <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 跳转到指定页</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; pageNo </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="attr">changePage</span>: <span class="keyword">function</span>(<span class="params">pageNo</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pageInfo</span>.<span class="property">pageno</span> = pageNo;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadData</span>();</span><br><span class="line">            &#125;,</span><br><span class="line">           <span class="attr">edit</span>: <span class="keyword">function</span>(<span class="params">url,id</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">                 <span class="keyword">var</span> datas = <span class="variable language_">this</span>.<span class="title function_">_getSelectedData</span>();</span><br><span class="line">                 <span class="keyword">if</span>(datas.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                     <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;请选择要操作的记录&#x27;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                 <span class="keyword">if</span>(datas.<span class="property">length</span>&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;只能选择一条记录&#x27;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">                 id = datas[<span class="number">0</span>].<span class="property">id</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              url = url.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;id&#125;&#x27;</span>,id);</span><br><span class="line">              <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = url;</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">del</span>: <span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">var</span> ids = [];</span><br><span class="line">              </span><br><span class="line">              <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">                 <span class="keyword">var</span> datas = <span class="variable language_">this</span>.<span class="title function_">_getSelectedData</span>();</span><br><span class="line">                  <span class="keyword">if</span>(datas.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                     <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;请选择要删除的记录&#x27;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  datas.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                     ids.<span class="title function_">push</span>(obj.<span class="property">id</span>);</span><br><span class="line">                  &#125;);</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 ids=[id];</span><br><span class="line">              &#125;</span><br><span class="line">              </span><br><span class="line">              <span class="title function_">showConfrim</span>(<span class="string">&#x27;确定要删除吗?&#x27;</span>).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                  _this.<span class="title function_">exeDel</span>(ids.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>));</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">_getSelectedData</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> res = [];</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">datas</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                 <span class="keyword">if</span>(obj.<span class="property">selected</span>)&#123;</span><br><span class="line">                    res.<span class="title function_">push</span>(obj);</span><br><span class="line">                 &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">              <span class="keyword">return</span> res;</span><br><span class="line">           &#125;,</span><br><span class="line">            <span class="title function_">onClickCacheAllBus</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新所有业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">var</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache/all&#x27;</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&quot;任务提交成功&quot;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">onClickCacheBus</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache?username=&#x27;</span> + obj.<span class="property">userName</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&#x27;操作成功&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">cacheAdmBus</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache/adm&#x27;</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&#x27;任务提交成功&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">template</span>: tpl</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">define</span>(<span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>,<span class="built_in">exports</span>,<span class="variable language_">module</span></span>)&#123;</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-panel-top&quot;</span>);</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-tool-bars&quot;</span>);</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&quot;iic-table&quot;</span>);</span><br><span class="line">   <span class="keyword">var</span> tpl = <span class="built_in">require</span>(<span class="string">&#x27;./user-list.html&#x27;</span>);</span><br><span class="line">   </span><br><span class="line">   <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Vue</span>.<span class="title function_">extend</span>(&#123;</span><br><span class="line">      <span class="attr">extends</span>: <span class="title class_">IICBaseTable</span>,</span><br><span class="line">      <span class="attr">props</span>: [],</span><br><span class="line">        <span class="attr">data</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">datas</span>: [],</span><br><span class="line">            <span class="attr">pageInfo</span>: &#123;</span><br><span class="line">               <span class="attr">pagesize</span>: <span class="number">10</span>,</span><br><span class="line">               <span class="attr">pageno</span>: <span class="number">1</span>,</span><br><span class="line">               <span class="attr">recordTotal</span>: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">params</span>: &#123;</span><br><span class="line">               <span class="attr">typeId</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">selectAll</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">keyword</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">watch</span>: &#123;</span><br><span class="line">         <span class="string">&#x27;$route&#x27;</span>: <span class="string">&#x27;initCom&#x27;</span>,</span><br><span class="line">         <span class="attr">keyword</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="comment">//删除了查找关键字，回到第一页数据</span></span><br><span class="line">            <span class="keyword">if</span> ( !<span class="variable language_">this</span>.<span class="property">keyword</span>.<span class="title function_">trim</span>() ) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">changePage</span>(<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">methods</span>: &#123;</span><br><span class="line">           <span class="attr">initCom</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">loadData</span>();</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="title function_">queryByAcct</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">keyword</span>.<span class="title function_">trim</span>()) &#123;</span><br><span class="line">               <span class="title class_">Iic</span>.<span class="title function_">showMessage</span>(<span class="string">&quot;请输入用户账号&quot;</span>);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pageInfo</span>.<span class="property">pageno</span> = <span class="number">1</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadData</span>(<span class="literal">true</span>);</span><br><span class="line">         &#125;,</span><br><span class="line">           <span class="attr">loadData</span>: <span class="keyword">function</span>(<span class="params">searchByAcct</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">            <span class="keyword">var</span> url = <span class="string">&#x27;./mgrapi/user/user-list&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (searchByAcct) &#123;</span><br><span class="line">               url += <span class="string">&quot;?usrAcct=&quot;</span> + <span class="title function_">encodeUrl</span>(<span class="variable language_">this</span>.<span class="property">keyword</span>);</span><br><span class="line">            &#125;</span><br><span class="line">              <span class="keyword">var</span> params = &#123;</span><br><span class="line">                 <span class="attr">pagesize</span>: _this.<span class="property">pageInfo</span>.<span class="property">pagesize</span>,</span><br><span class="line">                 <span class="attr">pageno</span>: _this.<span class="property">pageInfo</span>.<span class="property">pageno</span></span><br><span class="line">              &#125;;</span><br><span class="line">              <span class="title function_">ajaxPost</span>(url,params).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">                 _this.<span class="property">datas</span> = data.<span class="property">datas</span>;</span><br><span class="line">               _this.<span class="property">pageInfo</span>.<span class="property">recordTotal</span> = data.<span class="property">recordTotal</span>;</span><br><span class="line">               _this.<span class="property">selectAll</span> = <span class="literal">false</span>;</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">exeDel</span>: <span class="keyword">function</span>(<span class="params">ids</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">var</span> url = <span class="string">&#x27;./mgrapi/user/del&#x27;</span>;</span><br><span class="line">              <span class="keyword">var</span> params = &#123;<span class="attr">ids</span>:ids&#125;;</span><br><span class="line">              <span class="title function_">ajaxPost</span>(url,params).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                 _this.<span class="title function_">loadData</span>();</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           </span><br><span class="line">           <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">           <span class="comment">///////////////////////////////////  默认方法  //////////////////////////////////////////</span></span><br><span class="line">           <span class="comment">///////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">           <span class="attr">onSelectAll</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              _this.<span class="property">selectAll</span> = !_this.<span class="property">selectAll</span>;</span><br><span class="line">              _this.<span class="property">datas</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                 obj.<span class="property">selected</span> = _this.<span class="property">selectAll</span>;</span><br><span class="line">              &#125;);</span><br><span class="line">              _this.<span class="property">datas</span> = _this.<span class="property">datas</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">onSelectOne</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">              obj.<span class="property">selected</span> = !obj.<span class="property">selected</span>;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">datas</span> = <span class="variable language_">this</span>.<span class="property">datas</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">isSelected</span>: <span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(obj.<span class="property">selected</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">go</span>: <span class="keyword">function</span>(<span class="params">url,id</span>)&#123;</span><br><span class="line">              <span class="keyword">if</span>(id)&#123;</span><br><span class="line">                 url = url.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;id&#125;&#x27;</span>,id);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = url;</span><br><span class="line">         &#125;,</span><br><span class="line">          <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 跳转到指定页</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; pageNo </span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="attr">changePage</span>: <span class="keyword">function</span>(<span class="params">pageNo</span>)&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">pageInfo</span>.<span class="property">pageno</span> = pageNo;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">loadData</span>();</span><br><span class="line">            &#125;,</span><br><span class="line">           <span class="attr">edit</span>: <span class="keyword">function</span>(<span class="params">url,id</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">                 <span class="keyword">var</span> datas = <span class="variable language_">this</span>.<span class="title function_">_getSelectedData</span>();</span><br><span class="line">                 <span class="keyword">if</span>(datas.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                     <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;请选择要操作的记录&#x27;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                 <span class="keyword">if</span>(datas.<span class="property">length</span>&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;只能选择一条记录&#x27;</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">                 id = datas[<span class="number">0</span>].<span class="property">id</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              url = url.<span class="title function_">replace</span>(<span class="string">&#x27;&#123;id&#125;&#x27;</span>,id);</span><br><span class="line">              <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span> = url;</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">del</span>: <span class="keyword">function</span>(<span class="params">id</span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> _this = <span class="variable language_">this</span>;</span><br><span class="line">              <span class="keyword">var</span> ids = [];</span><br><span class="line">              </span><br><span class="line">              <span class="keyword">if</span>(!id)&#123;</span><br><span class="line">                 <span class="keyword">var</span> datas = <span class="variable language_">this</span>.<span class="title function_">_getSelectedData</span>();</span><br><span class="line">                  <span class="keyword">if</span>(datas.<span class="property">length</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                     <span class="title function_">showErrAlert</span>(<span class="string">&#x27;操作错误&#x27;</span>,<span class="string">&#x27;请选择要删除的记录&#x27;</span>);</span><br><span class="line">                       <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  datas.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                     ids.<span class="title function_">push</span>(obj.<span class="property">id</span>);</span><br><span class="line">                  &#125;);</span><br><span class="line">              &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 ids=[id];</span><br><span class="line">              &#125;</span><br><span class="line">              </span><br><span class="line">              <span class="title function_">showConfrim</span>(<span class="string">&#x27;确定要删除吗?&#x27;</span>).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                  _this.<span class="title function_">exeDel</span>(ids.<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>));</span><br><span class="line">              &#125;);</span><br><span class="line">           &#125;,</span><br><span class="line">           <span class="attr">_getSelectedData</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">              <span class="keyword">var</span> res = [];</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">datas</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                 <span class="keyword">if</span>(obj.<span class="property">selected</span>)&#123;</span><br><span class="line">                    res.<span class="title function_">push</span>(obj);</span><br><span class="line">                 &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">              <span class="keyword">return</span> res;</span><br><span class="line">           &#125;,</span><br><span class="line">            <span class="title function_">onClickCacheAllBus</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新所有业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">var</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache/all&#x27;</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&quot;任务提交成功&quot;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">onClickCacheBus</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache?username=&#x27;</span> + obj.<span class="property">userName</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&#x27;操作成功&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="title function_">cacheAdmBus</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">showConfrim</span>(<span class="string">&#x27;确认刷新业务缓存&#x27;</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">const</span> url = <span class="string">&#x27;/mgrapi/user/bus/cache/adm&#x27;</span>;</span><br><span class="line">                    <span class="title function_">ajaxPost</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">rs</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="title function_">showSuccAlert</span>(<span class="string">&#x27;任务提交成功&#x27;</span>);</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">template</span>: tpl</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="6-4-MgrUserController"><a href="#6-4-MgrUserController" class="headerlink" title="6.4 MgrUserController"></a>6.4 MgrUserController</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.swagger.annotations.ApiOperation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.controller.JsonResult;</span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.exception.BusException;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.ListPageVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.MgrBaseController;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.model.RoleVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.model.UserVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.service.IMgrUserService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/mgrapi/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MgrUserController</span> <span class="keyword">extends</span> <span class="title class_">MgrBaseController</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Log</span> <span class="variable">log</span> <span class="operator">=</span> LogFactory.getLog(MgrUserController.class);</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IMgrUserService iMgrUserService;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;读取用户列表&quot;, notes = &quot;读取用户列表&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/user-list&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">loadUserList</span><span class="params">(Integer pagesize, Integer pageno, String usrAcct)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         ListPageVo&lt;UserVo&gt; vo = iMgrUserService.loadUserList(pagesize, pageno, usrAcct);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(vo, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;添加用户&quot;, notes = &quot;添加用户&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/add&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">add</span><span class="params">(UserVo vo)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         iMgrUserService.addUser(vo);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;添加成功&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;读取用户详细信息&quot;, notes = &quot;读取用户详细信息&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/detail&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">loadUserDetail</span><span class="params">(String id)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="type">UserVo</span> <span class="variable">vo</span> <span class="operator">=</span> iMgrUserService.loadUserDetail(id);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(vo,<span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;读取所有角色&quot;, notes = &quot;读取所有角色&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/load-all-user-role&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">loadAllUserRole</span><span class="params">(String userId)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         List&lt;RoleVo&gt; datas = iMgrUserService.loadAllUserRole(userId);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(datas, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;修改用户角色&quot;, notes = &quot;修改用户角色&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update-user-role&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">updateUserRole</span><span class="params">(String userId, String roles)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         iMgrUserService.updateUserRole(userId, roles);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;删除用户&quot;, notes = &quot;删除用户&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/del&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">deleteUser</span><span class="params">(String ids)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         iMgrUserService.deleteUser(ids);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@ApiOperation(value = &quot;修改用户&quot;, notes = &quot;修改用户&quot;, httpMethod = &quot;POST&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/update-user&quot;, method = RequestMethod.POST)</span></span><br><span class="line">   <span class="keyword">public</span> JsonResult <span class="title function_">updateUser</span><span class="params">(UserVo vo)</span>&#123;</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">         iMgrUserService.updateUser(vo);</span><br><span class="line">         </span><br><span class="line">         <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(BusException ex)&#123;</span><br><span class="line">         log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">         <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//将某用户的标识业务id接入redis</span></span><br><span class="line">   <span class="meta">@PostMapping(path = &quot;/bus/cache&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">cacheBus</span><span class="params">(<span class="meta">@RequestParam</span> String username)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            iMgrUserService.cacheBus(username);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BusException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将admin的标识业务id接入redis</span></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/bus/cache/adm&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">cacheAllBusForAdm</span><span class="params">()</span>&#123;</span><br><span class="line">        iMgrUserService.cacheAdmBus();</span><br><span class="line">        <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将所有非admin用户的标识业务id接入redis</span></span><br><span class="line">    <span class="meta">@PostMapping(path = &quot;/bus/cache/all&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> JsonResult <span class="title function_">cacheAllBus</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            iMgrUserService.cacheAllBus();</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createSuccess(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BusException ex) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            <span class="keyword">return</span> JsonResult.createFail(ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-5-IMgrUserService"><a href="#6-5-IMgrUserService" class="headerlink" title="6.5 IMgrUserService"></a>6.5 IMgrUserService</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.lll.framework.exception.BusException;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.common.ListPageVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.model.RoleVo;</span><br><span class="line"><span class="keyword">import</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.model.UserVo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IMgrUserService</span></span><br></pre></td></tr></table></figure>

<h2 id="6-6-MgrUserServiceImpl"><a href="#6-6-MgrUserServiceImpl" class="headerlink" title="6.6 MgrUserServiceImpl"></a>6.6 MgrUserServiceImpl</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.ssp.mgr.<span class="keyword">module</span>.admin.user.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MgrUserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IMgrUserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Log</span> <span class="variable">LOG</span> <span class="operator">=</span> LogFactory.getLog(MgrUserServiceImpl.class);</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssUserTeUserService iGdssUserTeUserService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssUserTsUserCompanyService iGdssUserTsUserCompanyService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IGdssUserTeCompanyService iGdssUserTeCompanyService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssCfgTeConfigService iGdssCfgTeConfigService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssAuthTeRoleService iGdssAuthTeRoleService;</span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> IGdssAuthTsUserRoleService iGdssAuthTsUserRoleService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ISecService iSecService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ICfgService iCfgService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor threadPoolExecutor;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IGdssSecTeKeyService iGdssSecTeKeyService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IGdssBusTeApiBusinessService iGdssBusTeApiBusinessService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IGdssStatTeHistoryAmountsDayMwService iGdssStatTeHistoryAmountsDayMwService;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> ListPageVo&lt;UserVo&gt; <span class="title function_">loadUserList</span><span class="params">(Integer pagesize, Integer pageno, String usrAcct)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      </span><br><span class="line">      <span class="type">GdssUserTeUser</span> <span class="variable">params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTeUser</span>();</span><br><span class="line">      params.setOrderBy(<span class="string">&quot; CREATE_TIME DESC&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (!StringUtil.isEmpty(usrAcct))&#123;</span><br><span class="line">         params.setUserName(usrAcct);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      List&lt;GdssUserTeUser&gt; ls = iGdssUserTeUserService.searchEntity(params, pagesize, pageno);</span><br><span class="line">      </span><br><span class="line">      List&lt;UserVo&gt; datas = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;UserVo&gt;();</span><br><span class="line">      <span class="keyword">for</span>(GdssUserTeUser user : ls)&#123;</span><br><span class="line">         <span class="type">UserVo</span> <span class="variable">v</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVo</span>();</span><br><span class="line">         v.setId(user.getId());</span><br><span class="line">         v.setUserName(StringUtil.trim(user.getUserName()));</span><br><span class="line">         v.setNickname(StringUtil.trim(user.getNickname()));</span><br><span class="line">         v.setStatus(user.getStatus());</span><br><span class="line">         <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> v.getUserName();</span><br><span class="line">         v.setLanguage(<span class="built_in">this</span>.getLan(username));</span><br><span class="line"></span><br><span class="line">         v.setMobile(StringUtil.trim(user.getMobile()));</span><br><span class="line">         v.setEmail(StringUtil.trim(user.getEmail()));</span><br><span class="line">         v.setAuthMobile(user.getAuthMobile());</span><br><span class="line">         v.setAuthEmail(user.getAuthEmail());</span><br><span class="line">         v.setCreateTime(user.getCreateTime());</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//读取用户角色</span></span><br><span class="line">         List&lt;GdssAuthTeRoleDao&gt; roles = iGdssAuthTeRoleService.searchUserRoleByUserId(user.getId());</span><br><span class="line">         List&lt;String&gt; roleCodes = roles.stream().map(item -&gt; item.getCode()).collect(Collectors.toList());</span><br><span class="line">         List&lt;String&gt; roleNames = roles.stream().map(item -&gt; item.getName()).collect(Collectors.toList());</span><br><span class="line">         v.setRoleCodes(roleCodes);</span><br><span class="line">         v.setRoleNames(roleNames);</span><br><span class="line">         </span><br><span class="line">         datas.add(v);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="type">int</span> <span class="variable">recordTotal</span> <span class="operator">=</span> iGdssUserTeUserService.count(params);</span><br><span class="line">      <span class="comment">//绑定接入状态</span></span><br><span class="line">        bindAccessStatus(datas);</span><br><span class="line">      <span class="keyword">return</span> ListPageVo.create(datas, recordTotal);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">private</span>  String <span class="title function_">getLan</span><span class="params">(String username)</span>&#123;</span><br><span class="line">      <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> username.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">      String[] lanArr = <span class="string">&quot;Java,C++,Java,Java,C#,Java,PHP,Java,Java,Go,C++,Java,Java,Java,Java,Node.js,Java&quot;</span>.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (index &gt; <span class="number">0</span>)&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">suffix</span> <span class="operator">=</span> username.substring(index+<span class="number">1</span>);</span><br><span class="line">         <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> ToolUtil.parseInt(suffix,<span class="number">0</span>) % lanArr.length;</span><br><span class="line">         <span class="type">String</span> <span class="variable">lan</span> <span class="operator">=</span> lanArr[count];</span><br><span class="line">         <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.251&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.288&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.200&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;C#&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.313&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.263&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;PHP&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (username.equals(<span class="string">&quot;88.168.352&quot;</span>))&#123;</span><br><span class="line">            lan = <span class="string">&quot;C++&quot;</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span> lan;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span>  <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="comment">//绑定接入状态</span></span><br><span class="line">   <span class="keyword">private</span> List&lt;UserVo&gt; <span class="title function_">bindAccessStatus</span><span class="params">(List&lt;UserVo&gt; datas)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">       <span class="keyword">if</span> (datas == <span class="literal">null</span> || datas.isEmpty()) <span class="keyword">return</span> datas;</span><br><span class="line"></span><br><span class="line">       Set&lt;String&gt; userIds = datas.stream().map(item -&gt; item.getId()).collect(Collectors.toSet());</span><br><span class="line">       <span class="comment">//查询关联企业</span></span><br><span class="line">        <span class="type">GdssUserTsUserCompany</span> <span class="variable">tsParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTsUserCompany</span>();</span><br><span class="line">        tsParam.setUserIdIn(userIds);</span><br><span class="line">        List&lt;GdssUserTsUserCompany&gt; tsList = iGdssUserTsUserCompanyService.searchEntity(tsParam, <span class="number">10_000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (tsList == <span class="literal">null</span> || tsList.isEmpty()) <span class="keyword">return</span> datas;</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; companyIds = tsList.stream().map(item -&gt; item.getCompanyId()).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//查前缀</span></span><br><span class="line">        <span class="type">GdssUserTeCompany</span> <span class="variable">companyParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTeCompany</span>();</span><br><span class="line">        companyParam.setIdIn(companyIds);</span><br><span class="line">        List&lt;GdssUserTeCompany&gt; companyList = iGdssUserTeCompanyService.searchEntity(companyParam, <span class="number">10_000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (companyList == <span class="literal">null</span> || companyList.isEmpty()) <span class="keyword">return</span> datas;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; userTsMwCodeMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        Set&lt;String&gt; allMwCodes = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="type">String</span> <span class="variable">appEnv</span> <span class="operator">=</span> SpringUtil.getEnvironment();</span><br><span class="line">        <span class="keyword">for</span> (UserVo userVo : datas) &#123;</span><br><span class="line">            List&lt;String&gt; companyIdList = tsList.stream().filter(item -&gt; item.getUserId().equals( userVo.getId() ))</span><br><span class="line">                    .map(item -&gt; item.getCompanyId()).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//筛选前缀</span></span><br><span class="line">            List&lt;String&gt; mwCodes = companyList.stream().filter(item -&gt; companyIdList.contains( item.getId() ))</span><br><span class="line">                    .map(item -&gt; HandleUtil.getMwCodeByPrefix(item.getHandle(), appEnv)).collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">if</span> ( !mwCodes.isEmpty() )&#123;</span><br><span class="line">                userTsMwCodeMap.put(userVo.getId(), mwCodes);</span><br><span class="line">                allMwCodes.addAll(mwCodes);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查统计信息</span></span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">now</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        <span class="type">GdssStatTeHistoryAmountsDayMw</span> <span class="variable">statParam</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssStatTeHistoryAmountsDayMw</span>();</span><br><span class="line">        statParam.setYearer( now.get(Calendar.YEAR) );</span><br><span class="line">        statParam.setMonther( now.get(Calendar.MONTH) + <span class="number">1</span> );</span><br><span class="line">        statParam.setDateer( now.get(Calendar.DAY_OF_MONTH) );</span><br><span class="line">        statParam.setMwCodeIn(allMwCodes);</span><br><span class="line">        List&lt;GdssStatTeHistoryAmountsDayMw&gt; statList = iGdssStatTeHistoryAmountsDayMwService.searchEntity(statParam, <span class="number">10_000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (statList == <span class="literal">null</span> || statList.isEmpty()) <span class="keyword">return</span> datas;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (UserVo userVo : datas) &#123;</span><br><span class="line">            List&lt;String&gt; userMwCodes = userTsMwCodeMap.get( userVo.getId() );</span><br><span class="line">            <span class="keyword">if</span> (userMwCodes == <span class="literal">null</span> || userMwCodes.isEmpty()) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            List&lt;GdssStatTeHistoryAmountsDayMw&gt; tempStat = statList.stream().filter(item -&gt; userMwCodes.contains( item.getMwCode() )).collect(Collectors.toList());</span><br><span class="line">            <span class="keyword">if</span> ( tempStat.isEmpty() ) <span class="keyword">continue</span>;</span><br><span class="line">            userVo.setAccessStatus(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> datas;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(UserVo vo)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 判断账号是否重复</span></span><br><span class="line">      <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> iGdssUserTeUserService.isRepeatUserName(vo.getUserName());</span><br><span class="line">      <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;00400013&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 从配置中心读取用户默认密码</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> <span class="built_in">this</span>.readDefaultPwd();</span><br><span class="line">      pwd = Base64Util.String2SHA256(pwd);</span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 创建用户</span></span><br><span class="line">      <span class="type">GdssUserTeUser</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTeUser</span>();</span><br><span class="line">      BeanUtils.copyProperties(vo, user);</span><br><span class="line"></span><br><span class="line">      user.setUserName(StringUtil.trim(user.getUserName()));</span><br><span class="line">      user.setMobile(StringUtil.trim(user.getMobile()));</span><br><span class="line">      user.setEmail(StringUtil.trim(user.getEmail()));</span><br><span class="line">      user.setNickname(StringUtil.trim(user.getNickname()));</span><br><span class="line">      user.setPwd(pwd);</span><br><span class="line">      user.setStatus(GdssUserTeUser.Info.STATUS_VALID);</span><br><span class="line">      user.setAuthMobile(<span class="number">0</span>);</span><br><span class="line">      user.setAuthEmail(<span class="number">0</span>);</span><br><span class="line">      user.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        user.setAlteredPwd( (<span class="type">byte</span>)<span class="number">0</span> );</span><br><span class="line">      user.setId( UUID.getUUID() );</span><br><span class="line">      </span><br><span class="line">      iGdssUserTeUserService.addEntity(user);</span><br><span class="line">      <span class="comment">//如果是系统管理员,则默认分配系统管理员角色</span></span><br><span class="line">      <span class="keyword">if</span>(user.getType()==GdssUserTeUser.Info.TYPE_SYSTEM)&#123;</span><br><span class="line">         <span class="type">GdssAuthTeRoleDao</span> <span class="variable">role</span> <span class="operator">=</span> iGdssAuthTeRoleService.getEntityByCode(<span class="string">&quot;system&quot;</span>);</span><br><span class="line">         <span class="type">GdssAuthTsUserRole</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssAuthTsUserRole</span>();</span><br><span class="line">         r.setRoleId(role.getId());</span><br><span class="line">         r.setUserId(user.getId());</span><br><span class="line">         iGdssAuthTsUserRoleService.addEntity(r);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//如果是一般用户，默认分配一般用户角色</span></span><br><span class="line">      <span class="keyword">if</span>(user.getType()==GdssUserTeUser.Info.TYPE_COMMON)&#123;</span><br><span class="line">         <span class="type">GdssAuthTeRoleDao</span> <span class="variable">role</span> <span class="operator">=</span> iGdssAuthTeRoleService.getEntityByCode(<span class="string">&quot;common&quot;</span>);</span><br><span class="line">         <span class="type">GdssAuthTsUserRole</span> <span class="variable">r</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssAuthTsUserRole</span>();</span><br><span class="line">         r.setRoleId(role.getId());</span><br><span class="line">         r.setUserId(user.getId());</span><br><span class="line">         iGdssAuthTsUserRoleService.addEntity(r);</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="comment">//<span class="doctag">TODO:</span> 创建用户密钥</span></span><br><span class="line">        iSecService.createUserKeyPair(vo.getUserName(), user.getId());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> UserVo <span class="title function_">loadUserDetail</span><span class="params">(String id)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">GdssUserTeUser</span> <span class="variable">user</span> <span class="operator">=</span> iGdssUserTeUserService.getEntityById(id);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//读取用户账号关联的角色</span></span><br><span class="line">      List&lt;GdssAuthTeRoleDao&gt; roles = iGdssAuthTeRoleService.searchUserRoleByUserId(id);</span><br><span class="line">      List&lt;String&gt; roleCodes = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt; (roles.size() );</span><br><span class="line">      List&lt;String&gt; roleNames = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;( roles.size() );</span><br><span class="line">      <span class="keyword">for</span>(GdssAuthTeRoleDao role : roles)&#123;</span><br><span class="line">         roleCodes.add(role.getCode());</span><br><span class="line">         roleNames.add(role.getName());</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="type">UserVo</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVo</span>();</span><br><span class="line">        BeanUtils.copyProperties(user, vo);</span><br><span class="line">      vo.setRoleCodes(roleCodes);</span><br><span class="line">      vo.setRoleNames(roleNames);</span><br><span class="line">      <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> vo.getUserName();</span><br><span class="line">      vo.setLanguage(<span class="built_in">this</span>.getLan(username));</span><br><span class="line">      <span class="comment">//绑定</span></span><br><span class="line">        bindAccessStatus( Arrays.asList(vo) );</span><br><span class="line">      <span class="keyword">return</span> vo;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> List&lt;RoleVo&gt; <span class="title function_">loadAllUserRole</span><span class="params">(String userId)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">GdssAuthTeRoleDao</span> <span class="variable">params</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssAuthTeRoleDao</span>();</span><br><span class="line">      params.setOrderBy(<span class="string">&quot; CODE ASC&quot;</span>);</span><br><span class="line">      List&lt;GdssAuthTeRoleDao&gt; all = iGdssAuthTeRoleService.searchEntity(params,<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">      </span><br><span class="line">      List&lt;GdssAuthTsUserRole&gt; roles = iGdssAuthTsUserRoleService.searchByUserId(userId);</span><br><span class="line">      </span><br><span class="line">      List&lt;RoleVo&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;RoleVo&gt;();</span><br><span class="line">      <span class="keyword">for</span>(GdssAuthTeRoleDao role : all)&#123;</span><br><span class="line">         <span class="type">RoleVo</span> <span class="variable">vo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleVo</span>();</span><br><span class="line">         vo.setId(role.getId());</span><br><span class="line">         vo.setCode(role.getCode());</span><br><span class="line">         vo.setName(role.getName());</span><br><span class="line">         vo.setRemark(role.getRemark());</span><br><span class="line">         </span><br><span class="line">         <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">         <span class="keyword">for</span>(GdssAuthTsUserRole r : roles)&#123;</span><br><span class="line">            <span class="keyword">if</span>(r.getRoleId().equals(role.getId()))&#123;</span><br><span class="line">               flag = <span class="literal">true</span>;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            vo.setAuth(RoleVo.Info.AUTH_YES);</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            vo.setAuth(RoleVo.Info.AUTH_NO);</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         res.add(vo);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUserRole</span><span class="params">(String userId, String roles)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 删除账号所有角色</span></span><br><span class="line">      iGdssAuthTsUserRoleService.deleteByUserId(userId);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//<span class="doctag">TODO:</span> 添加关联的角色</span></span><br><span class="line">      String[] roleIds = roles.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;roleIds.length;i++)&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">roleId</span> <span class="operator">=</span> roleIds[i];</span><br><span class="line">         <span class="type">GdssAuthTsUserRole</span> <span class="variable">role</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssAuthTsUserRole</span>();</span><br><span class="line">         role.setUserId(userId);</span><br><span class="line">         role.setRoleId(roleId);</span><br><span class="line">         iGdssAuthTsUserRoleService.addEntity(role);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(String ids)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      String[] idArg = ids.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="comment">//如果包含超级管理员，则报错</span></span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;idArg.length;i++)&#123;</span><br><span class="line">         <span class="keyword">if</span>(GdssUserTeUser.ID_ADMIN.equals(idArg[i]))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;00400022&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> idArg[i];</span><br><span class="line">         List&lt;GdssUserTsUserCompany&gt; list = iGdssUserTsUserCompanyService.searchByUserId(id);</span><br><span class="line">         <span class="keyword">if</span>(list!=<span class="literal">null</span>&amp;&amp;list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;00430010&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;idArg.length;i++)&#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> idArg[i];</span><br><span class="line">         <span class="comment">//删除相关的角色关系</span></span><br><span class="line">         iGdssAuthTsUserRoleService.deleteByUserId(id);</span><br><span class="line">            <span class="type">GdssUserTeUser</span> <span class="variable">thisUser</span> <span class="operator">=</span> iGdssUserTeUserService.getEntityById(id);</span><br><span class="line">         <span class="comment">//删除用户</span></span><br><span class="line">         iGdssUserTeUserService.delEntityById(id, <span class="literal">null</span>);</span><br><span class="line">         <span class="keyword">if</span> (thisUser != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//删除企业的密钥</span></span><br><span class="line">                iGdssSecTeKeyService.deleteByUsername(thisUser.getUserName());</span><br><span class="line">            &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(UserVo vo)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">      <span class="type">GdssUserTeUser</span> <span class="variable">user</span> <span class="operator">=</span> iGdssUserTeUserService.getEntityById(vo.getId());</span><br><span class="line">      <span class="keyword">if</span>(user==<span class="literal">null</span>)&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusException</span>(<span class="string">&quot;00000005&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      user.setNickname(StringUtil.trim(vo.getNickname()));</span><br><span class="line">      user.setMobile(StringUtil.trim(vo.getMobile()));</span><br><span class="line">      user.setEmail(StringUtil.trim(vo.getEmail()));</span><br><span class="line">      user.setAuditPower( vo.getAuditPower() );</span><br><span class="line">      iGdssUserTeUserService.updateEntityById(user, user.getId(), user.getId());</span><br><span class="line">      </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> String <span class="title function_">readDefaultPwd</span><span class="params">()</span> <span class="keyword">throws</span> BusException&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">cfgCode</span> <span class="operator">=</span> <span class="string">&quot;SSP_USER_DEFAULT_PWD&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> iCfgService.getCfgString(cfgCode);</span><br><span class="line">        <span class="keyword">if</span> (!StringUtil.isEmpty(pwd))&#123;</span><br><span class="line">            <span class="keyword">return</span> pwd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">GdssCfgTeConfig</span> <span class="variable">cfg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssCfgTeConfig</span>();</span><br><span class="line">        cfg.setCode(cfgCode);</span><br><span class="line">        cfg.setCfgValue(<span class="string">&quot;gdxx688&quot;</span>);</span><br><span class="line">        cfg.setRemark(<span class="string">&quot;用户默认密码&quot;</span>);</span><br><span class="line">        cfg = iGdssCfgTeConfigService.addEntity(cfg);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> cfg.getCfgValue();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheBus</span><span class="params">(String username)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">       <span class="keyword">if</span> (GdssUserTeUser.Info.ADM_USERNAME.equals(username))&#123;</span><br><span class="line">           threadPoolExecutor.submit(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cacheBusByUser(username);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (BusException e) &#123; LOG.error(<span class="string">&quot;&quot;</span>, e); &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cacheBusByUser(username);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cacheBusByUser</span><span class="params">(String username)</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">       <span class="keyword">if</span> ( ToolUtil.isNull(username) ) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">       Map&lt;String, List&lt;String&gt;&gt; codeKeyMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">        codeKeyMap.put(GdssBusTeApiBusiness.Info.CACHE_BUS_API2_CREATE_PREFIX, Arrays.asList(ApiCodeEnum.CREATE_IDENTIFIER.name()));</span><br><span class="line">        codeKeyMap.put(GdssBusTeApiBusiness.Info.CACHE_BUS_API2_MODIFY_PREFIX, Arrays.asList(ApiCodeEnum.ADD_IDENTIFIER_ATTR.name(), ApiCodeEnum.MODIFY_IDENTIFIER_ATTR.name(), ApiCodeEnum.REMOVE_IDENTIFIER_ATTR.name()) );</span><br><span class="line">        codeKeyMap.put(GdssBusTeApiBusiness.Info.CACHE_BUS_API2_DEL_PREFIX, Arrays.asList(ApiCodeEnum.REMOVE_IDENTIFIER.name()) );</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;String&gt;&gt; entry : codeKeyMap.entrySet()) &#123;</span><br><span class="line">            List&lt;String&gt; codes = entry.getValue();</span><br><span class="line">            <span class="type">GdssBusTeApiBusiness</span> <span class="variable">param</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssBusTeApiBusiness</span>();</span><br><span class="line">            param.setUsername(username);</span><br><span class="line">            param.setApiCodeList(codes);</span><br><span class="line">            param.setOrderBy(<span class="string">&quot;CREATE_TIME desc&quot;</span>);</span><br><span class="line">            List&lt;GdssBusTeApiBusiness&gt; businessesList = iGdssBusTeApiBusinessService.searchEntity(param, GdssBusTeApiBusiness.Info.BUS_API_CACHE_LIMIT, <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (businessesList == <span class="literal">null</span> || businessesList.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey() + username;</span><br><span class="line">            List&lt;List&lt;String&gt;&gt; idHandleList = businessesList.stream().map(item -&gt; Arrays.asList(item.getId(), item.getHandle())).collect(Collectors.toList());</span><br><span class="line">            saveBusToRedis(key, idHandleList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveBusToRedis</span><span class="params">(String key, List&lt;List&lt;String&gt;&gt; cacheList)</span>&#123;</span><br><span class="line">        redisTemplate.execute(<span class="keyword">new</span> <span class="title class_">SessionCallback</span>&lt;List&lt;Object&gt;&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">execute</span><span class="params">(RedisOperations operations)</span> <span class="keyword">throws</span> DataAccessException &#123;</span><br><span class="line">                operations.multi();</span><br><span class="line">                operations.delete(key);</span><br><span class="line">                <span class="keyword">if</span> ( !cacheList.isEmpty() )&#123;</span><br><span class="line">                    operations.opsForList().rightPushAll(key, cacheList);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> operations.exec();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheAdmBus</span><span class="params">()</span> &#123;</span><br><span class="line">       threadPoolExecutor.submit(() -&gt; &#123;</span><br><span class="line">           <span class="comment">//admin成功</span></span><br><span class="line">            <span class="type">GdssBusTeApiBusiness</span> <span class="variable">param</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssBusTeApiBusiness</span>();</span><br><span class="line">            param.setResult(ApiBusinessInstance.Info.RESULT_SUCCESS);</span><br><span class="line">            param.setOrderBy(<span class="string">&quot;CREATE_TIME desc&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                List&lt;GdssBusTeApiBusiness&gt; businessesList = iGdssBusTeApiBusinessService.searchEntity(param, GdssBusTeApiBusiness.Info.BUS_API_CACHE_LIMIT, <span class="number">1</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> GdssBusTeApiBusiness.Info.CACHE_BUS_API2_SUC_PREFIX + GdssUserTeUser.Info.ADM_USERNAME;</span><br><span class="line">                cacheAdminBusToRedis(businessesList, key);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">                LOG.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//admin错误业务</span></span><br><span class="line">            param.setResult(ApiBusinessInstance.Info.RESULT_FAILURE);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                List&lt;GdssBusTeApiBusiness&gt; businessesList = iGdssBusTeApiBusinessService.searchEntity(param, GdssBusTeApiBusiness.Info.BUS_API_CACHE_LIMIT, <span class="number">1</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> GdssBusTeApiBusiness.Info.CACHE_BUS_API2_ERROR_PREFIX + GdssUserTeUser.Info.ADM_USERNAME;</span><br><span class="line">                cacheAdminBusToRedis(businessesList, key);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception ex)&#123;</span><br><span class="line">                LOG.error(<span class="string">&quot;&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cacheAdminBusToRedis</span><span class="params">(List&lt;GdssBusTeApiBusiness&gt; businessesList, String key)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (businessesList != <span class="literal">null</span> &amp;&amp; !businessesList.isEmpty())&#123;</span><br><span class="line">            List&lt;List&lt;String&gt;&gt; idHandleList = businessesList.stream().map(item -&gt; Arrays.asList(item.getId(), item.getHandle())).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">//先push，再清除</span></span><br><span class="line">            saveBusToRedis(key, idHandleList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cacheAllBus</span><span class="params">()</span> <span class="keyword">throws</span> BusException &#123;</span><br><span class="line">        <span class="comment">//查所有开通普通用户</span></span><br><span class="line">        <span class="type">GdssUserTeUser</span> <span class="variable">param</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GdssUserTeUser</span>();</span><br><span class="line">        param.setType(GdssUserTeUser.Info.TYPE_COMMON);</span><br><span class="line">        param.setStatus(GdssUserTeUser.Info.STATUS_VALID);</span><br><span class="line">        List&lt;GdssUserTeUser&gt; userList = iGdssUserTeUserService.searchEntity(param, <span class="number">10_000</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (userList == <span class="literal">null</span> || userList.isEmpty()) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        threadPoolExecutor.submit(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (GdssUserTeUser user : userList) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    cacheBusByUser( user.getUserName() );</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ex)&#123; LOG.error(<span class="string">&quot;&quot;</span>, ex); &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-7-IGdssUserTeUserService"><a href="#6-7-IGdssUserTeUserService" class="headerlink" title="6.7 IGdssUserTeUserService"></a>6.7 IGdssUserTeUserService</h2><p>usercenter-dao-service  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.user.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGdssUserTeUserService</span> <span class="keyword">extends</span> <span class="title class_">ILllDbRedisBaseService</span>&lt;GdssUserTeUser&gt;</span><br></pre></td></tr></table></figure>

<h2 id="6-8-GdssUserTeUserServiceImpl"><a href="#6-8-GdssUserTeUserServiceImpl" class="headerlink" title="6.8 GdssUserTeUserServiceImpl"></a>6.8 GdssUserTeUserServiceImpl</h2><p>usercenter-dao-service-impl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.user.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GdssUserTeUserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">IGdssUserTeUserService</span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> IGdssUserTeUserMapper iGdssUserTeUserMapper;</span><br><span class="line">	</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="6-9-IGdssUserTeUserMapper"><a href="#6-9-IGdssUserTeUserMapper" class="headerlink" title="6.9 IGdssUserTeUserMapper"></a>6.9 IGdssUserTeUserMapper</h2><p>usercenter-dao-mapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.lll.iic.user.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IGdssUserTeUserMapper</span> <span class="keyword">extends</span> <span class="title class_">ILllBaseMapper</span>&lt;GdssUserTeUser&gt;</span><br></pre></td></tr></table></figure>



<h2 id="6-10-mybatis-GdssUserTeUser-xml"><a href="#6-10-mybatis-GdssUserTeUser-xml" class="headerlink" title="6.10 mybatis-GdssUserTeUser.xml"></a>6.10 mybatis-GdssUserTeUser.xml</h2><p>usercenter-dao-resource</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;cn.lll.iic.user.mapper.IGdssUserTeUserMapper&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;GdssUserTeUserMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;cn.lll.iic.user.model.GdssUserTeUser&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/unusable-index/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/unusable-index/">1</a><span class="space">&hellip;</span><a class="page-number" href="/unusable-index/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/unusable-index/page/6/">6</a><a class="extend next" rel="next" href="/unusable-index/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">invincible-nerd</p>
  <div class="site-description" itemprop="description">For explorer everywhere</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022-04 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">invincible-nerd</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">632k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:34</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
