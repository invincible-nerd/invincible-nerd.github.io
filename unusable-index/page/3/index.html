<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"invincible-nerd.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="For explorer everywhere">
<meta property="og:type" content="website">
<meta property="og:title" content="IVN">
<meta property="og:url" content="http://invincible-nerd.github.io/unusable-index/page/3/index.html">
<meta property="og:site_name" content="IVN">
<meta property="og:description" content="For explorer everywhere">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="invincible-nerd">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://invincible-nerd.github.io/unusable-index/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>IVN</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">IVN</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/12/13/quotes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/13/quotes/" class="post-title-link" itemprop="url">quotes</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-13 22:04:00" itemprop="dateCreated datePublished" datetime="2022-12-13T22:04:00+08:00">2022-12-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-14 14:42:07" itemprop="dateModified" datetime="2022-12-14T14:42:07+08:00">2022-12-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index"><span itemprop="name">随笔</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Let no feeling of discouragement prey upon you, and in the end you are sure to succeed.</p>
<p>​                                                                                <em>Abraham Lincoln</em></p>
</blockquote>
<blockquote>
<p>You become responsible, forever, for what you have tamed.</p>
<p>​                                                                                <em>Oscar Wilde</em></p>
</blockquote>
<blockquote>
<p>Laziness is nothing more than the habit of resting before you get tired.</p>
<p>​                                                                                <em>Jules Renard</em></p>
</blockquote>
<blockquote>
<p>A day without laughter is a day wasted.</p>
<p>​                                                                                <em>Charlie Chaplin</em></p>
</blockquote>
<blockquote>
<p>Knowledge speaks, but wisdom listens.</p>
<p>​                                                                                <em>Jimi Hendrix</em></p>
</blockquote>
<blockquote>
<p>Life is something that happens when you can’t get to sleep.</p>
<p>​                                                                                <em>Fran Lebowitz</em></p>
</blockquote>
<blockquote>
<p>Truth is more of a stranger than fiction.</p>
<p>​                                                                                <em>Fran Lebowitz</em></p>
</blockquote>
<blockquote>
<p>Everyone is a moon and has a dark side which he never shows to anybody.</p>
<p>​                                                                                <em>Mark Twain</em></p>
</blockquote>
<blockquote>
<p>Art is making something out of nothing and selling it.</p>
<p>​                                                                                <em>Frank Zappa</em></p>
</blockquote>
<blockquote>
<p>Better to write for yourself and have no public, than to write for the public and have no self.</p>
<p>​                                                                                <em>Cyril Connolly</em></p>
</blockquote>
<blockquote>
<p>It is our choices that show what we truly are, far more than our abilities.</p>
<p>​                                                                                <em>J. K. Rowling</em></p>
</blockquote>
<blockquote>
<p>Everything is funny as long as it is happening to somebody else.</p>
<p>​                                                                                <em>Will Rogers</em></p>
</blockquote>
<blockquote>
<p>When you have eliminated the impossible, whatever remains, however improbable, must be the truth.</p>
<p>​                                                                                <em>Sir Arthur Conan Doyle</em></p>
</blockquote>
<blockquote>
<p>A good novel tells us the truth about its hero; but a bad novel tells us the truth about its author.</p>
<p>​                                                                                <em>G. K. Chesterton</em></p>
</blockquote>
<blockquote>
<p>Famous remarks are very seldom quoted correctly.</p>
<p>​                                                                                <em>Simeon Strunsky</em></p>
</blockquote>
<blockquote>
<p>The two most important days in your life are the day you are born and the day you find out why.</p>
<p>​                                                                                <em>Mark Twain</em></p>
</blockquote>
<blockquote>
<p>The two most important days in your life are the day you are born and the day you find out why.</p>
<p>​                                                                                <em>Mark Twain</em></p>
</blockquote>
<blockquote>
<p>Fashion is a form of ugliness so intolerable that we have to alter it every six months.</p>
<p>​                                                                                <em>Oscar Wilde</em></p>
</blockquote>
<blockquote>
<p>Education’s purpose is to replace an empty mind with an open one.</p>
<p>​                                                                                <em>Malcolm Forbes</em></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/12/11/Segment-Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/11/Segment-Tree/" class="post-title-link" itemprop="url">Segment Tree</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-12 12:13:47" itemprop="dateCreated datePublished" datetime="2022-12-12T12:13:47+08:00">2022-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-28 13:53:12" itemprop="dateModified" datetime="2022-12-28T13:53:12+08:00">2022-12-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Segment-Tree选编"><a href="#Segment-Tree选编" class="headerlink" title="Segment Tree选编"></a>Segment Tree选编</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>如何表示线段树？</p>
<ol>
<li>直接用node构造一棵树</li>
<li>用一个数组模拟一棵树</li>
</ol>
<p>三大功能：</p>
<ol>
<li>build</li>
<li>querySum</li>
<li>update</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NumArray</span> &#123;</span><br><span class="line">    SegmentTree tree;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NumArray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        tree = <span class="keyword">new</span> <span class="title class_">SegmentTree</span>(nums);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        tree.update(i, val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumRange</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> tree.querySum(i, j);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SegmentTree</span>&#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">root</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        SegmentTree(<span class="type">int</span>[] array)&#123;</span><br><span class="line">            <span class="built_in">this</span>.root = build(<span class="number">0</span>, array.length-<span class="number">1</span>, array);</span><br><span class="line">        &#125;</span><br><span class="line">        Node <span class="title function_">build</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end, <span class="type">int</span>[] array)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (start&gt;end)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(start, end);</span><br><span class="line">            <span class="keyword">if</span> (start==end)&#123;</span><br><span class="line">                node.sum = array[start];</span><br><span class="line">                <span class="keyword">return</span> node;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> start + (end-start)/<span class="number">2</span>;</span><br><span class="line">            node.left = build(start, mid, array);</span><br><span class="line">            node.right = build(mid+<span class="number">1</span>, end, array);</span><br><span class="line">            node.sum = node.left.sum + node.right.sum;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="title function_">querySum</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> querySum(root, start, end);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="title function_">querySum</span><span class="params">(Node root, <span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (start&gt;end)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (root.start==start &amp;&amp; root.end==end)&#123;</span><br><span class="line">                <span class="keyword">return</span> root.sum;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> root.start + (root.end-root.start)/<span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">leftsum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">rightsum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (start&lt;=mid)&#123;</span><br><span class="line">                leftsum = querySum(root.left, start, Math.min(mid, end));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (end&gt;=mid+<span class="number">1</span>)&#123;</span><br><span class="line">                rightsum = querySum(root.right, Math.max(mid+<span class="number">1</span>, start), end);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> leftsum+rightsum;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> value)</span>&#123;</span><br><span class="line">            update(root, index, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Node root, <span class="type">int</span> index, <span class="type">int</span> value)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (root.start==index &amp;&amp; root.end==index)&#123;</span><br><span class="line">                root.sum = value;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> root.start + (root.end-root.start)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (index &lt;= mid)&#123;</span><br><span class="line">                update(root.left, index, value);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                update(root.right, index, value);</span><br><span class="line">            &#125;</span><br><span class="line">            root.sum = root.left.sum + root.right.sum;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&#123;</span><br><span class="line">        <span class="type">int</span> start;</span><br><span class="line">        <span class="type">int</span> end;</span><br><span class="line">        <span class="type">int</span> sum;</span><br><span class="line">        Node left;</span><br><span class="line">        Node right;</span><br><span class="line">        Node(<span class="type">int</span> start, <span class="type">int</span> end)&#123;</span><br><span class="line">            <span class="built_in">this</span>.start = start;</span><br><span class="line">            <span class="built_in">this</span>.end = end;</span><br><span class="line">            sum = <span class="number">0</span>;</span><br><span class="line">            left = <span class="literal">null</span>;</span><br><span class="line">            right = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="327-Count-of-Range-Sum"><a href="#327-Count-of-Range-Sum" class="headerlink" title="327. Count of Range Sum"></a>327. Count of Range Sum</h2><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/count-of-range-sum/discuss/1674377/Java-Segment-Tree-With-Explanation">https://leetcode.com/problems/count-of-range-sum/discuss/1674377/Java-Segment-Tree-With-Explanation</a></p>
<p>prefix_sum超时，考虑用segment_tree</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Time Limit Exceeded</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countRangeSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lower, <span class="type">int</span> upper)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=nums.length;</span><br><span class="line">    <span class="comment">//pres[i]=[0,i]=pres[i-1]+nums[i]</span></span><br><span class="line">    <span class="type">long</span>[] pres=<span class="keyword">new</span> <span class="title class_">long</span>[n];</span><br><span class="line">    pres[<span class="number">0</span>]=nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        pres[i]=pres[i-<span class="number">1</span>]+nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//sums(i,j)=[0,j]-[0,i-1]=pres[j]-pres[i-1]</span></span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="type">long</span> sum= i==<span class="number">0</span> ? pres[j] : pres[j]-pres[i-<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(sum&gt;=lower &amp;&amp; sum&lt;=upper)&#123;</span><br><span class="line">                res++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p><a target="_blank" rel="noopener" href="https://leetcode.cn/problems/count-of-range-sum/solution/by-ac_oier-b36o/">https://leetcode.cn/problems/count-of-range-sum/solution/by-ac_oier-b36o/</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    树状数组模板</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;    <span class="comment">// 树状数组索引</span></span><br><span class="line">    <span class="type">int</span>[] tr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">3</span> * <span class="number">100010</span>]; <span class="comment">// 树状数组节点(数目等于元素坑位数)</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">lowBit</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x &amp; -x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 往u坑位加上x</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> u; i &lt;= idx; i += lowBit(i)) &#123;</span><br><span class="line">            tr[i] += x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询[1,x]前缀和</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">query</span><span class="params">(<span class="type">int</span> u)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> u; i &gt; <span class="number">0</span>; i -= lowBit(i)) &#123;</span><br><span class="line">            res += tr[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countRangeSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lower, <span class="type">int</span> upper)</span> &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        离散化+树状数组:</span></span><br><span class="line"><span class="comment">        题目原意:给定数组nums,寻找nums中区间和在[lower,upper]的区间sum[i,j]个数</span></span><br><span class="line"><span class="comment">        设当前区间区间为[i,j],移动j指针,我们只需要的求出每个以j结尾的区间有多少个是区间和在[lower,upper]即可</span></span><br><span class="line"><span class="comment">        朴素的解法中我们可以扫描k∈[0,i-1],求适合的k有多少个,时间复杂度综合为O(N^2)</span></span><br><span class="line"><span class="comment">        逆向思维,我们把目光放在[0,k]区间上,设sum[0,i]=sum[0,k]+sum[k+1,i]=s</span></span><br><span class="line"><span class="comment">        其中lower&lt;=sum[k+1,i]&lt;=upper --&gt; lower&lt;=s-sum[0,k]&lt;=upper --&gt; s-upper&lt;=sum[0,k]&lt;=s-lower</span></span><br><span class="line"><span class="comment">        我们把问题就转化为了求在[0,i-1]区间内前缀和为[s-upper,s-lower]的个数</span></span><br><span class="line"><span class="comment">        求前缀和&quot;个数&quot;,同时前缀和的值域范围爆炸,我们把可能出现的前缀和直接离散化分散到特定数据结构</span></span><br><span class="line"><span class="comment">        然后统计[s-upper,s-lower]范围内的前缀和个数可以抽象成 前面前缀和出现了就在对应坑位数目+1 ,然后再进行区间求和</span></span><br><span class="line"><span class="comment">        此处要想在O(logN)内求出某个区间的和(前缀和作差得到)就要用到树状数组</span></span><br><span class="line"><span class="comment">        前缀和可能出现的情况数目为:3*1e5</span></span><br><span class="line"><span class="comment">        总体时间复杂度:O(NlogN) 空间复杂度:O(N)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">// 将前缀和进行去重</span></span><br><span class="line">        HashSet&lt;Long&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();    <span class="comment">// 存储可能出现的前缀和</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">preSum</span> <span class="operator">=</span> <span class="number">0L</span>;</span><br><span class="line">        set.add(<span class="number">0L</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">            preSum += num;</span><br><span class="line">            set.add(preSum);</span><br><span class="line">            set.add(preSum - upper);</span><br><span class="line">            set.add(preSum - lower);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 排序并离散化</span></span><br><span class="line">        List&lt;Long&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(set);</span><br><span class="line">        Collections.sort(list);</span><br><span class="line">        HashMap&lt;Long, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();   <span class="comment">// 存储某个前缀和对应的索引</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> sum : list) map.put(sum, ++idx);   <span class="comment">// 树状数组索引从1开始</span></span><br><span class="line">        preSum = <span class="number">0L</span>;</span><br><span class="line">        add(map.get(preSum), <span class="number">1</span>);    <span class="comment">// 初始化前缀和为0的坑位+1</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">            preSum += num;</span><br><span class="line">            <span class="comment">// a 为前缀和preSum-lower对应坑位; b 为前缀和preSum-upper对应坑位</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> map.get(preSum - lower), b = map.get(preSum - upper);</span><br><span class="line">            res += query(a) - query(b - <span class="number">1</span>); <span class="comment">// 累加[preSum-upper,preSum-lower]前缀和个数</span></span><br><span class="line">            <span class="comment">// 记得是先求完前缀和个数再更新,保证树状数组是[0,i-1]状态下的</span></span><br><span class="line">            add(map.get(preSum), <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/12/04/COEN317/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/04/COEN317/" class="post-title-link" itemprop="url">COEN317</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-04 22:20:42" itemprop="dateCreated datePublished" datetime="2022-12-04T22:20:42+08:00">2022-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-05 14:22:15" itemprop="dateModified" datetime="2022-12-05T14:22:15+08:00">2022-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="COEN-317-Distributed-system"><a href="#COEN-317-Distributed-system" class="headerlink" title="COEN 317     Distributed system"></a>COEN 317     Distributed system</h1><h2 id="09-x2F-21"><a href="#09-x2F-21" class="headerlink" title="09&#x2F;21"></a>09&#x2F;21</h2><h3 id="layer-tier"><a href="#layer-tier" class="headerlink" title="layer tier"></a>layer tier</h3><ul>
<li>layer: software</li>
<li>tier: hardware</li>
</ul>
<h3 id="layerd-architecture-style"><a href="#layerd-architecture-style" class="headerlink" title="layerd architecture style"></a>layerd architecture style</h3><ul>
<li>separation of concerns</li>
<li>unnecessary transaction</li>
<li>grey line, hard to decide which layer to put</li>
</ul>
<h3 id="event-based-architecture-styles"><a href="#event-based-architecture-styles" class="headerlink" title="event based architecture styles"></a>event based architecture styles</h3><ul>
<li>dynamic</li>
<li>at the beginning, each component don’t know who to communicate to</li>
<li>after that, can point-to-point</li>
</ul>
<h3 id="middleware"><a href="#middleware" class="headerlink" title="middleware"></a>middleware</h3><ul>
<li>libararies, runtime environment</li>
<li>JVM</li>
</ul>
<h3 id="blocking"><a href="#blocking" class="headerlink" title="blocking"></a>blocking</h3><ul>
<li><p>sent&#x2F;transmission !&#x3D; reach the destination</p>
</li>
<li><p>blocking: suspended until transmission finishes</p>
</li>
<li><p>transmission:  IT DEPENDS!</p>
<ol>
<li><p>sending message buffer</p>
</li>
<li><p>channel</p>
</li>
<li><p>receiving messsage buffer</p>
</li>
</ol>
</li>
</ul>
<h3 id="persistent-communication"><a href="#persistent-communication" class="headerlink" title="persistent communication"></a>persistent communication</h3><ul>
<li>message queue</li>
<li>need to store data</li>
</ul>
<h3 id="asynchronous"><a href="#asynchronous" class="headerlink" title="asynchronous"></a>asynchronous</h3><ul>
<li>synchronous: wait unitl <strong>delivery</strong>, not process of the data</li>
</ul>
<h3 id="soft-state"><a href="#soft-state" class="headerlink" title="soft state"></a>soft state</h3><p>cache</p>
<h2 id="09-x2F-26"><a href="#09-x2F-26" class="headerlink" title="09&#x2F;26"></a>09&#x2F;26</h2><ul>
<li><p>application-specific protocol</p>
</li>
<li><p>application-independent protocol: </p>
<p><strong>middleware</strong></p>
</li>
<li><p>TCP&#x2F;IP protocol:</p>
<p>local OS</p>
</li>
</ul>
<h3 id="why-layered"><a href="#why-layered" class="headerlink" title="why layered?"></a>why layered?</h3><p>separation of concerns</p>
<h3 id="OSI-reference-model"><a href="#OSI-reference-model" class="headerlink" title="OSI reference model"></a>OSI reference model</h3><ol>
<li><p>application</p>
</li>
<li><p>presentation</p>
<ul>
<li>process information for applications</li>
<li>serialization&#x2F;deserialization</li>
<li>encryption&#x2F;decryption</li>
</ul>
</li>
<li><p>session</p>
</li>
<li><p>transport</p>
<ul>
<li>end-to-end communication between different applications</li>
</ul>
</li>
<li><p>network</p>
<ul>
<li>routing packets</li>
</ul>
</li>
<li><p>data link</p>
<ul>
<li>send, detect and corrent data frames</li>
<li>data frames: units of bits</li>
</ul>
</li>
<li><p>physical layer</p>
<ul>
<li>actual transfer of binary bits data</li>
</ul>
</li>
</ol>
<p>​          </p>
<h3 id="TCP-x2F-IP-protocol-suite"><a href="#TCP-x2F-IP-protocol-suite" class="headerlink" title="TCP&#x2F;IP protocol suite"></a>TCP&#x2F;IP protocol suite</h3><ol>
<li><p>application</p>
<ul>
<li>HTTP, FTP, SMTP</li>
<li>process-to-process</li>
</ul>
</li>
<li><p>transport</p>
<ul>
<li>TCP, UDP</li>
<li>host-to-host</li>
</ul>
</li>
<li><p>internet</p>
<ul>
<li><p>IP</p>
</li>
<li><p>routing table</p>
<p>host a-&gt; router -&gt; router -&gt; host b</p>
</li>
</ul>
</li>
<li><p>link</p>
</li>
</ol>
<p>​        </p>
<h3 id="TCP-UDP"><a href="#TCP-UDP" class="headerlink" title="TCP UDP"></a>TCP UDP</h3><ul>
<li><p>TCP</p>
<p>data in streams</p>
</li>
<li><p>UDP</p>
<p>data in messages</p>
</li>
</ul>
<h3 id="remote-procedure-calls"><a href="#remote-procedure-calls" class="headerlink" title="remote procedure calls"></a>remote procedure calls</h3><p>remote invocation</p>
<ul>
<li>one-way RPC</li>
<li>asynchronous RPC</li>
</ul>
<h3 id="remote-object-calls"><a href="#remote-object-calls" class="headerlink" title="remote object calls"></a>remote object calls</h3><h3 id="message-brokers"><a href="#message-brokers" class="headerlink" title="message brokers"></a>message brokers</h3><ul>
<li><p>between clients and servers</p>
</li>
<li><p>beyond simple queues</p>
</li>
<li><p>message will be persistent</p>
</li>
</ul>
<h3 id="socket-APIs"><a href="#socket-APIs" class="headerlink" title="socket APIs"></a>socket APIs</h3><ul>
<li>transport-level socket programming via socket interface</li>
<li>message-oriented transient communication at the <strong>transport layer</strong></li>
</ul>
<h3 id="Messaging-passing-interface"><a href="#Messaging-passing-interface" class="headerlink" title="Messaging-passing interface"></a>Messaging-passing interface</h3><ul>
<li>message-oriented transient communication at the <strong>application layer</strong></li>
</ul>
<h3 id="queuing-model"><a href="#queuing-model" class="headerlink" title="queuing model"></a>queuing model</h3><ul>
<li><p>message-oriented persistent communication</p>
</li>
<li><p>asynchronous&#x2F;time uncoupling</p>
</li>
<li><p>advanced message queuing protocol</p>
<p>rabbitMQ</p>
</li>
</ul>
<h2 id="0928"><a href="#0928" class="headerlink" title="0928"></a>0928</h2><h3 id="why-some-inaccuracy-is-tolerable"><a href="#why-some-inaccuracy-is-tolerable" class="headerlink" title="why some inaccuracy is tolerable?"></a>why some inaccuracy is tolerable?</h3><ol>
<li>more than one failure detection mechanism</li>
<li>in heart-beating, after some times it will correct itself</li>
</ol>
<h3 id="atomic-gt-reliable"><a href="#atomic-gt-reliable" class="headerlink" title="atomic &gt; reliable"></a>atomic &gt; reliable</h3><ul>
<li>atomic: all or none receive the message   <strong>overkill</strong></li>
<li>reliable: we can tolerate some inaccuracy</li>
</ul>
<h3 id="centralized-heart-beating-out-of-consideration"><a href="#centralized-heart-beating-out-of-consideration" class="headerlink" title="centralized heart-beating   out of consideration!"></a>centralized heart-beating   out of consideration!</h3><ul>
<li>single point  &#x2F;   performance</li>
<li>too much workload for the center node</li>
<li>can not be dynamic:  the center needs to know the global state</li>
<li>saturated</li>
</ul>
<h3 id="ring-heart-beating-valid"><a href="#ring-heart-beating-valid" class="headerlink" title="ring heart-beating  valid"></a>ring heart-beating  valid</h3><ul>
<li>predecessor and successor</li>
<li>what if 2 nodes fail?     stablization protocol</li>
<li>detection is too slow</li>
</ul>
<h3 id="all-to-all-heart-beating-valid"><a href="#all-to-all-heart-beating-valid" class="headerlink" title="all-to-all heart-beating    valid"></a>all-to-all heart-beating    valid</h3><ul>
<li>full of unnecessary message</li>
<li>can not be dynamic</li>
</ul>
<h3 id="false-positive-x2F-false-negative"><a href="#false-positive-x2F-false-negative" class="headerlink" title="false positive  &#x2F;   false negative"></a>false positive  &#x2F;   false negative</h3><ul>
<li>inaccurate</li>
<li>incomplete!   intolerable</li>
</ul>
<h3 id="local-buffers-processes-and-channels"><a href="#local-buffers-processes-and-channels" class="headerlink" title="local buffers   processes and channels"></a>local buffers   processes and channels</h3><ul>
<li>copy message to outgoing message buffer   send</li>
<li>copy message from incoming message buffer   receive</li>
<li>latency: in channel and in operation system</li>
</ul>
<h3 id="process-failure-x2F-channel-failure"><a href="#process-failure-x2F-channel-failure" class="headerlink" title="process failure &#x2F; channel failure"></a>process failure &#x2F; channel failure</h3><h2 id="1003"><a href="#1003" class="headerlink" title="1003"></a>1003</h2><h3 id="virtualization"><a href="#virtualization" class="headerlink" title="virtualization"></a>virtualization</h3><ul>
<li>Virtual Machine Memory &#x3D; Hypervisor</li>
</ul>
<ol>
<li><p>platform virtualization, hosted VM<br>shared OS</p>
<ol>
<li>hardware</li>
<li>host OS<br>Patch, upgrade together</li>
<li>hypervisor, virtualizing the OS</li>
<li>applications, limited(no kernel module)<br>example: Linux container<br>host OS adminstrater sees everything! not fully isolated!<br>reboot OS? all down!</li>
</ol>
</li>
<li><p>full virtualization, native VM<br>independent guest OS</p>
<ol>
<li>hardware</li>
<li>hypervisor, virtualizing the hardware</li>
<li>virtual hardwares, including VCPU, VNIC</li>
<li>guest OSs(Windows, Linux, MacOS)</li>
<li>applications<br>fully isolated!<br>less scalable<br>better performance</li>
</ol>
</li>
<li><p>combined<br>within each guest OS, platform virtualization(virtualzing some guest OS)</p>
</li>
</ol>
<h3 id="network-address-translation"><a href="#network-address-translation" class="headerlink" title="network address translation"></a>network address translation</h3><p>NIC: Network Interface Control<br>NAT: Network address translation<br>hardware: MAC, Media Access Control<br>VMs: MACs<br>query NAT table for every connection<br>improvement: SRIOV</p>
<h4 id="SRIOV"><a href="#SRIOV" class="headerlink" title="SRIOV"></a>SRIOV</h4><p>integrate NAT into NIC<br>PCIe: Peripheral Component Interconnect express     chip-to-chip interconnect<br>Ethernet: via cables                                system-to-system</p>
<h3 id="network-bridging"><a href="#network-bridging" class="headerlink" title="network bridging"></a>network bridging</h3><p>poor scalability<br>bridge over the hypervisor for better performance</p>
<h3 id="host-only-networking"><a href="#host-only-networking" class="headerlink" title="host only networking"></a>host only networking</h3><p>inter instance communication, VM to VM</p>
<h2 id="1005"><a href="#1005" class="headerlink" title="1005"></a>1005</h2><h3 id="P2P-exmaple-Napster"><a href="#P2P-exmaple-Napster" class="headerlink" title="P2P exmaple: Napster"></a>P2P exmaple: Napster</h3><ul>
<li>server <ol>
<li>stores no files</li>
<li>maintains a table</li>
<li>response with where to download the music(IP address, port)</li>
</ol>
</li>
<li>client stores their own data</li>
<li>server search: <strong>ternary tree</strong> algorithm</li>
<li>problem:<ol>
<li>infringement of copyright</li>
<li>security : each peer exposes a port; clear-text communication</li>
<li>fault-tolerance: centralized server, centralized algorithm<br><strong>single point of failure</strong></li>
</ol>
</li>
</ul>
<h3 id="Distributed-Hash-Table"><a href="#Distributed-Hash-Table" class="headerlink" title="Distributed Hash Table"></a>Distributed Hash Table</h3><ul>
<li><p>objects: files</p>
</li>
<li><p>bucket: nodes</p>
</li>
<li><p>hash function: consistent hashing    <strong>hash ring</strong><br>SHA-1(<strong>filename</strong> IP address, port)  &#x3D;&gt; 160-bit string(key) <strong>m bits</strong><br>may use leader-election algorithm</p>
</li>
<li><p>routing mechanism: </p>
<ul>
<li>routing: all operations, including <strong>insert, lookup and delete</strong></li>
<li>each node knows its successor and predecessor <strong>node id: 0~pow(2,m)-1</strong></li>
<li>each node computes a finger table(routing table, nodes it knows)</li>
<li>if doesn’t have the file(after local search), querying, <strong>each step halves the distance O(log(N))</strong><ol>
<li>go(forward) to the farthest node in finger table, but no crossing the key</li>
<li>if none exist, send query to successor</li>
</ol>
</li>
<li>all query steps are RPCs</li>
</ul>
</li>
<li><p>search under peer failures</p>
<ul>
<li>one solution: maintain <strong>(r)</strong> more than one successor entries instead of one <ul>
<li>if one query fails, go to the next successor</li>
<li>sender’s finger table not yet corrected</li>
</ul>
</li>
<li>one solution: replicate file&#x2F;key at r successors and predecessors</li>
</ul>
</li>
<li><p>new peers joining  (dynamic changes <strong>churn</strong>)</p>
<ul>
<li>stablization protocol followed by all nodes    <strong>stablization algorithm</strong><ul>
<li>periodically check and update</li>
<li>ensure non-loopiness</li>
</ul>
</li>
<li>copy keys and update finger table</li>
<li>bandwidth cost   busy network</li>
<li>alternatives: store and replicate only pointers to files(meta info)</li>
</ul>
</li>
</ul>
<h2 id="1010"><a href="#1010" class="headerlink" title="1010"></a>1010</h2><h3 id="naming-in-distributed-systems"><a href="#naming-in-distributed-systems" class="headerlink" title="naming in distributed systems"></a>naming in distributed systems</h3><ul>
<li><p>same name; unique identifier</p>
</li>
<li><p>address &#x3D; identifer + access point</p>
</li>
<li><p>context is import! </p>
<ul>
<li>global</li>
<li>local</li>
</ul>
</li>
<li><p>dynamic or static binding?</p>
</li>
</ul>
<h3 id="broadcast-link-network"><a href="#broadcast-link-network" class="headerlink" title="broadcast link network"></a>broadcast link network</h3><ul>
<li>identifier: IP and MAC address    <strong>Media Access Control</strong></li>
<li>arp -a    every node in the network will broadcast their id</li>
</ul>
<h3 id="independent-nodes-P2P-system"><a href="#independent-nodes-P2P-system" class="headerlink" title="independent nodes   P2P system"></a>independent nodes   P2P system</h3><ul>
<li>identifier: hash to 160-bits-string, then truncate it to m bits(name space)</li>
<li>name resolution: distributed hash tables</li>
<li>shaw-one algorithm</li>
</ul>
<h3 id="flat-naming"><a href="#flat-naming" class="headerlink" title="flat naming"></a>flat naming</h3><ul>
<li>no structure, just plain bits</li>
<li>ip address</li>
</ul>
<h3 id="structured-naming"><a href="#structured-naming" class="headerlink" title="structured naming"></a>structured naming</h3><ul>
<li>directory</li>
<li>file system: <ul>
<li>alias: short, multiple names</li>
<li>multiple path to one file</li>
</ul>
</li>
</ul>
<h3 id="centralized-management-generic-problems"><a href="#centralized-management-generic-problems" class="headerlink" title="centralized management    generic problems"></a>centralized management    generic problems</h3><ul>
<li>global state: no one can know all</li>
<li>transaction for second</li>
<li>single point of failure</li>
</ul>
<h3 id="hard-links-amp-amp-symbolic-links"><a href="#hard-links-amp-amp-symbolic-links" class="headerlink" title="hard links &amp;&amp; symbolic links"></a>hard links &amp;&amp; symbolic links</h3><ul>
<li><p>hard links:</p>
<ul>
<li>When adding one hard link, this file’s reference count++</li>
<li>must delete reference count before deleting</li>
</ul>
</li>
<li><p>symbolic links:</p>
<ul>
<li>When adding one link, the file will store the meta data pointing to the original file</li>
<li>linux: ln -s</li>
</ul>
</li>
</ul>
<h3 id="mounting"><a href="#mounting" class="headerlink" title="mounting"></a>mounting</h3><ul>
<li>nfs protocol       </li>
<li>remote server B: share file&#x2F;directory<ul>
<li>linux: exportfs &#x2F;home&#x2F;steen</li>
</ul>
</li>
<li>local server A: mount remote shared file&#x2F;directory locally<ul>
<li>linux: mount B.ip:&#x2F;home&#x2F;steen &#x2F;remote&#x2F;vu </li>
<li>linux: cd &#x2F;remote&#x2F;vu</li>
</ul>
</li>
</ul>
<h3 id="name-resolution"><a href="#name-resolution" class="headerlink" title="name resolution"></a>name resolution</h3><ul>
<li><p>client send query to name servers<br>host query DNS server</p>
</li>
<li><p>linux: </p>
<ul>
<li>the host knows where to query in DNS<br>&#x2F;etc&#x2F;reslve.conf</li>
</ul>
<ol>
<li>nslookup  <a target="_blank" rel="noopener" href="http://www.scu.edu/">www.scu.edu</a></li>
<li>dig</li>
</ol>
</li>
<li><p>iterative</p>
</li>
<li><p>recursive</p>
</li>
<li><p>redundancy and caching server</p>
<ul>
<li>speed</li>
<li>fault tolerance</li>
</ul>
</li>
<li><p>caching on the client side: local browser name resolver</p>
</li>
</ul>
<h3 id="attribute-based-naming"><a href="#attribute-based-naming" class="headerlink" title="attribute-based naming"></a>attribute-based naming</h3><ul>
<li>tuple&#x2F;triple: key, value&#x2F;set of values</li>
<li>Lightweigh Directory Access Protocol</li>
<li>when sending email, client query LDAP server<br>west coast, east coast, europe, …</li>
<li>Directory Information Base  <strong>data sharding</strong></li>
</ul>
<h2 id="1017"><a href="#1017" class="headerlink" title="1017"></a>1017</h2><h3 id="gossip-multicast"><a href="#gossip-multicast" class="headerlink" title="gossip  multicast"></a>gossip  multicast</h3><ul>
<li>fault tolerance</li>
<li>scalability     sending messages fast</li>
</ul>
<h3 id="centralized-approach"><a href="#centralized-approach" class="headerlink" title="centralized approach"></a>centralized approach</h3><ul>
<li>performance bottleneck   not scalable</li>
<li>single point of failure  not reliable</li>
<li>communication channel may be unreliable<ul>
<li>acknowlegement      protocol</li>
</ul>
</li>
</ul>
<h3 id="tree-based-mechanism"><a href="#tree-based-mechanism" class="headerlink" title="tree-based mechanism"></a>tree-based mechanism</h3><ul>
<li>overheads:<ol>
<li>someone needs to be responsible to set up and maintain the tree</li>
<li>acknowledgement    ACKs &#x2F; NAKs</li>
<li>RMTP      SRM</li>
</ol>
</li>
</ul>
<h3 id="gossip-protocol-epidemic-multicast"><a href="#gossip-protocol-epidemic-multicast" class="headerlink" title="gossip protocol     epidemic multicast"></a>gossip protocol     epidemic multicast</h3><ul>
<li><p>every round, pick random targets and send messages via UDP</p>
</li>
<li><p>may have duplicates(send messages back)</p>
</li>
<li><p>once become infected, do the same</p>
</li>
<li><p>push vs pull</p>
<ul>
<li>push: whenever have a new mutlicast message</li>
<li>pull: periodically poll<br>if node crashes, after coming back, and poll messages   fault-tolerant</li>
</ul>
</li>
<li><p>topology-aware gossip:</p>
<ul>
<li>to reduce router load</li>
<li>fix: pick gossip target in its subnet</li>
</ul>
</li>
</ul>
<h2 id="1024"><a href="#1024" class="headerlink" title="1024"></a>1024</h2><h3 id="time-and-ordering"><a href="#time-and-ordering" class="headerlink" title="time and ordering"></a>time and ordering</h3><ul>
<li>host1, host2, host3</li>
<li>t1    t2      t3</li>
<li>each have local clocks(local frequencies)</li>
<li>within host1, different processes, all have same time t1</li>
<li>each process will order tasks it has</li>
<li>However, to order p1 from host1 and p2 from host2? <strong>Time Synchronization</strong></li>
</ul>
<h3 id="time-synchronization"><a href="#time-synchronization" class="headerlink" title="time synchronization"></a>time synchronization</h3><ol>
<li>external time synchronization: <ul>
<li>rely on external time source</li>
<li>when off bounds, sychronize</li>
<li>Cristian’s algorithm, NTP</li>
<li>problem: unbounded latency in asynchronous system:<ol>
<li>network latency</li>
<li>processing latency</li>
</ol>
</li>
</ul>
</li>
<li>internal time synchronization: <ul>
<li>between hosts’s processes, clock skew</li>
<li>when off bounds, sychronize</li>
<li>Berkeley algorithm</li>
<li>problem: time drift from the UTC(correct time)</li>
</ul>
</li>
<li>logical time synchronization</li>
</ol>
<h3 id="clock-skew-amp-amp-clock-drift"><a href="#clock-skew-amp-amp-clock-drift" class="headerlink" title="clock skew &amp;&amp; clock drift"></a>clock skew &amp;&amp; clock drift</h3><ul>
<li>clock skew; distance</li>
<li>clock drift: speeds difference</li>
<li>non-zero clock skew: clocks are not synchronized</li>
<li>non-zero clock drift: the skew will increase</li>
</ul>
<h3 id="cristian’s-algorithm"><a href="#cristian’s-algorithm" class="headerlink" title="cristian’s algorithm"></a>cristian’s algorithm</h3><ul>
<li>RTT: round-trip time</li>
<li>erro is at most (RTT-min2-min1)&#x2F;2</li>
<li>still has problem:<br>bounded error &#x3D;&gt; error rate more than zero<br>what if processes asynchronize within the bound? &#x3D;&gt; won’t trigger the algorithm</li>
</ul>
<h3 id="Network-Time-Protocol"><a href="#Network-Time-Protocol" class="headerlink" title="Network Time Protocol"></a>Network Time Protocol</h3><ul>
<li>to reduce min1, min2</li>
<li>leaf nodes are clients</li>
<li>child has ts1, tr1, ts2, tr2, then calculate the offset &#x3D; (tr1-tr2+ts2-ts1)&#x2F;2</li>
<li>error: difference between the calcuated offset and the real offset</li>
<li>still have a non-zero error!! &#x3D;&gt; still invalid in asynchronous distributed system</li>
</ul>
<h3 id="logical-time-instead-of-absolute-time"><a href="#logical-time-instead-of-absolute-time" class="headerlink" title="logical time, instead of absolute time"></a>logical time, instead of absolute time</h3><ul>
<li>Leslie Lamport, Turing award</li>
<li>causality: <ol>
<li>ordering within one process</li>
<li>send-recieve message between two processes</li>
</ol>
</li>
<li>transitivity</li>
<li>lamport timestaps   ts&#x3D;max(local,msg)+1</li>
<li>timestamp doesn’t not determine order, only causal path does!</li>
<li>timestamps only matter if there is a causal path!</li>
<li>when there is no causal path? concurrent events</li>
<li>shortcoming: can’t tell where two events are concurrent or not</li>
</ul>
<h3 id="vector-timestamps"><a href="#vector-timestamps" class="headerlink" title="vector timestamps"></a>vector timestamps</h3><ul>
<li>n processes &#x3D;&gt; n elements within the vector</li>
<li>each process maintains a vector</li>
<li>causality: iff VT1 &lt;&#x3D; VT2</li>
<li>concurrent (VT1 ||| VT2): !(VT1 &lt;&#x3D; VT2) &amp;&amp; !(VT2 &lt;&#x3D; VT1)</li>
</ul>
<h2 id="1026"><a href="#1026" class="headerlink" title="1026"></a>1026</h2><h3 id="coordination-coordinator-x2F-leader-x2F-introducer"><a href="#coordination-coordinator-x2F-leader-x2F-introducer" class="headerlink" title="coordination  coordinator&#x2F;leader&#x2F;introducer"></a>coordination  coordinator&#x2F;leader&#x2F;introducer</h3><ol>
<li>receive client requrest &#x3D;&gt; forward to appropriate host</li>
<li>handling of failure&#x2F;join&#x2F;leave</li>
</ol>
<ul>
<li><p>property&#x2F;attribute: cpu, disk, ID, space</p>
</li>
<li><p>safety: get an election result</p>
</li>
<li><p>liveness: election terminates</p>
</li>
</ul>
<h3 id="ring-election-protocol-consensus-problem"><a href="#ring-election-protocol-consensus-problem" class="headerlink" title="ring election protocol    consensus problem"></a>ring election protocol    consensus problem</h3><ul>
<li>elect highest id process as leader</li>
<li>received id &#x3D;&#x3D; this.id &#x3D;&gt; elected!!</li>
<li>whenever a new node joins, run the protocol<br>either become the new leader, or get the leader</li>
</ul>
<h3 id="fixing-for-failure"><a href="#fixing-for-failure" class="headerlink" title="fixing for failure"></a>fixing for failure</h3><ul>
<li>have predecessor&#x2F;successor detect failure</li>
<li>use the failure detector</li>
</ul>
<h3 id="bully-algorithm"><a href="#bully-algorithm" class="headerlink" title="bully algorithm"></a>bully algorithm</h3><ul>
<li>premise: all knows all</li>
<li>handle failures better</li>
</ul>
<h3 id="google-chubby"><a href="#google-chubby" class="headerlink" title="google chubby"></a>google chubby</h3><ul>
<li>quorum: voting set</li>
<li>master lease: time duration</li>
</ul>
<h3 id="apache-zookeeper"><a href="#apache-zookeeper" class="headerlink" title="apache zookeeper"></a>apache zookeeper</h3><ul>
<li>paxos: Zookeeper Atomic Broadcast</li>
</ul>
<h2 id="1031"><a href="#1031" class="headerlink" title="1031"></a>1031</h2><h3 id="transaction"><a href="#transaction" class="headerlink" title="transaction"></a>transaction</h3><ul>
<li>series of operations executed by client</li>
<li>each operation is a RPC to a server</li>
<li>either <strong>commit</strong> or <strong>abort</strong></li>
</ul>
<h3 id="atomicity"><a href="#atomicity" class="headerlink" title="atomicity"></a>atomicity</h3><ul>
<li>all or nothing; commit or abort</li>
<li>failure&#x2F;exception: roll back(undone)</li>
</ul>
<h3 id="consistency"><a href="#consistency" class="headerlink" title="consistency"></a>consistency</h3><ul>
<li>if the server starts in a consistent state, the transaction ends the server in a consistent state </li>
<li>Data is in a consistent state when a transaction starts and when it ends. For example, in an application that transfers funds from one account to another, the consistency property ensures that the total value of funds in both the accounts is the same at the start and end of each transaction.</li>
</ul>
<h3 id="isolation"><a href="#isolation" class="headerlink" title="isolation"></a>isolation</h3><ul>
<li>scenario: concurrency of transactions     </li>
<li>two transactions can not update the same object<br>one has to wait for the prior to commit</li>
</ul>
<ol>
<li>no access to intermediate result&#x2F;states of other transactions</li>
<li>free from interference by operations of other transactions</li>
</ol>
<h3 id="durability"><a href="#durability" class="headerlink" title="durability"></a>durability</h3><ul>
<li>transactions’effects are saved in permanent storage</li>
</ul>
<h3 id="multiple-servers-within-one-transaction-–-distributed-transaction"><a href="#multiple-servers-within-one-transaction-–-distributed-transaction" class="headerlink" title="multiple servers within one transaction – distributed transaction"></a>multiple servers within one transaction – distributed transaction</h3><ul>
<li>solution: 2-phase commit</li>
</ul>
<h3 id="lost-update-problem"><a href="#lost-update-problem" class="headerlink" title="lost update problem"></a>lost update problem</h3><ul>
<li>depending on how the server schedules, one of the update wil be lost</li>
<li>cause of problem: inconsistency, simultaneous access of a shared&amp;unsynchronized object; write-write conflict</li>
</ul>
<h3 id="inconsistent-retrieval-problem"><a href="#inconsistent-retrieval-problem" class="headerlink" title="inconsistent retrieval problem"></a>inconsistent retrieval problem</h3><h3 id="concurrent-transactions"><a href="#concurrent-transactions" class="headerlink" title="concurrent transactions"></a>concurrent transactions</h3><ul>
<li>transaction per second</li>
<li>goal: increase concurrency while maintaining correctness(ACID)</li>
</ul>
<h3 id="serial-amp-interleaving-schedule"><a href="#serial-amp-interleaving-schedule" class="headerlink" title="serial &amp; interleaving schedule"></a>serial &amp; interleaving schedule</h3><ul>
<li>serializability: T1,T2 &#x3D;&#x3D; T1.T2 or T2.T1</li>
<li>why: serial executions are most consistent</li>
</ul>
<h3 id="conflicting-operations"><a href="#conflicting-operations" class="headerlink" title="conflicting operations"></a>conflicting operations</h3><ul>
<li><p>same object: </p>
<ol>
<li>read write</li>
<li>write read</li>
<li>write write</li>
</ol>
</li>
<li><p>serially equivalent</p>
</li>
</ul>
<h3 id="prevent-violation-of-isolation"><a href="#prevent-violation-of-isolation" class="headerlink" title="prevent violation of isolation"></a>prevent violation of isolation</h3><ul>
<li><p>pessimistic</p>
<ol>
<li><p>exclusive locking</p>
<ol>
<li>before read&#x2F;write, lock(O)</li>
<li>either enter the lock or wait</li>
<li>when done, unlock(O)</li>
</ol>
<ul>
<li>improvement: exclusive locking is an overkill for read</li>
</ul>
</li>
<li><p>another approach: read&#x2F;write modes</p>
<ul>
<li>read_lock(O), write_lock(O), unlock(O)</li>
</ul>
</li>
</ol>
</li>
<li><p>optimistic</p>
<ol>
<li>check commit time&#x2F;serial equivalence</li>
</ol>
</li>
</ul>
<h3 id="two-phase-locking-protocol"><a href="#two-phase-locking-protocol" class="headerlink" title="two-phase locking protocol"></a>two-phase locking protocol</h3><ul>
<li>guarantee serial equivalence</li>
</ul>
<ol>
<li>growing phase: only acquires or promotes lock</li>
<li>shrinking phase: only release lock</li>
</ol>
<ul>
<li>drawback: deadlock</li>
<li>detect deadlocks in a wait-for graph</li>
</ul>
<h3 id="3-necessary-conditions-for-deadlock"><a href="#3-necessary-conditions-for-deadlock" class="headerlink" title="3 necessary conditions for deadlock"></a>3 necessary conditions for deadlock</h3><ol>
<li>Some objects are accessed in exclusive lock modes</li>
<li>Transactions holding locks cannotbe preempted</li>
<li>There is a circular wait (cycle) in the Wait-for graph</li>
</ol>
<h3 id="Coffman-conditions-if-all-four-simultaneously-x3D-gt-deadlock"><a href="#Coffman-conditions-if-all-four-simultaneously-x3D-gt-deadlock" class="headerlink" title="Coffman conditions    if all four simultaneously &#x3D;&gt; deadlock"></a>Coffman conditions    if all four simultaneously &#x3D;&gt; deadlock</h3><ol>
<li>mutual exlusion    resources</li>
<li>hold and wait      processes</li>
<li>no preemption      process holding resources</li>
<li>cirular wait</li>
</ol>
<h3 id="optimistic-lock"><a href="#optimistic-lock" class="headerlink" title="optimistic lock"></a>optimistic lock</h3><ul>
<li>example: dropbox</li>
<li>first-cut</li>
<li>ordering</li>
<li>multi-version concurrency control: svn</li>
</ul>
<h2 id="1102"><a href="#1102" class="headerlink" title="1102"></a>1102</h2><h3 id="distributed-system-mutual-exclusion"><a href="#distributed-system-mutual-exclusion" class="headerlink" title="distributed system mutual exclusion"></a>distributed system mutual exclusion</h3><ul>
<li><p>ATM<br>avoid WW conflicts, serial equivalence: false</p>
</li>
<li><p>distributed file systems<br>accessing objects in a safe and consistent way<br>server cooridination<br>in industry, Chubby, Apache Zookeeper</p>
</li>
<li><p>piece of code we ensure that there is at most one process executing it at any point of time</p>
</li>
<li><p><strong>critical section</strong> of the process</p>
<ol>
<li>enter()</li>
<li>accessResource()</li>
<li>exit()</li>
</ol>
</li>
</ul>
<h3 id="single-OS-process-synchronization"><a href="#single-OS-process-synchronization" class="headerlink" title="single OS: process synchronization"></a>single OS: process synchronization</h3><ul>
<li><p>semaphore</p>
<ul>
<li><p>signalling mechanism</p>
</li>
<li><p>an integer variable S, initialized with the number of resources available</p>
</li>
<li><p>only two functions can change its value: </p>
<ol>
<li>wait():</li>
</ol>
<ul>
<li>if S&gt;0: S–, accessResource()</li>
<li>if S&#x3D;&#x3D;0: wait</li>
</ul>
<ol>
<li>signal(): S++</li>
</ol>
</li>
</ul>
</li>
<li><p>mutex</p>
<ul>
<li>mutual exclusion object</li>
<li>locked-based technique</li>
<li>lock, use, release</li>
</ul>
</li>
</ul>
<h3 id="need-to-guarantee-3-properties"><a href="#need-to-guarantee-3-properties" class="headerlink" title="need to guarantee 3 properties"></a>need to guarantee 3 properties</h3><ol>
<li>safety(essential)<br>at most one at a time</li>
<li>liveness(essential)<br>all request for a CS is granted eventually</li>
<li>ordering(desirable)</li>
</ol>
<h3 id="distributed-system-central-solution"><a href="#distributed-system-central-solution" class="headerlink" title="distributed system: central solution"></a>distributed system: central solution</h3><ul>
<li>elect a central master(leader)</li>
<li>master keeps:<ol>
<li>a <strong>queue</strong> of waiting requests from processes</li>
<li>a special <strong>token</strong> which allows its holder to access CS</li>
</ol>
</li>
<li>any process in group:<ol>
<li>enter()<ul>
<li>send a request to master</li>
<li>wait for token from master</li>
</ul>
</li>
<li>exit()<ul>
<li>send back token</li>
</ul>
</li>
</ol>
</li>
</ul>
<h3 id="analyzing-performance-metrics"><a href="#analyzing-performance-metrics" class="headerlink" title="analyzing performance   metrics"></a>analyzing performance   metrics</h3><ul>
<li>bandwidth</li>
<li>client delay</li>
<li>synchronization delay</li>
</ul>
<h3 id="ring-based-mutual-exlusion"><a href="#ring-based-mutual-exlusion" class="headerlink" title="ring based mutual exlusion"></a>ring based mutual exlusion</h3><ul>
<li>safety: yes</li>
<li>liveness: yes</li>
<li>ordering: no<br>the nature of ring topology</li>
</ul>
<h3 id="Ricart-Agrawala’s-Algorithm"><a href="#Ricart-Agrawala’s-Algorithm" class="headerlink" title="Ricart-Agrawala’s Algorithm"></a>Ricart-Agrawala’s Algorithm</h3><ul>
<li>premise: reliable all-to-all communication</li>
<li>no token</li>
<li>uses the notion of causality and multicast<br>send messages of <strong>&lt;timestamp, process id&gt;</strong></li>
<li>lowing waiting time to enter CS</li>
<li>state<ul>
<li>wanted</li>
<li>held</li>
<li>released</li>
</ul>
</li>
</ul>
<h3 id="Maekawa’s-Algorithm"><a href="#Maekawa’s-Algorithm" class="headerlink" title="Maekawa’s Algorithm"></a>Maekawa’s Algorithm</h3><ul>
<li>voting set(<strong>quorum</strong>)</li>
<li>safety but not liveness</li>
</ul>
<h2 id="1107"><a href="#1107" class="headerlink" title="1107"></a>1107</h2><h3 id="replication-control"><a href="#replication-control" class="headerlink" title="replication control"></a>replication control</h3><ul>
<li>example: airline booking system</li>
<li>one client, query which one of multiple servers</li>
<li>multiple clients, coordinations; concurrency</li>
</ul>
<h3 id="why-replication-x3D-gt-higher-availability"><a href="#why-replication-x3D-gt-higher-availability" class="headerlink" title="why replication &#x3D;&gt; higher availability"></a>why replication &#x3D;&gt; higher availability</h3><ol>
<li>fault-tolerance</li>
<li>load balancing</li>
</ol>
<h3 id="availability-vs-reliability"><a href="#availability-vs-reliability" class="headerlink" title="availability vs reliability"></a>availability vs reliability</h3><ul>
<li><p>availability: </p>
<ol>
<li>The <strong>percentage of time</strong> that the infrastructure, system, or solution is <strong>operational</strong> under normal circumstances.</li>
<li>Percentage of availability &#x3D; (total elapsed time – sum of downtime)&#x2F;total elapsed time</li>
</ol>
</li>
<li><p>reliability: </p>
<ol>
<li>The <strong>probability</strong> that the system will meet certain performance standards and <strong>yield correct output</strong> for a specific time.</li>
<li><strong>Mean Time Betwen Failures</strong></li>
<li>MTBF &#x3D; (total elapsed time – sum of downtime)&#x2F;number of failures</li>
</ol>
</li>
<li><p>The measurement of Availability is driven by <strong>time loss</strong> whereas the measurement of Reliability is driven by the <strong>frequency and impact of failures</strong>. </p>
</li>
<li><p>Mathematically, the Availability of a system can be treated as a function of its Reliability. In other words, Reliability can be considered <strong>a subset of Availability</strong>.</p>
</li>
</ul>
<h3 id="maintain-two-properties"><a href="#maintain-two-properties" class="headerlink" title="maintain two properties"></a>maintain two properties</h3><ol>
<li><p>replication <strong>consistency</strong></p>
<ul>
<li>All clients see single consistent copy of data, in spite of replication</li>
<li>For transactions, ACID</li>
<li>achieved by passive&#x2F;active replication</li>
</ul>
</li>
<li><p>replication <strong>transparency</strong></p>
<ul>
<li>transparent to a single client</li>
<li>achieved by FEs</li>
</ul>
</li>
</ol>
<h3 id="replication-consistency"><a href="#replication-consistency" class="headerlink" title="replication consistency"></a>replication consistency</h3><ul>
<li>two ways to forward updates from front-ends to replica group<ol>
<li>passive replication<ol>
<li>leader election, select a primary replica (master)</li>
<li>FEs send request to the master</li>
</ol>
</li>
<li>active replication <ul>
<li>treats all replicas indentically</li>
</ul>
</li>
</ol>
</li>
<li>both approaches: <strong>replicated state machine</strong></li>
</ul>
<h3 id="passive-replication"><a href="#passive-replication" class="headerlink" title="passive replication"></a>passive replication</h3><ul>
<li>election: ring, bully, Google Chubby</li>
</ul>
<h3 id="active-replication"><a href="#active-replication" class="headerlink" title="active replication"></a>active replication</h3><ul>
<li>FEs send multicast requests: gossip</li>
<li>multicast ordering:<ol>
<li>FIFO</li>
<li>causal ordering, Lamport timestamp</li>
<li>total ordering<ul>
<li>object-based: timestamp, size, etc</li>
</ul>
</li>
<li>hybrid ordering</li>
</ol>
</li>
</ul>
<h3 id="one-copy-serializability"><a href="#one-copy-serializability" class="headerlink" title="one-copy serializability"></a>one-copy serializability</h3><ul>
<li>a concurrent execution of transactions equivalent to a serial execution of these transactions</li>
<li>one-copy: results should be consistent&#x2F;the same: doesn’t matter if I execute a, or b, or both</li>
<li>if non-replication: just order the concurrent transactions; ensure <strong>correctness</strong></li>
<li>when replicated:</li>
</ul>
<h3 id="distributed-transactions"><a href="#distributed-transactions" class="headerlink" title="distributed transactions"></a>distributed transactions</h3><ul>
<li>transaction: sequence of R&#x2F;W operations</li>
<li>main challenge: maintain ACID, especially Atomiciy</li>
<li>atomic commit problem:<ol>
<li>commit itself is distributed</li>
<li>make sure commit itself is atomic</li>
</ol>
</li>
</ul>
<h3 id="one-phase-commit-not-usable"><a href="#one-phase-commit-not-usable" class="headerlink" title="one-phase commit    not usable"></a>one-phase commit    not usable</h3><ul>
<li>special server called coordinator, which initiates atomic commit</li>
<li>tell other servers to either commit or abort</li>
<li>why not usable<ol>
<li>one-way communication<br>server has no say(can not time out), just coordinator telling servers what to do</li>
<li>server may crash before receiving commit message</li>
</ol>
</li>
</ul>
<h3 id="two-phase-commit"><a href="#two-phase-commit" class="headerlink" title="two-phase commit"></a>two-phase commit</h3><ol>
<li>coordinator prepared to save</li>
<li>servers respond with yes&#x2F;no</li>
<li>coordinator decides whether commit or abort</li>
</ol>
<h3 id="two-phase-commit-failures"><a href="#two-phase-commit-failures" class="headerlink" title="two-phase commit failures:"></a>two-phase commit failures:</h3><ol>
<li>server crashes<br>save tentative updates into permanent storage right before replying yes&#x2F;no</li>
<li>coordinator crashes:<br>log all decisions and received messages on disk</li>
<li>message loss: <strong>pessimistic</strong><ol>
<li>prepare message loss</li>
<li>yes&#x2F;no message loss</li>
<li>commit&#x2F;abort</li>
</ol>
</li>
</ol>
<h2 id="1109"><a href="#1109" class="headerlink" title="1109"></a>1109</h2><h3 id="distributed-systems-snapshots"><a href="#distributed-systems-snapshots" class="headerlink" title="distributed systems snapshots"></a>distributed systems snapshots</h3><ul>
<li>example:<br>transactions, take a global snapshot to construct the weight-for graph</li>
<li>distributed system global snapshot:<ol>
<li>process state</li>
<li>communiation channel<br><em>two main parts of distributed system: hosts and communications</em></li>
</ol>
</li>
</ul>
<h3 id="uses-of-having-a-global-picture"><a href="#uses-of-having-a-global-picture" class="headerlink" title="uses of having a global picture"></a>uses of having a global picture</h3><ol>
<li>checkpointing: can restart distributed application on failure</li>
<li>garbage collection: objects at servers that don’t have any other objects at any servers with pointers to them</li>
<li>deadlock detection: useful in database transaction systems</li>
<li>termination of computation: useful in batch computing systems</li>
</ol>
<h3 id="how-to-take-a-global-snapshot"><a href="#how-to-take-a-global-snapshot" class="headerlink" title="how to take a global snapshot"></a>how to take a global snapshot</h3><ul>
<li><p>obvious first solution</p>
<ol>
<li>synchronize clocks of all processes</li>
<li>then ask all processes to record their states at known time t</li>
</ol>
</li>
<li><p>problems:</p>
<ol>
<li>time synchronization always has error  <strong>clock skew</strong></li>
<li>also, doesn’t record the state of messages in the channels</li>
</ol>
</li>
<li><p>again: synchronization is not required! causality is enough!<br>(global) state to state movement obeys causality</p>
<ol>
<li>process receives message</li>
<li>process sends message</li>
<li>proces takes a step</li>
</ol>
</li>
</ul>
<h3 id="system-model"><a href="#system-model" class="headerlink" title="system model"></a>system model</h3><h3 id="requirements"><a href="#requirements" class="headerlink" title="requirements"></a>requirements</h3><ol>
<li>snapshot should not interfere with normal applcation actions&#x2F;sending messages</li>
<li>each process is able to record its own state<br>its heap, registers, program counter, code, etc (<strong>coredump</strong>)</li>
<li>global state is collected in a distributed manner</li>
<li>any process may initiate the snapshot</li>
</ol>
<h3 id="Chandy-Lamport-global-snapshot-algorithm"><a href="#Chandy-Lamport-global-snapshot-algorithm" class="headerlink" title="Chandy-Lamport global snapshot algorithm"></a>Chandy-Lamport global snapshot algorithm</h3><ul>
<li>initiator process records its own state</li>
<li>create and send <strong>Marker</strong> messages to all other processes via outgoing channels<br>turn on recording on all incoming channels</li>
<li>other processes start recording on each of the incoming channels<ul>
<li>if first marker message:<ol>
<li>record its own state</li>
<li>mark incoming channel as emtpy (<strong>&lt;&gt;</strong>)</li>
<li>turn on recording on other incoming channels</li>
<li>send out markers</li>
</ol>
</li>
<li>already seen a marker message:<ol>
<li>k: sender; i: receiver</li>
<li>mark the state of channel Cki as all the messages that have arrived on it since recording was turned on for Cki</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="consistent-cut"><a href="#consistent-cut" class="headerlink" title="consistent cut"></a>consistent cut</h3><ul>
<li><p>cut: time frontier at each process and at each channel</p>
<ul>
<li>in the cut</li>
<li>out of the cut</li>
</ul>
</li>
<li><p>consistent cut: a cut that obeys causality<br>event e in cut C; f happens before e (f-&gt;e)<br>then event f is also in the cut C</p>
</li>
<li><p>any run of the Chandy-Lamport gloabal snapshot algorithm creates a consistent cut</p>
</li>
</ul>
<h3 id="correctness-in-distributed-systems"><a href="#correctness-in-distributed-systems" class="headerlink" title="correctness in distributed systems"></a>correctness in distributed systems</h3><ul>
<li>liveness:<br>guarantee that something good will happen, eventually<br>eventually: does not imply a time bound, but if you let the system run long enough, then…<ul>
<li>examples:<ol>
<li>distributed computation: guarantee that it will terminate</li>
<li>completeness in failure detectors: every failure is eventually detected by some non-faulty process</li>
<li>consensus (election, Google Chubby): all processes eventually decide on a value</li>
</ol>
</li>
</ul>
</li>
<li>safety:<br>guarantee that something bad will never happen<ul>
<li>examples:<ol>
<li>there is no deadlock in a distributed system</li>
<li>no object is orphaned in a distributed system</li>
<li>accuracy in failure detectors</li>
<li>in consensus: no two processes decide on different values</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="stable-properties"><a href="#stable-properties" class="headerlink" title="stable properties"></a>stable properties</h3><ul>
<li>stable: once true, stays true forever afterwards</li>
<li>all stable properties can be detected using the Chandy-Lamport algorithm</li>
</ul>
<h2 id="1114"><a href="#1114" class="headerlink" title="1114"></a>1114</h2><h3 id="file-system"><a href="#file-system" class="headerlink" title="file system"></a>file system</h3><ul>
<li>higher level of abstraction</li>
<li>file contents:<ol>
<li>header:<ol>
<li>timestamps</li>
<li>file type</li>
<li>ownership</li>
<li>access control list</li>
<li>reference count: number of directories containing this file</li>
</ol>
</li>
<li>blocks</li>
</ol>
</li>
<li>directory</li>
</ul>
<h3 id="unix-file-system-local-methods"><a href="#unix-file-system-local-methods" class="headerlink" title="unix file system  local methods"></a>unix file system  local methods</h3><ul>
<li>file descriptors<ol>
<li>open</li>
<li>creat</li>
<li>close</li>
</ol>
</li>
<li>read-write pointer<ol>
<li>read</li>
<li>write</li>
<li>lseek</li>
</ol>
</li>
<li>status<ol>
<li>link</li>
<li>unlink</li>
<li>stat&#x2F;fstat</li>
</ol>
</li>
</ul>
<h3 id="distributed-file-systems"><a href="#distributed-file-systems" class="headerlink" title="distributed file systems"></a>distributed file systems</h3><ol>
<li>transparency</li>
<li>support concurrent clients</li>
<li>replcation: fault-tolerance</li>
</ol>
<ul>
<li>idempotent</li>
<li>stateless</li>
</ul>
<h3 id="security"><a href="#security" class="headerlink" title="security"></a>security</h3><ol>
<li>autentication</li>
<li>authorization:<ol>
<li>Access Control Lists, per file</li>
<li>Capability Lists, per user</li>
</ol>
</li>
</ol>
<h3 id="why-DFS-not-using-file-descriptors"><a href="#why-DFS-not-using-file-descriptors" class="headerlink" title="why DFS not using file descriptors?"></a>why DFS not using file descriptors?</h3><ol>
<li>transparency: client should not know the absolute position of the file</li>
<li>confusion: a file may be replicated across multiple servers, each having a file descriptor</li>
</ol>
<h3 id="Network-File-System"><a href="#Network-File-System" class="headerlink" title="Network File System"></a>Network File System</h3><ul>
<li><p>virtual file system: provide transparency</p>
<ul>
<li>local unix file system, if file is local</li>
<li>NFS client system, if file is not local<ul>
<li>do RPCs</li>
</ul>
</li>
</ul>
</li>
<li><p>server: exportfs</p>
</li>
<li><p>client: mount</p>
<ul>
<li>not clone, but hook(point to)</li>
<li>unlink dropbox, where file is local</li>
</ul>
</li>
</ul>
<h3 id="why-not-clone"><a href="#why-not-clone" class="headerlink" title="why not clone?"></a>why not clone?</h3><ul>
<li>replcation: consistency</li>
</ul>
<h3 id="virtual-file-system-module"><a href="#virtual-file-system-module" class="headerlink" title="virtual file system module"></a>virtual file system module</h3><ul>
<li>allow processes to access files via file descriptors</li>
<li>transparency: local and romote files look the same</li>
<li>“NFS file handles”</li>
<li>v-node</li>
</ul>
<h3 id="server-optimizations"><a href="#server-optimizations" class="headerlink" title="server optimizations"></a>server optimizations</h3><ul>
<li><p>server caching: locality of access</p>
</li>
<li><p>writes: two flavors</p>
<ol>
<li>delayed write:</li>
</ol>
<ul>
<li>write in memory, flush to disk every 30s</li>
<li>non-blocking</li>
<li>fast but not consistent</li>
</ul>
<ol start="2">
<li>write-through</li>
</ol>
<ul>
<li>blocking</li>
<li>consistent but may be slow(latency)</li>
</ul>
</li>
</ul>
<h3 id="client-optimization"><a href="#client-optimization" class="headerlink" title="client optimization"></a>client optimization</h3><ul>
<li>client caching</li>
<li>cache recently-accessed blocks</li>
<li>when block is written, do a delayed-write to server</li>
<li>compromise between consistency and efficiency</li>
</ul>
<h3 id="AFS"><a href="#AFS" class="headerlink" title="AFS"></a>AFS</h3><ul>
<li>whole file serving</li>
<li>whole file caching</li>
</ul>
<h2 id="1116"><a href="#1116" class="headerlink" title="1116"></a>1116</h2><h3 id="security-threats"><a href="#security-threats" class="headerlink" title="security threats"></a>security threats</h3><ol>
<li>leakage</li>
<li>tampering</li>
<li>vandalism</li>
</ol>
<h3 id="common-attacks"><a href="#common-attacks" class="headerlink" title="common attacks"></a>common attacks</h3><ol>
<li>eavesdropping: taps into network</li>
<li>masquerading: pretend</li>
<li>message tampering: modify</li>
<li>replay attack</li>
<li>denial of service: bombard a port</li>
</ol>
<h3 id="CIA-properties"><a href="#CIA-properties" class="headerlink" title="CIA properties"></a>CIA properties</h3><ul>
<li>confidentiality</li>
<li>integrity</li>
<li>availability</li>
</ul>
<h3 id="separate-policy-from-mechanism"><a href="#separate-policy-from-mechanism" class="headerlink" title="separate policy from mechanism"></a>separate policy from mechanism</h3><ul>
<li>policy: what’s the goal</li>
<li>mechanism: how the goal is accomplished</li>
</ul>
<h3 id="Mechanisms-Golden-A’s"><a href="#Mechanisms-Golden-A’s" class="headerlink" title="Mechanisms: Golden A’s"></a>Mechanisms: Golden A’s</h3><ul>
<li>authentication:<br>is a user claiming to be Alice, really Alice?</li>
<li>authorization:<br>Yes, it is Alice, but is Alice allowed to perfrom the requested operation?</li>
<li>auditing:<br>How did Eve manage to attack the system and breach defenses?<br>Usually done by continuously logging all operations.<br>No attack should go unnoticed!</li>
</ul>
<h3 id="designing-secure-systems"><a href="#designing-secure-systems" class="headerlink" title="designing secure systems"></a>designing secure systems</h3><ul>
<li>don’t know how powerful attacker is</li>
<li>when designing a secruity protocol, need to:<ol>
<li>specify <strong>Attacker Model</strong><br>capabilities of attacker; tied to reality, no imagination<ul>
<li>study</li>
</ul>
</li>
<li>design security mechanisms to satisfy policy under the attacker model<ul>
<li>engineers implement the mechanisms</li>
</ul>
</li>
<li>prove that mechanisms satisfy policy under attacker model<ul>
<li>a second organization may come into play, try to attack</li>
</ul>
</li>
<li>measure effect on overall performance in the common ase, i.e., no attacks<br>compare: <ul>
<li>no-security-control throughput</li>
<li>throughput with security control</li>
</ul>
</li>
</ol>
</li>
<li>security is not a one-time deal!</li>
</ul>
<h3 id="basic-cryptography"><a href="#basic-cryptography" class="headerlink" title="basic cryptography"></a>basic cryptography</h3><ul>
<li>key: <ul>
<li>sequence of bytes assigned to a user</li>
<li>can be used to lock a message, and only this key can be used to unlock that locked message</li>
</ul>
</li>
</ul>
<h3 id="encryption"><a href="#encryption" class="headerlink" title="encryption"></a>encryption</h3><ul>
<li>encrypted message &#x3D; encrypt(original message, key) </li>
<li>decrypted message &#x3D; decrypt(encrypted message, key)</li>
</ul>
<h3 id="two-cryptography-systems"><a href="#two-cryptography-systems" class="headerlink" title="two cryptography systems"></a>two cryptography systems</h3><ol>
<li><p>symmetric key systems: DES</p>
<ul>
<li>shared keys</li>
<li>hard to revoke permissions from principals</li>
</ul>
</li>
<li><p>public-private key systems: RSA, PGP</p>
<ul>
<li>private key</li>
<li>public key: known to all</li>
<li>anything encrypted with Kapriv can be decrypted only with Kapub</li>
<li>anything encrypted with Kapub can be decrypted only with Kapriv</li>
<li>relatively costly: 2 operations, at least one is costly</li>
</ul>
</li>
<li><p>combination: use public-private key system to generate shared key</p>
</li>
</ol>
<h3 id="authentication"><a href="#authentication" class="headerlink" title="authentication"></a>authentication</h3><ul>
<li>direct authentication</li>
<li>indirect authentication: uses a trusted third-party server, authentication server</li>
</ul>
<h3 id="digital-signatures"><a href="#digital-signatures" class="headerlink" title="digital signatures"></a>digital signatures</h3><ul>
<li>between two parties</li>
<li>SHA-1, MD-5</li>
</ul>
<h3 id="digital-certificates"><a href="#digital-certificates" class="headerlink" title="digital certificates"></a>digital certificates</h3><ul>
<li>transitivity: chains of certificates</li>
<li>trace back</li>
</ul>
<h3 id="authorization"><a href="#authorization" class="headerlink" title="authorization"></a>authorization</h3><ul>
<li><p>Access Control Matrix</p>
</li>
<li><p>Access Control Lists, per file&#x2F;object</p>
</li>
<li><p>Capability Lists, per user&#x2F;principal</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/12/04/COEN317-midterm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/04/COEN317-midterm/" class="post-title-link" itemprop="url">COEN317_midterm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-04 22:20:28" itemprop="dateCreated datePublished" datetime="2022-12-04T22:20:28+08:00">2022-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-05 14:23:16" itemprop="dateModified" datetime="2022-12-05T14:23:16+08:00">2022-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="midterm-review"><a href="#midterm-review" class="headerlink" title="midterm review"></a>midterm review</h1><h2 id="Chap-1-Intro"><a href="#Chap-1-Intro" class="headerlink" title="Chap 1   Intro"></a>Chap 1   Intro</h2><h3 id="what’s-a-distributed-system"><a href="#what’s-a-distributed-system" class="headerlink" title="what’s a distributed system"></a>what’s a distributed system</h3><ul>
<li>definitions: <ol>
<li>a collection of independent computers that appears to users as a single coherent system</li>
<li>a collection of autonomous computers linked by a computer network and supported by software that enables the collection to operate as an integrated facility</li>
<li>crash you never heard of stops you from getting work done</li>
</ol>
</li>
<li><strong>types:</strong></li>
</ul>
<h3 id="what-do-we-want-from-distributed-system"><a href="#what-do-we-want-from-distributed-system" class="headerlink" title="what do we want from distributed system"></a>what do we want from distributed system</h3><ul>
<li><p>resource sharing: </p>
<ol>
<li>Quality of Service, trade-offs</li>
</ol>
</li>
<li><p>transparency: information hiding applied to distributed systems</p>
<ol>
<li>hiding different aspects of distribution from clients</li>
<li>make the system more user friendly</li>
<li>appears to users and applications as a single computer system</li>
<li>users&#x2F;apps should be able to access remote resources the same way they access local resources</li>
</ol>
<ul>
<li>types:<ol>
<li>access: hide differences in data representation and how a resource is accessed</li>
<li>location: hide where a resource is located</li>
<li>migration: hide that a resource may move to another location</li>
<li>relocation: hide that a resource may be moved to another location while in use</li>
<li>replication: hide that a resource is replicated</li>
<li>concurrency: hide that a resource may be shared by several competitive users</li>
<li>failure: hide the failure and recovery of a resource</li>
</ol>
</li>
</ul>
</li>
<li><p>openness:</p>
<ul>
<li>offer services according to standard rules</li>
<li>In other words, the interfaces to the system are clearly specified and freely available</li>
<li>formalized in protocols, not proprietary</li>
<li>definitions are language and machine independent    interoperate</li>
<li><strong>separating policy from mechanism</strong></li>
</ul>
</li>
<li><p>scalability: able to grow to meet increasing demands </p>
<ol>
<li>3 dimensions of scalability</li>
</ol>
<ul>
<li>size: users&#x2F;resources<ul>
<li>performance bottlneck: centralized server, data, algorithms</li>
</ul>
</li>
<li>geographically: topologically<ul>
<li>LAN: synchronous, fast ,reliable</li>
<li>WAN: asynchronous, slow, unreliable</li>
</ul>
</li>
<li><strong>administratively</strong>: independent organizations&#x2F;domains</li>
</ul>
<ol start="2">
<li>vertical horizontal</li>
<li>problems:</li>
</ol>
<ul>
<li>trade-off: scalability, security</li>
</ul>
<ol start="4">
<li>scaling techniques</li>
</ol>
<ul>
<li>caching: proximity, client decision</li>
<li>replicate: consistency vs scalability</li>
<li>asynchronous: hiding communication latency</li>
<li>synchronous</li>
<li>hierachies, domains, zones     split</li>
</ul>
</li>
</ul>
<h3 id="elements-of-distributed-system"><a href="#elements-of-distributed-system" class="headerlink" title="elements of distributed system"></a>elements of distributed system</h3><ul>
<li>networks</li>
<li>hosts</li>
<li>middleware</li>
</ul>
<h3 id="architecture-styles"><a href="#architecture-styles" class="headerlink" title="architecture styles"></a>architecture styles</h3><ul>
<li><p>describe a particular way to configure a collection of components and connectors</p>
</li>
<li><p>layered</p>
</li>
<li><p>object-based: object + RPC&#x2F;RMI</p>
</li>
<li><p>event&#x2F;publish-subscribe: </p>
<ul>
<li>publish to event bus &#x3D;&gt; event bus delivers</li>
<li>asynchronous communciation, decouples senders&amp;receivers</li>
</ul>
</li>
<li><p>shared data-space: </p>
<ul>
<li>publish to shared persistent data space &#x3D;&gt; data space delivers</li>
</ul>
</li>
<li><p>client&#x2F;server model:</p>
<ul>
<li>user-interface level: GUI</li>
<li>processing level: core functionality</li>
<li>data level: interacts with database or file system</li>
<li>two-tiered: <ul>
<li>thin-client: GUI</li>
<li>fat-client: user interface + processing + some data</li>
</ul>
</li>
<li>three-tiered:<ul>
<li>application server acting as a client</li>
<li>client &#x3D;&gt; middleware &#x3D;&gt; resource management server</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="various-configurations-of-distributed-systems"><a href="#various-configurations-of-distributed-systems" class="headerlink" title="various configurations of distributed systems"></a>various configurations of distributed systems</h3><h3 id="example-distributed-systems"><a href="#example-distributed-systems" class="headerlink" title="example distributed systems"></a>example distributed systems</h3><h2 id="Chap-2-3-Communications-Foudamentals"><a href="#Chap-2-3-Communications-Foudamentals" class="headerlink" title="Chap 2,3   Communications  Foudamentals"></a>Chap 2,3   Communications  Foudamentals</h2><h3 id="packets"><a href="#packets" class="headerlink" title="packets"></a>packets</h3><ul>
<li>segment &#x3D; original data + transport layer header</li>
<li>packet &#x3D; segment + network layer header</li>
<li>fram &#x3D; packet + data link layer header</li>
</ul>
<h3 id="protocols"><a href="#protocols" class="headerlink" title="protocols"></a>protocols</h3><ul>
<li>connection-oriented: setup of communication first</li>
<li>connectionless: no setup of communication</li>
<li>application-specific vs application-independent</li>
</ul>
<h3 id="blocking-x2F-unblocking-communication-calls"><a href="#blocking-x2F-unblocking-communication-calls" class="headerlink" title="blocking&#x2F;unblocking communication calls"></a>blocking&#x2F;unblocking communication calls</h3><ul>
<li>blocking: process&#x2F;thread execution is suspended until transmission finishes</li>
<li>unblocking: execution continues without waiting for the finish of the transmission</li>
</ul>
<h3 id="layering"><a href="#layering" class="headerlink" title="layering"></a>layering</h3><ul>
<li>do I need other intermediators to relay the message?</li>
</ul>
<h3 id="layered-protocols"><a href="#layered-protocols" class="headerlink" title="layered protocols"></a>layered protocols</h3><h3 id="application-layering"><a href="#application-layering" class="headerlink" title="application layering"></a>application layering</h3><h3 id="communication-between-processes"><a href="#communication-between-processes" class="headerlink" title="communication between processes"></a>communication between processes</h3><h3 id="middleware-and-application-protocols"><a href="#middleware-and-application-protocols" class="headerlink" title="middleware and application protocols"></a>middleware and application protocols</h3><ul>
<li>application layer protocols</li>
<li>between application and transport: middleware</li>
<li>program and network layer</li>
</ul>
<h3 id="layered-network-models"><a href="#layered-network-models" class="headerlink" title="layered network models"></a>layered network models</h3><ul>
<li><p>OSI 7-layer model     Open System Interconnection</p>
<ul>
<li>application: support application-specific needs</li>
<li>presentation: process information format and deliver(serialize and encrypt)</li>
<li>session: manage communication sessions among applications</li>
<li>transport: end-to-end communication for applications</li>
<li>network: route data packets among senders&#x2F;receivers</li>
<li>data link: send, detect and correct data frames(units of bits)</li>
<li>physical: transfer bits over physical interfaces(fiber optics)</li>
</ul>
</li>
<li><p>TCP&#x2F;IP 4-layer</p>
<ul>
<li>application: SMTP,HTTP,FTP,Telnet</li>
<li>transport: UCP,TCP</li>
<li>network: IP</li>
<li>link: most network hardware   Ethernet&#x2F;fiber&#x2F;satellite</li>
</ul>
</li>
<li><p>Ethernet: local area network</p>
</li>
<li><p>Inter-network Protocols       IP</p>
<ul>
<li>define datagram as the basic data unit</li>
<li>define the internet address schema</li>
<li>routes datagrams to destinations</li>
<li>divides and assembles datagrams</li>
</ul>
</li>
</ul>
<h3 id="addressing-and-routing"><a href="#addressing-and-routing" class="headerlink" title="addressing and routing"></a>addressing and routing</h3><ul>
<li>TCP<ul>
<li>Transmission Control Protocol</li>
<li>data sent via streams of bytes</li>
</ul>
</li>
<li>UDP<ul>
<li>User Datagram Protocol</li>
<li>data sent in messages</li>
</ul>
</li>
<li>communication ports and sockets</li>
</ul>
<h3 id="multicast-more-than-one-recipient"><a href="#multicast-more-than-one-recipient" class="headerlink" title="multicast : more than one recipient"></a>multicast : more than one recipient</h3><h3 id="client-x2F-server-communication-protocols"><a href="#client-x2F-server-communication-protocols" class="headerlink" title="client&#x2F;server communication protocols"></a>client&#x2F;server communication protocols</h3><h3 id="processing-multiple-requests"><a href="#processing-multiple-requests" class="headerlink" title="processing multiple requests"></a>processing multiple requests</h3><ul>
<li>iterative processing:<br>receive &#x3D;&gt; process &#x3D;&gt; return result &#x3D;&gt; wait for new</li>
<li>concurrent processing:<br>receive &#x3D;&gt; ask another to process &#x3D;&gt; wait for new<br>                      process &#x3D;&gt; return result</li>
<li>using replicated processes</li>
<li>using multiple threads</li>
<li>using message brokers&#x2F;space repository</li>
</ul>
<h3 id="communication-types"><a href="#communication-types" class="headerlink" title="communication types"></a>communication types</h3><ul>
<li>transient: messages are kept in the communication temporarily only if both the sender and the receiver are live</li>
<li>persistent: messages are kept in the communciation system until they are delivered to the receiver</li>
<li>synchronous: <ul>
<li>the sender waits until it knows the messages have been delivered to the receiver</li>
<li>blocking send&#x2F;receive</li>
</ul>
</li>
<li>asynchronous: <ul>
<li>the process continues as soon as sending messages have been copied to the local buffer    </li>
<li>non-blocking send</li>
<li>callback mechanisms</li>
</ul>
</li>
</ul>
<h3 id="stateful-x2F-stateless-server"><a href="#stateful-x2F-stateless-server" class="headerlink" title="stateful&#x2F;stateless server"></a>stateful&#x2F;stateless server</h3><ul>
<li>keep clients’ state information</li>
</ul>
<h2 id="Chap-4-5-6-9-Commuications-Programming"><a href="#Chap-4-5-6-9-Commuications-Programming" class="headerlink" title="Chap 4,5,6,9 Commuications     Programming"></a>Chap 4,5,6,9 Commuications     Programming</h2><h3 id="ports"><a href="#ports" class="headerlink" title="ports"></a>ports</h3><h3 id="sockets"><a href="#sockets" class="headerlink" title="sockets"></a>sockets</h3><ul>
<li>how does an application use the transport layer communciation to send&#x2F;receive messages?   Transport-level socket programming via socket interface</li>
<li>socket interface: socket APIs</li>
<li>what is a socket: a communication end point to&#x2F;from which an application can send&#x2F;receive data through the underlying network</li>
<li>message-oriented transient communication at transport level</li>
<li>client: connect, send, receive</li>
<li>server: bind, listen&#x2F;accept, recieve, process, send</li>
</ul>
<h3 id="binding"><a href="#binding" class="headerlink" title="binding"></a>binding</h3><ul>
<li>attach a local address to a socket</li>
</ul>
<h3 id="datagram-sockets"><a href="#datagram-sockets" class="headerlink" title="datagram sockets"></a>datagram sockets</h3><h3 id="UDP-User-Datagram-Protocol"><a href="#UDP-User-Datagram-Protocol" class="headerlink" title="UDP   User Datagram Protocol"></a>UDP   User Datagram Protocol</h3><h3 id="locating-resources-on-the-network"><a href="#locating-resources-on-the-network" class="headerlink" title="locating resources on the network"></a>locating resources on the network</h3><h3 id="network-programming-sockets"><a href="#network-programming-sockets" class="headerlink" title="network programming: sockets"></a>network programming: sockets</h3><h3 id="socket-programming-with-TCP"><a href="#socket-programming-with-TCP" class="headerlink" title="socket programming with TCP"></a>socket programming with TCP</h3><h3 id="models-for-application-communications"><a href="#models-for-application-communications" class="headerlink" title="models for application communications"></a>models for application communications</h3><ul>
<li>RPC, remote procedure call<ul>
<li>asynchronous RPC:<ol>
<li>synchronize at request submission</li>
<li>synchronize at request delivery</li>
</ol>
</li>
<li>synchronous RPC:<ol>
<li>synchronize after processed by server</li>
</ol>
</li>
</ul>
</li>
<li>message-oriented communication<ul>
<li>transient   socket</li>
<li>persistent  message-queuing<ul>
<li>time uncoupling</li>
</ul>
</li>
</ul>
</li>
<li>stream-oriented communication</li>
<li>multicast communication</li>
</ul>
<h3 id="remote-objects-and-RMI"><a href="#remote-objects-and-RMI" class="headerlink" title="remote objects and RMI"></a>remote objects and RMI</h3><ul>
<li>distributed&#x2F;remote objects</li>
<li>RMI, Remote Method Invocation</li>
</ul>
<h3 id="web-services"><a href="#web-services" class="headerlink" title="web services"></a>web services</h3><ul>
<li>architecture</li>
<li>REST<ol>
<li>resources are identified and accessed through URIs</li>
<li>resources are data and functionality</li>
<li>a web service manages a set of resources</li>
<li>a client and a service exchange representation of resources via standardized interface and protocols</li>
</ol>
</li>
<li>cloud computing&#x2F; cloud resources: file, storage, compute machine, middleware</li>
</ul>
<h3 id="stream-data-programming"><a href="#stream-data-programming" class="headerlink" title="stream data programming"></a>stream data programming</h3><ul>
<li>data stream: a sequence of data units<br>reading bytes from a file and sending bytes via a TCP socket</li>
<li>can be used for: <ol>
<li>continuous media: video</li>
<li>discrete media: stock market events&#x2F;twitter events</li>
</ol>
</li>
<li>timing issues   transmission modes<ol>
<li>asynchronous: no contraints of delay(when the transmission completes)</li>
<li>synchronous: maximum end-to-end delay defined for each data unit</li>
<li>iochronous: maximum and minimum delay defined</li>
</ol>
</li>
</ul>
<h3 id="group-communication"><a href="#group-communication" class="headerlink" title="group communication"></a>group communication</h3><ul>
<li><p>use multicast messages</p>
<ol>
<li>IP multicast</li>
<li>application-level multicast</li>
</ol>
<ul>
<li>application processes are organized into an overlay network, in mesh or tree</li>
</ul>
</li>
<li><p>atomic multicast: messages are received either by every memeber or by none of them</p>
</li>
<li><p>reliable multicast: messages are delivered to all members in the best effort, but not guaranteed</p>
</li>
</ul>
<h3 id="gossip-based-communication"><a href="#gossip-based-communication" class="headerlink" title="gossip based communication"></a>gossip based communication</h3><ul>
<li>why? It can spread messages fast and reliably.</li>
<li>periodically transmit to b random targets</li>
<li>other nodes do same after receiving multicast</li>
</ul>
<h2 id="Chap-10-Naming"><a href="#Chap-10-Naming" class="headerlink" title="Chap 10 Naming"></a>Chap 10 Naming</h2><h3 id="definitions"><a href="#definitions" class="headerlink" title="definitions:"></a>definitions:</h3><ul>
<li>entity: any kind of object in distributed system:<br>process, file, printer, host, communication endpoint</li>
<li>naming services:<ul>
<li>usefulness: <ul>
<li>identification</li>
<li>providing detailed description</li>
<li>foundations for communication, security, auditing</li>
</ul>
</li>
</ul>
</li>
<li>name space:<ul>
<li>contains all valid names recognized and managed by a service</li>
</ul>
</li>
<li>naming domain:<ul>
<li>name space with a single administrative authority which manages names for the name space</li>
</ul>
</li>
<li>name resolution: <ul>
<li>a process to look up information&#x2F;attributes from a name</li>
<li>mounting: <ul>
<li>a directory node in a remote server can be mounted into a local node</li>
</ul>
</li>
</ul>
</li>
<li>name: set of bits&#x2F;characters used to refer to an entity&#x2F;a collective of entities, in a context</li>
<li>identifier: a name that uniquely identifies an entity</li>
<li>address: the name of an access point, the location of an entity</li>
</ul>
<h3 id="design-principles"><a href="#design-principles" class="headerlink" title="design principles:"></a>design principles:</h3><ul>
<li>flat naming:<ul>
<li>identifiers have no structured description, just a set of bits<br>m-bits in distributed hash table</li>
</ul>
</li>
<li>structured naming:<ul>
<li>hard links: multiple absolute paths names referring to the same node</li>
<li>symbolic links: leaf node storing an absolute path name</li>
</ul>
</li>
<li>attribute based naming:</li>
</ul>
<h3 id="naming-services"><a href="#naming-services" class="headerlink" title="naming services:"></a>naming services:</h3><ul>
<li>DNS</li>
<li>distributed naming service<ul>
<li>global layer: com, org, us, edu</li>
<li>administrational layer: yale.cs.linda</li>
<li>managerial layer: robot.txt</li>
</ul>
</li>
<li>iterative&#x2F;recursive name resolution<ul>
<li>client’s name resolver &#x3D;&gt; name server &#x3D;&gt;client’s name resolver </li>
<li>iterative name resolution at resolver side </li>
<li>iterative name resolution at server side</li>
<li>recursive name resolution</li>
</ul>
</li>
<li>administrative zones</li>
<li>caching servers<ul>
<li>scalabiltiy<ul>
<li>response time</li>
<li>fault tolerance</li>
</ul>
</li>
</ul>
</li>
<li>Directory Service(LDAP,RDF)<ul>
<li>LDAP implementation, flow</li>
</ul>
</li>
</ul>
<h3 id="attributed-based-naming"><a href="#attributed-based-naming" class="headerlink" title="attributed-based naming"></a>attributed-based naming</h3><ul>
<li>a tuple(attribute,value) can be used to describe a property</li>
<li>directory service</li>
<li>hierachical implementation: LDAP</li>
<li>decentralized implementations</li>
</ul>
<h3 id="name-and-name-services"><a href="#name-and-name-services" class="headerlink" title="name and name services"></a>name and name services</h3><h3 id="naming-space-and-implementation"><a href="#naming-space-and-implementation" class="headerlink" title="naming space and implementation"></a>naming space and implementation</h3><h3 id="flat-naming-and-simple-resolutions"><a href="#flat-naming-and-simple-resolutions" class="headerlink" title="flat naming and simple resolutions"></a>flat naming and simple resolutions</h3><h3 id="structured-naming"><a href="#structured-naming" class="headerlink" title="structured naming"></a>structured naming</h3><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><h2 id="Virtualization"><a href="#Virtualization" class="headerlink" title="Virtualization"></a>Virtualization</h2><h3 id="definitions-1"><a href="#definitions-1" class="headerlink" title="definitions"></a>definitions</h3><ul>
<li><p>hypervisor</p>
<ol>
<li>type 1:</li>
</ol>
<ul>
<li>right on top of computer hardware</li>
<li>all guest operating systems are a layer above the hypervisor</li>
</ul>
<ol start="2">
<li>type 2:  VMware workstation</li>
</ol>
<ul>
<li>run over a host OS</li>
<li>the second layer over the hardware</li>
<li>the guest OSs run a layer over the hypervisor(the third layer)</li>
</ul>
</li>
<li><p>virtual machine</p>
<ul>
<li>virtual machine layer, VMM, hypervisor: software that runs in a layer between a hypervisor&#x2F;host OS and one of more VMs</li>
</ul>
</li>
<li><p>full vs platform virtualization</p>
<ol>
<li>full virtualization    native VM<ul>
<li>complete simulation of underlying hardware, all instructions</li>
<li>hardware architectural support provided to allow virtualziation</li>
</ul>
</li>
<li>platform virtualization    hosted VM<ul>
<li>limited simulation of underlying hardware</li>
</ul>
</li>
</ol>
</li>
<li><p>native vs hosted VM</p>
</li>
</ul>
<h3 id="performance-x2F-efficiency-analysis"><a href="#performance-x2F-efficiency-analysis" class="headerlink" title="performance&#x2F;efficiency analysis"></a>performance&#x2F;efficiency analysis</h3><ul>
<li>virtual networking <ul>
<li>bridging: guest OS is given direct access to the host’s NIC independent of the host OS</li>
<li>NAT: guest OS is given a virtual NIC<br>network traffic &#x3D;&gt; virtual NIC &#x3D;&gt; host OS &#x3D;&gt; physical NIC</li>
<li>Host Only: virtual NIC has no direct route to physical NIC</li>
</ul>
</li>
<li>virtual IO<ul>
<li>emulation: scalable, low performance</li>
<li>direct IO: unscalable, high performance</li>
</ul>
</li>
<li>SRIOV<ul>
<li>solution to 50 VMs but 5 I&#x2F;O devices </li>
<li>allow PCIe device to present itself as multiple virtual interfaces </li>
<li>best performance</li>
<li>limitation: VF configuration depends on PF configuration, thus can not configure</li>
</ul>
</li>
<li>trade off</li>
</ul>
<h3 id="case-study"><a href="#case-study" class="headerlink" title="case study"></a>case study</h3><ul>
<li>XEN architecture<ul>
<li>domain 0 for control and I&#x2F;O</li>
</ul>
</li>
<li>Amazon AWS&#x2F;Google</li>
</ul>
<h3 id="virtual-machine"><a href="#virtual-machine" class="headerlink" title="virtual machine"></a>virtual machine</h3><h3 id="virtual-machine-architecture"><a href="#virtual-machine-architecture" class="headerlink" title="virtual machine architecture"></a>virtual machine architecture</h3><h3 id="virtual-I-x2F-O-and-networking"><a href="#virtual-I-x2F-O-and-networking" class="headerlink" title="virtual I&#x2F;O and networking"></a>virtual I&#x2F;O and networking</h3><h2 id="Chap-13-Peer-to-Peer-System"><a href="#Chap-13-Peer-to-Peer-System" class="headerlink" title="Chap 13, Peer to Peer System"></a>Chap 13, Peer to Peer System</h2><h3 id="history-Napster"><a href="#history-Napster" class="headerlink" title="history   Napster"></a>history   Napster</h3><ul>
<li>servers store table: filename, peer pointer(ip address, port number)</li>
<li>peers store their own files</li>
<li>all communications use TCP</li>
<li>problem: <ol>
<li>centralized server: congestion</li>
<li>centralized server: single point of failure</li>
<li>security: plaintext messages</li>
</ol>
</li>
</ul>
<h3 id="distributed-hash-table"><a href="#distributed-hash-table" class="headerlink" title="distributed hash table"></a>distributed hash table</h3><ul>
<li>to insert, lookup and delete objects with keys</li>
<li>key, object(file)</li>
</ul>
<h3 id="Chord"><a href="#Chord" class="headerlink" title="Chord"></a>Chord</h3><ul>
<li>finger table: ft[m] [0,m-1]<ul>
<li>ft[i] &#x3D; first peer with id &gt;&#x3D; (n+pow(2,i)) mod pow(2,m) </li>
<li>file is stored at first peer with id &gt;&#x3D; file_key mod pow(2,m)</li>
</ul>
</li>
<li>efficiency analysis: O(log(n)) for insertion and lookup given correct finger table entries</li>
<li>lookup algorithm, finger table<ul>
<li>local search</li>
<li>query largest successor&#x2F;finger table entry &lt;&#x3D; k</li>
<li>if none exist, query next successor</li>
</ul>
</li>
<li>new nodes joining</li>
<li>stablization algorithm: O(n^2) rounds for strict stablization</li>
<li>rate of churn per hour: define r(successor and predecessor)</li>
</ul>
<h2 id="Failure-Detection"><a href="#Failure-Detection" class="headerlink" title="Failure Detection"></a>Failure Detection</h2><h3 id="two-different-system-models"><a href="#two-different-system-models" class="headerlink" title="two different system models"></a>two different system models</h3><ul>
<li>synchronous distributed system</li>
<li>asynchronous distributed system   <ul>
<li>no bounds on process execution</li>
<li>no bounds on message transmission delay </li>
<li>the Internet</li>
</ul>
</li>
</ul>
<h3 id="failure-model"><a href="#failure-model" class="headerlink" title="failure model"></a>failure model</h3><ul>
<li>process omission failure<ul>
<li>crash-stop</li>
<li>crash-recovery</li>
</ul>
</li>
</ul>
<h3 id="type-of-failure-detection"><a href="#type-of-failure-detection" class="headerlink" title="type of failure detection"></a>type of failure detection</h3><ul>
<li>process failure</li>
<li>arbitrary failure<ul>
<li>arbitrary process failure</li>
<li>arbitrary channel failure</li>
</ul>
</li>
<li>communication failure<ul>
<li>send omission</li>
<li>channel omission</li>
<li>receive omission</li>
</ul>
</li>
<li>completeness and accuracy<ul>
<li>completness: no misses</li>
<li>accuracy: no mistakes<br>Every detected failure corresponds to a crashed process.</li>
</ul>
</li>
<li>synchronous and asynchronous model</li>
<li>measuring accuracy(metrics)<ul>
<li>speed: detection time</li>
<li>accuracy: <ol>
<li>mistake recurrence time</li>
<li>mistake duration time</li>
<li>number of false failure detections per time</li>
<li>number of undetected failures per time</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="process-failure"><a href="#process-failure" class="headerlink" title="process failure"></a>process failure</h3><p>pj fails</p>
<ul>
<li>ping-ack<br>pi Ping&#x3D;&gt; pj, pj Ack&#x3D;&gt; pi</li>
<li>heartbeat<br>pj Heartbeat&#x3D;&gt; pi</li>
<li>satifies completness and accuracy in synchronous systems</li>
<li>satifies completness and probabilistic accuracy in asynchronous systems</li>
</ul>
<h3 id="implement-heartbeat-in-a-distributed-system-environment"><a href="#implement-heartbeat-in-a-distributed-system-environment" class="headerlink" title="implement heartbeat in a distributed system environment"></a>implement heartbeat in a distributed system environment</h3><ul>
<li>want all to know the failure</li>
<li>combine failure detection with a dissemination protocol</li>
<li>central, ring, all-to-all</li>
<li>heartbeat combined reliable multicast protocol</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/12/04/COEN317_final/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/04/COEN317_final/" class="post-title-link" itemprop="url">COEN317 Final Review</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-04 16:34:54" itemprop="dateCreated datePublished" datetime="2022-12-04T16:34:54+08:00">2022-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-05 11:49:59" itemprop="dateModified" datetime="2022-12-05T11:49:59+08:00">2022-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="COEN317-Final-Review"><a href="#COEN317-Final-Review" class="headerlink" title="COEN317 Final Review"></a>COEN317 Final Review</h1><h2 id="Global-Time-and-Global-State"><a href="#Global-Time-and-Global-State" class="headerlink" title="Global Time and Global State"></a>Global Time and Global State</h2><ul>
<li>Asynchronous distributed systems consist of several  processes without common memory which communicate  via messages with <strong>unpredictable transmission delays</strong></li>
<li>Global time &amp; global state are hard to realize in distributed  systems<ul>
<li>Processes are distributed geographically</li>
<li>Rate of event occurrence can be high (unpredictable)</li>
<li>Event execution times can be small</li>
</ul>
</li>
<li>We can only approximate the global view<ul>
<li>Simulate a global time – Logical Clocks</li>
<li>Simulate a global state – Global Snapshots</li>
</ul>
</li>
</ul>
<h2 id="Simulating-global-time"><a href="#Simulating-global-time" class="headerlink" title="Simulating global time"></a>Simulating global time</h2><ul>
<li><p>An accurate notion of global time is difficult to achieve in distributed systems.</p>
<ul>
<li>We often derive “causality” from loosely synchronized clocks</li>
</ul>
</li>
<li><p>Clocks in a distributed system drift</p>
<ul>
<li>Relative to each other</li>
<li>Relative to a real world clock<ul>
<li>Determination of this real world clock itself may be an issue</li>
</ul>
</li>
<li>Clock Skew versus Drift<ul>
<li>Clock Skew &#x3D; Relative Difference in clock values of two processes</li>
<li>Clock Drift &#x3D; Relative Difference in clock frequencies (rates) of two  processes</li>
</ul>
</li>
</ul>
</li>
<li><p>Clock synchronization is needed to simulate global time</p>
<ul>
<li>Correctness – consistency, fairness</li>
</ul>
</li>
<li><p>Physical Clocks vs. Logical clocks </p>
<ul>
<li>Physical clocks - must not deviate from the real-time by more than a  certain amount.</li>
</ul>
</li>
</ul>
<h2 id="Cristian’s-Time-Server-Algorithm"><a href="#Cristian’s-Time-Server-Algorithm" class="headerlink" title="Cristian’s (Time Server) Algorithm"></a>Cristian’s (Time Server) Algorithm</h2><ul>
<li><p>Uses <strong>a time server</strong> to synchronize clocks</p>
<ul>
<li>Time server keeps the reference time (say UTC)</li>
<li>A client asks the time server for time, the server responds with its current  time, and the client uses the received value <strong>T</strong> to set its clock</li>
</ul>
</li>
<li><p>But network round-trip time introduces errors…</p>
<ul>
<li><p>Let <strong>RTT</strong> &#x3D; response-received-time – request-sent-time (measurable at  client),</p>
</li>
<li><p>If we know </p>
<ul>
<li>(a) <strong>min1</strong> &#x3D; minimum P -&gt; S latency </li>
<li>(b) <strong>min2</strong> &#x3D; minimum S -&gt; P latency </li>
<li>(c) that the server timestamped the message at the last possible instant  before sending it back</li>
</ul>
</li>
<li><p>Then, the actual time could be between <strong>[T+min2,T+RTT— min1]</strong></p>
</li>
<li><p>P sets its time to halfway through this interval</p>
<ul>
<li>To: t + (RTT+min2-min1)&#x2F;2</li>
</ul>
</li>
<li><p>Error is at most (RTT-min2-min1)&#x2F;2 </p>
<ul>
<li>Bounded!</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Berkeley-UNIX-algorithm"><a href="#Berkeley-UNIX-algorithm" class="headerlink" title="Berkeley UNIX algorithm"></a>Berkeley UNIX algorithm</h2><ul>
<li>One daemon without UTC</li>
<li>Periodically, this <strong>daemon</strong> polls and asks all the machines for their  time</li>
<li>The machines respond.</li>
<li>The daemon computes an average time and then broadcasts this  average time.</li>
</ul>
<h2 id="Decentralized-Averaging-Algorithm"><a href="#Decentralized-Averaging-Algorithm" class="headerlink" title="Decentralized Averaging Algorithm"></a>Decentralized Averaging Algorithm</h2><ul>
<li>Each machine has a daemon without UTC</li>
<li>Periodically, at fixed agreed-upon times, each machine broadcasts its  local time.</li>
<li>Each of them calculates the average time by averaging all the received  local times.</li>
</ul>
<h2 id="Network-Time-Protocol-NTP"><a href="#Network-Time-Protocol-NTP" class="headerlink" title="Network Time Protocol (NTP)"></a>Network Time Protocol (NTP)</h2><ul>
<li>Most widely used physical clock synchronization protocol on the Internet</li>
<li>Hierarchical tree of time servers.<ul>
<li>The primary server at the root synchronizes with the UTC.</li>
<li>Secondary servers - backup to primary server.</li>
<li>Lowest</li>
<li>synchronization subnet with clients.</li>
</ul>
</li>
</ul>
<p><img src="/images/317/NTP.JPG"></p>
<p><img src="/images/317/NTP1.JPG"></p>
<p><img src="/images/317/NTP2.JPG"></p>
<p><img src="/images/317/NTP3.JPG"></p>
<p><img src="/images/317/NTP4.JPG"></p>
<h2 id="Event-Ordering"><a href="#Event-Ordering" class="headerlink" title="Event Ordering"></a>Event Ordering</h2><ul>
<li>Lamport defined the “happens before” (-&gt;) relation<ul>
<li>If a and b are events in the same process, and a occurs before b, then  a-&gt;b.</li>
<li>If a is the event of a message being sent by one process and b is the  event of the message being received by another process, then a -&gt; b.</li>
<li>If X -&gt; Y and Y-&gt; Z then X -&gt; Z.</li>
</ul>
</li>
<li>If a -&gt; b then time (a) &lt; time (b)</li>
</ul>
<h2 id="Causal-Ordering"><a href="#Causal-Ordering" class="headerlink" title="Causal Ordering"></a>Causal Ordering</h2><ul>
<li><p>“Happens Before” also called causal ordering</p>
</li>
<li><p>Possible to draw a causality relation between 2 events if</p>
<ul>
<li>They happen in the same process</li>
<li>There is a chain of messages between them</li>
</ul>
</li>
<li><p>“Happens Before” notion is not straightforward in distributed system</p>
<ul>
<li><p>No guarantees of synchronized clocks</p>
</li>
<li><p>Communication latency</p>
</li>
</ul>
</li>
</ul>
<h2 id="Types-of-Logical-Clocks"><a href="#Types-of-Logical-Clocks" class="headerlink" title="Types of Logical Clocks"></a>Types of Logical Clocks</h2><ul>
<li>Systems of logical clocks differ in their representation of logical time  and also in the protocol to update the logical clocks.</li>
<li>2 kinds of logical clocks<ul>
<li>Lamport</li>
<li>Vector</li>
</ul>
</li>
</ul>
<h2 id="Lamport-Clock"><a href="#Lamport-Clock" class="headerlink" title="Lamport Clock"></a>Lamport Clock</h2><ul>
<li><p>Proposed by Lamport in 1978 as an attempt to totally order events in  a distributed system.</p>
</li>
<li><p>Each process uses a local counter (clock) which is an integer</p>
<ul>
<li><p>initial value of counter is set to a non-negative integer or zero</p>
</li>
<li><p>A process increments its counter when a send or an instruction happens at it.</p>
<p>The counter is assigned to the event as its timestamp.</p>
</li>
<li><p>Each process keeps its own logical clock used to timestamp events</p>
</li>
</ul>
</li>
<li><p>A send (message) event carries its timestamp</p>
</li>
<li><p>For a receive (message) event the counter is updated by</p>
<ul>
<li>max(local clock, message timestamp) + 1</li>
</ul>
</li>
</ul>
<p><img src="/images/317/Lamport1.JPG"></p>
<h2 id="Vector-Timestamp"><a href="#Vector-Timestamp" class="headerlink" title="Vector Timestamp"></a>Vector Timestamp</h2><ul>
<li>In the system of vector clocks, the time domain is represented by a set of  n-dimensional non-negative integer vectors.</li>
<li>Each process has a clock Ci consisting of a vector of length n, where n is  the total number of processes vt[1..n], where vt[j ] is the local logical  clock of Pj and describes the logical time progress at process Pj .</li>
<li>Incrementing vector clocks<ul>
<li>On an instruction or send event at process i, it increments only its ith element of its vector clock</li>
</ul>
</li>
<li>Each message carries the send-event’s vector timestamp  Vmessage[1…N]</li>
<li>On receiving a message at process i:<ul>
<li>Vi[i] &#x3D; Vi[i] + 1</li>
<li>Vi[j] &#x3D; max(Vmessage[j], Vi[j]) for j≠ i</li>
</ul>
</li>
<li>Vector Clocks example</li>
</ul>
<p><img src="/images/317/Vector.JPG"></p>
<p><img src="/images/317/Vector1.JPG"></p>
<p><img src="/images/317/Vector2.JPG"></p>
<p><img src="/images/317/Vector3.JPG"></p>
<p><img src="/images/317/Vector4.JPG"></p>
<h2 id="Global-State"><a href="#Global-State" class="headerlink" title="Global State"></a>Global State</h2><ul>
<li>Recording the global state of a distributed system on-the-fly is an  important paradigm.<ul>
<li>Challenge: lack of globally shared memory, global clock and unpredictable message  delays in a distributed system</li>
</ul>
</li>
<li>Notions of global time and global state closely related</li>
<li>A process can (without freezing the whole computation) compute the  best possible approximation of global state</li>
<li>A global state that could have occurred<ul>
<li>No process in the system can decide whether the state did really occur</li>
<li>Guarantee stable properties (i.e. once they become true, they remain true)</li>
</ul>
</li>
</ul>
<h2 id="Consistent-Cuts"><a href="#Consistent-Cuts" class="headerlink" title="Consistent Cuts"></a>Consistent Cuts</h2><ul>
<li>A cut (or time slice) is a zigzag line cutting a time diagram  into 2 parts (past and future)</li>
<li>Consistent Cut: a cut that obeys causality<ul>
<li>A cut C is a consistent cut if and only if:<ul>
<li>for (each pair of events e, f in the system)</li>
<li>Such that event e is in the cut C, and if f-&gt;e (f happens-before e)</li>
<li>Then: Event f is also in the cut C</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/317/Cut.JPG"></p>
<h2 id="System-Model-for-Global-Snapshots"><a href="#System-Model-for-Global-Snapshots" class="headerlink" title="System Model for Global Snapshots"></a>System Model for Global Snapshots</h2><ul>
<li>The system consists of a collection of n processes p1, p2, …, pn that are  connected by channels.</li>
<li>There are no globally shared memory and physical global clock and processes  communicate by passing messages through communication channels.</li>
<li>Cij denotes the channel from process pi to process pj and its state is denoted by Si</li>
<li>The actions performed by a process are modeled as three types of events:<ul>
<li>Internal events,the message send event and the message receive event.</li>
<li>For a message mij that is sent by process pi to process pj , let send(mij ) and rec(mij ) denote  its send and receive events.</li>
</ul>
</li>
</ul>
<h2 id="Chandy-Lamport-Distributed-Snapshot-Algorithm"><a href="#Chandy-Lamport-Distributed-Snapshot-Algorithm" class="headerlink" title="Chandy-Lamport Distributed Snapshot Algorithm"></a>Chandy-Lamport Distributed Snapshot Algorithm</h2><ul>
<li>Assumes FIFO communication in channels</li>
<li>Uses a marker message to separate messages in the channels.<ul>
<li>After a process has recorded its snapshot, it sends a marker, along all of its  outgoing channels before sending out any more messages.</li>
<li>The marker separates the messages in the channel into those to be included  in the snapshot from those not to be recorded in the snapshot.</li>
</ul>
</li>
<li>A process must record its snapshot no later than when it receives a marker on  any of its incoming channels.</li>
<li>The algorithm terminates after each process has received a marker on all of its  incoming channels.</li>
<li>All the local snapshots get disseminated to all other processes and all the  processes can determine the global state</li>
</ul>
<p><img src="/images/317/Chandy_Lamport1.JPG"></p>
<p><img src="/images/317/Chandy_Lamport2.JPG"></p>
<p><img src="/images/317/Chandy_Lamport3.JPG"></p>
<ul>
<li>Global Snapshot calculated by Chandy-Lamport algorithm is  causally correct</li>
</ul>
<h2 id="Distributed-Mutual-Exclusion"><a href="#Distributed-Mutual-Exclusion" class="headerlink" title="Distributed Mutual Exclusion"></a>Distributed Mutual Exclusion</h2><ul>
<li>Mutual exclusion<ul>
<li>ensures that concurrent processes have serialized access to  shared resources - the critical section problem</li>
<li>At any point in time, only one process can be executing in its  critical section</li>
</ul>
</li>
<li>Shared variables (semaphores) cannot be used in a distributed  system<ul>
<li>Mutual exclusion must be based on message passing, in the  context of unpredictable delays and incomplete knowledge</li>
</ul>
</li>
</ul>
<h2 id="Approaches-to-Distributed-Mutual-Exclusion"><a href="#Approaches-to-Distributed-Mutual-Exclusion" class="headerlink" title="Approaches to Distributed Mutual Exclusion"></a>Approaches to Distributed Mutual Exclusion</h2><ul>
<li>Central coordinator-based approach<ul>
<li>A centralized coordinator determines who enters the CS</li>
</ul>
</li>
<li>Distributed approaches to mutual exclusion<ul>
<li>Token based approach<ul>
<li>A unique token is shared among the processes. A process is allowed to  enter its CS if it possesses the token.</li>
<li>Mutual exclusion is ensured because the token is unique.</li>
</ul>
</li>
<li>Non-token based approach<ul>
<li>Two or more successive rounds of messages are exchanged among the  processes to determine which process will enter the CS next.</li>
</ul>
</li>
<li>Quorum based approach<ul>
<li>Each process requests permission to execute the CS from a subset of  processes (called a quorum).</li>
<li>Any two quorums contain a common process. This common process makes sure that only one request executes the CS at any time.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Requirements-x2F-Conditions"><a href="#Requirements-x2F-Conditions" class="headerlink" title="Requirements&#x2F;Conditions"></a>Requirements&#x2F;Conditions</h3><ul>
<li>Safety Property<ul>
<li>At any instant, only one process can execute the critical section.</li>
</ul>
</li>
<li>Liveness Property<ul>
<li>This property states the absence of deadlock and starvation. Two or more  processess should not endlessly wait for messages which will never arrive.</li>
</ul>
</li>
<li>Ordering&#x2F;Fairness<ul>
<li>Each process gets a fair chance to execute the CS which means the CS  execution requests are executed in the order of their arrival (time is  determined by a logical clock) in the system.</li>
</ul>
</li>
</ul>
<h2 id="Mutual-Exclusion-Techniques-Covered"><a href="#Mutual-Exclusion-Techniques-Covered" class="headerlink" title="Mutual Exclusion Techniques Covered"></a>Mutual Exclusion Techniques Covered</h2><ul>
<li><p>Central Coordinator Algorithm</p>
<p><img src="/images/317/central_coordinator.JPG"></p>
</li>
<li><p>In a distributed environment it seems more natural to implement  mutual exclusion, based upon distributed agreement - not on a  central coordinator.</p>
</li>
<li><p>Distributed Non-token based</p>
<ul>
<li>Ricart-Agrawala Algorithm</li>
<li>Maekawa’s Algorithm</li>
</ul>
</li>
</ul>
<h2 id="Ricart-Agrawala-Algorithm"><a href="#Ricart-Agrawala-Algorithm" class="headerlink" title="Ricart-Agrawala Algorithm"></a>Ricart-Agrawala Algorithm</h2><ul>
<li>Uses only two types of messages – REQUEST and REPLY.</li>
<li>It is assumed that all processes keep a (Lamport’s) logical clock which is updated  according to the clock rules.<ul>
<li>Requests are ordered according to their global logical timestamps; if  timestamps are equal, process identifiers are compared to order them.</li>
</ul>
</li>
<li>The process that requires entry to a CS multicasts the request message to all  other processes competing for the same resource.<ul>
<li>Process is allowed to enter the CS when all processes have replied to this  message.</li>
<li>The request message consists of the requesting process’ timestamp (logical  clock) and its identifier.</li>
</ul>
</li>
<li>Each process keeps its state with respect to the CS: released, requested, or held.</li>
</ul>
<p><img src="/images/317/RA.JPG"></p>
<h3 id="Analysis-Ricart-Agrawala’s-Algorithm"><a href="#Analysis-Ricart-Agrawala’s-Algorithm" class="headerlink" title="Analysis: Ricart-Agrawala’s Algorithm"></a>Analysis: Ricart-Agrawala’s Algorithm</h3><ul>
<li>Safety<ul>
<li>Two processes Pi and Pj cannot both have access to CS</li>
</ul>
</li>
<li>Liveness<ul>
<li>Worst-case: wait for all other (N-1) processes to send Reply</li>
</ul>
</li>
<li>Ordering<ul>
<li>Requests with lower Lamport timestamps are granted earlier</li>
</ul>
</li>
</ul>
<h3 id="Performance-Ricart-Agrawala’s-Algorithm"><a href="#Performance-Ricart-Agrawala’s-Algorithm" class="headerlink" title="Performance: Ricart-Agrawala’s Algorithm"></a>Performance: Ricart-Agrawala’s Algorithm</h3><ul>
<li>Bandwidth: 2*(N-1) messages per enter() operation</li>
<li>Client delay: one round-trip time</li>
<li>Synchronization delay: one message transmission time</li>
</ul>
<h2 id="Quorum-Based-–-Maekawa’s-Algorithm"><a href="#Quorum-Based-–-Maekawa’s-Algorithm" class="headerlink" title="Quorum-Based – Maekawa’s Algorithm"></a>Quorum-Based – Maekawa’s Algorithm</h2><ul>
<li><p>Site obtains permission only from a subset of sites to enter CS</p>
</li>
<li><p>Multicasts messages to a voting subset of processes</p>
<ul>
<li><p>Each process pi is associated with a voting set vi (of processes)</p>
<ul>
<li>Each process belongs to its own voting set</li>
<li>The intersection of any two voting sets is non-empty</li>
<li>Each voting set is of size K</li>
<li>Each process belongs to M other voting sets</li>
</ul>
</li>
<li><p>To access a critical section, pi requests permission from all other processes in  its own voting set vi</p>
<ul>
<li><p>Voting set member gives permission to only one requestor at a time, and  queues all other requests</p>
</li>
<li><p>Guarantees safety </p>
</li>
<li><p>May not guarantee liveness (may deadlock)</p>
<p><img src="/images/317/M_liveness.JPG"></p>
</li>
<li><p>Maekawa showed that K&#x3D;M&#x3D;N^0.5 works best</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/317/Maekawa1.JPG"></p>
<p><img src="/images/317/Maekawa2.JPG"></p>
<h2 id="Election-Algorithms"><a href="#Election-Algorithms" class="headerlink" title="Election Algorithms"></a>Election Algorithms</h2><ul>
<li>It doesn’t matter which process is elected.<ul>
<li>What is important is that one and only one process is chosen (we call this  process the coordinator) and all processes agree on this decision</li>
</ul>
</li>
<li>Assume that each process has a unique number (identifier)<ul>
<li>In general, election algorithms attempt to locate the process with the highest  number, among those which currently are up</li>
</ul>
</li>
<li>Election is typically started after a failure occurs<ul>
<li>The detection of a failure (e.g. the crash of the current coordinator) is  normally based on time-out → a process that gets no response for a period of  time suspects a failure and initiates an election process.</li>
</ul>
</li>
<li>An election process is typically performed in two phases:<ul>
<li>Select a leader with the highest priority.</li>
<li>Inform all processes about the winner.</li>
</ul>
</li>
</ul>
<h2 id="The-Ring-based-Algorithm"><a href="#The-Ring-based-Algorithm" class="headerlink" title="The Ring-based Algorithm"></a>The Ring-based Algorithm</h2><ul>
<li>We assume that the processes are arranged in a logical ring<ul>
<li>Each process knows the address of one other process, which is its  neighbor in the clockwise direction</li>
</ul>
</li>
<li>The algorithm elects a single coordinator, which is the highest id process.</li>
<li>Election is started by a process which detects the coordinator failure<ul>
<li>The process prepares an election message which includes its id and passed it to the successor process.</li>
<li>When a process receives an election message<ul>
<li>It compares the identifier in the message with its own</li>
<li>If the arrived identifier is greater, it forwards the received election  message to its neighbor</li>
<li>If the arrived identifier is smaller, it substitutes its own identifier in the  election message before forwarding it.</li>
<li>If the received id is that of the receiver itself → this will be the  coordinator.</li>
</ul>
</li>
</ul>
</li>
<li>The new coordinator sends an elected message through the ring</li>
</ul>
<p><img src="/images/317/ring.JPG"></p>
<h2 id="The-Bully-Algorithm"><a href="#The-Bully-Algorithm" class="headerlink" title="The Bully Algorithm"></a>The Bully Algorithm</h2><ul>
<li>A process has to know the identifier of all other processes <ul>
<li>(it doesn’t know, however, which one is still up); the process with the highest identifier, among those which are  up, is selected.</li>
</ul>
</li>
<li>Any process could fail during the election procedure.</li>
<li>When a process Pi detects a failure and a coordinator has to be elected<ul>
<li>it sends an election message to all the processes with a higher identifier and then waits for an answer message:</li>
<li>If no response arrives within a time limit<ul>
<li>Pi becomes the coordinator (all processes with higher identifier are down)</li>
<li>it broadcasts a coordinator message to all processes to let them know.</li>
</ul>
</li>
<li>If an answer message arrives, <ul>
<li>Pi knows that another process has to become the coordinator → it waits in order to receive the  coordinator message.</li>
<li>If this message fails to arrive within a time limit (which means that a potential coordinator crashed after  sending the answer message) Pi resends the election message.</li>
</ul>
</li>
</ul>
</li>
<li>When receiving an election message from Pi<ul>
<li>a process Pj replies with an answer message to Pi and</li>
<li>then starts an election procedure itself( unless it has already started one) it sends an election message to all  processes with higher identifier.</li>
</ul>
</li>
<li>Finally all processes get an answer message, except the one which becomes the coordinator.</li>
</ul>
<p><img src="D:\Blog\source\images\317\bully.JPG"></p>
<h2 id="Distributed-File-System-DFS"><a href="#Distributed-File-System-DFS" class="headerlink" title="Distributed File System (DFS)"></a>Distributed File System (DFS)</h2><ul>
<li>Files are stored on a server machine<ul>
<li>client machine does RPCs to server to perform operations on file</li>
</ul>
</li>
<li>Desirable Properties from a DFS<ul>
<li>Transparency: client accesses DFS files as if it were accessing local files<ul>
<li>Same API as local files, i.e., client code doesn’t change</li>
<li>Need to make location, replication, etc. invisible to client</li>
</ul>
</li>
<li>Support concurrent clients<ul>
<li>Multiple client processes reading&#x2F;writing the file concurrently</li>
</ul>
</li>
</ul>
</li>
<li>Replication: for fault-tolerance</li>
</ul>
<h2 id="File-Sharing-Semantics"><a href="#File-Sharing-Semantics" class="headerlink" title="File Sharing Semantics"></a>File Sharing Semantics</h2><ul>
<li>One-copy Serializability<ul>
<li>Updates are written to the single copy and are available immediately</li>
</ul>
</li>
<li>Serializability<ul>
<li>Transaction semantics (file locking protocols implemented - share for  read, exclusive for write).</li>
</ul>
</li>
</ul>
<h2 id="Example-Sun-NFS"><a href="#Example-Sun-NFS" class="headerlink" title="Example: Sun-NFS"></a>Example: Sun-NFS</h2><ul>
<li><p>Network File System</p>
</li>
<li><p>Supports heterogeneous systems</p>
</li>
<li><p>Architecture</p>
<ul>
<li>Server exports one or more directory trees for access by  remote clients</li>
<li>Clients access exported directory trees by mounting them  to the client local tree</li>
</ul>
</li>
<li><p>Protocols</p>
<ul>
<li>Mounting protocol</li>
<li>Directory and file access protocol - stateless, no open-close  messages, full access path on read&#x2F;write</li>
</ul>
</li>
</ul>
<h3 id="NFS-Architecture"><a href="#NFS-Architecture" class="headerlink" title="NFS Architecture"></a>NFS Architecture</h3><p><img src="/images/317/NFS.JPG"></p>
<h2 id="Example-Andrew-File-System"><a href="#Example-Andrew-File-System" class="headerlink" title="Example: Andrew File System"></a>Example: Andrew File System</h2><ul>
<li><p>Designed at CMU</p>
<ul>
<li>Named after Andrew Carnegie and Andrew Mellon, the “C” and  “M” in CMU</li>
</ul>
</li>
<li><p>In use today in some clusters (especially University  clusters)</p>
</li>
<li><p>Supports information sharing on a large scale</p>
</li>
<li><p>Uses a session semantics</p>
<ul>
<li>Entire file is copied to the local machine (Venus) from the server  (Vice) when open. If file is changed, it is copied to server when  closed.<ul>
<li>Works because in practice, most files are changed by one  person</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Replication"><a href="#Replication" class="headerlink" title="Replication"></a>Replication</h2><ul>
<li><p>Enhances a service by replicating data</p>
<ul>
<li><p>Increased Availability</p>
<ul>
<li>Of service. When servers fail or when the network is partitioned.</li>
</ul>
</li>
<li><p>Fault Tolerance</p>
<ul>
<li>Under the fail-stop model, if up to f of f+1 servers crash, at least one is alive</li>
</ul>
</li>
<li><p>Load Balancing</p>
<ul>
<li>One approach: Multiple server IPs can be assigned to the same name in DNS,  which returns answers round-robin.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Passive-Replication"><a href="#Passive-Replication" class="headerlink" title="Passive Replication"></a>Passive Replication</h3><ul>
<li><p>uses a primary replica (master)</p>
<p>master: elected leader</p>
</li>
</ul>
<p><img src="/images/317/passive_replication.JPG"></p>
<h3 id="Active-Replication"><a href="#Active-Replication" class="headerlink" title="Active Replication"></a>Active Replication</h3><ul>
<li><p>treats all replicas identically</p>
</li>
<li><p>multicast inside replica group</p>
</li>
<li><p>can use any flavor of multicast ordering</p>
<ul>
<li>FIFO ordering</li>
<li>causal ordering</li>
<li>total ordering</li>
<li>hybrid ordering</li>
</ul>
</li>
</ul>
<p><img src="/images/317/active_replication.JPG"></p>
<h2 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h2><ul>
<li><p>Sequence of Read&#x2F;Write operations that act as ONE unit of execution</p>
</li>
<li><p>ACID Properties</p>
<ul>
<li>Atomicity<ul>
<li>All or nothing</li>
<li>a transaction should either <ul>
<li>i)complete successfully, so its effects are recorded in the  server objects; </li>
<li>or ii) the transaction has no effect at all.</li>
</ul>
</li>
</ul>
</li>
<li>Consistency<ul>
<li>if the server starts in a consistent state,  the transaction ends the server in a consistent state.</li>
</ul>
</li>
<li>Isolation<ul>
<li>Each transaction must be performed  without interference from other transactions</li>
<li>i.e.,  non-final effects of a transaction must not be visible  to other transactions</li>
</ul>
</li>
<li>Durability<ul>
<li>After a transaction has completed  successfully, all its effects are saved in permanent  storage.</li>
</ul>
</li>
</ul>
</li>
<li><p>Serializable Schedule </p>
<ul>
<li>Goal: increase <strong>concurrency</strong> while maintaining  <strong>correctness (ACID)</strong></li>
<li>Equivalent to some Serial execution → Correctness</li>
<li>Serial Equivalency Test</li>
</ul>
</li>
<li><p>serial</p>
<ul>
<li>An interleaving (say O) of transaction operations is  <strong>serially equivalent</strong> iff (if and only if):<ul>
<li>Cannot distinguish end-result of real  operation O from (fake) serial transaction order O’</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Distributed-Transactions"><a href="#Distributed-Transactions" class="headerlink" title="Distributed Transactions"></a>Distributed Transactions</h2><ul>
<li>Transactions distributed based on which entity hosts the  object&#x2F;replica</li>
<li>One-phase Commit: Issues<ul>
<li>Server with object has no say in whether transaction  commits or aborts<ul>
<li>If object corrupted, it just cannot commit (while other servers have  committed)</li>
</ul>
</li>
<li>Server may crash before receiving commit message,  with some updates still in memory</li>
</ul>
</li>
<li>Uses 2 Phase Commit protocol for guaranteeing atomic commit (in  contrast to 1 Phase Commit)<ul>
<li>Failures in Two-phase Commit <ul>
<li>To deal with server crashes<ul>
<li>Each server saves tentative updates into permanent storage, right  before replying Yes&#x2F;No in first phase. Retrievable after crash  recovery</li>
</ul>
</li>
<li>To deal with coordinator crashes<ul>
<li>Coordinator logs all decisions and received&#x2F;sent messages on disk</li>
<li>After recovery or new election &#x3D;&gt; new coordinator takes over</li>
</ul>
</li>
<li>To deal with Yes&#x2F;No message loss, <ul>
<li>coordinator aborts  the transaction after a timeout (pessimistic!)</li>
</ul>
</li>
<li>To deal with Commit or Abort message loss<ul>
<li>Server can poll coordinator (repeatedly)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Concurrency-Control"><a href="#Concurrency-Control" class="headerlink" title="Concurrency Control"></a>Concurrency Control</h2><ul>
<li>Optimistic Concurrency Control<ul>
<li>Used in Dropbox, Google apps, Wikipedia, key-value  stores like Cassandra, Riak, and Amazon’s Dynamo</li>
<li>Used for Read&#x2F;Read-Only transaction</li>
<li>Allow the transaction to execute</li>
<li>If Serial Equivalency passed, then commit. Otherwise, abort</li>
</ul>
</li>
<li>Pessimistic Concurrency Control<ul>
<li>Use Locking (Mutual Exclusion)</li>
</ul>
</li>
<li>2 Phase Locking protocol (2PL)<ul>
<li>Growing&#x2F;expanding phase – Acquire locks</li>
<li>Shrinking phase – release locks and no new locks can be acquired</li>
</ul>
</li>
<li>Strict 2PL – hold on to locks until transactions commits&#x2F;aborts</li>
</ul>
<h2 id="Deadlocks"><a href="#Deadlocks" class="headerlink" title="Deadlocks"></a>Deadlocks</h2><ul>
<li><p>3 necessary conditions for a deadlock to occur</p>
<ol>
<li>Some objects are accessed in exclusive lock modes</li>
<li>Transactions holding locks cannot be preempted</li>
<li>There is a circular wait (cycle) in the Wait-for graph</li>
</ol>
</li>
</ul>
<h2 id="Handling-Deadlocks"><a href="#Handling-Deadlocks" class="headerlink" title="Handling Deadlocks"></a>Handling Deadlocks</h2><ol>
<li><p>Lock timeout: </p>
<ul>
<li>abort transaction if lock cannot be  acquired within timeout</li>
<li>Expensive; leads to wasted work</li>
</ul>
</li>
<li><p>Deadlock Detection:</p>
<ul>
<li>keep track of Wait-for graph (e.g., via Global  Snapshot algorithm), and</li>
<li>find cycles in it (e.g., periodically)</li>
<li>If find cycle, there’s a deadlock &#x3D;&gt; Abort one or  more transactions to break cycle</li>
<li>Still allows deadlocks to occur</li>
</ul>
</li>
<li><p>Deadlock Prevention</p>
</li>
</ol>
<ul>
<li><p>Set up the system so one of the necessary conditions is violated</p>
<ol>
<li><p>Some objects are accessed in exclusive lock modes</p>
<p>Fix: Allow read-only access to objects</p>
</li>
<li><p>Transactions holding locks cannot be preempted</p>
<p>Fix: Allow preemption of some transactions</p>
</li>
<li><p>There is a circular wait (cycle) in the Wait-for graph</p>
<p>Fix: Lock all objects in the beginning; if fail any, abort  transaction &#x3D;&gt; No cycles in Wait-for graph</p>
</li>
</ol>
</li>
</ul>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><ul>
<li>Threats<ul>
<li>Leakage<ul>
<li>Unauthorized access to service or data</li>
<li>E.g., Someone knows your bank balance</li>
</ul>
</li>
<li>Tampering<ul>
<li>Unauthorized modification of service or data</li>
<li>E.g., Someone modifies your bank balance</li>
</ul>
</li>
<li>Vandalism<ul>
<li>Interference with normal service, without  direct gain to attacker</li>
<li>E.g., Denial of Service attacks</li>
</ul>
</li>
</ul>
</li>
<li>Common Attacks<ul>
<li>Eavesdropping<ul>
<li>Attacker taps into network</li>
</ul>
</li>
<li>Masquerading<ul>
<li>Attacker pretends to be someone else, i.e.,  identity theft</li>
</ul>
</li>
<li>Message tampering<ul>
<li>Attacker modifies messages</li>
</ul>
</li>
<li>Replay attack<ul>
<li>Attacker replays old messages</li>
</ul>
</li>
<li>Denial of service<ul>
<li>bombard a port</li>
</ul>
</li>
</ul>
</li>
<li>CIA properties<ul>
<li>Confidentiality<ul>
<li>Protection against disclosure to unauthorized  individuals</li>
<li>Addresses Leakage threat</li>
</ul>
</li>
<li>Integrity<ul>
<li>Protection against unauthorized alteration or  corruption</li>
<li>Addresses Tampering threat</li>
</ul>
</li>
<li>Availability<ul>
<li>Service&#x2F;data is always readable&#x2F;writable</li>
<li>Addresses Vandalism threat</li>
</ul>
</li>
</ul>
</li>
<li>Policy vs Mechanism<ul>
<li>Many scientists (e.g., Hansen) have argued for a  separation of policy vs. mechanism</li>
<li>A security policy indicates what a secure system  accomplishes</li>
<li>A security mechanism indicates how these goals  are accomplished</li>
<li>E.g.,<ul>
<li>Policy: in a file system, only authorized individuals  allowed to access files (i.e., CIA properties)</li>
<li>Mechanism: Encryption, capabilities, etc.</li>
</ul>
</li>
</ul>
</li>
<li>Mechanisms: Golden A’s<ul>
<li>Authentication<ul>
<li>Is a user (communicating over the network)  claiming to be Alice, really Alice?</li>
</ul>
</li>
<li>Authorization<ul>
<li>Yes, the user is Alice, but is she allowed to  perform her requested operation on this  object?</li>
</ul>
</li>
<li>Auditing<ul>
<li>How did Eve manage to attack the system and  breach defenses? Usually done by  continuously logging all operations.</li>
</ul>
</li>
</ul>
</li>
<li>Encryption<ul>
<li>Symmetric Keys<ul>
<li>Same key (KAB) used to both encrypt and decrypt a  message</li>
<li>E.g., DES (Data Encryption Standard): 56 b key  operates on 64 b blocks from the message</li>
</ul>
</li>
<li>Public-Private keys<ul>
<li>Anything encrypted with KApriv can be decrypted only with  KApub</li>
<li>Anything encrypted with KApub can be decrypted only with  KApri</li>
<li>If Alice wants to send a secret message M that can  be read only by Bob<ol>
<li>Alice encrypts it with Bob’s public key</li>
<li>KBpub(M)</li>
<li>Bob only one able to decrypt it</li>
<li>KBpriv(KBpub(M)) &#x3D; M</li>
</ol>
</li>
</ul>
</li>
<li>Shared&#x2F;Symmetric vs. Public&#x2F;Private<ul>
<li>Shared keys reveal too much information<ul>
<li>Hard to revoke permissions from principals</li>
<li>E.g., group of principals shares one key <ul>
<li>want to remove one principal from group</li>
<li>need everyone in group to change key</li>
</ul>
</li>
</ul>
</li>
<li>Public&#x2F;private keys involve costly encryption or  decryption<ul>
<li>At least one of these 2 operations is costly</li>
</ul>
</li>
<li>Many systems use public&#x2F;private key system to  generate shared key, and use latter on messages</li>
</ul>
</li>
</ul>
</li>
<li>Digital Signature&#x2F;Certificate<ul>
<li>To sign a message M, Alice encrypts message with her  own private key<ul>
<li>Signed message: [M, KApriv(M)]</li>
<li>Anyone can verify, using Alice’s public key, that Alice signed it</li>
</ul>
</li>
<li>Digital Certificates implemented using digital signatures</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/12/04/COEN210/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/04/COEN210/" class="post-title-link" itemprop="url">COEN 210 — Computer Architecture</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-04 16:34:43" itemprop="dateCreated datePublished" datetime="2022-12-04T16:34:43+08:00">2022-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-05 14:11:11" itemprop="dateModified" datetime="2022-12-05T14:11:11+08:00">2022-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>16 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="COEN-210-Computer-Architecture"><a href="#COEN-210-Computer-Architecture" class="headerlink" title="COEN 210 Computer Architecture"></a>COEN 210 Computer Architecture</h1><h2 id="Chapter-1-—-Computer-Abstraction-and-Technology"><a href="#Chapter-1-—-Computer-Abstraction-and-Technology" class="headerlink" title="Chapter 1 — Computer Abstraction and Technology"></a>Chapter 1 — Computer Abstraction and Technology</h2><h3 id="Understanding-Performance"><a href="#Understanding-Performance" class="headerlink" title="Understanding Performance"></a>Understanding Performance</h3><ul>
<li><p>Algorithm </p>
<ul>
<li>Determines number of operations executed</li>
</ul>
</li>
<li><p>Programming language, compiler, architecture </p>
<ul>
<li>Determine number of machine instructions  executed per operation</li>
</ul>
</li>
<li><p>Processor and memory system </p>
<ul>
<li>Determine how fast instructions are executed</li>
</ul>
</li>
<li><p>I&#x2F;O system (including OS) </p>
<ul>
<li>Determines how fast I&#x2F;O operations are executed</li>
</ul>
</li>
</ul>
<h3 id="Eight-Great-Ideas"><a href="#Eight-Great-Ideas" class="headerlink" title="Eight Great Ideas"></a>Eight Great Ideas</h3><ul>
<li>Design for Moore’s Law</li>
<li>Use abstraction to simplify design</li>
<li>Make the common case fast</li>
<li>Performance via parallelism</li>
<li>Performance via pipelining</li>
<li>Performance via prediction</li>
<li>Hierarchy of memories</li>
<li>Dependability via redundancy</li>
</ul>
<h3 id="Pitfalls"><a href="#Pitfalls" class="headerlink" title="Pitfalls"></a>Pitfalls</h3><ul>
<li><p>Amdahl’s Law</p>
<ul>
<li>Improving an aspect of a computer and expecting a  proportional improvement in overall performance</li>
<li>Corollary: make the common case fast</li>
</ul>
</li>
<li><p>Low Power at Idle</p>
<ul>
<li>Google data center <ul>
<li>Mostly operates at 10% – 50% load </li>
<li>At 100% load less than 1% of the time</li>
</ul>
</li>
<li>Consider designing processors to make power  proportional to load</li>
</ul>
</li>
<li><p>MIPS as a Performance Metric</p>
<ul>
<li>MIPS: Millions of Instructions Per Second</li>
<li>Doesn’t account for<ul>
<li>Differences in ISAs between computers</li>
<li>Differences in complexity between instructions</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Chapter-2-—-Instructions-Language-of-the-Computer"><a href="#Chapter-2-—-Instructions-Language-of-the-Computer" class="headerlink" title="Chapter 2 — Instructions: Language of the Computer"></a>Chapter 2 — Instructions: Language of the Computer</h2><h3 id="Design-Principle"><a href="#Design-Principle" class="headerlink" title="Design Principle"></a>Design Principle</h3><ol>
<li><p>Simplicity favors regularity</p>
<ul>
<li><p>All arithmetic operations have this form</p>
<p><strong>ADD a, b, c &#x2F;&#x2F; a &#x3D; b + c</strong></p>
</li>
<li><p>Regularity makes implementation simpler</p>
</li>
<li><p>Simplicity enables higher performance at lower  cost</p>
</li>
</ul>
</li>
<li><p>Smaller is faster</p>
<ul>
<li>LEGv8 has a 32 × 64-bit register file</li>
<li>64-bit data is called a “doubleword” <ul>
<li>31 x 64-bit general purpose registers X0 to X30</li>
</ul>
</li>
<li>c.f. main memory: millions of locations</li>
</ul>
</li>
<li><p>Make the common case fast</p>
<ul>
<li><p>Constant data specified in an instruction </p>
<p><strong>ADDI X22, X22, #4</strong></p>
</li>
<li><p>Small constants are common</p>
</li>
<li><p>Immediate operand avoids a load instruction</p>
</li>
</ul>
</li>
<li><p>Good design demands good compromises</p>
<ul>
<li>Different formats complicate decoding, but allow 32-bit instructions  uniformly</li>
<li>Keep formats as similar as possible</li>
</ul>
</li>
</ol>
<h3 id="LEGv8-Registers"><a href="#LEGv8-Registers" class="headerlink" title="LEGv8 Registers"></a>LEGv8 Registers</h3><ul>
<li>X0 – X7: procedure arguments&#x2F;results </li>
<li>X8: indirect result location register </li>
<li>X9 – X15: temporaries </li>
<li>X16 – X17 (IP0 – IP1): may be used by linker as a scratch  register, other times as temporary register</li>
<li>X18: platform register for platform independent code;  otherwise a temporary register </li>
<li>X19 – X27: saved </li>
<li>X28 (SP): stack pointer </li>
<li>X29 (FP): frame pointer </li>
<li>X30 (LR): link register (return address) </li>
<li>XZR (register 31): the constant value 0</li>
</ul>
<h3 id="Memory-Layout"><a href="#Memory-Layout" class="headerlink" title="Memory Layout"></a>Memory Layout</h3><ul>
<li>Text: program code</li>
<li>Static data: global variables <ul>
<li>e.g., static variables in C,  constant arrays and strings</li>
</ul>
</li>
<li>Dynamic data: heap <ul>
<li>E.g., malloc in C, new in Java</li>
</ul>
</li>
<li>Stack: automatic storage</li>
</ul>
<p><img src="/images/210/memory_layout.JPG"></p>
<h3 id="LEGv8-Addressing-Summary"><a href="#LEGv8-Addressing-Summary" class="headerlink" title="LEGv8 Addressing Summary"></a>LEGv8 Addressing Summary</h3><p><img src="/images/210/addressing.JPG"></p>
<h3 id="LEGv8-Encoding-Summary"><a href="#LEGv8-Encoding-Summary" class="headerlink" title="LEGv8 Encoding Summary"></a>LEGv8 Encoding Summary</h3><p><img src="/images/210/encoding.JPG"></p>
<h3 id="Synchronization"><a href="#Synchronization" class="headerlink" title="Synchronization"></a>Synchronization</h3><ul>
<li>Two processors sharing an area of memory<ul>
<li>P1 writes, then P2 reads</li>
<li>Data race if P1 and P2 don’t synchronize<ul>
<li>Result depends on order of accesses</li>
</ul>
</li>
</ul>
</li>
<li>Hardware support required<ul>
<li>Atomic read&#x2F;write memory operation</li>
<li>No other access to the location allowed between the read  and write</li>
</ul>
</li>
<li>Could be a single instruction<ul>
<li>E.g., atomic swap of register ↔ memory</li>
<li>Or an atomic pair of instructions</li>
</ul>
</li>
</ul>
<h3 id="Translation-and-Startup"><a href="#Translation-and-Startup" class="headerlink" title="Translation and Startup"></a>Translation and Startup</h3><p><img src="/images/210/translation_startup.JPG"></p>
<p><img src="/images/210/java_startup.JPG"></p>
<h3 id="Loading-a-Program"><a href="#Loading-a-Program" class="headerlink" title="Loading a Program"></a>Loading a Program</h3><p>Load from image file on disk into memory</p>
<ol>
<li>Read header to determine segment sizes</li>
<li>Create virtual address space</li>
<li>Copy text and initialized data into memory <ul>
<li>Or set page table entries so they can be faulted in</li>
</ul>
</li>
<li>Set up arguments on stack</li>
<li>Initialize registers (including SP, FP)</li>
<li>Jump to startup routine<ul>
<li>Copies arguments to X0, … and calls main</li>
<li>When main returns, do exit syscall</li>
</ul>
</li>
</ol>
<h3 id="Dynamic-Linking"><a href="#Dynamic-Linking" class="headerlink" title="Dynamic Linking"></a>Dynamic Linking</h3><ul>
<li>Only link&#x2F;load library procedure when it is  called<ul>
<li>Requires procedure code to be relocatable</li>
<li>Avoids image bloat caused by static linking of all  (transitively) referenced libraries</li>
<li>Automatically picks up new library versions</li>
</ul>
</li>
</ul>
<h3 id="Lessons-Learnt"><a href="#Lessons-Learnt" class="headerlink" title="Lessons Learnt"></a>Lessons Learnt</h3><ul>
<li>Instruction count and CPI are not good  performance indicators in isolation</li>
<li>Compiler optimizations are sensitive to the  algorithm</li>
<li>Java&#x2F;JIT compiled code is significantly faster  than JVM interpreted<ul>
<li>Comparable to optimized C in some cases</li>
</ul>
</li>
<li>Nothing can fix a dumb algorithm!</li>
</ul>
<h3 id="Fallacies"><a href="#Fallacies" class="headerlink" title="Fallacies"></a>Fallacies</h3><ol>
<li>Powerful instruction -&gt; higher performance<ul>
<li>Fewer instructions required</li>
<li>But complex instructions are hard to implement<ul>
<li>May slow down all instructions, including simple ones</li>
</ul>
</li>
<li>Compilers are good at making fast code from simple  instructions</li>
</ul>
</li>
<li>Use assembly code for high performance<ul>
<li>But modern compilers are better at dealing with modern  processors</li>
<li>More lines of code -&gt; more errors and less productivity</li>
</ul>
</li>
<li>Backward compatibility -&gt; instruction set  doesn’t change<ul>
<li>But they do accrete more instructions</li>
</ul>
</li>
</ol>
<h3 id="Pitfalls-1"><a href="#Pitfalls-1" class="headerlink" title="Pitfalls"></a>Pitfalls</h3><ol>
<li>Sequential words are not at sequential  addresses<ul>
<li>Increment by 4, not by 1!</li>
</ul>
</li>
<li>Keeping a pointer to an automatic variable  after procedure returns<ul>
<li>e.g., passing pointer back via an argument</li>
<li>Pointer becomes invalid when stack popped</li>
</ul>
</li>
</ol>
<h2 id="Chapter-4-—-The-Processor"><a href="#Chapter-4-—-The-Processor" class="headerlink" title="Chapter 4 — The Processor"></a>Chapter 4 — The Processor</h2><h3 id="Logic-Design-Basics"><a href="#Logic-Design-Basics" class="headerlink" title="Logic Design Basics"></a>Logic Design Basics</h3><ul>
<li>Information encoded in binary<ul>
<li>Low voltage &#x3D; 0, High voltage &#x3D; 1</li>
<li>One wire per bit</li>
<li>Multi-bit data encoded on multi-wire buses</li>
</ul>
</li>
<li>Combinational element<ul>
<li>Operate on data</li>
<li>Output is a function of input<ul>
<li>AND-gate</li>
<li>Multiplexer</li>
<li>Adder</li>
<li>Arithmetic&#x2F;Logic Unit</li>
</ul>
</li>
</ul>
</li>
<li>State (sequential) elements<ul>
<li>Store information</li>
<li>Register: stores data in a circuit<ul>
<li>Uses a clock signal to determine when to update  the stored value</li>
<li>Edge-triggered: update when Clk changes from 0  to 1</li>
</ul>
</li>
<li>Register with write control<ul>
<li>Only updates on clock edge when write control  input is 1</li>
<li>Used when stored value is required later</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Clocking-Methodology"><a href="#Clocking-Methodology" class="headerlink" title="Clocking Methodology"></a>Clocking Methodology</h3><ul>
<li>Combinational logic transforms data during  clock cycles<ul>
<li>Between clock edges</li>
<li>Input from state elements, output to state element</li>
<li>Longest delay determines clock period</li>
</ul>
</li>
</ul>
<h3 id="Full-Datapath"><a href="#Full-Datapath" class="headerlink" title="Full Datapath"></a>Full Datapath</h3><p>control signals derived from instruction</p>
<p><img src="/images/210/full_datapath.JPG"></p>
<h3 id="Datapath-With-Control"><a href="#Datapath-With-Control" class="headerlink" title="Datapath With Control"></a>Datapath With Control</h3><p><img src="/images/210/datapath_with_control.JPG"></p>
<h3 id="R-Type-Instruction"><a href="#R-Type-Instruction" class="headerlink" title="R-Type Instruction"></a>R-Type Instruction</h3><p><img src="/images/210/r_type.JPG"></p>
<h3 id="Load-Instruction"><a href="#Load-Instruction" class="headerlink" title="Load Instruction"></a>Load Instruction</h3><p><img src="/images/210/load.JPG"></p>
<h3 id="CBZ-Instruction"><a href="#CBZ-Instruction" class="headerlink" title="CBZ Instruction"></a>CBZ Instruction</h3><p><img src="/images/210/CBZ.JPG"></p>
<h3 id="Datapath-With-B-Added"><a href="#Datapath-With-B-Added" class="headerlink" title="Datapath With B Added"></a>Datapath With B Added</h3><p><img src="/images/210/B_added.JPG"></p>
<h3 id="Single-Cycle-Performance-Issues"><a href="#Single-Cycle-Performance-Issues" class="headerlink" title="Single Cycle Performance Issues"></a>Single Cycle Performance Issues</h3><ul>
<li>Longest delay determines clock period<ul>
<li>Critical path: load instruction</li>
<li>Instruction memory → register file → ALU → data  memory → register file</li>
</ul>
</li>
<li>Not feasible to vary period for different  instructions</li>
<li>Violates design principle<ul>
<li>Making the common case fast</li>
</ul>
</li>
<li>We will improve performance by pipelining</li>
</ul>
<h3 id="Pipelining-Analogy"><a href="#Pipelining-Analogy" class="headerlink" title="Pipelining Analogy"></a>Pipelining Analogy</h3><ul>
<li>Pipelined laundry: overlapping execution<ul>
<li>Parallelism improves performance</li>
</ul>
</li>
</ul>
<p><img src="/images/210/pipeline_analogy.JPG"></p>
<h3 id="LEGv8-Pipeline"><a href="#LEGv8-Pipeline" class="headerlink" title="LEGv8 Pipeline"></a>LEGv8 Pipeline</h3><ul>
<li>Five stages, one step per stage<ol>
<li>IF: Instruction fetch from memory</li>
<li>ID: Instruction decode &amp; register read</li>
<li>EX: Execute operation or calculate address</li>
<li>MEM: Access memory operand</li>
<li>WB: Write result back to register</li>
</ol>
</li>
</ul>
<h3 id="Pipeline-Performance"><a href="#Pipeline-Performance" class="headerlink" title="Pipeline Performance"></a>Pipeline Performance</h3><p><img src="D:\Blog\source\images\210\pipeline_performance1.JPG"></p>
<p><img src="/images/210/pipeline_performance2.JPG"></p>
<h3 id="Pipeline-Speedup"><a href="#Pipeline-Speedup" class="headerlink" title="Pipeline Speedup"></a>Pipeline Speedup</h3><ul>
<li>If all stages take the same time (balanced)<ul>
<li>Time between instructions(pipelined) &#x3D; Time between instructions(nonpipelined) &#x2F; Number of stages</li>
</ul>
</li>
<li>If not balanced, speedup is less</li>
<li>Speedup due to increased throughput<ul>
<li>Latency (time for each instruction) does not  decrease</li>
</ul>
</li>
</ul>
<h3 id="Pipelining-and-ISA-Design"><a href="#Pipelining-and-ISA-Design" class="headerlink" title="Pipelining and ISA Design"></a>Pipelining and ISA Design</h3><ul>
<li>LEGv8 ISA designed for pipelining<ul>
<li>All instructions are 32-bits<ul>
<li>Easier to fetch and decode in one cycle</li>
<li>c.f. x86: 1- to 17-byte instructions</li>
</ul>
</li>
<li>Few and regular instruction formats<ul>
<li>Can decode and read registers in one step</li>
</ul>
</li>
<li>Load&#x2F;store addressing<ul>
<li>Can calculate address in 3rd stage, access memory in 4th stage</li>
</ul>
</li>
<li>Alignment of memory operands<ul>
<li>Memory access takes only one cycle</li>
<li>registers &amp; stack</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Hazards"><a href="#Hazards" class="headerlink" title="Hazards"></a>Hazards</h3><p>Situations that prevent starting the next  instruction in the next cycle</p>
<ol>
<li><p>Structure hazards</p>
<ul>
<li>A required resource is busy</li>
<li>Conflict for use of a resource</li>
<li>In LEGv8 pipeline with a single memory<ul>
<li>Load&#x2F;store requires data access</li>
<li>Instruction fetch would have to stall for that cycle<ul>
<li>Would cause a pipeline “bubble”</li>
</ul>
</li>
</ul>
</li>
<li>Hence, pipelined datapaths require separate  instruction&#x2F;data memories<ul>
<li>Or separate instruction&#x2F;data caches</li>
</ul>
</li>
</ul>
</li>
<li><p>Data hazard</p>
<ul>
<li><p>Need to wait for previous instruction to complete  its data read&#x2F;write</p>
</li>
<li><p>An instruction depends on completion of data  access by a previous instruction</p>
<p><strong>ADD <em>X19</em>, X0, X1</strong> </p>
<p><strong>SUB X2, <em>X19</em>, X3</strong></p>
</li>
<li><p>Forwarding (aka Bypassing)</p>
<ul>
<li>Use result when it is computed</li>
<li>Don’t wait for it to be stored in a register</li>
<li>Requires extra connections in the datapath</li>
</ul>
<p><img src="/images/210/forwarding.JPG"></p>
</li>
<li><p>Load-Use Data Hazard</p>
<ul>
<li>Can’t always avoid stalls by forwarding<ul>
<li>If value not computed when needed</li>
<li>Can’t forward backward in time!</li>
</ul>
</li>
</ul>
<p><img src="/images/210/bubble.JPG"></p>
<ul>
<li>Code Scheduling to Avoid Stalls<ul>
<li>Reorder code to avoid use of load result in the  next instruction</li>
</ul>
</li>
</ul>
<p><img src="/images/210/code_scheduling.JPG"></p>
</li>
</ul>
</li>
<li><p>Control hazard</p>
<ul>
<li>Deciding on control action depends on previous  instruction</li>
<li>Branch determines flow of control<ul>
<li>Fetching next instruction depends on branch  outcome</li>
<li>Pipeline can’t always fetch correct instruction<ul>
<li>Still working on ID stage of branch</li>
</ul>
</li>
</ul>
</li>
<li>In LEGv8 pipeline<ul>
<li>Need to compare registers and compute target  early in the pipeline</li>
<li>Add hardware to do it in ID stage</li>
</ul>
</li>
<li>Stall on Branch<ul>
<li>Wait until branch outcome determined before  fetching next instruction</li>
</ul>
</li>
</ul>
<p><img src="/images/210/stall_on_branch.JPG"></p>
</li>
</ol>
<h3 id="Branch-Prediction"><a href="#Branch-Prediction" class="headerlink" title="Branch Prediction"></a>Branch Prediction</h3><ul>
<li>Longer pipelines can’t readily determine  branch outcome early<ul>
<li>Stall penalty becomes unacceptable</li>
</ul>
</li>
<li>Predict outcome of branch<ul>
<li>Only stall if prediction is wrong</li>
</ul>
</li>
<li>In LEGv8 pipeline<ul>
<li>Can predict branches not taken</li>
<li>Fetch instruction after branch, with no delay</li>
</ul>
</li>
</ul>
<h3 id="More-Realistic-Branch-Prediction"><a href="#More-Realistic-Branch-Prediction" class="headerlink" title="More-Realistic Branch Prediction"></a>More-Realistic Branch Prediction</h3><ul>
<li><p>Static branch prediction</p>
<ul>
<li><p>Based on typical branch behavior</p>
</li>
<li><p>Example: loop and if-statement branches</p>
<ul>
<li><p>Predict backward branches taken</p>
<p>do loop</p>
</li>
<li><p>Predict forward branches not taken</p>
<p>for loop</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Dynamic branch prediction</p>
<ul>
<li>Hardware measures actual branch behavior<ul>
<li>e.g., record recent history of each branch</li>
</ul>
</li>
<li>Assume future behavior will continue the trend<ul>
<li>When wrong, stall while re-fetching, and update history</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Pipeline-Summary"><a href="#Pipeline-Summary" class="headerlink" title="Pipeline Summary"></a>Pipeline Summary</h3><ul>
<li>Pipelining improves performance by increasing  instruction throughput<ul>
<li>Executes multiple instructions in parallel</li>
<li>Each instruction has the same latency</li>
</ul>
</li>
<li>Subject to hazards<ul>
<li>Structure, data, control</li>
</ul>
</li>
<li>Instruction set design affects complexity of  pipeline implementation</li>
</ul>
<h3 id="LEGv8-Pipelined-Datapath"><a href="#LEGv8-Pipelined-Datapath" class="headerlink" title="LEGv8 Pipelined Datapath"></a>LEGv8 Pipelined Datapath</h3><p><img src="/images/210/legv8_pipelined_datapath.JPG"></p>
<h3 id="Pipeline-registers"><a href="#Pipeline-registers" class="headerlink" title="Pipeline registers"></a>Pipeline registers</h3><p>Need registers between stages</p>
<ul>
<li>To hold information produced in previous cycle</li>
</ul>
<p><img src="/images/210/pipeline_registers.JPG"></p>
<h3 id="Multi-Cycle-Pipeline-Diagram"><a href="#Multi-Cycle-Pipeline-Diagram" class="headerlink" title="Multi-Cycle Pipeline Diagram"></a>Multi-Cycle Pipeline Diagram</h3><p><img src="/images/210/multi_cycle_pipeline.JPG"></p>
<h3 id="Single-Cycle-Pipeline-Diagram"><a href="#Single-Cycle-Pipeline-Diagram" class="headerlink" title="Single-Cycle Pipeline Diagram"></a>Single-Cycle Pipeline Diagram</h3><p><img src="/images/210/single_cycle_pipeline.JPG"></p>
<h3 id="Pipelined-Control"><a href="#Pipelined-Control" class="headerlink" title="Pipelined Control"></a>Pipelined Control</h3><p><img src="/images/210/pipelined_control2.JPG"></p>
<h3 id="Forwarding-and-Hazard-Detection"><a href="#Forwarding-and-Hazard-Detection" class="headerlink" title="Forwarding and Hazard Detection"></a>Forwarding and Hazard Detection</h3><ul>
<li><p>Detecting the Need to Forward</p>
<p><img src="/images/210/need_to_forward.JPG"></p>
<p><img src="/images/210/need_to_forward2.JPG"></p>
</li>
</ul>
<p>​        <img src="/images/210/forwarding_path.JPG"></p>
<p>​    <img src="/images/210/revised_forwarding_condition.JPG"></p>
<ul>
<li>Hazard in ALU</li>
<li>Load-use hazard</li>
</ul>
<p>​        <img src="/images/210/load_use_data_hazard.JPG"></p>
<p><img src="/images/210/datapath_with_hazard_detection.JPG"></p>
<ul>
<li>Branch hazard</li>
</ul>
<p><img src="/images/210/branch_hazard.JPG"></p>
<h3 id="Stalls-and-Performance"><a href="#Stalls-and-Performance" class="headerlink" title="Stalls and Performance"></a>Stalls and Performance</h3><ul>
<li>Stalls reduce performance<ul>
<li>But are required to get correct results</li>
</ul>
</li>
<li>Compiler can arrange code to avoid hazards  and stalls<ul>
<li>Requires knowledge of the pipeline structure</li>
</ul>
</li>
</ul>
<h3 id="Dynamic-Branch-Prediction"><a href="#Dynamic-Branch-Prediction" class="headerlink" title="Dynamic Branch Prediction"></a>Dynamic Branch Prediction</h3><ul>
<li>In deeper and superscalar pipelines, branch penalty is  more significant</li>
<li>Use dynamic prediction<ul>
<li>Branch prediction buffer (aka branch history table)</li>
<li>Indexed by recent branch instruction addresses</li>
<li>Stores outcome (taken&#x2F;not taken)</li>
<li>To execute a branch<ul>
<li>Check table, expect the same outcome</li>
<li>Start fetching from fall-through or target</li>
<li>If wrong, flush pipeline and flip prediction</li>
</ul>
</li>
</ul>
</li>
<li>1-Bit Predictor: Shortcoming<ul>
<li>Inner loop branches mispredicted twice!</li>
</ul>
</li>
<li>2-Bit Predictor<ul>
<li>Only change prediction on two successive  mispredictions</li>
</ul>
</li>
</ul>
<h3 id="Exceptions-and-Interrupts"><a href="#Exceptions-and-Interrupts" class="headerlink" title="Exceptions and Interrupts"></a>Exceptions and Interrupts</h3><ul>
<li>“Unexpected” events requiring change in flow of control<ul>
<li>Different ISAs use the terms differently</li>
</ul>
</li>
<li>Exception<ul>
<li>Arises within the CPU<ul>
<li>e.g., undefined opcode, overflow, syscall, …</li>
</ul>
</li>
</ul>
</li>
<li>Interrupt<ul>
<li>From an external I&#x2F;O controller</li>
</ul>
</li>
<li>Dealing with them without sacrificing performance is hard</li>
</ul>
<p><img src="/images/210/exception_interrupt.JPG"></p>
<h3 id="Handling-Exceptions"><a href="#Handling-Exceptions" class="headerlink" title="Handling Exceptions"></a>Handling Exceptions</h3><ul>
<li><p>Save PC of offending (or interrupted) instruction <strong>&#x3D;EPC</strong></p>
<ul>
<li>In LEGv8: Exception Link Register (ELR)</li>
</ul>
</li>
<li><p>Save indication of the problem</p>
<ul>
<li>In LEGv8: Exception Syndrome Rregister (ESR)</li>
<li>We’ll assume 1-bit<ul>
<li>0 for undefined opcode, 1 for overflow</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/210/pipeline_with_exceptions.JPG"></p>
<h3 id="Exception-Properties"><a href="#Exception-Properties" class="headerlink" title="Exception Properties"></a>Exception Properties</h3><ul>
<li>Restartable exceptions<ul>
<li>Pipeline can flush the instruction</li>
<li>Handler executes, then returns to the instruction<ul>
<li>Refetched and executed from scratch</li>
</ul>
</li>
</ul>
</li>
<li>PC saved in ELR register<ul>
<li>Identifies causing instruction</li>
<li>Actually PC + 4 is saved<ul>
<li>Actually PC + 4 is saved</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Instruction-Level-Parallelism-ILP"><a href="#Instruction-Level-Parallelism-ILP" class="headerlink" title="Instruction-Level Parallelism (ILP)"></a>Instruction-Level Parallelism (ILP)</h3><ul>
<li>Pipelining: multiple instructions in parallel</li>
<li>To increase ILP<ul>
<li>Deeper pipeline<ul>
<li>Less work per stage -&gt; shorter clock cycle</li>
</ul>
</li>
<li>Multiple issue<ul>
<li>Replicate pipeline stages -&gt; multiple pipelines</li>
<li>Start multiple instructions per clock cycle</li>
<li>CPI &lt; 1, so use Instructions Per Cycle (IPC)</li>
<li>E.g., 4GHz 4-way multiple-issue<ul>
<li>16 BIPS, peak CPI &#x3D; 0.25, peak IPC &#x3D; 4</li>
</ul>
</li>
<li>But dependencies reduce this in practice</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Multiple-Issue"><a href="#Multiple-Issue" class="headerlink" title="Multiple Issue"></a>Multiple Issue</h3><ul>
<li>Static multiple issue (compile time)<ul>
<li>Compiler groups instructions to be issued together</li>
<li>Packages them into “issue slots”</li>
<li>Compiler detects and avoids hazards</li>
</ul>
</li>
<li>Dynamic multiple issue (run time)<ul>
<li>CPU examines instruction stream and chooses instructions  to issue each cycle</li>
<li>Compiler can help by reordering instructions</li>
<li>CPU resolves hazards using advanced techniques at runtime</li>
</ul>
</li>
</ul>
<h3 id="Speculation"><a href="#Speculation" class="headerlink" title="Speculation"></a>Speculation</h3><ul>
<li>“Guess” what to do with an instruction<ul>
<li>Start the guessed operation as soon as possible</li>
<li>Check whether guess was right<ul>
<li>If so, complete the operation</li>
<li>If not, roll-back and do the right thing</li>
</ul>
</li>
</ul>
</li>
<li>Common to static and dynamic multiple issue</li>
<li>Examples<ul>
<li>Speculate on branch outcome<ul>
<li>Roll back if path taken is different</li>
</ul>
</li>
<li>Speculate on load<ul>
<li>Roll back if location is updated</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Loop-Unrolling"><a href="#Loop-Unrolling" class="headerlink" title="Loop Unrolling"></a>Loop Unrolling</h3><ul>
<li>Replicate loop body to expose more  parallelism<ul>
<li>Reduces loop-control overhead</li>
</ul>
</li>
<li>Use different registers per replication<ul>
<li>Called “register renaming”</li>
<li>Avoid loop-carried “anti-dependencies”<ul>
<li>Store followed by a load of the same register</li>
<li>Aka “name dependence”<ul>
<li>Reuse of a register name</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Does-Multiple-Issue-Work"><a href="#Does-Multiple-Issue-Work" class="headerlink" title="Does Multiple Issue Work?"></a>Does Multiple Issue Work?</h3><ul>
<li>Yes, but not as much as we’d like</li>
<li>Programs have real dependencies that limit ILP</li>
<li>Some dependencies are hard to eliminate<ul>
<li>e.g., pointer aliasing</li>
</ul>
</li>
<li>Some parallelism is hard to expose<ul>
<li>Limited window size during instruction issue</li>
</ul>
</li>
<li>Memory delays and limited bandwidth<ul>
<li>Hard to keep pipelines full</li>
</ul>
</li>
<li>Speculation can help if done well</li>
</ul>
<h3 id="Fallacies-1"><a href="#Fallacies-1" class="headerlink" title="Fallacies"></a>Fallacies</h3><ol>
<li>Pipelining is easy (!)<ul>
<li>The basic idea is easy</li>
<li>The devil is in the details<ul>
<li>e.g., detecting data hazards</li>
</ul>
</li>
</ul>
</li>
<li>Pipelining is independent of technology<ul>
<li>So why haven’t we always done pipelining?</li>
<li>More transistors make more advanced techniques feasible</li>
<li>Pipeline-related ISA design needs to take account of  technology trends<ul>
<li>e.g., predicated instructions</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Pitfalls-2"><a href="#Pitfalls-2" class="headerlink" title="Pitfalls"></a>Pitfalls</h3><ul>
<li>Poor ISA design can make pipelining harder<ul>
<li>e.g., complex instruction sets (VAX, IA-32)<ul>
<li>Significant overhead to make pipelining work</li>
<li>IA-32 micro-op approach</li>
</ul>
</li>
<li>e.g., complex addressing modes<ul>
<li>Register update side effects, memory indirection</li>
</ul>
</li>
<li>e.g., delayed branches<ul>
<li>Advanced pipelines have long delay slots</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Concluding-Remarks"><a href="#Concluding-Remarks" class="headerlink" title="Concluding Remarks"></a>Concluding Remarks</h3><ul>
<li>ISA influences design of datapath and control</li>
<li>Datapath and control influence design of ISA</li>
<li>Pipelining improves instruction throughput using parallelism<ul>
<li>More instructions completed per second</li>
<li>Latency for each instruction not reduced</li>
</ul>
</li>
<li>Hazards: structural, data, control</li>
<li>Multiple issue and dynamic scheduling (ILP)<ul>
<li>Dependencies limit achievable parallelism</li>
<li>Complexity leads to the power wall</li>
</ul>
</li>
</ul>
<h2 id="Chapter-5-—-Large-and-Fast-Exploiting-Memory-Hierarchy"><a href="#Chapter-5-—-Large-and-Fast-Exploiting-Memory-Hierarchy" class="headerlink" title="Chapter 5 — Large and Fast: Exploiting Memory Hierarchy"></a>Chapter 5 — Large and Fast: Exploiting Memory Hierarchy</h2><h3 id="Principle-of-Locality"><a href="#Principle-of-Locality" class="headerlink" title="Principle of Locality"></a>Principle of Locality</h3><ul>
<li>Programs access a small portion of their  address space at any time</li>
<li>Temporal locality<ul>
<li>Items accessed recently are likely to be accessed  again soon</li>
<li>e.g., instructions in a loop, induction variables</li>
</ul>
</li>
<li>Spatial locality<ul>
<li>Items near those accessed recently are likely to be  accessed soon</li>
<li>E.g., sequential instruction access, array data</li>
</ul>
</li>
</ul>
<h3 id="Taking-Advantage-of-Locality"><a href="#Taking-Advantage-of-Locality" class="headerlink" title="Taking Advantage of Locality"></a>Taking Advantage of Locality</h3><ul>
<li>Memory hierarchy</li>
<li>Store everything on disk</li>
<li>Copy recently accessed (and nearby) items  from disk to smaller DRAM memory<ul>
<li>Main memory</li>
</ul>
</li>
<li>Copy more recently accessed (and nearby)  items from DRAM to smaller SRAM memory<ul>
<li>Cache memory attached to CPU</li>
</ul>
</li>
</ul>
<h3 id="Cache-Block-Size-Considerations"><a href="#Cache-Block-Size-Considerations" class="headerlink" title="Cache Block Size Considerations"></a>Cache Block Size Considerations</h3><ul>
<li>Larger blocks should reduce miss rate<ul>
<li>Due to spatial locality</li>
</ul>
</li>
<li>But in a fixed-sized cache<ul>
<li>Larger blocks -&gt; fewer of them<ul>
<li>More competition -&gt; increased miss rate</li>
</ul>
</li>
<li>Larger blocks -&gt; pollution<ul>
<li>Partially used before being replaced</li>
</ul>
</li>
</ul>
</li>
<li>Larger miss penalty<ul>
<li>Can override benefit of reduced miss rate</li>
<li>Early restart and critical-word-first can help<ul>
<li>early restart: don’t wait for everything to load</li>
<li>critical-word-first: bring in the required data first</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Cache-Misses"><a href="#Cache-Misses" class="headerlink" title="Cache Misses"></a>Cache Misses</h3><ul>
<li>On cache hit, CPU proceeds normally</li>
<li>On cache miss<ul>
<li>Stall the CPU pipeline</li>
<li>Fetch block from next level of hierarchy</li>
<li>Instruction cache miss<ul>
<li>Restart instruction fetch (PC - 4)</li>
</ul>
</li>
<li>Data cache miss<ul>
<li>Complete data access</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="On-data-write-hit"><a href="#On-data-write-hit" class="headerlink" title="On data-write hit"></a>On data-write hit</h3><ul>
<li>Write-Through<ul>
<li>also update memory</li>
<li>But makes writes take longer</li>
<li>Solution: write buffer<ul>
<li>Holds data waiting to be written to memory</li>
<li>CPU continues immediately<ul>
<li>Only stalls on write if write buffer is already full</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Write-Back<ul>
<li>Alternative: On data-write hit, just update the  block in cache<ul>
<li>Keep track of whether each block is dirty</li>
</ul>
</li>
<li>When a dirty block is replaced<ul>
<li>Write it back to memory</li>
<li>Can use a write buffer to allow replacing block to  be read first</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Performance-Summary"><a href="#Performance-Summary" class="headerlink" title="Performance Summary"></a>Performance Summary</h3><ul>
<li>When CPU performance increased<ul>
<li>Miss penalty becomes more significant</li>
</ul>
</li>
<li>Decreasing base CPI<ul>
<li>Greater proportion of time spent on memory stalls</li>
</ul>
</li>
<li>Increasing clock rate<ul>
<li>Memory stalls account for more CPU cycles</li>
</ul>
</li>
<li>Can’t neglect cache behavior when evaluating  system performance</li>
</ul>
<h3 id="Set-Associative-Cache"><a href="#Set-Associative-Cache" class="headerlink" title="Set Associative Cache"></a>Set Associative Cache</h3><ul>
<li>n-way set associative<ul>
<li>Each set contains n entries</li>
<li>Block number determines which set<ul>
<li>(Block number) modulo (#Sets in cache)</li>
</ul>
</li>
<li>Search all entries in a given set at once</li>
<li>n comparators (less expensive)</li>
</ul>
</li>
<li>Replacement Policy<ul>
<li>Prefer non-valid entry, if there is one</li>
<li>Otherwise, choose among entries in the set<ul>
<li>Least-recently used (LRU)<ul>
<li>Choose the one unused for the longest time</li>
</ul>
</li>
<li>Random</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Multilevel-Caches"><a href="#Multilevel-Caches" class="headerlink" title="Multilevel Caches"></a>Multilevel Caches</h3><ul>
<li>Primary cache attached to CPU<ul>
<li>Focus on minimal hit time</li>
</ul>
</li>
<li>Level-2 cache services misses  from primary cache<ul>
<li>Focus on low miss rate to avoid main memory  access</li>
<li>Hit time has less overall impact</li>
</ul>
</li>
<li>Main memory services L-2  cache misses</li>
<li>Some high-end systems include  L-3 cache</li>
</ul>
<h3 id="Dependability-Measures"><a href="#Dependability-Measures" class="headerlink" title="Dependability Measures"></a>Dependability Measures</h3><ul>
<li>Reliability: mean time to failure (MTTF)</li>
<li>Service interruption: mean time to repair (MTTR)</li>
<li>Availability &#x3D; MTTF &#x2F; (MTTF + MTTR)</li>
<li>Improving Availability<ul>
<li>Increase MTTF: fault avoidance, fault tolerance, fault  forecasting</li>
<li>Reduce MTTR: improved tools and processes for diagnosis  and repair</li>
</ul>
</li>
</ul>
<h3 id="The-Hamming-SEC-Code"><a href="#The-Hamming-SEC-Code" class="headerlink" title="The Hamming SEC Code"></a>The Hamming SEC Code</h3><ul>
<li>Hamming distance<ul>
<li>Number of bits that are different between two bit  patterns, e.g. 2 in 011011 and 001111</li>
</ul>
</li>
<li>Code with minimum distance &#x3D; 2 provides  single bit error detection<ul>
<li>E.g. parity code</li>
</ul>
</li>
<li>Minimum distance &#x3D; 3 provides single error  correction, 2 bit error detection</li>
</ul>
<h3 id="Virtual-Memory"><a href="#Virtual-Memory" class="headerlink" title="Virtual Memory"></a>Virtual Memory</h3><ul>
<li><p>Use main memory as a “cache” for secondary  (disk) storage</p>
<ul>
<li>Managed jointly by CPU hardware and the  operating system (OS)</li>
</ul>
</li>
<li><p>Programs share main memory</p>
<ul>
<li>Each gets a private virtual address space holding its  frequently used code and data</li>
<li>Protected from other programs</li>
</ul>
</li>
<li><p>CPU and OS translate virtual addresses to  physical addresses</p>
<ul>
<li>VM “block” is called a page</li>
<li>VM translation “miss” is called a page fault</li>
</ul>
</li>
<li><p>PTE: Page Table Entry</p>
</li>
<li><p>TLB: Translation Look-aside Buffer</p>
</li>
</ul>
<p><img src="/images/210/TLB.JPG"></p>
<p><img src="/images/210/Integration.JPG"></p>
<h3 id="Pitfalls-3"><a href="#Pitfalls-3" class="headerlink" title="Pitfalls"></a>Pitfalls</h3><ul>
<li>Byte vs. word addressing<ul>
<li>Example: 32-byte direct-mapped cache, 4-byte blocks<ul>
<li>Byte 36 maps to block 1</li>
<li>Word 36 maps to block 4</li>
</ul>
</li>
</ul>
</li>
<li>Ignoring memory system effects when writing  or generating code<ul>
<li>Example: iterating over rows vs. columns of arrays</li>
<li>Large strides result in poor locality</li>
</ul>
</li>
<li>In multiprocessor with shared L2 or L3 cache<ul>
<li>Less associativity than cores results in conflict  misses</li>
<li>More cores -&gt; need to increase associativity</li>
</ul>
</li>
<li>Using AMAT to evaluate performance of out-of-order processors<ul>
<li>Ignores effect of non-blocked accesses</li>
<li>Instead, evaluate performance by simulation</li>
</ul>
</li>
<li>Extending address range using segments<ul>
<li>E.g., Intel 80286</li>
<li>But a segment is not always big enough</li>
<li>Makes address arithmetic complicated</li>
</ul>
</li>
<li>Implementing a VMM on an ISA not designed  for virtualization<ul>
<li>E.g., non-privileged instructions accessing  hardware resources</li>
<li>Either extend ISA, or require guest OS not to use  problematic instructions</li>
</ul>
</li>
</ul>
<h3 id="Concluding-Remarks-1"><a href="#Concluding-Remarks-1" class="headerlink" title="Concluding Remarks"></a>Concluding Remarks</h3><ul>
<li>Fast memories are small, large memories are slow<ul>
<li>We really want fast, large memories</li>
<li>Caching gives this illusion</li>
</ul>
</li>
<li>Principle of locality<ul>
<li>Programs use a small part of their memory space frequently</li>
</ul>
</li>
<li>Memory hierarchy<ul>
<li>L1 cache &lt;-&gt; L2 cache &lt;-&gt; … &lt;-&gt; DRAM memory &lt;-&gt; disk</li>
</ul>
</li>
<li>Memory system design is critical for multiprocessors</li>
</ul>
<h2 id="Chapter-6-—-Parallel-Processors-from-Client-to-Cloud"><a href="#Chapter-6-—-Parallel-Processors-from-Client-to-Cloud" class="headerlink" title="Chapter 6 — Parallel Processors from Client to Cloud"></a>Chapter 6 — Parallel Processors from Client to Cloud</h2><h3 id="GPU-Architectures"><a href="#GPU-Architectures" class="headerlink" title="GPU Architectures"></a>GPU Architectures</h3><ul>
<li>Processing is highly data-parallel<ul>
<li>GPUs are highly multithreaded</li>
<li>Use thread switching to hide memory latency<ul>
<li>Less reliance on multi-level caches</li>
</ul>
</li>
<li>Graphics memory is wide and high-bandwidth</li>
</ul>
</li>
<li>Trend toward general purpose GPUs<ul>
<li>Heterogeneous CPU&#x2F;GPU systems</li>
<li>CPU for sequential code, GPU for parallel code</li>
</ul>
</li>
<li>Programming languages&#x2F;APIs<ul>
<li>DirectX, OpenGL</li>
<li>C for Graphics (Cg), High Level Shader Language (HLSL)</li>
<li>Compute Unified Device Architecture (CUDA</li>
</ul>
</li>
</ul>
<h3 id="Concluding-Remarks-2"><a href="#Concluding-Remarks-2" class="headerlink" title="Concluding Remarks"></a>Concluding Remarks</h3><ul>
<li>Goal: higher performance by using multiple  processors</li>
<li>Difficulties</li>
<li>SaaS importance is growing and clusters are a good  match</li>
<li>Performance per dollar and performance per Joule  drive both mobile and WSC</li>
<li>SIMD and vector  operations match  multimedia applications  and are easy to program</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/28/Web-Developer-Bootcamp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/28/Web-Developer-Bootcamp/" class="post-title-link" itemprop="url">Web Developer Bootcamp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-28 23:21:41" itemprop="dateCreated datePublished" datetime="2022-11-28T23:21:41+08:00">2022-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 15:34:21" itemprop="dateModified" datetime="2022-11-29T15:34:21+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>44k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>40 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Web-Developer-Bootcamp"><a href="#Web-Developer-Bootcamp" class="headerlink" title="Web Developer Bootcamp"></a>Web Developer Bootcamp</h1><h2 id="1-快捷键"><a href="#1-快捷键" class="headerlink" title="1. 快捷键"></a>1. 快捷键</h2><p>ctrl shift p : format document</p>
<p>a tab</p>
<p>lorem</p>
<p>ctrl &#x2F;</p>
<p>inp tab</p>
<p>! 标准html初始化</p>
<h2 id="2-HTML5"><a href="#2-HTML5" class="headerlink" title="2. HTML5"></a>2. HTML5</h2><p>HTML is not a version, but a standard.</p>
<p>You can’t turn off HTML5!</p>
<ul>
<li><p>inline elements</p>
<ul>
<li><p>a    anchor</p>
</li>
<li><p>span </p>
<p>generic element</p>
</li>
</ul>
</li>
<li><p>block elements</p>
<ul>
<li><p>p    paragraph</p>
</li>
<li><p>div  division</p>
<p>generic element</p>
</li>
</ul>
</li>
</ul>
<p>hr: a segment line</p>
<p>br: a line break</p>
<p>sup: superscript</p>
<p>sub: subscript</p>
<h3 id="HTML-Entities：start-with-ampersand-amp-end-with-semicolon"><a href="#HTML-Entities：start-with-ampersand-amp-end-with-semicolon" class="headerlink" title="HTML Entities：start with ampersand&amp;, end with semicolon;"></a>HTML Entities：start with ampersand&amp;, end with semicolon;</h3><ul>
<li>greater than： </li>
<li>less than：</li>
</ul>
<h3 id="Semantic-Markup-meaningful-markup-accessibility"><a href="#Semantic-Markup-meaningful-markup-accessibility" class="headerlink" title="Semantic Markup: meaningful markup       accessibility"></a>Semantic Markup: meaningful markup       accessibility</h3><p>not div, but</p>
<ul>
<li>main</li>
<li>nav</li>
<li>section</li>
<li>article</li>
<li>aside</li>
<li>header</li>
<li>footer</li>
<li>time</li>
<li>figure<ul>
<li>figcaption</li>
</ul>
</li>
</ul>
<h3 id="Emmet"><a href="#Emmet" class="headerlink" title="Emmet:"></a>Emmet:</h3><ul>
<li>child: &gt;</li>
<li>sibling: +</li>
<li>multiplication:  *</li>
<li>item numbering: $</li>
</ul>
<h3 id="table"><a href="#table" class="headerlink" title="table:"></a>table:</h3><ul>
<li>tr : table row</li>
<li>td : single data cell</li>
<li>th : single header:<ul>
<li>rowspan&#x3D;”2”</li>
<li>colspan&#x3D;”2”</li>
</ul>
</li>
<li>thead</li>
<li>tbody</li>
<li>tfoot</li>
</ul>
<h3 id="form"><a href="#form" class="headerlink" title="form:"></a>form:</h3><ul>
<li><p>empty container for data inputs</p>
</li>
<li><p>specify how and where the data should be sent</p>
</li>
<li><p>action: where the http request should be sent</p>
</li>
<li><p>method: “get” “post”</p>
</li>
<li><p>input: </p>
<ul>
<li>type:<ul>
<li>text</li>
<li>password</li>
<li>email: pattern</li>
<li>url: pattern</li>
<li>color: color picker</li>
<li>file</li>
<li>number:<ul>
<li>min</li>
<li>max</li>
<li>step</li>
</ul>
</li>
<li>time</li>
<li>range:<ul>
<li>id + label for</li>
<li>name</li>
<li>min</li>
<li>max</li>
<li>value: initial value</li>
<li>step</li>
</ul>
</li>
<li>radio:<ul>
<li>one name for a group of radio</li>
<li>id</li>
<li>label for</li>
<li>value 绑定 name</li>
</ul>
</li>
<li>checkbox:<ul>
<li>name 选中后属性为on，不选中则没有该属性</li>
<li>id</li>
<li>label for 绑定 id</li>
<li>checked</li>
</ul>
</li>
<li>submit:<ul>
<li>value</li>
</ul>
</li>
</ul>
</li>
<li>placeholder </li>
<li>label + input<ul>
<li>input id name</li>
<li>label for</li>
</ul>
</li>
</ul>
</li>
<li><p>button:</p>
<ul>
<li>type:<ul>
<li>submit (default)</li>
<li>button</li>
</ul>
</li>
</ul>
</li>
<li><p>select:</p>
<ul>
<li>name</li>
<li>id</li>
<li>option:<ul>
<li>value</li>
<li>selected</li>
</ul>
</li>
</ul>
</li>
<li><p>textarea:</p>
<ul>
<li>id + label for</li>
<li>name</li>
<li>placeholder</li>
<li>rows </li>
<li>cols</li>
</ul>
</li>
</ul>
<h3 id="validation"><a href="#validation" class="headerlink" title="validation:"></a>validation:</h3><ul>
<li>browser side validation:<ul>
<li>html built-in :<ul>
<li>required</li>
<li>minlength</li>
<li>maxlength</li>
<li>min</li>
<li>max</li>
<li>pattern : regular expression: a pattern</li>
<li>type: <ul>
<li>url</li>
<li>email</li>
<li>tel</li>
</ul>
</li>
</ul>
</li>
<li>javascript</li>
</ul>
</li>
<li>server side validation</li>
</ul>
<h2 id="3-CSS"><a href="#3-CSS" class="headerlink" title="3. CSS"></a>3. CSS</h2><p>cascading style sheets</p>
<p>selector {</p>
<p>​        property: value;</p>
<p>}</p>
<p>where:</p>
<ol>
<li>inline style&#x3D;”color: green”   bad!</li>
<li>head style</li>
<li>css file + link :<ul>
<li>href</li>
<li>rel&#x3D;”stylesheet”</li>
</ul>
</li>
</ol>
<p>color: text color</p>
<p>background-color</p>
<p>font-size:</p>
<ul>
<li>px : not recommended for responsive websites</li>
</ul>
<h3 id="CSS-selector"><a href="#CSS-selector" class="headerlink" title="CSS selector:"></a>CSS selector:</h3><ul>
<li><p>universal selector:</p>
<ul>
<li><ul>
<li></li>
</ul>
</li>
</ul>
</li>
<li><p>h1 ,h2</p>
</li>
<li><p>id selector:</p>
<ul>
<li>#signup</li>
</ul>
</li>
<li><p>class selector:</p>
<ul>
<li>.tag</li>
</ul>
</li>
<li><p>descendant selector: (generic descendant)</p>
<ul>
<li>li a</li>
<li>span a </li>
<li>.tag a</li>
</ul>
</li>
<li><p>adjacent selector: (immediately after)</p>
<ul>
<li>h1 + p</li>
</ul>
</li>
<li><p>direct child: (direct descendant)</p>
<ul>
<li>div &gt; li</li>
</ul>
</li>
<li><p>attribute selector:</p>
<ul>
<li>input[type&#x3D;”password”]</li>
<li>section[class&#x3D;”post”]</li>
<li>a[href*&#x3D;”google”]  <ul>
<li>contains</li>
</ul>
</li>
</ul>
</li>
<li><p>pseudo class:</p>
<ul>
<li>button:hover</li>
<li>.post a:hover</li>
<li>button:active</li>
<li>.post:nth-of-type(2n)</li>
<li>.post:nth-of-type(2n-1)</li>
</ul>
</li>
<li><p>pseudo element:</p>
<ul>
<li>h2::first-letter</li>
<li>p::first-line</li>
<li>p::selection</li>
<li>::selection</li>
</ul>
</li>
</ul>
<p>“cascade”: order matters!</p>
<h3 id="specificity"><a href="#specificity" class="headerlink" title="specificity:"></a>specificity:</h3><ul>
<li><p>The more specific selector wins!</p>
</li>
<li><p>id &gt; class, attribute, pseudo class &gt; element, pseudo element</p>
</li>
<li><p>!important</p>
</li>
<li><p>inherit</p>
</li>
</ul>
<h3 id="CSS-box-model"><a href="#CSS-box-model" class="headerlink" title="CSS box model"></a>CSS box model</h3><ul>
<li>content box:<ul>
<li>width</li>
<li>height</li>
</ul>
</li>
<li>padding</li>
<li>margin</li>
<li>border</li>
</ul>
<h2 id="4-JS"><a href="#4-JS" class="headerlink" title="4.JS"></a>4.JS</h2><h3 id="loop"><a href="#loop" class="headerlink" title="loop:"></a>loop:</h3><ul>
<li><p>for of: 遍历iterable</p>
</li>
<li><p>for in: object</p>
</li>
</ul>
<h3 id="scope"><a href="#scope" class="headerlink" title="scope:"></a>scope:</h3><ul>
<li>var 只限定function scope, 不限定block scope( loop, conditional)</li>
<li>let 限定block scope</li>
<li>const 限定block scope</li>
</ul>
<h3 id="callback；"><a href="#callback；" class="headerlink" title="callback；"></a>callback；</h3><p>A callback function is a function passed into another function as an argument, which is then invoked inside the outer function to complete some kind of routine or action.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//array.forEach(function)</span></span><br><span class="line">nums.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(num%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//array.map(function)</span></span><br><span class="line"><span class="keyword">const</span> doubles=nums.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//arrow function</span></span><br><span class="line"><span class="keyword">const</span> double=nums.<span class="title function_">map</span>(<span class="function">(<span class="params">num</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//arrow function implicit return</span></span><br><span class="line"><span class="keyword">const</span> double1=nums.<span class="title function_">map</span>(<span class="function">(<span class="params">num</span>)=&gt;</span>&#123;</span><br><span class="line">    num*<span class="number">2</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> double2=nums.<span class="title function_">map</span>(<span class="function"><span class="params">num</span>=&gt;</span>num*<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//setTimeOut(function,t)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="title function_">setTimeOut</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;...Are you still there?&quot;</span>)</span><br><span class="line">&#125;,<span class="number">3000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;I SHOULD BE THE SECOND LINE&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//setInterval(function,t)</span></span><br><span class="line"><span class="keyword">const</span> id=<span class="built_in">setInterval</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>());</span><br><span class="line">&#125;,<span class="number">2000</span>);</span><br><span class="line"><span class="built_in">clearInterval</span>(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">//array.filter(function)</span></span><br><span class="line"><span class="keyword">const</span> filters=nums.<span class="title function_">filter</span>(<span class="function"><span class="params">num</span>=&gt;</span>num%<span class="number">2</span>==<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//&quot;sum of all&quot;</span></span><br><span class="line"><span class="keyword">const</span> total=nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total,price</span>)=&gt;</span>total+price)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&quot;product of all&quot;</span></span><br><span class="line"><span class="keyword">const</span> total=nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total,price</span>)=&gt;</span>total*price)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&quot;minimum of all&quot;</span></span><br><span class="line"><span class="keyword">const</span> min=nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">min,num</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//the return value becomes the next min</span></span><br><span class="line">    <span class="comment">//num start from nums[1] to nums[n-1]</span></span><br><span class="line">    <span class="keyword">if</span>(min&lt;num)&#123;</span><br><span class="line">        <span class="keyword">return</span> num;	</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//reduce with initial value 100</span></span><br><span class="line"><span class="keyword">const</span> total=nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total,num</span>)=&gt;</span>total+num,<span class="number">100</span>)</span><br></pre></td></tr></table></figure>



<h4 id="synchronous-callback"><a href="#synchronous-callback" class="headerlink" title="synchronous callback:"></a>synchronous callback:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function greeting(name) &#123;</span><br><span class="line">  alert(`Hello, $&#123;name&#125;`);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function processUserInput(callback) &#123;</span><br><span class="line">  const name = prompt(&#x27;Please enter your name.&#x27;);</span><br><span class="line">  callback(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">processUserInput(greeting);</span><br></pre></td></tr></table></figure>



<h4 id="asynchronous-callback"><a href="#asynchronous-callback" class="headerlink" title="asynchronous callback:"></a>asynchronous callback:</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function">https://developer.mozilla.org/en-US/docs/Glossary/Callback_function</a></p>
<h3 id="this"><a href="#this" class="headerlink" title="this:"></a>this:</h3><ul>
<li><p>“this” in regular function:  </p>
<ul>
<li><strong>whoever calling it; object before “.”</strong></li>
<li>how it is executed!</li>
</ul>
</li>
<li><p>“this” in arrow function: </p>
<ul>
<li><strong>the scope that it was created in</strong> </li>
<li>where it is created!</li>
</ul>
</li>
</ul>
<h3 id="spread"><a href="#spread" class="headerlink" title="spread:"></a>spread:</h3><ol>
<li>iterables:</li>
</ol>
<ul>
<li>array</li>
<li>string</li>
</ul>
<ol start="2">
<li>objects</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="title function_">max</span>(...[<span class="number">10</span>,<span class="number">5</span>,<span class="number">7</span>])</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(...<span class="string">&quot;Happy&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr1=[<span class="number">5</span>,<span class="number">8</span>]</span><br><span class="line"><span class="keyword">const</span> arr2=[<span class="number">1</span>,<span class="number">6</span>]</span><br><span class="line"><span class="keyword">const</span> arr=[...arr1,...arr2]</span><br></pre></td></tr></table></figure>



<h3 id="arguments"><a href="#arguments" class="headerlink" title="arguments:"></a>arguments:</h3><p>like an array but not an array</p>
<h3 id="rest"><a href="#rest" class="headerlink" title="rest:"></a>rest:</h3><p>an actual array</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params">...nums</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total,el</span>)=&gt;</span>total+el);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="destructuring："><a href="#destructuring：" class="headerlink" title="destructuring："></a>destructuring：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scores=[<span class="number">100</span>,<span class="number">99</span>,<span class="number">98</span>,<span class="number">67</span>,<span class="number">59</span>]</span><br><span class="line"><span class="keyword">const</span> [first,second,...everyoneElse]=scores</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">born</span>:birthYear, <span class="attr">deathYear</span>:dead =<span class="string">&#x27;N/A&#x27;</span>&#125;=user	<span class="comment">//destructuring object; rename variable; with default value</span></span><br></pre></td></tr></table></figure>





<h2 id="5-DOM"><a href="#5-DOM" class="headerlink" title="5.DOM"></a>5.DOM</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(<span class="variable language_">document</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">all</span>[<span class="number">10</span>].<span class="property">innerText</span>=<span class="string">&quot;New&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//select the JavaScript object</span></span><br><span class="line"><span class="keyword">const</span> toc=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(toc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> allImages=<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;img&quot;</span>)	<span class="comment">//a HTML Collection, consisting of HTML Elements, not an array</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(allImages[<span class="number">0</span>])	</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> image <span class="keyword">of</span> allImages)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(image.<span class="property">src</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> squareImages=<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&quot;square&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//querySelector</span></span><br><span class="line"><span class="keyword">const</span> firstPTag=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> firstPId=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#p&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> firstPClass=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.p&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;a[title=&#x27;Java&#x27;]&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;p a&quot;</span>)</span><br></pre></td></tr></table></figure>



<ul>
<li><p>innerText</p>
</li>
<li><p>textContent</p>
</li>
<li><p>innerHTML</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>).<span class="property">innerHTML</span> += <span class="string">&quot;&lt;sup&gt;superscript&lt;/sup&gt;&quot;</span></span><br></pre></td></tr></table></figure>




</li>
<li><p>attribute</p>
</li>
<li><p>style</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allLinks=<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> link <span class="keyword">of</span> allLinks)&#123;</span><br><span class="line">    link.<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;magenta&quot;</span></span><br><span class="line">    link.<span class="property">style</span>.<span class="property">textDecorationColor</span>=<span class="string">&quot;olive&quot;</span></span><br><span class="line">    link.<span class="property">style</span>.<span class="property">textDecorationStyle</span>=<span class="string">&quot;wavy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">const</span> h1=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(h1).<span class="property">fontSize</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>classList</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const h2=document.querySelector(&quot;h2&quot;)</span><br><span class="line">h2.classList.add(&quot;border&quot;)</span><br><span class="line">h2.classList.remove(&quot;purple&quot;)</span><br><span class="line">h2.classList.contains(&quot;green&quot;)	//false</span><br><span class="line"></span><br><span class="line">//on and off</span><br><span class="line">h2.classList.toggle(&quot;purple&quot;)</span><br><span class="line">h2.classList.toggle(&quot;purple&quot;)</span><br><span class="line">h2.classList.toggle(&quot;purple&quot;)</span><br></pre></td></tr></table></figure>



<ul>
<li>parentElement</li>
<li>children      &#x2F;&#x2F;HTMLCollection</li>
<li>nextElementSibling</li>
<li>previousElementSibling</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//appendChild</span></span><br><span class="line"><span class="keyword">const</span> newH3=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;h3&quot;</span>)</span><br><span class="line">newH3.<span class="property">innerText</span>=<span class="string">&quot;I AM NEW&quot;</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendCHild</span>(newH3)</span><br><span class="line"></span><br><span class="line"><span class="comment">//append </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//prepend</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//insertAjacentElement</span></span><br><span class="line"><span class="keyword">const</span> h4=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;h4&quot;</span>)</span><br><span class="line">h4.<span class="title function_">append</span>(<span class="string">&quot;hhhh&quot;</span>)</span><br><span class="line">newH3.<span class="title function_">insertAjacentElement</span>(<span class="string">&quot;afterend&quot;</span>,h4)	<span class="comment">//newH3.nextElementSibling</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//removeChild()</span></span><br><span class="line">img.<span class="property">parentElement</span>.<span class="title function_">removeChild</span>(img)</span><br><span class="line"><span class="comment">//remove()</span></span><br><span class="line">img.<span class="title function_">remove</span>()</span><br></pre></td></tr></table></figure>





<h2 id="6-DOM-events"><a href="#6-DOM-events" class="headerlink" title="6.DOM events"></a>6.DOM events</h2><h3 id="button"><a href="#button" class="headerlink" title="button"></a>button</h3><ul>
<li>onclick</li>
<li>ondblclick</li>
<li>onmouseenter</li>
<li>onmouseleave</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> btn=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;button&quot;</span>)</span><br><span class="line"></span><br><span class="line">btn.<span class="property">onclick</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HAHAHA!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//recommended, generic way</span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;You clicked me!!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,shout)</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,twist)	<span class="comment">//can coexist!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//not recommended</span></span><br><span class="line">btn.<span class="property">onclick</span>=shout</span><br><span class="line">btn.<span class="property">onclick</span>=twist	<span class="comment">//shout is lost, can not coexit</span></span><br></pre></td></tr></table></figure>



<h3 id="keyboard-event-objects"><a href="#keyboard-event-objects" class="headerlink" title="(keyboard) event objects"></a>(keyboard) event objects</h3><ul>
<li>keydown</li>
<li>keyup</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> input=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;input&quot;</span>)</span><br><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">key</span>)	<span class="comment">//q	</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">code</span>)	<span class="comment">//KeyQ</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">code</span>)	<span class="comment">//ArrowUp, ArrowLeft, ArrowRight, ArrowDown</span></span><br><span class="line">    <span class="keyword">switch</span>(e.<span class="property">code</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ArrowUp&quot;</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;UP&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ArrowDown&quot;</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;DOWN&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IGNORED!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="form-event"><a href="#form-event" class="headerlink" title="form event"></a>form event</h3><p>form action: send form data to the url, and switch to that url</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/url&quot;</span>&gt;</span>	</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;catName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span></span><br><span class="line">        Submit</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">    Available Cats</span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;cats&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>to stay in the same page after submitting form: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> form=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;form&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> input=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#catName&quot;</span>)	<span class="comment">//input.value</span></span><br><span class="line"><span class="keyword">const</span> list=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#cats&quot;</span>)</span><br><span class="line"></span><br><span class="line">form.<span class="title function_">addEventListener</span>(<span class="string">&quot;submit&quot;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Submitted the form!&quot;</span>)</span><br><span class="line">    <span class="keyword">const</span> name=input.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">const</span> newLi=<span class="variable language_">document</span>.<span class="title class_">CreateElement</span>(<span class="string">&quot;li&quot;</span>)</span><br><span class="line">    newLi.<span class="property">innerText</span>=name</span><br><span class="line">    list.<span class="title function_">append</span>(newLi)	<span class="comment">//list.appendChild(newLi)</span></span><br><span class="line">    input.<span class="property">value</span>=<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="input-event"><a href="#input-event" class="headerlink" title="input event"></a>input event</h3><ul>
<li>change event</li>
<li>input event</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> h1=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> input=docuemnt.<span class="title function_">querySelector</span>(<span class="string">&quot;input&quot;</span>)</span><br><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    h1.<span class="property">innerText</span>=input.<span class="property">value</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="event-bubbling"><a href="#event-bubbling" class="headerlink" title="event bubbling"></a>event bubbling</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.hide</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;changeColor&quot;</span>&gt;</span></span><br><span class="line">        change color</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container=docuemnt.<span class="title function_">querySelector</span>(<span class="string">&quot;#container&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> button=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#changeColor&quot;</span>)</span><br><span class="line">container.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    container.<span class="property">classList</span>.<span class="title function_">toggle</span>(<span class="string">&quot;hide&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeColor</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> r=<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">    <span class="keyword">const</span> g=<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">    <span class="keyword">const</span> b=<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span></span><br><span class="line">&#125;</span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">    container.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="title function_">makeRandColor</span>()</span><br><span class="line">    e.<span class="title function_">stopPropagation</span>();	<span class="comment">//stop bubbling!</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="event-delegation"><a href="#event-delegation" class="headerlink" title="event delegation"></a>event delegation</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#list&quot;</span>)</span><br><span class="line">container.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="comment">//console.log(&quot;Click on ul&quot;)</span></span><br><span class="line">    <span class="comment">//e.target.remove()</span></span><br><span class="line">    e.<span class="property">target</span>.<span class="property">nodeName</span>===<span class="string">&quot;LI&quot;</span> &amp;&amp; e.<span class="property">target</span>.<span class="title function_">remove</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="7-Asynchronous-JavaScript"><a href="#7-Asynchronous-JavaScript" class="headerlink" title="7. Asynchronous JavaScript"></a>7. Asynchronous JavaScript</h2><h3 id="call-stack"><a href="#call-stack" class="headerlink" title="call stack"></a>call stack</h3><h3 id="js-is-single-threaded"><a href="#js-is-single-threaded" class="headerlink" title="js is single-threaded!"></a>js is single-threaded!</h3><h3 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h3><ul>
<li>pending</li>
<li>resolved</li>
<li>rejected</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request=<span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee&quot;</span>)</span><br><span class="line">request.<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!&quot;</span>)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, ERROR!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page1&quot;</span>).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page1)&quot;</span>)</span><br><span class="line">    <span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page2&quot;</span>).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page2)&quot;</span>)</span><br><span class="line">    	&#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, ERROR!!&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, ERROR!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//promise chain: dependent asynchronous functions</span></span><br><span class="line"><span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page1&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page1)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page2&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page2)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page3&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page3)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, A REQUEST FAILED!!&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//create a promise</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fakeRequest</span>=(<span class="params">url</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> rand=<span class="title class_">Math</span>.<span class="title function_">random</span>()</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(rand&gt;<span class="number">0.7</span>)&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="string">&quot;Your fake data here&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&quot;Request error&quot;</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fakeRequest</span>(<span class="string">&#x27;/dogs/1&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;DONE WITH REQUEST&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Your data is: &quot;</span>,data)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, ERROR&quot;</span>+err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//example: rainbow</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">delayedColorChange</span>=(<span class="params">color, delay</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">backgroundColor</span>=color</span><br><span class="line">            <span class="title function_">resolve</span>()</span><br><span class="line">        &#125;, delay)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">delayedColorChange</span>(<span class="string">&quot;red&quot;</span>,<span class="number">1000</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;orange&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;yellow&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;green&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;blue&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;indigo&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;violet&quot;</span>,<span class="number">1000</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="async"><a href="#async" class="headerlink" title="async"></a>async</h3><ul>
<li>syntax sugar</li>
<li><strong>async function always returns Promise()</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sing</span>= <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&quot;OH NO&quot;</span>	<span class="comment">//a rejected Promise</span></span><br><span class="line">    <span class="comment">//after throw, becomes a rejected Promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;LA LA LA&quot;</span>	<span class="comment">//a resolved Promise</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sing</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">login</span> = <span class="keyword">async</span>(<span class="params">username, password</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(!username || !password) <span class="keyword">throw</span> <span class="string">&quot;Missing Credentials&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(password === <span class="string">&quot;ivnwth&quot;</span>) <span class="keyword">return</span> <span class="string">&quot;Welcome&quot;</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&quot;Invalid Password&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">login</span>(<span class="string">&quot;wrong input&quot;</span>)</span><br><span class="line">	.<span class="title function_">then</span>(<span class="function"><span class="params">msg</span>=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line">	.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="await"><a href="#await" class="headerlink" title="await"></a>await</h3><p>only valid when inside async functions</p>
<p><strong>wait for a Promise to be resolved</strong> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">rainbow</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;red&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="comment">//without await, won&#x27;t see red color because codes happen at the same time!!</span></span><br><span class="line">    <span class="comment">//with await, first see red, then see orange, ...</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;orange&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;yellow&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;green&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;blue&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;indigo&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;violet&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ALL DONE&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">rainbow</span>().<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;End of rainbow&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fakeRequest = (<span class="function"><span class="params">url0</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> delay = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*(<span class="number">4500</span>))+<span class="number">500</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(delay&gt;<span class="number">4000</span>)&#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="string">&quot;Connection Timeout:(&quot;</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="string">`Here is your fake data from <span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, delay)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">                     </span><br><span class="line"><span class="keyword">async</span> <span class="title function_">makeTwoRequests</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> data1=<span class="keyword">await</span> <span class="title function_">fakeRequest</span>(<span class="string">&quot;/page1&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data1)</span><br><span class="line">        <span class="keyword">let</span> data2=<span class="keyword">await</span> <span class="title function_">fakeRequest</span>(<span class="string">&quot;/page2&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data2)</span><br><span class="line">&#125;                     </span><br></pre></td></tr></table></figure>





<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">makeTwoRequest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> data1=<span class="keyword">await</span> <span class="title function_">fakeRequest</span>(<span class="string">&quot;/page1&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data1)</span><br><span class="line">        <span class="keyword">let</span> data2=<span class="keyword">await</span> <span class="title function_">fakeRequest</span>(<span class="string">&quot;/page2&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data2)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="8-AJAX"><a href="#8-AJAX" class="headerlink" title="8.AJAX"></a>8.AJAX</h2><ul>
<li>request a <strong>web API</strong>, and get a JSON string in return, instead of HTML, CSS and JavaScript<ul>
<li>JSON.parse(string)</li>
<li>JSON.stringify(object)</li>
</ul>
</li>
<li>AJAX? AJAJ!</li>
<li>JSON: JavaScript Object Notation</li>
</ul>
<h3 id="HTTP-Verbs"><a href="#HTTP-Verbs" class="headerlink" title="HTTP Verbs"></a>HTTP Verbs</h3><ul>
<li>get        &#x2F;&#x2F;get data through APIs<ul>
<li>a GET request <strong>cannot</strong> have <strong>req.body</strong>, only <strong>req.query</strong></li>
</ul>
</li>
<li>post      &#x2F;&#x2F;send data and store somewhere</li>
<li>put        &#x2F;&#x2F;completely update</li>
<li>patch    &#x2F;&#x2F;partly update data</li>
<li>delete</li>
</ul>
<h3 id="HTTP-Status-Codes"><a href="#HTTP-Status-Codes" class="headerlink" title="HTTP Status Codes"></a>HTTP Status Codes</h3><p>1:</p>
<p>2: success</p>
<p>3: redirection</p>
<p>4: client error</p>
<p>5: server error</p>
<h3 id="Query-string"><a href="#Query-string" class="headerlink" title="Query string"></a>Query string</h3><h3 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h3><ul>
<li>request header<ul>
<li>Accept: <ol>
<li>text&#x2F;html</li>
<li>application&#x2F;json</li>
<li>text&#x2F;plain</li>
</ol>
</li>
</ul>
</li>
<li>response header</li>
</ul>
<h3 id="XHRs"><a href="#XHRs" class="headerlink" title="XHRs"></a>XHRs</h3><p>old, unrecommended way</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> req=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"></span><br><span class="line">req.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT LOADED!!&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req.<span class="property">onerror</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!!&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;https://swapi.dev/api/people/1&quot;</span>);</span><br><span class="line">req.<span class="title function_">send</span>();</span><br></pre></td></tr></table></figure>







<h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h3><p>return a Promise</p>
<p>res.json() also returns a Promise</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;https://swapi.dev/api/people/1&quot;</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;RESOLVED!&quot;</span>,res);</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;JSON DONE&quot;</span>,data);</span><br><span class="line">      &#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>,e);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//a series of request</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadPeople</span>= <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> res1=<span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://swapi.dev/api/people/1&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> data1=<span class="keyword">await</span> res1.<span class="title function_">json</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data1);</span><br><span class="line">        <span class="keyword">const</span> res2=<span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://swapi.dev/api/people/2&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> data2=<span class="keyword">await</span> res2.<span class="title function_">json</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data2);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>,e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">loadPeople</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h3><p>axios.get() returns a data object</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;https://swapi.dev/api/people/1&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;RESPONSE:&quot;</span>,res);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>,e);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>axios.get(api, config_object)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getDadJoke</span>= <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> config=&#123;<span class="attr">header</span>:&#123;<span class="title class_">Accept</span>: <span class="string">&quot;application/json&quot;</span>&#125;&#125;;</span><br><span class="line">    	<span class="keyword">const</span> res=<span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;https://icanhazdadjoke.com/&quot;</span>,config);</span><br><span class="line">    	<span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>.<span class="property">joke</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="9-OOP"><a href="#9-OOP" class="headerlink" title="9.OOP"></a>9.OOP</h2><p>Array.prototype 和 String.prototype 可定义自定义方法，可override默认方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">grumpus</span>=<span class="function">()=&gt;</span><span class="title function_">alert</span>(<span class="string">&quot;GO AWAY!!&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cat=<span class="string">&quot;cat&quot;</span>;</span><br><span class="line">cat.<span class="title function_">grumpus</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">yell</span>=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`OMG!!!<span class="subst">$&#123;<span class="variable language_">this</span>.toUpperCase()&#125;</span>!!!!!!`</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="string">&quot;i love you&quot;</span>.<span class="title function_">yell</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>	<span class="comment">//actual template object</span></span><br><span class="line">[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>].<span class="property">__proto__</span>	<span class="comment">//reference to Array.prototype, no need to use it </span></span><br></pre></td></tr></table></figure>



<p>syntactic sugar</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Color</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">r,g,b,name</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">r</span>=r;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">g</span>=g;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">b</span>=b;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span>=name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">calcHSL</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="title function_">greet</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`HELLO FROM COLOR <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">rgb</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;r,g,b&#125;=<span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">hex</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;r,g,b&#125;=<span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>+((<span class="number">1</span>&lt;&lt;<span class="number">24</span>)+(r&lt;&lt;<span class="number">16</span>)+(g&lt;&lt;<span class="number">8</span>)+b).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">calcHSL</span>(<span class="params"></span>)&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">//adding new values to this object</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">h</span>=h;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">s</span>=s;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">l</span>=l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">const</span> c1=<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>,<span class="string">&quot;blue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> c2=<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="string">&quot;white&quot;</span>);</span><br><span class="line">c1.<span class="property">hex</span>===c2.<span class="property">hex</span>		<span class="comment">//true</span></span><br></pre></td></tr></table></figure>





<p>hsl:    hew([1,360]), saturation, lightness</p>
<h3 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h3><h3 id="super"><a href="#super" class="headerlink" title="super"></a>super</h3><p>调用父类的constructor</p>
<h2 id="10-Terminal"><a href="#10-Terminal" class="headerlink" title="10.Terminal"></a>10.Terminal</h2><ul>
<li>faster than GUI</li>
<li>all-access pass</li>
</ul>
<p>terminal:    </p>
<ul>
<li>a text-based interface to your computer</li>
<li>originally a physical object, but now we use software terminals</li>
</ul>
<p>shell:</p>
<ul>
<li>the program running on the terminal</li>
</ul>
<p>bash:</p>
<ul>
<li><p>one of the most popular shells</p>
</li>
<li><p>ls</p>
</li>
<li><p>pwd</p>
</li>
<li><p>cd</p>
</li>
<li><p>~ means home directory</p>
</li>
<li><p>&#x2F; means root directory</p>
</li>
<li><p>cd .. 后退一级 </p>
</li>
<li><p>cd &#x2F;</p>
</li>
<li><p>cd ~</p>
</li>
<li><p>mkdir Frogs&#x2F;TreeFrogs SugarGliders</p>
</li>
<li><p>touch index.html app.css app.js</p>
</li>
<li><p>rm index.html</p>
</li>
<li><p>rmdir 只能删空directory</p>
</li>
<li><p>rm -rf</p>
<ul>
<li>can delete (non-empty) directory</li>
<li>recursive </li>
<li>force</li>
</ul>
</li>
</ul>
<h3 id="man"><a href="#man" class="headerlink" title="man"></a>man</h3><ul>
<li>zsh 支持 man ls</li>
<li>bash 不支持</li>
</ul>
<h2 id="11-NodeJS"><a href="#11-NodeJS" class="headerlink" title="11.NodeJS"></a>11.NodeJS</h2><h3 id="Node-REPL"><a href="#Node-REPL" class="headerlink" title="Node REPL"></a>Node REPL</h3><p>Read Evaluate Print Loop</p>
<ul>
<li>.exit    &#x2F;&#x2F;ctrl+d</li>
<li>no <strong>window</strong>, but <strong>global</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node firstScript.js</span><br></pre></td></tr></table></figure>



<h3 id="process"><a href="#process" class="headerlink" title="process"></a>process</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.argv</span><br></pre></td></tr></table></figure>





<h3 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h3><ul>
<li>sync: try, catch</li>
<li>async: callback function</li>
</ul>
<h3 id="module-exports"><a href="#module-exports" class="headerlink" title="module.exports"></a>module.exports</h3><ol>
<li><p>export a single file</p>
<ul>
<li><p>export an object that other files can require</p>
</li>
<li><p>in the same directory: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> math=<span class="built_in">require</span>(<span class="string">&quot;./math&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>export a directory</p>
<ul>
<li>该directory的<strong>index.js</strong> module.exports什么，其他文件就require到什么</li>
</ul>
</li>
</ol>
<h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><p>Node Package Manager</p>
<ol>
<li>a free library</li>
<li>a command line tool</li>
<li>normally and by default install <strong>locally</strong></li>
<li>or, installed globly, and <strong>npm link</strong></li>
</ol>
<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><ul>
<li><p>npm init</p>
<p>npm init -y</p>
<p>创建package.json</p>
</li>
<li><p>npm install</p>
<p>根据package.json中的dependencies安装所有依赖包</p>
</li>
</ul>
<h2 id="12-Express"><a href="#12-Express" class="headerlink" title="12.Express"></a>12.Express</h2><h3 id="listen-amp-use"><a href="#listen-amp-use" class="headerlink" title="listen&amp;use"></a>listen&amp;use</h3><ul>
<li>libraries: You are in charge</li>
<li>framework: The framework is in charge!</li>
</ul>
<p>​        <strong>inversion of control</strong></p>
<ul>
<li><p>app.use(callback)</p>
<ul>
<li><p>express将html request&#x2F;response变成两个JS对象，传入callback</p>
</li>
<li><p>req: based on the incoming HTTP request</p>
</li>
<li><p>res: going to generate a HTTP response to the client</p>
<p><strong>can only have one request for one response</strong></p>
</li>
<li><p>res.send()</p>
<ul>
<li>可以传回html</li>
<li>也可以传回json</li>
</ul>
</li>
</ul>
</li>
<li><p>app.listen(8080,callback)</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app=<span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//anytime we have an incoming request</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WE GOT A NEW REQUEST!!&quot;</span>);</span><br><span class="line">    <span class="comment">//console.dir(req);</span></span><br><span class="line">    <span class="comment">//res.send(&quot;HELLO, WE GOT YOUR REQUEST! THIS IS A RESPONSE!!&quot;);</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;ivn&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;HELLO WORLD!&quot;</span> &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//start listening!</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;LISTENING ON PORT 8080&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3 id="routing"><a href="#routing" class="headerlink" title="routing"></a>routing</h3><p>app.get() only match get request</p>
<p>browser地址栏输入都是get request</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;&lt;h1&gt;IVN&lt;h1&gt;&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/r/:sub&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//console.log(req.params);</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`Welcome to subpage: <span class="subst">$&#123;req.params.sub&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/r/:sub/:postId&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; sub, postId &#125; = req.<span class="property">params</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`&lt;h1&gt;Viewing PostID: <span class="subst">$&#123;postId&#125;</span> on <span class="subst">$&#123;sub&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//必须放最后</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;*&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;I don&#x27;t know that path!!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="query-string"><a href="#query-string" class="headerlink" title="query string"></a>query string</h3><p>&#x2F;search?q&#x3D;cat</p>
<p>request.query</p>
<h3 id="nodemon"><a href="#nodemon" class="headerlink" title="nodemon"></a>nodemon</h3><p>automatic restart after change</p>
<h2 id="13-Templating"><a href="#13-Templating" class="headerlink" title="13.Templating"></a>13.Templating</h2><p>fill in the blank to create HTML</p>
<p>similar to <em>string template literal</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;ejs&quot;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;/views&quot;</span>));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&quot;home.ejs&quot;</span>);	<span class="comment">//.ejs可以省略</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3 id="EJS-syntax"><a href="#EJS-syntax" class="headerlink" title="EJS syntax"></a>EJS syntax</h3><ul>
<li>Embedded JS</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;</span><br><span class="line">    Page &lt;%=5+6-1 %&gt;</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure>



<p>res.render还可以传对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> num = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//res.render(&quot;home&quot;,&#123;allNum:num&#125;); </span></span><br><span class="line">    <span class="comment">//in ejs template: allNum</span></span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&quot;home&quot;</span>, &#123; num &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<ul>
<li>show data</li>
<li>conditions</li>
<li>loops</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;Random number: &lt;%= num %&gt;</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">&lt;%if (num%2==0)&#123;	%&gt;</span><br><span class="line">    &lt;h2&gt;</span><br><span class="line">        This is an even number!</span><br><span class="line">    &lt;/h2&gt;</span><br><span class="line">&lt;%&#125;	%&gt;</span><br></pre></td></tr></table></figure>



<h3 id="express-static"><a href="#express-static" class="headerlink" title="express.static()"></a>express.static()</h3><p>middleware</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//规定路径</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&#x27;public&#x27;</span>)));</span><br></pre></td></tr></table></figure>



<h3 id="ejs-partials"><a href="#ejs-partials" class="headerlink" title="ejs partials"></a>ejs partials</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include(&quot;partials/head&quot;)%&gt;</span><br></pre></td></tr></table></figure>





<h2 id="14-Bootstrap"><a href="#14-Bootstrap" class="headerlink" title="14.Bootstrap"></a>14.Bootstrap</h2><p>svg    fontawesome</p>
<h2 id="15-RESTful"><a href="#15-RESTful" class="headerlink" title="15.RESTful"></a>15.RESTful</h2><ul>
<li>get: <ul>
<li>query string</li>
<li>retrieve data, not creating anything</li>
</ul>
</li>
<li>post:<ul>
<li>request body</li>
<li>create data</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//built-in parsing middlewares	</span></span><br><span class="line"><span class="comment">//form data</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">//json data</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/tacos&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;meat, qty&#125;=req.<span class="property">body</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`OK, here are your <span class="subst">$&#123;qty&#125;</span> <span class="subst">$&#123;meat&#125;</span> tacos!`</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>REpresentational State Transfer</p>
<ul>
<li>client-server architecture</li>
</ul>
<p>​        Can make requests from browser or Postman. Doesn’t matter where the request is coming from.</p>
<ul>
<li>statelessness</li>
</ul>
<p>​        Every request is on its own.</p>
<ul>
<li><p>uniform interface</p>
<p>combine <strong>URLs</strong> with <strong>HTTP methods</strong> to expose full <strong>CRUD operations</strong> over HTTP</p>
</li>
</ul>
<h3 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h3><ol>
<li><p>app.get(“&#x2F;comments&#x2F;new”)    一个包含form的页面，submit调用app.post()完成新建</p>
</li>
<li><p>app.post(“&#x2F;comments”)   </p>
</li>
<li><p>post完毕后，app.redirect(“&#x2F;comments”)</p>
<p>redirect默认为get</p>
</li>
</ol>
<h3 id="show-x2F-detail-route"><a href="#show-x2F-detail-route" class="headerlink" title="show&#x2F;detail route"></a>show&#x2F;detail route</h3><p>nested route</p>
<h3 id="uuid"><a href="#uuid" class="headerlink" title="uuid"></a>uuid</h3><p>v4</p>
<p>uuidv4()</p>
<h3 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h3><p>html form only supports GET and POST</p>
<p>however, <strong>method-override</strong></p>
<h2 id="16-MongoDB"><a href="#16-MongoDB" class="headerlink" title="16.MongoDB"></a>16.MongoDB</h2><p>database</p>
<p>database management system</p>
<ul>
<li>effiecency</li>
<li>security</li>
<li>scalability</li>
</ul>
<h3 id="Structured-Query-Language"><a href="#Structured-Query-Language" class="headerlink" title="Structured Query Language"></a>Structured Query Language</h3><ul>
<li><p>predefined schema&#x2F;tables</p>
</li>
<li><p>relational&#x2F;referencing</p>
</li>
</ul>
<h3 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h3><ul>
<li>document</li>
<li>key-value</li>
<li>graph</li>
</ul>
<h3 id="mongod-exe"><a href="#mongod-exe" class="headerlink" title="mongod.exe"></a>mongod.exe</h3><p>get the server running</p>
<p>cmd打开后不要关！！</p>
<h3 id="mongo-exe"><a href="#mongo-exe" class="headerlink" title="mongo.exe"></a>mongo.exe</h3><p>enter the shell</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:27017/">http://127.0.0.1:27017/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br><span class="line">use loginDemo</span><br><span class="line">show collections</span><br><span class="line">db.users.find()</span><br></pre></td></tr></table></figure>



<h3 id="BSON"><a href="#BSON" class="headerlink" title="BSON"></a>BSON</h3><p>db</p>
<p>show collections</p>
<p>db.dogs.insertOne({name:”hhh”, age:3})</p>
<p>db.dogs.insert([{name:”iii”, age:5},{age:9}])    &#x2F;&#x2F;single or multiple </p>
<p>db.dogs.find()</p>
<p>db.dogs.find({age:9})    &#x2F;&#x2F;return the cursors</p>
<p>db.dogs.findOne({age:9})    &#x2F;&#x2F;return the actual object</p>
<p>db.cats.updateOne({} ,{})</p>
<p>db.cats.updateMany({}, {})</p>
<p>db.replaceOne()</p>
<p>db.deleteOne({})</p>
<p>db.deleteMany({})</p>
<h2 id="17-Mongoose"><a href="#17-Mongoose" class="headerlink" title="17.Mongoose"></a>17.Mongoose</h2><p>npm package </p>
<h3 id="Object-Data-x2F-Document-Mapper"><a href="#Object-Data-x2F-Document-Mapper" class="headerlink" title="Object Data&#x2F;Document Mapper"></a>Object Data&#x2F;Document Mapper</h3><p>nosql</p>
<h3 id="Object-Relation-Mapper"><a href="#Object-Relation-Mapper" class="headerlink" title="Object Relation Mapper"></a>Object Relation Mapper</h3><p>sql</p>
<h3 id="schema"><a href="#schema" class="headerlink" title="schema"></a>schema</h3><p>类比mybatis    .xml</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose=<span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&quot;mongodb://localhost:27017/moviewApp&quot;</span>,&#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CONNECTION OPEN!!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO ERROR!!!&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//schema</span></span><br><span class="line"><span class="keyword">const</span> movieSchema=<span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">year</span>:<span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">score</span>:<span class="title class_">Number</span></span><br><span class="line">    <span class="attr">rating</span>:<span class="title class_">String</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//name of model, schema</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Movie</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;Movie&quot;</span>, movieSchema);</span><br><span class="line"><span class="comment">//create a db collection called movies</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//make a new JS object</span></span><br><span class="line"><span class="keyword">const</span> amadeus = <span class="keyword">new</span> <span class="title class_">Movie</span>(&#123;<span class="attr">title</span>:<span class="string">&quot;Amadeus&quot;</span>, <span class="attr">year</span>: <span class="number">1986</span>, <span class="attr">score</span>: <span class="number">9.2</span>, <span class="attr">rating</span>: <span class="string">&quot;G&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//save to database collection!</span></span><br><span class="line">amadeus.<span class="title function_">save</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//insert many</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">insertMany</span>([</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>



<h3 id="load"><a href="#load" class="headerlink" title=".load"></a>.load</h3><p>node</p>
<p>.load index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//return an array; zero, one or many</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">find</span>(&#123;<span class="attr">year</span>: &#123;<span class="attr">$lt</span>: <span class="number">1990</span>&#125;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//findById</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">findById</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//updateOne</span></span><br><span class="line"><span class="comment">//updateMany</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">updateMany</span>(&#123;<span class="attr">title</span>: &#123;<span class="attr">$in</span>:[<span class="string">&quot;Amadeus&quot;</span>,<span class="string">&quot;Stand By Me&quot;</span>]&#125;&#125;, &#123;<span class="attr">score</span>: <span class="number">10</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line"></span><br><span class="line"><span class="comment">//findOneAndUpdate</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">findOneAndUpdate</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//remove is deprecated</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">remove</span>(&#123;&#125;)</span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">deleteMany</span>(&#123;&#125;)</span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">findOneAndDelete</span>(&#123;&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="Operation-Buffering"><a href="#Operation-Buffering" class="headerlink" title="Operation Buffering"></a>Operation Buffering</h3><h3 id="schema-constraints"><a href="#schema-constraints" class="headerlink" title="schema constraints"></a>schema constraints</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> productSchema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">maxlength</span>: <span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">price</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">        <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">//min: 0</span></span><br><span class="line">        <span class="comment">//constraint and error message</span></span><br><span class="line">        <span class="attr">min</span>:[<span class="number">0</span>,<span class="string">&quot;Price must be positive!&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onSale</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">categories</span>: [<span class="title class_">String</span>],	<span class="comment">//attempt to cast input into String</span></span><br><span class="line">    <span class="attr">qty</span>: &#123;</span><br><span class="line">        <span class="attr">online</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">inStore</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">size</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">        <span class="comment">//all valid values</span></span><br><span class="line">        <span class="attr">enum</span>: [<span class="string">&quot;S&quot;</span>, <span class="string">&quot;M&quot;</span>, <span class="string">&#x27;L&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Product</span> = mongoose.<span class="title function_">model</span>(<span class="string">&quot;Product&quot;</span>, productSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bike = <span class="keyword">new</span> <span class="title class_">Product</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Bike Helmet&quot;</span>, <span class="attr">price</span>: <span class="number">9.5</span>&#125;, <span class="attr">categories</span>: [<span class="string">&quot;Cycling&quot;</span>, <span class="string">&quot;Safety&quot;</span>, <span class="number">123</span>]);</span><br><span class="line"></span><br><span class="line">bike.<span class="title function_">save</span>()</span><br><span class="line">	.<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">	.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//When updating, schema constraint by default Not working</span></span><br><span class="line"><span class="title class_">Product</span>.<span class="title function_">findOneAndUpdate</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Bike Helmet&quot;</span>&#125;, &#123;<span class="attr">price</span>: <span class="number">99</span>&#125;, &#123;<span class="attr">new</span>:<span class="literal">true</span>, <span class="attr">runValidators</span>: <span class="literal">true</span>&#125; )</span><br><span class="line">	.<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">	.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="model-instance-method"><a href="#model-instance-method" class="headerlink" title="model instance method"></a>model instance method</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">productSchema.<span class="property">methods</span>.<span class="property">toggleOnSale</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onSale</span> = !<span class="variable language_">this</span>.<span class="property">onSale</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">save</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">findProduct</span> = <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> foundProduct = <span class="keyword">await</span> <span class="title class_">Product</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;hhh&quot;</span>&#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(foundProduct);</span><br><span class="line">    <span class="keyword">await</span> foundProduct.<span class="title function_">toggleOnSale</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(foundProduct);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="model-static-method"><a href="#model-static-method" class="headerlink" title="model static method"></a>model static method</h3><p><strong>fancy ways of CRUD</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">productSchema.<span class="property">statics</span>.<span class="property">fireSale</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="virtuals"><a href="#virtuals" class="headerlink" title="virtuals"></a>virtuals</h3><ul>
<li><p>behave as if it is a virtual property</p>
</li>
<li><p>not in Mongo database, but only in JS</p>
</li>
<li><p>get</p>
</li>
<li><p>set</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> personSchema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">first</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">last</span>:<span class="title class_">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">personSchema.<span class="title function_">virtual</span>(<span class="string">&quot;fullName&quot;</span>).<span class="title function_">get</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.first&#125;</span> <span class="subst">$&#123;<span class="variable language_">this</span>.last&#125;</span>`</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Person</span> = mongoose.<span class="title function_">model</span>(<span class="string">&quot;Person&quot;</span>, personSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tammy = <span class="keyword">new</span> <span class="title class_">Person</span>(&#123;<span class="attr">first</span>:<span class="string">&quot;Tammy&quot;</span>, <span class="attr">last</span>:<span class="string">&quot;Chow&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tammy.<span class="property">fullName</span>)</span><br><span class="line">                                            </span><br></pre></td></tr></table></figure>





<h3 id="middleware"><a href="#middleware" class="headerlink" title="middleware"></a>middleware</h3><p>do things before and after something(CRUD)</p>
<ul>
<li>pre hook</li>
<li>post hook</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">personSchema.<span class="title function_">pre</span>(<span class="string">&quot;save&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first</span>=<span class="string">&quot;first&quot;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">last</span>=<span class="string">&quot;last&quot;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ABOUT TO SAVE!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">personSchema.<span class="title function_">post</span>(<span class="string">&quot;save&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;JUST SAVED!!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="18-Express-Middleware"><a href="#18-Express-Middleware" class="headerlink" title="18.Express Middleware"></a>18.Express Middleware</h2><ul>
<li>Express middleware are functions that run during the req&#x2F;res lifecycle.</li>
<li>Middleware can end the HTTP request by sending back a response with methods like res.send()</li>
<li>OR middleware can be chained together, one afte another by calling next()</li>
</ul>
<h3 id="morgan"><a href="#morgan" class="headerlink" title="morgan"></a>morgan</h3><p>logger</p>
<p>npm i morgan</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> morgan=<span class="built_in">require</span>(<span class="string">&quot;morgan&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//app.use 		whenever a request comes in</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;HIJACKED BY MY APP.USE()&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">morgan</span>(<span class="string">&quot;tiny&quot;</span>))	<span class="comment">//inject in the middle</span></span><br><span class="line"><span class="comment">//app.use(morgan(&quot;common&quot;))</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY FIRST MIDDLEWARE&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY FIRST MIDDLEWARE - AFTER CALLING NEXT()&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY SECOND MIDDLEWARE&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//to make sure nothing happens after next, return next</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY FIRST MIDDLEWARE&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">next</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY FIRST MIDDLEWARE - AFTER CALLING NEXT()&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    req.<span class="property">method</span>=<span class="string">&quot;GET&quot;</span></span><br><span class="line">    req.<span class="property">requestTime</span>=<span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">path</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;password&#125;=req.<span class="property">query</span></span><br><span class="line">    <span class="keyword">if</span>(password===<span class="string">&quot;chickennugget&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;SORRY YOU NEED A PASSWORD!!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/secret&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">send</span>(<span class="string">&quot;NOT FOUND!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">verifyPassword</span>=(<span class="params">req,res,next</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;password&#125;=req.<span class="property">query</span></span><br><span class="line">    <span class="keyword">if</span>(password===<span class="string">&quot;chickennugget&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;SORRY YOU NEED A PASSWORD!!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//can have multiple callbacks</span></span><br><span class="line"><span class="comment">//not all callbacks will necessarily be executed</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/secret&quot;</span>,verifyPassword,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;My secret:   &quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3 id="ejs-mate"><a href="#ejs-mate" class="headerlink" title="ejs -mate"></a>ejs -mate</h3><h4 id="basic-index"><a href="#basic-index" class="headerlink" title="basic index"></a>basic index</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;% layout(&quot;layouts/boilerplate&quot;) %&gt;</span><br><span class="line">&lt;h1&gt;All Campgrounds&lt;/h1&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;a href=&quot;/campgrounds/new&quot;&gt;Add Campground&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;% for( let campground of campgrounds ) &#123; %&gt;</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">    &lt;a href=&quot;/campgrounds/&lt;%= campground._id %&gt; &quot;&gt;</span><br><span class="line">      &lt;%=campground.title %&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">  &lt;% &#125; %&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>





<h4 id="basic-new"><a href="#basic-new" class="headerlink" title="basic new"></a>basic new</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;% layout(&quot;layouts/boilerplate&quot;) %&gt;</span><br><span class="line">&lt;form action=&quot;/campgrounds&quot; method=&quot;post&quot;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label for=&quot;title&quot;&gt;Title&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;title&quot; name=&quot;campground[title]&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label for=&quot;location&quot;&gt;Location&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;location&quot; name=&quot;campground[location]&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;button&gt;Add Campground&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;a href=&quot;/campgrounds&quot;&gt;Back&lt;/a&gt;</span><br></pre></td></tr></table></figure>



<h4 id="basic-show"><a href="#basic-show" class="headerlink" title="basic show"></a>basic show</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;</span><br><span class="line">  &lt;%= campground.title %&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;h2&gt;</span><br><span class="line">  &lt;%= campground.location %&gt;</span><br><span class="line">&lt;/h2&gt;</span><br><span class="line">&lt;img src=&quot;&lt;%= campground.image %&gt; &quot; alt=&quot;&quot;&gt;</span><br><span class="line">&lt;p&gt;&lt;%= campground.description  %&gt; &lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;a href=&quot;/campgrounds/&lt;%= campground._id %&gt;/edit &quot;&gt;Edit&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">&lt;form action=&quot;/campgrounds/&lt;%= campground._id %&gt;?_method=DELETE&quot; method=&quot;post&quot;&gt;</span><br><span class="line">  &lt;button&gt;Delete Campground&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;footer&gt;</span><br><span class="line">  &lt;p&gt;&lt;a href=&quot;/campgrounds&quot;&gt;All Campgrounds&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;/footer&gt;</span><br></pre></td></tr></table></figure>





<h3 id="error-handling"><a href="#error-handling" class="headerlink" title="error-handling"></a>error-handling</h3><ul>
<li>next()        calling next non-error-handling middleware</li>
<li>next(err)   calling next(default) error-handling middleware</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//custom error handling middleware</span></span><br><span class="line"><span class="comment">//if custom error handler is defined, the default one will no longer work, except we add next(err)</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err,req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=======ERROR========&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;OH BOY, WE GOT AN ERROR!!&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="19-Mongo-Relationships"><a href="#19-Mongo-Relationships" class="headerlink" title="19. Mongo Relationships"></a>19. Mongo Relationships</h2><h3 id="SQL-relationships-tables"><a href="#SQL-relationships-tables" class="headerlink" title="SQL relationships        tables!"></a>SQL relationships        tables!</h3><ul>
<li>one-to-many<ul>
<li>primary key     User[id]</li>
<li>foreign key      Post[user_id]</li>
</ul>
</li>
<li>many-to-many<ul>
<li>a third table</li>
<li>Movie[id], Actor[id]</li>
<li>Role[movie_id,actor_id]</li>
</ul>
</li>
</ul>
<h3 id="One-to-Few"><a href="#One-to-Few" class="headerlink" title="One to Few"></a>One to Few</h3><ul>
<li><p>example: users&#x2F;accounts &#x3D;&gt; addresses</p>
</li>
<li><p>embed the data directly in the document</p>
</li>
<li><p>mongo add a new _id for each document&#x2F;schema</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">first</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">last</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">addresses</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//by default, each address will also have a _id</span></span><br><span class="line">            <span class="comment">//can be turned off</span></span><br><span class="line">            <span class="attr">_id</span>: &#123;<span class="attr">id</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">            <span class="attr">street</span>: <span class="title class_">String</span>,</span><br><span class="line">            <span class="attr">city</span>: <span class="title class_">String</span>,</span><br><span class="line">            <span class="attr">state</span>: <span class="title class_">String</span>,</span><br><span class="line">            <span class="attr">country</span>: <span class="title class_">String</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="One-to-Many"><a href="#One-to-Many" class="headerlink" title="One to Many"></a>One to Many</h3><ul>
<li>store refenrences(object id) to document inside the parent</li>
<li>similar to SQL one-to-many</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> productSchema=<span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">price</span>: <span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">season</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">enum</span>: [<span class="string">&quot;Spring&quot;</span>,<span class="string">&quot;Summer&quot;</span>,<span class="string">&quot;Fall&quot;</span>,<span class="string">&quot;Autumn&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Product</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;Product&quot;</span>,productSchema);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Product</span>.<span class="title function_">insertMany</span>([</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">&quot;Goddess Melon&quot;</span>,<span class="attr">price</span>: <span class="number">4.99</span>,<span class="attr">season</span>:<span class="string">&quot;Summer&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">&quot;Sugar Baby Melon&quot;</span>,<span class="attr">price</span>: <span class="number">4.99</span>,<span class="attr">season</span>:<span class="string">&quot;Summer&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">&quot;Asparagus&quot;</span>,<span class="attr">price</span>: <span class="number">3.99</span>,<span class="attr">season</span>:<span class="string">&quot;Spring&quot;</span>&#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">//const Schema=mongoose.Schema;</span></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="title class_">Schema</span>&#125;=mongoose;</span><br><span class="line"><span class="comment">//the ref option tells Mongoose which model to use during population, or the name of the model we are referencing</span></span><br><span class="line"><span class="keyword">const</span> farmSchema=<span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">city</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">products</span>:[&#123;<span class="attr">type</span>: <span class="title class_">Schema</span>.<span class="property">Types</span>.<span class="property">ObjectId</span>, <span class="attr">ref</span>: <span class="string">&quot;Product&quot;</span>&#125;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Farm</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;Farm&quot;</span>,farmSchema);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> farm=<span class="keyword">new</span> <span class="title class_">Farm</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Fully Belly Farms&quot;</span>, <span class="attr">city</span>: <span class="string">&quot;Guinda, CA&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> melon1=<span class="title class_">Product</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Goddess Melon&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> melon2=<span class="title class_">Product</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Asparagus&quot;</span>&#125;);</span><br><span class="line"><span class="comment">//not pushing the entire object, but just the id</span></span><br><span class="line">farm.<span class="property">products</span>.<span class="title function_">push</span>(melon1);</span><br><span class="line">farm.<span class="property">products</span>.<span class="title function_">push</span>(melon2);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Farm</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Fully Belly Farms&quot;</span>&#125;)</span><br><span class="line">    .<span class="title function_">populate</span>(<span class="string">&quot;products&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">farm</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(farm))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="One-to-Bajillions"><a href="#One-to-Bajillions" class="headerlink" title="One to Bajillions"></a>One to Bajillions</h3><ul>
<li><p>example: users &#x3D;&gt; tweets</p>
</li>
<li><p>store reference to parent in child</p>
</li>
<li><p>ref: Model</p>
</li>
<li><p>populate: field</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userSchema=<span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="title class_">Number</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tweetSchema=<span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">text</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">likes</span>:<span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">user</span>:&#123;<span class="attr">type</span>:<span class="title class_">Schema</span>.<span class="property">Type</span>.<span class="property">ObjectId</span>, <span class="attr">ref</span>:<span class="string">&quot;User&quot;</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;User&quot;</span>,userSchema)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Tweet</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;Tweet&quot;</span>,tweetSchema)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;chickenfan99&quot;</span>,<span class="attr">age</span>:<span class="number">63</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> tweet1=<span class="keyword">new</span> <span class="title class_">Tweet</span>(&#123;<span class="attr">text</span>:<span class="string">&quot;omg I love my chicken family!&quot;</span>, <span class="attr">likes</span>:<span class="number">0</span>&#125;);</span><br><span class="line">tweet1.<span class="property">user</span>=user;</span><br><span class="line">user.<span class="title function_">save</span>();</span><br><span class="line">tweet1.<span class="title function_">save</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//populate: name of the field, not name of the model</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Tweet</span>.<span class="title function_">findOne</span>(&#123;&#125;).<span class="title function_">populate</span>(<span class="string">&quot;user&quot;</span>))</span><br><span class="line"><span class="comment">//only want user.username</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Tweet</span>.<span class="title function_">findOne</span>(&#123;&#125;).<span class="title function_">populate</span>(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;username&quot;</span>))</span><br></pre></td></tr></table></figure>



<h3 id="paradox-of-choice-rule-of-thumb"><a href="#paradox-of-choice-rule-of-thumb" class="headerlink" title="paradox of choice: rule of thumb"></a>paradox of choice: rule of thumb</h3><ul>
<li>favor embedding unless there is compelling reason not to</li>
<li>needing to access an object on its own is a compelling reason not to embed it </li>
<li>Arrays should not grow without bound.</li>
<li>Don’t be afraid of application-level joins.</li>
<li>Consider the write&#x2F;read ratio when denormalizing.<ul>
<li>denormal: duplicate and store some requently accessed field together with objectId</li>
</ul>
</li>
<li>As always with MongoDB, how you model your data depends - entirely - on your particular application’s data access patterns.<ul>
<li>query?</li>
<li>update?</li>
</ul>
</li>
</ul>
<h3 id="deletion-mongoose-middleware"><a href="#deletion-mongoose-middleware" class="headerlink" title="deletion mongoose middleware"></a>deletion mongoose middleware</h3><ul>
<li>query middleware</li>
<li>document middleware</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//before &quot;findByIdAndDelete&quot;, have no access to data deleted</span></span><br><span class="line">farmSchema.<span class="title function_">pre</span>(<span class="string">&quot;findOneAndDelete&quot;</span>,<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;PRE MIDDLEWARE&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//after &quot;findByIdAndDelete&quot;, have access to data deleted</span></span><br><span class="line">farmSchema.<span class="title function_">post</span>(<span class="string">&quot;findOneAndDelete&quot;</span>,<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">farm</span>)&#123;</span><br><span class="line">    <span class="comment">//console.log(&quot;POST MIDDLEWARE&quot;)</span></span><br><span class="line">    <span class="comment">//console.log(data)</span></span><br><span class="line">    <span class="keyword">if</span>(farm.<span class="property">products</span>.<span class="property">length</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> res =<span class="keyword">await</span> <span class="title class_">Product</span>.<span class="title function_">deleteMany</span>(&#123;<span class="attr">_id</span>:&#123;<span class="attr">$in</span>: farm.<span class="property">products</span>&#125;&#125;)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="20-express-router"><a href="#20-express-router" class="headerlink" title="20. express router"></a>20. express router</h2><ul>
<li><p>better handle nested routes</p>
</li>
<li><p>separate and group different routes</p>
</li>
<li><p>assign middlewares to specific groups</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> router=express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//middleware</span></span><br><span class="line">router.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">query</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;SORRY NOT AN ADMIN!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//router.get(&quot;/shelters&quot;,(req,res)=&gt;&#123;</span></span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//router.post(&quot;/shelters&quot;,(req,res)=&gt;&#123;</span></span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/shelters/:id&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/:id&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//router.get(&quot;/shelters/:id/edit&quot;,(req,res)=&gt;&#123;</span></span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/:id/edit&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=router</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> app=<span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> shelterRoutes=<span class="built_in">require</span>(<span class="string">&quot;./routes/shelters&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//app.use(&quot;/&quot;,shelterRoutes)</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/shelters&quot;</span>,shelterRoutes)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Serving app on localhost:3000&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="21-http-cookies"><a href="#21-http-cookies" class="headerlink" title="21. http cookies"></a>21. http cookies</h2><ul>
<li><strong>cookies</strong> are little bits of information that are stored in a user’s browser when browsing a particular website</li>
<li>once a <strong>cookie</strong> is set, a user’s browser will send the cookie on every subsequent request to the site</li>
<li><strong>cookies</strong> add some <strong>“statefulness”</strong> to HTTP , between requests</li>
</ul>
<h3 id="send-cookies"><a href="#send-cookies" class="headerlink" title="send cookies"></a>send cookies</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/setname&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;steve chicks&quot;</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;OK SENT YOU A COOKIE!!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="cookie-parser-middleware"><a href="#cookie-parser-middleware" class="headerlink" title="cookie parser middleware"></a>cookie parser middleware</h3><p>npm i cookie-parser</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cookieParser=<span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>())</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/greet&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//console.log(req.cookies)</span></span><br><span class="line">    <span class="keyword">const</span> &#123;name=<span class="string">&quot;No-name&quot;</span>&#125; = req.<span class="property">cookies</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`HEY THERE, <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="signed-cookie"><a href="#signed-cookie" class="headerlink" title="signed cookie:"></a>signed cookie:</h3><h4 id="signed"><a href="#signed" class="headerlink" title="signed?"></a>signed?</h4><ul>
<li>analogy: old wax seal on letter, proving its <strong>validity&#x2F;integrity</strong></li>
<li>analogy: seal on peanut butter jar, if it’s broken, don’t eat it</li>
<li>is way to make sure it is not tampered with, not to make it a secret&#x2F;encrypted!!</li>
</ul>
<h4 id="basic-idea"><a href="#basic-idea" class="headerlink" title="basic idea:"></a>basic idea:</h4><ol>
<li>server send signed cookie to client</li>
<li>client send plain cookie to server on every request</li>
<li>client able to tell whether the cookie has been tampered with</li>
</ol>
<p>​        cookie-parser</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cookieParser=<span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>(<span class="string">&quot;thisismysecret&quot;</span>))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/getsignedcookie&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&quot;fruit&quot;</span>,<span class="string">&quot;grape&quot;</span>,&#123;<span class="attr">signed</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;sent you a signed cookie!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/verifyfruit&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">cookies</span>)	<span class="comment">//won&#x27;t contain signed cookie</span></span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">signedCookies</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="HMAC"><a href="#HMAC" class="headerlink" title="HMAC"></a>HMAC</h4><p><strong>Hash-based Message Authentication Code</strong></p>
<p>hashing function: SHA256</p>
<h2 id="22-session"><a href="#22-session" class="headerlink" title="22. session"></a>22. session</h2><ul>
<li><p>server side data store to make requests somewhat <strong>stateful</strong></p>
</li>
<li><p>example: shopping cart</p>
<ol>
<li>session contains the whole shopping carts of different id’s</li>
<li>cookie only contains the session id, <strong>connect.sid</strong></li>
</ol>
</li>
<li><p>server send back the session id as cookie</p>
</li>
<li><p>default store: <strong>MemoryStore</strong></p>
<p>when restart the browser, everything is reset</p>
</li>
<li><p>impermenant data store: Redis</p>
</li>
</ul>
<h3 id="why-not-cookie"><a href="#why-not-cookie" class="headerlink" title="why not cookie?"></a>why not cookie?</h3><ol>
<li>limited size</li>
<li>insecure</li>
</ol>
<h3 id="express-session"><a href="#express-session" class="headerlink" title="express-session"></a>express-session</h3><p>npm i express-session</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> app=<span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> session=<span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;<span class="attr">secret</span>: <span class="string">&quot;thisisnotagoodsecret&quot;</span>, <span class="attr">resave</span>: <span class="literal">false</span>, <span class="attr">saveUninitialized</span>: <span class="literal">false</span>&#125;))</span><br><span class="line"><span class="comment">//send back a signed cookie: connect.sid</span></span><br><span class="line"><span class="comment">//to the browser</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/viewcount&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">count</span>)&#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">count</span>+=<span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">count</span>=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`YOU HAVE VIEWED THIS PAGE <span class="subst">$&#123;req.session.count&#125;</span> TIMES`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/register&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;username=<span class="string">&quot;Anonymous&quot;</span>&#125; = req.<span class="property">query</span>;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">username</span>=username;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&quot;/greet&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/greet&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;username&#125; = req.<span class="property">session</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`Welcome back, <span class="subst">$&#123;username&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Serving app on localhost:3000&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="connect-flash"><a href="#connect-flash" class="headerlink" title="connect-flash"></a>connect-flash</h3><ul>
<li>after some action (create, delete, log in)</li>
<li>before redirection</li>
<li>depends on session</li>
</ul>
<p>npm i connect-flash</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> flash=<span class="built_in">require</span>(<span class="string">&quot;connect-flash&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">flash</span>())</span><br></pre></td></tr></table></figure>



<p>with the flash middleware in place, all requests will have a req.flash() function that can be used to flash messages</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//(key, value), stored in session</span></span><br><span class="line"><span class="comment">//before redirect</span></span><br><span class="line">req.<span class="title function_">flash</span>(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;information I want to flash&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//when I want to use it, in the redirected page</span></span><br><span class="line">res.<span class="title function_">render</span>(<span class="string">&quot;index&quot;</span>,&#123;<span class="attr">messages</span>:req.<span class="title function_">flash</span>(<span class="string">&quot;info&quot;</span>)&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= messages %&gt;</span><br></pre></td></tr></table></figure>



<h3 id="improvement-using-res-locals"><a href="#improvement-using-res-locals" class="headerlink" title="improvement using res.locals"></a>improvement using res.locals</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="property">locals</span>.<span class="property">messages</span>=req.<span class="title function_">flash</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="23-Authentication-amp-Authorization"><a href="#23-Authentication-amp-Authorization" class="headerlink" title="23. Authentication &amp; Authorization"></a>23. Authentication &amp; Authorization</h2><ul>
<li><p>authentication is the process of verifying <strong>who a particular user is</strong></p>
<ol>
<li>username&#x2F;password combo</li>
<li>security questions</li>
<li>facial recognition</li>
</ol>
</li>
<li><p>authorization is verifying <strong>what a specific user has access to</strong></p>
<p>“Now that we know who you are, here is what you are allowed to do and NOT allowed to do”</p>
</li>
</ul>
<h3 id="NEVER-STORE-PASSWORDS"><a href="#NEVER-STORE-PASSWORDS" class="headerlink" title="NEVER STORE PASSWORDS"></a>NEVER STORE PASSWORDS</h3><ul>
<li>Rather than storing a password in the database, wu run the password through a <strong>hashing function</strong> first and then store the result in the database</li>
</ul>
<h3 id="hashing-function"><a href="#hashing-function" class="headerlink" title="hashing function"></a>hashing function</h3><ul>
<li>functions that map input data of some <strong>arbitrary size</strong> to <strong>fixed-size</strong> output values</li>
</ul>
<h3 id="cryptographic-hash-functions"><a href="#cryptographic-hash-functions" class="headerlink" title="cryptographic hash functions"></a>cryptographic hash functions</h3><ul>
<li><strong>one-way function</strong> which is infeasible to invert</li>
</ul>
<p>​       unable to get the input from the output</p>
<ul>
<li><p>small change in input yields large change in the output</p>
</li>
<li><p><strong>deterministic</strong>: same input yields same output</p>
</li>
<li><p>unlikely to find 2 outputs with same value</p>
<p>collisions are rare</p>
</li>
<li><p>password hash functions are <strong>deliberately slow</strong></p>
</li>
</ul>
<h3 id="password-salts"><a href="#password-salts" class="headerlink" title="password salts"></a>password salts</h3><ul>
<li><p>an extra safeguard</p>
</li>
<li><p>facts:</p>
<ol>
<li>people use same passwords from one site to the next frequently</li>
<li>people in general, use the same passwords from one person to the next</li>
</ol>
</li>
<li><p>if hackers know the hash fuction is Bcrypt ahead of time, they can precompute, trying every common password</p>
</li>
<li><p>password salts:</p>
<pre><code>1. A salt is a **random value** added to the password before we hash it.
   + append
   + prepend
</code></pre>
<ol>
<li>It helps ensure unique hashes and mitigate common attacks.</li>
</ol>
</li>
</ul>
<h3 id="Bcrypt"><a href="#Bcrypt" class="headerlink" title="Bcrypt"></a>Bcrypt</h3><ul>
<li><p>saltRounds: difficulty, amoun of time to hash</p>
<p>recommended around 12</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bcrypt=<span class="built_in">require</span>(<span class="string">&quot;bcrypt&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hashPassword</span>=<span class="keyword">async</span>(<span class="params">pw</span>)=&gt;&#123;</span><br><span class="line">    <span class="comment">//const salt=await bcrypt.genSalt(10);</span></span><br><span class="line">    <span class="comment">//const hash=await bcrypt.hash(pw,salt);</span></span><br><span class="line">    <span class="comment">//console.log(salt)</span></span><br><span class="line">    <span class="keyword">const</span> hash=<span class="keyword">await</span> bcrypt.<span class="title function_">hash</span>(pw,<span class="number">10</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(hash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">login</span>=<span class="keyword">async</span>(<span class="params">pw,hashedPassword</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> result=<span class="keyword">await</span> bcrypt.<span class="title function_">compare</span>(pw,hashedPassword)</span><br><span class="line">    <span class="keyword">if</span>(result)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;LOGGED IN !!&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;INCORRECT&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">hashPassword</span>(<span class="string">&quot;monkey&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="use-session-to-log-in-x2F-out"><a href="#use-session-to-log-in-x2F-out" class="headerlink" title="use session to log in&#x2F;out"></a>use session to log in&#x2F;out</h3><p>On an incoming http request, Express middleware that supports the session checks a particular client cookie and if that particular cookie is found on the http request and is found in the global session object&#x2F;database, then it adds that session’s stored info to the request object for the http request handler to later use.</p>
<p>So, here’s a typical sequence:</p>
<ol>
<li>Incoming HTTP request.</li>
<li>Middleware checks for session cookie.</li>
<li>If session cookie not there, then create one and, in the process created a unique id to identify this http client.</li>
<li>In the persistent session store, initialize the session for this new client.</li>
<li>If session cookie is there, then look in the session store for the session data for this client and add that data to the request object.</li>
<li>End of session middleware processing</li>
<li>Later on in the Express processing of this http request, it gets to a matching request handler. The session data from the session store for this particular http client is already attached to the request object and available for the request handler to use.</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>,<span class="title function_">async</span>(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;username,password&#125;=req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;username&#125;)</span><br><span class="line">    <span class="keyword">const</span> validPassword=<span class="keyword">await</span> bcrypt.<span class="title function_">compare</span>(password,user.<span class="property">password</span>)</span><br><span class="line">    <span class="keyword">if</span>(validPassword)&#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">user_id</span>=user.<span class="property">_id</span></span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;YAY WELCOME!!&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;TRY AGAIN&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/secret&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">user_id</span>)&#123;</span><br><span class="line">        res.<span class="title function_">redierct</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;This is a secret for logged in users!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;logout&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//req.session.user_id=null;</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="title function_">destroy</span>(); <span class="comment">//destroy the entire session</span></span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3 id="refactor-to-model-methods"><a href="#refactor-to-model-methods" class="headerlink" title="refactor to model methods"></a>refactor to model methods</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">userSchema.<span class="property">statics</span>.<span class="property">findAndValidate</span>=<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">username,password</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> foundUser=<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">findOne</span>(&#123;username&#125;)</span><br><span class="line">    <span class="keyword">const</span> isValid=<span class="keyword">await</span> bcrypt.<span class="title function_">compare</span>(password,foundUser.<span class="property">password</span>)</span><br><span class="line">    <span class="keyword">return</span> isValid ? foundUser : <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">userSchema.<span class="title function_">pre</span>(<span class="string">&quot;save&quot;</span>,<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">next</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="title function_">isModified</span>(<span class="string">&quot;password&quot;</span>)) <span class="keyword">return</span> <span class="title function_">next</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">password</span>=<span class="keyword">await</span> bcrypt.<span class="title function_">hash</span>(<span class="variable language_">this</span>.<span class="property">password</span>,<span class="number">12</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="24-image-upload"><a href="#24-image-upload" class="headerlink" title="24. image upload"></a>24. image upload</h2><ul>
<li>mongo document size limit: 16MB</li>
<li>GridFS</li>
</ul>
<ol>
<li>set up a form that would accept images</li>
<li>submit the form</li>
<li>store image data in Cloudinary</li>
<li>Cloudinary send back URLs</li>
<li>store URLs in mongo</li>
</ol>
<h3 id="Cloudinary"><a href="#Cloudinary" class="headerlink" title="Cloudinary"></a>Cloudinary</h3><ul>
<li>like AWS</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CLOUDINARY_CLOUD_NAME=</span><br><span class="line">CLOUDINARY_KEY=</span><br><span class="line">CLOUDINARY_SECRET=</span><br></pre></td></tr></table></figure>



<h3 id="enctype"><a href="#enctype" class="headerlink" title="enctype"></a>enctype</h3><ul>
<li><p>application&#x2F;x-www-form-urlencoded</p>
<p>default</p>
</li>
<li><p>multipart&#x2F;form-data</p>
<p>if the form contains file inputs</p>
</li>
</ul>
<h3 id="Multer"><a href="#Multer" class="headerlink" title="Multer"></a>Multer</h3><ol>
<li><p>first upload</p>
</li>
<li><p>then we can use req.body and req.file(s)</p>
</li>
</ol>
<p>in order to parse mutlipart form</p>
<ul>
<li><p>req.body</p>
<p>other information, except for the file</p>
</li>
<li><p>req.file</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multer=<span class="built_in">require</span>(<span class="string">&quot;multer&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> upload=<span class="title function_">multer</span>(&#123;<span class="attr">dest</span>:<span class="string">&quot;uploads/&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">route</span>(<span class="string">&quot;/&quot;</span>).<span class="title function_">post</span>(upload.<span class="title function_">single</span>(<span class="string">&quot;image&quot;</span>),<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>,req.<span class="property">file</span>)</span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">file</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">route</span>(<span class="string">&quot;/&quot;</span>).<span class="title function_">post</span>(upload.<span class="title function_">array</span>(<span class="string">&quot;image&quot;</span>),<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>,req.<span class="property">files</span>)</span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">files</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="dotenv"><a href="#dotenv" class="headerlink" title="dotenv"></a>dotenv</h3><ul>
<li>avoid embedding api credentials right inside applications</li>
<li>instead, store in .env files</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SECRET=lololololol</span><br><span class="line">API_KEY=fasdjfoiahfawe8</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !==<span class="string">&quot;production&quot;</span>)&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>).<span class="title function_">config</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">env</span>.<span class="property">SECRET</span>)</span><br></pre></td></tr></table></figure>





<h2 id="25-common-security-vulnerabilities"><a href="#25-common-security-vulnerabilities" class="headerlink" title="25. common security vulnerabilities"></a>25. common security vulnerabilities</h2><h3 id="database-injection"><a href="#database-injection" class="headerlink" title="database injection"></a>database injection</h3><ul>
<li><p>sql injection</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; DROP TABLE user</span><br></pre></td></tr></table></figure>


</li>
<li><p>mongo injection</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;username:req.body.username&#125;)</span><br><span class="line">//</span><br><span class="line">db.users.find(&#123;username:&#123;&quot;$gt&quot;:&quot;&quot;&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Cross-Site-Scripting-XSS"><a href="#Cross-Site-Scripting-XSS" class="headerlink" title="Cross Site Scripting(XSS)"></a>Cross Site Scripting(XSS)</h3><p><a target="_blank" rel="noopener" href="https://xss-game.appspot.com/">https://xss-game.appspot.com/</a></p>
<h3 id="helmet"><a href="#helmet" class="headerlink" title="helmet"></a>helmet</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">    <span class="title function_">helmet</span>(&#123;</span><br><span class="line">        <span class="attr">contentSecurityPolicy</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">crossOriginEmbedderPolicy</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>





<h2 id="26-heroku"><a href="#26-heroku" class="headerlink" title="26. heroku"></a>26. heroku</h2><h3 id="heroku-CLI"><a href="#heroku-CLI" class="headerlink" title="heroku CLI"></a>heroku CLI</h3><p>command line interface</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">heroku git:remote -a &lt;name of the heroku app&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">heroku login</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;new message&quot;</span><br><span class="line">git push heroku master</span><br><span class="line"></span><br><span class="line">heroku restart</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/28/Sentence-Similarity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/28/Sentence-Similarity/" class="post-title-link" itemprop="url">Sentence Similarity</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-28 17:50:20" itemprop="dateCreated datePublished" datetime="2022-11-28T17:50:20+08:00">2022-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 10:11:47" itemprop="dateModified" datetime="2022-11-29T10:11:47+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Sentence-Similarity"><a href="#Sentence-Similarity" class="headerlink" title="Sentence Similarity"></a>Sentence Similarity</h1><h2 id="734-Sentence-Similarity"><a href="#734-Sentence-Similarity" class="headerlink" title="734. Sentence Similarity"></a>734. Sentence Similarity</h2><p>not transitive:</p>
<ul>
<li>HashSet</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">areSentencesSimilar</span><span class="params">(String[] sentence1, String[] sentence2, List&lt;List&lt;String&gt;&gt; similarPairs)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=sentence1.length;</span><br><span class="line">    <span class="keyword">if</span>(n!= sentence2.length)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    HashSet&lt;String&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (List&lt;String&gt; similarPair : similarPairs) &#123;</span><br><span class="line">        String a=similarPair.get(<span class="number">0</span>);</span><br><span class="line">        String b=similarPair.get(<span class="number">1</span>);</span><br><span class="line">        set.add(a+b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        String s1=sentence1[i];</span><br><span class="line">        String s2=sentence2[i];</span><br><span class="line">        <span class="keyword">if</span>(s1.equals(s2))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!set.contains(s1+s2) &amp;&amp; !set.contains(s2+s1))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="737-Sentence-Similarity-II"><a href="#737-Sentence-Similarity-II" class="headerlink" title="737. Sentence Similarity II"></a>737. Sentence Similarity II</h2><p>transitive: </p>
<ul>
<li>BFS search</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">areSentencesSimilarTwo</span><span class="params">(String[] sentence1, String[] sentence2, List&lt;List&lt;String&gt;&gt; similarPairs)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=sentence1.length;</span><br><span class="line">    <span class="keyword">if</span>(n!= sentence2.length)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, List&lt;String&gt;&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (List&lt;String&gt; similarPair : similarPairs) &#123;</span><br><span class="line">        String a=similarPair.get(<span class="number">0</span>);</span><br><span class="line">        String b=similarPair.get(<span class="number">1</span>);</span><br><span class="line">        map.putIfAbsent(a,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;());</span><br><span class="line">        map.get(a).add(b);</span><br><span class="line">        map.putIfAbsent(b,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;());</span><br><span class="line">        map.get(b).add(a);</span><br><span class="line">    &#125;</span><br><span class="line">    Deque&lt;String&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    Set&lt;String&gt; visited=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        String s1=sentence1[i];</span><br><span class="line">        String s2=sentence2[i];</span><br><span class="line">        <span class="keyword">if</span>(s1.equals(s2))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        q.clear();</span><br><span class="line">        visited.clear();</span><br><span class="line">        q.offer(s1);</span><br><span class="line">        <span class="type">boolean</span> found=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">            String cur=q.poll();</span><br><span class="line">            <span class="keyword">if</span>(cur.equals(s2))&#123;</span><br><span class="line">                found=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(cur))&#123;</span><br><span class="line">                <span class="keyword">for</span> (String next : map.get(cur)) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!visited.contains(next))&#123;</span><br><span class="line">                        q.offer(next);</span><br><span class="line">                        visited.add(next);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/27/BFS-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/27/BFS-2/" class="post-title-link" itemprop="url">BFS(2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-27 20:06:34" itemprop="dateCreated datePublished" datetime="2022-11-27T20:06:34+08:00">2022-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-03-24 08:42:14" itemprop="dateModified" datetime="2023-03-24T08:42:14+08:00">2023-03-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>22k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>20 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="BFS选编（2）"><a href="#BFS选编（2）" class="headerlink" title="BFS选编（2）"></a>BFS选编（2）</h1><h2 id="733-Flood-Fill"><a href="#733-Flood-Fill" class="headerlink" title="733. Flood Fill"></a>733. Flood Fill</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] floodFill(<span class="type">int</span>[][] image, <span class="type">int</span> sr, <span class="type">int</span> sc, <span class="type">int</span> color) &#123;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> row=image.length;</span><br><span class="line">    <span class="type">int</span> col=image[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span> c=image[sr][sc];</span><br><span class="line">    <span class="type">int</span>[] dx=&#123;<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span>[] dy=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;sr,sc&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">        <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(image[i][j]!=color)&#123;</span><br><span class="line">            image[i][j]=color;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x=i+dx[k];</span><br><span class="line">                <span class="type">int</span> y=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col</span><br><span class="line">                        &amp;&amp; image[x][y]==c)&#123;</span><br><span class="line">                    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="743-Network-Delay-Time"><a href="#743-Network-Delay-Time" class="headerlink" title="743. Network Delay Time"></a>743. Network Delay Time</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dijkstra</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">networkDelayTime</span><span class="params">(<span class="type">int</span>[][] times, <span class="type">int</span> n, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    Map&lt;Integer,List&lt;<span class="type">int</span>[]&gt;&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] time : times) &#123;</span><br><span class="line">        <span class="type">int</span> from=time[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> to=time[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> len=time[<span class="number">2</span>];</span><br><span class="line">        map.putIfAbsent(from,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        map.get(from).add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;to,len&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span>[] dist=<span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    Arrays.fill(dist,Integer.MAX_VALUE);</span><br><span class="line">    dist[k]=<span class="number">0</span>;</span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;(a[<span class="number">1</span>]-b[<span class="number">1</span>]));</span><br><span class="line">    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;k,<span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">        <span class="type">int</span> vertex=cur[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> distToStart=cur[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(vertex))&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span>[] ints : map.get(vertex)) &#123;</span><br><span class="line">                <span class="type">int</span> next=ints[<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> len=ints[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span>(distToStart+len&lt;dist[next])&#123;</span><br><span class="line">                    dist[next]=distToStart+len;</span><br><span class="line">                    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;next,distToStart+len&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res=Integer.MIN_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(dist[i]==Integer.MAX_VALUE)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res=Math.max(res,dist[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="752-Open-the-Lock"><a href="#752-Open-the-Lock" class="headerlink" title="752. Open the Lock"></a>752. Open the Lock</h2><p>KEY ISSUE: how to represent changes of layer?</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">openLock</span><span class="params">(String[] deadends, String target)</span> &#123;</span><br><span class="line">    Set&lt;String&gt; dead=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String deadend : deadends) &#123;</span><br><span class="line">        dead.add(deadend);</span><br><span class="line">    &#125;</span><br><span class="line">    Deque&lt;String&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    Set&lt;String&gt; visited=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    visited.add(<span class="string">&quot;0000&quot;</span>);</span><br><span class="line">    q.offer(<span class="string">&quot;0000&quot;</span>);</span><br><span class="line">    q.offer(<span class="literal">null</span>);</span><br><span class="line">    <span class="type">int</span> depth=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        String cur=q.poll();</span><br><span class="line">        <span class="keyword">if</span>(!dead.contains(cur))&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur==<span class="literal">null</span>)&#123;</span><br><span class="line">                depth++;</span><br><span class="line">                <span class="keyword">if</span>(!q.isEmpty())&#123;</span><br><span class="line">                    q.offer(<span class="literal">null</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cur.equals(target))&#123;</span><br><span class="line">                <span class="keyword">return</span> depth;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> d=-<span class="number">1</span>; d&lt;=<span class="number">1</span>; d+=<span class="number">2</span>)&#123;</span><br><span class="line">                        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>; p &lt;= i-<span class="number">1</span>; p++) &#123;</span><br><span class="line">                            sb.append(cur.charAt(p));</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="type">char</span> c=cur.charAt(i);</span><br><span class="line">                        <span class="type">char</span> next=(<span class="type">char</span>)(c+d);</span><br><span class="line">                        <span class="keyword">if</span>(next&gt;<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">                            next=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(next&lt;<span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">                            next=<span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        sb.append(next);</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> i+<span class="number">1</span>; p &lt; <span class="number">4</span>; p++) &#123;</span><br><span class="line">                            sb.append(cur.charAt(p));</span><br><span class="line">                        &#125;</span><br><span class="line">                        String string=sb.toString();</span><br><span class="line">                        <span class="keyword">if</span>(!visited.contains(string))&#123;</span><br><span class="line">                            visited.add(string);</span><br><span class="line">                            q.offer(string);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="773-Sliding-Puzzle"><a href="#773-Sliding-Puzzle" class="headerlink" title="773. Sliding Puzzle"></a>773. Sliding Puzzle</h2><p>KEY ISSUE: how to represent changes of layer?</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[][] neighbors=&#123;</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">3</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">2</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>,<span class="number">4</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">slidingPuzzle</span><span class="params">(<span class="type">int</span>[][] board)</span> &#123;</span><br><span class="line">    Set&lt;String&gt; seen=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    Deque&lt;String&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">char</span>[] chars=<span class="keyword">new</span> <span class="title class_">char</span>[<span class="number">6</span>];</span><br><span class="line">    chars[<span class="number">0</span>]=(<span class="type">char</span>)(board[<span class="number">0</span>][<span class="number">0</span>]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    chars[<span class="number">1</span>]=(<span class="type">char</span>)(board[<span class="number">0</span>][<span class="number">1</span>]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    chars[<span class="number">2</span>]=(<span class="type">char</span>)(board[<span class="number">0</span>][<span class="number">2</span>]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    chars[<span class="number">3</span>]=(<span class="type">char</span>)(board[<span class="number">1</span>][<span class="number">0</span>]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    chars[<span class="number">4</span>]=(<span class="type">char</span>)(board[<span class="number">1</span>][<span class="number">1</span>]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    chars[<span class="number">5</span>]=(<span class="type">char</span>)(board[<span class="number">1</span>][<span class="number">2</span>]+<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">    q.offer(<span class="keyword">new</span> <span class="title class_">String</span>(chars));</span><br><span class="line">    q.offer(<span class="literal">null</span>);</span><br><span class="line">    seen.add(<span class="keyword">new</span> <span class="title class_">String</span>(chars));</span><br><span class="line">    <span class="type">int</span> depth=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        String cur=q.poll();</span><br><span class="line">        <span class="keyword">if</span>(cur==<span class="literal">null</span>)&#123;</span><br><span class="line">            depth++;</span><br><span class="line">            <span class="keyword">if</span>(!q.isEmpty())&#123;</span><br><span class="line">                q.offer(<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cur.equals(<span class="string">&quot;123450&quot;</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> depth;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> index=cur.indexOf(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i : neighbors[index]) &#123;</span><br><span class="line">                String next=swap(cur,index,i);</span><br><span class="line">                <span class="keyword">if</span>(!seen.contains(next))&#123;</span><br><span class="line">                    seen.add(next);</span><br><span class="line">                    q.offer(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String <span class="title function_">swap</span><span class="params">(String cur, <span class="type">int</span> index, <span class="type">int</span> i)</span>&#123;</span><br><span class="line">    <span class="type">char</span>[] chars=cur.toCharArray();</span><br><span class="line">    <span class="type">char</span> temp=chars[index];</span><br><span class="line">    chars[index]=chars[i];</span><br><span class="line">    chars[i]=temp;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="785-Is-Graph-Bipartite"><a href="#785-Is-Graph-Bipartite" class="headerlink" title="785. Is Graph Bipartite?"></a>785. Is Graph Bipartite?</h2><p>BFS Solution:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBipartite</span><span class="params">(<span class="type">int</span>[][] graph)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> graph.length;</span><br><span class="line">        <span class="type">int</span>[] colors = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (colors[i] != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            Queue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">            queue.offer(i);</span><br><span class="line">            colors[i] = <span class="number">1</span>;   <span class="comment">// Blue: 1; Red: -1.</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">cur</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> next : graph[cur]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (colors[next] == <span class="number">0</span>) &#123;          <span class="comment">// If this node hasn&#x27;t been colored;</span></span><br><span class="line">                        colors[next] = -colors[cur];  <span class="comment">// Color it with a different color;</span></span><br><span class="line">                        queue.offer(next);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (colors[next] != -colors[cur]) &#123;   <span class="comment">// If it is colored and its color is different, return false;</span></span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="802-Find-Eventual-Safe-States"><a href="#802-Find-Eventual-Safe-States" class="headerlink" title="802. Find Eventual Safe States"></a>802. Find Eventual Safe States</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//if except to safe nodes, out degree == 0</span></span><br><span class="line"><span class="comment">//then is safe node</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">eventualSafeNodes</span><span class="params">(<span class="type">int</span>[][] graph)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=graph.length;</span><br><span class="line">    List&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    Map&lt;Integer,List&lt;Integer&gt;&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span>[] outs=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; graph.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(graph[i].length==<span class="number">0</span>)&#123;</span><br><span class="line">            res.add(i);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            outs[i]=graph[i].length;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> next : graph[i]) &#123;</span><br><span class="line">                map.putIfAbsent(next,<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">                map.get(next).add(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Deque&lt;Integer&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer node : res) &#123;</span><br><span class="line">        q.offer(node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> cur=q.poll();</span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(cur))&#123;</span><br><span class="line">            <span class="keyword">for</span> (Integer from : map.get(cur)) &#123;</span><br><span class="line">                outs[from]--;</span><br><span class="line">                <span class="keyword">if</span>(outs[from]==<span class="number">0</span>)&#123;</span><br><span class="line">                    q.offer(from);</span><br><span class="line">                    res.add(from);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    Collections.sort(res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="787-Cheapest-Flights-Within-K-Stops"><a href="#787-Cheapest-Flights-Within-K-Stops" class="headerlink" title="787. Cheapest Flights Within K Stops"></a>787. Cheapest Flights Within K Stops</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>&#123;</span><br><span class="line">    <span class="type">int</span> index;</span><br><span class="line">    <span class="type">int</span> distToSrc;</span><br><span class="line">    <span class="type">int</span> nodeToSrc;</span><br><span class="line">    State(<span class="type">int</span> i, <span class="type">int</span> distToSrc, <span class="type">int</span> nodeToSrc)&#123;</span><br><span class="line">        <span class="built_in">this</span>.index=i;</span><br><span class="line">        <span class="built_in">this</span>.distToSrc=distToSrc;</span><br><span class="line">        <span class="built_in">this</span>.nodeToSrc=nodeToSrc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findCheapestPrice</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[][] flights, <span class="type">int</span> src, <span class="type">int</span> dst, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    List&lt;<span class="type">int</span>[]&gt;[] graph=<span class="keyword">new</span> <span class="title class_">List</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        graph[i]=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] flight : flights) &#123;</span><br><span class="line">        <span class="type">int</span> from=flight[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> to=flight[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> cost=flight[<span class="number">2</span>];</span><br><span class="line">        graph[from].add(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;to,cost&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    k++;</span><br><span class="line">    <span class="type">int</span>[] distTo=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="type">int</span>[] nodeTo=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    Arrays.fill(distTo,Integer.MAX_VALUE);</span><br><span class="line">    Arrays.fill(nodeTo,Integer.MAX_VALUE);</span><br><span class="line">    distTo[src]=<span class="number">0</span>;</span><br><span class="line">    nodeTo[src]=<span class="number">0</span>;</span><br><span class="line">    PriorityQueue&lt;State&gt; pq=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;(a.distToSrc-b.distToSrc));</span><br><span class="line">    pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(src,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">    <span class="keyword">while</span>(!pq.isEmpty())&#123;</span><br><span class="line">        State curNode=pq.poll();</span><br><span class="line">        <span class="type">int</span> cur= curNode.index;</span><br><span class="line">        <span class="type">int</span> curDistToSrc=curNode.distToSrc;</span><br><span class="line">        <span class="type">int</span> curNodeToSrc=curNode.nodeToSrc;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(cur==dst)&#123;</span><br><span class="line">            <span class="keyword">return</span> curDistToSrc;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(curNodeToSrc+<span class="number">1</span>&gt;k)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] ints : graph[cur]) &#123;</span><br><span class="line">            <span class="type">int</span> next=ints[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> costToNext=curDistToSrc+ints[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> nodeToNext=curNodeToSrc+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(costToNext&lt;distTo[next])&#123;</span><br><span class="line">                distTo[next]=costToNext;</span><br><span class="line">                nodeTo[next]=nodeToNext;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(costToNext&gt;distTo[next] &amp;&amp; nodeToNext&gt;nodeTo[next])&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            pq.offer(<span class="keyword">new</span> <span class="title class_">State</span>(next,costToNext,nodeToNext));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="994-Rotting-Oranges"><a href="#994-Rotting-Oranges" class="headerlink" title="994. Rotting Oranges"></a>994. Rotting Oranges</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">orangesRotting</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">    <span class="type">int</span> row=grid.length;</span><br><span class="line">    <span class="type">int</span> col=grid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] dx=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span>[] dy=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(grid[i][j]==<span class="number">2</span>)&#123;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i,j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> minute=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> size=q.size();</span><br><span class="line">        <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">            <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x=i+dx[k];</span><br><span class="line">                <span class="type">int</span> y=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(x&lt;<span class="number">0</span> || x&gt;=row || y&lt;<span class="number">0</span> || y&gt;=col || grid[x][y]!=<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                grid[x][y]=<span class="number">2</span>;</span><br><span class="line">                count--;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!q.isEmpty())&#123;</span><br><span class="line">            minute++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count==<span class="number">0</span> ? minute : -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="934-Shortest-Bridge"><a href="#934-Shortest-Bridge" class="headerlink" title="934. Shortest Bridge"></a>934. Shortest Bridge</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shortestBridge</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">    <span class="type">int</span> row=grid.length;</span><br><span class="line">    <span class="type">int</span> col=grid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[] dx=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="type">int</span>[] dy=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    a:<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                set(grid,i,j,row,col);</span><br><span class="line">                <span class="keyword">break</span> a;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j]==<span class="number">2</span>)&#123;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i,j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> depth=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> size=q.size();</span><br><span class="line">        <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">            <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x=i+dx[k];</span><br><span class="line">                <span class="type">int</span> y=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(x&lt;<span class="number">0</span> || x&gt;=row || y&lt;<span class="number">0</span> || y&gt;=col || grid[x][y]==<span class="number">2</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(grid[x][y]==<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> depth;</span><br><span class="line">                &#125;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y&#125;);</span><br><span class="line">                grid[x][y]=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        depth++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span>[][] grid, <span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span> row, <span class="type">int</span> col)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;<span class="number">0</span> || i&gt;=row || j&lt;<span class="number">0</span> || j&gt;=col || grid[i][j]!=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    grid[i][j]=<span class="number">2</span>;</span><br><span class="line">    set(grid,i+<span class="number">1</span>,j,row,col);</span><br><span class="line">    set(grid,i-<span class="number">1</span>,j,row,col);</span><br><span class="line">    set(grid,i,j+<span class="number">1</span>,row,col);</span><br><span class="line">    set(grid,i,j-<span class="number">1</span>,row,col);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="2503-Maximum-Number-of-Points-From-Grid-Queries"><a href="#2503-Maximum-Number-of-Points-From-Grid-Queries" class="headerlink" title="2503. Maximum Number of Points From Grid Queries"></a>2503. Maximum Number of Points From Grid Queries</h2><p>好题：</p>
<ul>
<li>dfs + memo 超时 （17&#x2F;21）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> row;</span><br><span class="line"><span class="type">int</span> col;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] maxPoints(<span class="type">int</span>[][] grid, <span class="type">int</span>[] queries) &#123;</span><br><span class="line">    Map&lt;Integer,Integer&gt; memo=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> k=queries.length;</span><br><span class="line">    <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">    row=grid.length;</span><br><span class="line">     col=grid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        <span class="type">int</span> query=queries[i];</span><br><span class="line">        <span class="keyword">if</span>(memo.containsKey(query))&#123;</span><br><span class="line">            res[i]=memo.get(query);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">int</span> point=dfs(grid,query,<span class="keyword">new</span> <span class="title class_">boolean</span>[row][col],<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">            memo.put(query,point);</span><br><span class="line">            res[i]=point;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span>[][] grid, <span class="type">int</span> query, <span class="type">boolean</span>[][] visited, <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i&lt;<span class="number">0</span> || i&gt;=row || j&lt;<span class="number">0</span> || j&gt;=col || grid[i][j]&gt;=query || visited[i][j])&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    visited[i][j]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>+dfs(grid,query,visited,i+<span class="number">1</span>,j)</span><br><span class="line">            +dfs(grid,query,visited,i-<span class="number">1</span>,j)</span><br><span class="line">            +dfs(grid,query,visited,i,j+<span class="number">1</span>)</span><br><span class="line">            +dfs(grid,query,visited,i,j-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>priorityqueue + bfs<ul>
<li>直接利用原数组去重，若值为0则跳过</li>
<li>注意：在点入队时去重，而不是访问时才去重，防止重复入队，导致重复计数！</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] maxPoints(<span class="type">int</span>[][] grid, <span class="type">int</span>[] queries) &#123;</span><br><span class="line">    <span class="type">int</span> row=grid.length;</span><br><span class="line">    <span class="type">int</span> col=grid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[] dx=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="type">int</span>[] dy=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span> n=queries.length;</span><br><span class="line"></span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; queryQueue=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;(a[<span class="number">1</span>]-b[<span class="number">1</span>]));</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        queryQueue.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i,queries[i]&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; bfsQueue=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;(a[<span class="number">2</span>]-b[<span class="number">2</span>]));</span><br><span class="line">    bfsQueue.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">0</span>,grid[<span class="number">0</span>][<span class="number">0</span>]&#125;);</span><br><span class="line">    grid[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">    <span class="type">int</span> reach=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!queryQueue.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span>[] curQuery=queryQueue.poll();</span><br><span class="line">        <span class="type">int</span> idx=curQuery[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> query=curQuery[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(!bfsQueue.isEmpty() &amp;&amp; bfsQueue.peek()[<span class="number">2</span>]&lt;query)&#123;</span><br><span class="line">            <span class="type">int</span>[] node=bfsQueue.poll();</span><br><span class="line">            reach++;</span><br><span class="line">            <span class="type">int</span> i=node[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> j=node[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x=i+dx[k];</span><br><span class="line">                <span class="type">int</span> y=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(x&lt;<span class="number">0</span> || x&gt;=row || y&lt;<span class="number">0</span> || y&gt;=col || grid[x][y]==<span class="number">0</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                bfsQueue.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y,grid[x][y]&#125;);</span><br><span class="line">                grid[x][y]=<span class="number">0</span>;   <span class="comment">//set to 0, to avoid repetition</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res[idx]=reach;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="886-Possible-Bipartition"><a href="#886-Possible-Bipartition" class="headerlink" title="886. Possible Bipartition"></a>886. Possible Bipartition</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">possibleBipartition</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[][] dislikes)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt;[] graph=<span class="keyword">new</span> <span class="title class_">List</span>[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] dislike : dislikes) &#123;</span><br><span class="line">        <span class="type">int</span> a=dislike[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> b=dislike[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(graph[a]==<span class="literal">null</span>)&#123;</span><br><span class="line">            graph[a]=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        graph[a].add(b);</span><br><span class="line">        <span class="keyword">if</span>(graph[b]==<span class="literal">null</span>)&#123;</span><br><span class="line">            graph[b]=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        graph[b].add(a);</span><br><span class="line">    &#125;</span><br><span class="line">    Deque&lt;Integer&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span>[] party=<span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(party[i]!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        party[i]=<span class="number">1</span>;</span><br><span class="line">        q.offer(i);</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> cur=q.poll();</span><br><span class="line">            <span class="type">int</span> curParty=party[cur];</span><br><span class="line">            <span class="keyword">if</span>(graph[cur]!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> next : graph[cur]) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(party[next]==curParty)&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(party[next]==<span class="number">0</span>)&#123;</span><br><span class="line">                        party[next]=-curParty;</span><br><span class="line">                        q.offer(next);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1034-Coloring-A-Border"><a href="#1034-Coloring-A-Border" class="headerlink" title="1034. Coloring A Border"></a>1034. Coloring A Border</h2><p>注意：根据初始时刻判断，要等所有判断结束后方可变色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] colorBorder(<span class="type">int</span>[][] grid, <span class="type">int</span> row, <span class="type">int</span> col, <span class="type">int</span> color) &#123;</span><br><span class="line">    <span class="type">int</span> ro=grid.length;</span><br><span class="line">    <span class="type">int</span> co=grid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[] dx=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span>[] dy=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;row,col&#125;);</span><br><span class="line">    <span class="type">int</span> tag=grid[row][col];</span><br><span class="line">    <span class="type">boolean</span>[][] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[ro][co];</span><br><span class="line">    <span class="type">boolean</span>[][] change=<span class="keyword">new</span> <span class="title class_">boolean</span>[ro][co];</span><br><span class="line">    visited[row][col]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">        <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">        <span class="type">boolean</span> isBoarder=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">            <span class="type">int</span> x=i+dx[k];</span><br><span class="line">            <span class="type">int</span> y=j+dy[k];</span><br><span class="line">            <span class="keyword">if</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;ro &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;co)&#123;</span><br><span class="line">                <span class="keyword">if</span>(grid[x][y]!=tag)&#123;</span><br><span class="line">                    isBoarder=<span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(grid[x][y]==tag &amp;&amp; !visited[x][y])&#123;</span><br><span class="line">                    visited[x][y]=<span class="literal">true</span>;</span><br><span class="line">                    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(isBoarder || i==<span class="number">0</span> || i==ro-<span class="number">1</span> || j==<span class="number">0</span> || j==co-<span class="number">1</span>)&#123;</span><br><span class="line">            change[i][j]=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ro; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; co; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(change[i][j])&#123;</span><br><span class="line">                grid[i][j]=color;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> grid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1162-As-Far-from-Land-as-Possible"><a href="#1162-As-Far-from-Land-as-Possible" class="headerlink" title="1162. As Far from Land as Possible"></a>1162. As Far from Land as Possible</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDistance</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=grid.length;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span>[] dx=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="type">int</span>[] dy=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i,j&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(q.size()==<span class="number">0</span> || q.size()==n*n)&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> depth=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> size=q.size();</span><br><span class="line">        <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">            <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x=i+dx[k];</span><br><span class="line">                <span class="type">int</span> y=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(x&lt;<span class="number">0</span> || x&gt;=n || y&lt;<span class="number">0</span> || y&gt;=n || grid[x][y]==<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y&#125;);</span><br><span class="line">                grid[x][y]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!q.isEmpty())&#123;</span><br><span class="line">            depth++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> depth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="126-Word-Ladder-II"><a href="#126-Word-Ladder-II" class="headerlink" title="126. Word Ladder II"></a>126. Word Ladder II</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; <span class="title function_">findLadders</span><span class="params">(String beginWord, String endWord, List&lt;String&gt; wordList)</span> &#123;</span><br><span class="line">    Set&lt;String&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(wordList);</span><br><span class="line">    set.add(beginWord);</span><br><span class="line">    Map&lt;String,Set&lt;String&gt;&gt; neighbors=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String word : set) &#123;</span><br><span class="line">        <span class="type">char</span>[] chars = word.toCharArray();</span><br><span class="line">        neighbors.put(word,<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; word.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> c=chars[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">char</span> j=<span class="string">&#x27;a&#x27;</span>; j&lt;=<span class="string">&#x27;z&#x27;</span>; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j==c)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                chars[i]=j;</span><br><span class="line">                String s=<span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">                <span class="keyword">if</span>(set.contains(s))&#123;</span><br><span class="line">                    neighbors.get(word).add(s);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            chars[i]=c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; layers=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    Deque&lt;String&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    q.offer(beginWord);</span><br><span class="line">    set.remove(beginWord); <span class="comment">//once in queue, removed from set</span></span><br><span class="line">    <span class="type">boolean</span> reached=<span class="literal">false</span>;</span><br><span class="line">    a:<span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> size=q.size();</span><br><span class="line">        List&lt;String&gt; curLayer=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            String cur=q.poll();</span><br><span class="line">            <span class="keyword">if</span>(cur.equals(endWord))&#123;</span><br><span class="line">                reached=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span> a;</span><br><span class="line">            &#125;</span><br><span class="line">            curLayer.add(cur);</span><br><span class="line">            <span class="keyword">for</span> (String next : neighbors.get(cur)) &#123;</span><br><span class="line">                <span class="keyword">if</span>(set.contains(next))&#123;</span><br><span class="line">                    q.offer(next);</span><br><span class="line">                    set.remove(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        layers.add(curLayer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!reached)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;List&lt;String&gt;&gt; paths=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    LinkedList&lt;String&gt; path=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    path.add(endWord);</span><br><span class="line">    paths.add(path);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> layers.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        List&lt;List&lt;String&gt;&gt; modified=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; curLayer=layers.get(i);</span><br><span class="line">        <span class="keyword">for</span> (List&lt;String&gt; list : paths) &#123;</span><br><span class="line">            String end=list.get(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">for</span> (String s : curLayer) &#123;</span><br><span class="line">                <span class="keyword">if</span>(neighbors.get(end).contains(s))&#123;</span><br><span class="line">                    LinkedList&lt;String&gt; l=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(list);</span><br><span class="line">                    l.addFirst(s);</span><br><span class="line">                    modified.add(l);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        paths=modified;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> paths;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="818-Race-Car"><a href="#818-Race-Car" class="headerlink" title="818. Race Car"></a>818. Race Car</h2><p><a target="_blank" rel="noopener" href="https://leetcode.com/problems/race-car/discuss/124326/Summary-of-the-BFS-and-DP-solutions-with-intuitive-explanation">https://leetcode.com/problems/race-car/discuss/124326/Summary-of-the-BFS-and-DP-solutions-with-intuitive-explanation</a></p>
<h3 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">racecar</span><span class="params">(<span class="type">int</span> target)</span> &#123;</span><br><span class="line">    Set&lt;String&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; pq=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;(a[<span class="number">2</span>]-b[<span class="number">2</span>]));</span><br><span class="line">    <span class="comment">//curId, curSpeed, curStep</span></span><br><span class="line">    pq.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!pq.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span>[] cur=pq.poll();</span><br><span class="line">        <span class="type">int</span> curId=cur[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> curSpeed=cur[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> curStep=cur[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">if</span>(curId==target)&#123;</span><br><span class="line">            <span class="keyword">return</span> curStep;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> nextStep=curStep+<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//accelerate</span></span><br><span class="line">        <span class="type">int</span> nextId=curId+curSpeed;</span><br><span class="line">        <span class="type">int</span> nextSpeed=curSpeed*<span class="number">2</span>;</span><br><span class="line">        String s=nextId+<span class="string">&quot;,&quot;</span>+nextSpeed;</span><br><span class="line">        <span class="keyword">if</span>(nextId&gt;=<span class="number">0</span> &amp;&amp; nextSpeed&lt;=<span class="number">2</span>*target &amp;&amp;!set.contains(s))&#123;</span><br><span class="line">            set.add(s);</span><br><span class="line">            pq.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;nextId,nextSpeed,nextStep&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//reverse</span></span><br><span class="line">        nextSpeed=curSpeed&gt;<span class="number">0</span> ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">        nextId=curId;</span><br><span class="line">        s=nextId+<span class="string">&quot;,&quot;</span>+nextSpeed;</span><br><span class="line">        <span class="keyword">if</span>(!set.contains(s))&#123;</span><br><span class="line">            set.add(s);</span><br><span class="line">            pq.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;nextId,nextSpeed,nextStep&#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="DP"><a href="#DP" class="headerlink" title="DP"></a>DP</h3><h2 id="296-Best-Meeting-Point"><a href="#296-Best-Meeting-Point" class="headerlink" title="296. Best Meeting Point"></a>296. Best Meeting Point</h2><h3 id="BFS-1"><a href="#BFS-1" class="headerlink" title="BFS"></a>BFS</h3><p>56&#x2F;58</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> row;</span><br><span class="line"><span class="type">int</span> col;</span><br><span class="line"><span class="type">int</span>[][] grid;</span><br><span class="line"><span class="type">int</span>[] dx=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line"><span class="type">int</span>[] dy=<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">int</span>[][] dist;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minTotalDistance</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.grid=grid;</span><br><span class="line">    row=grid.length;</span><br><span class="line">    col=grid[<span class="number">0</span>].length;</span><br><span class="line"></span><br><span class="line">    dist=<span class="keyword">new</span> <span class="title class_">int</span>[row][col];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                bfs(i,j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> min=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            min=Math.min(min,dist[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">bfs</span><span class="params">(<span class="type">int</span> r, <span class="type">int</span> c)</span>&#123;</span><br><span class="line">    <span class="type">boolean</span>[][] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[row][col];</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;r,c&#125;);</span><br><span class="line">    visited[r][c]=<span class="literal">true</span>;</span><br><span class="line">    <span class="type">int</span> d=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> size=q.size();</span><br><span class="line">        <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">            <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">            dist[i][j]+=d;</span><br><span class="line">            <span class="type">int</span> x,y;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                x=i+dx[k];</span><br><span class="line">                y=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(x&lt;<span class="number">0</span> || x&gt;=row || y&lt;<span class="number">0</span> || y&gt;=col || visited[x][y])&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y&#125;);</span><br><span class="line">                visited[x][y]=<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        d++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="找中点"><a href="#找中点" class="headerlink" title="找中点"></a>找中点</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minTotalDistance</span><span class="params">(<span class="type">int</span>[][] grid)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; list1=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; list2=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> row=grid.length;</span><br><span class="line">    <span class="type">int</span> col=grid[<span class="number">0</span>].length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; row; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; col; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(grid[i][j]==<span class="number">1</span>)&#123;</span><br><span class="line">                list1.add(i);</span><br><span class="line">                list2.add(j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dist(list1)+dist(list2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dist</span><span class="params">(List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">    Collections.sort(list);</span><br><span class="line">    <span class="type">int</span> mid=list.get(list.size()/<span class="number">2</span>);</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Integer num : list) &#123;</span><br><span class="line">        res+=Math.abs(mid-num);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1197-Minimum-Knight-Moves"><a href="#1197-Minimum-Knight-Moves" class="headerlink" title="1197. Minimum Knight Moves"></a>1197. Minimum Knight Moves</h2><p>注意更新逻辑：</p>
<ul>
<li>当前dist &gt; 最短距离，则跳过当前状态</li>
<li>入队时同时更新最短距离</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minKnightMoves</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">    <span class="type">int</span>[][] dist=<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">601</span>][<span class="number">601</span>]; <span class="comment">//[-300,300]</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] arr : dist) &#123;</span><br><span class="line">        Arrays.fill(arr,Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//x+300,y+300</span></span><br><span class="line">    <span class="type">int</span>[][] dirs=<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;<span class="number">2</span>,<span class="number">1</span>&#125;,&#123;<span class="number">2</span>,-<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,-<span class="number">2</span>&#125;,&#123;-<span class="number">1</span>,-<span class="number">2</span>&#125;,&#123;-<span class="number">2</span>,-<span class="number">1</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;-<span class="number">2</span>,<span class="number">1</span>&#125;&#125;;</span><br><span class="line">    PriorityQueue&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;((a,b)-&gt;(a[<span class="number">2</span>]-b[<span class="number">2</span>]));</span><br><span class="line">    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">300</span>,<span class="number">300</span>,<span class="number">0</span>&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">        <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> d=cur[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">if</span>(d&gt;dist[i][j])&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(i==x+<span class="number">300</span> &amp;&amp; j==y+<span class="number">300</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> d;</span><br><span class="line">        &#125;</span><br><span class="line">        dist[i][j]=d;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] dir : dirs) &#123;</span><br><span class="line">            <span class="type">int</span> nx=i+dir[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> ny=j+dir[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(nx&gt;=<span class="number">0</span> &amp;&amp; nx&lt;=<span class="number">600</span> &amp;&amp; ny&gt;=<span class="number">0</span> &amp;&amp; ny&lt;=<span class="number">600</span> &amp;&amp; d+<span class="number">1</span>&lt;dist[nx][ny])&#123;</span><br><span class="line">                dist[nx][ny]=d+<span class="number">1</span>;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;nx,ny,d+<span class="number">1</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1245-Tree-Diameter"><a href="#1245-Tree-Diameter" class="headerlink" title="1245. Tree Diameter"></a>1245. Tree Diameter</h2><p>思路：</p>
<ol>
<li>Start at any node A and traverse the tree to find the furthest node from it, let’s call it B.</li>
<li>Having found the furthest node B, traverse the tree from B to find the furthest node from it, lets call it C.</li>
<li>The distance between B and C is the tree diameter.</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LeetCode1245</span> &#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    List&lt;Integer&gt;[] graph;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">treeDiameter</span><span class="params">(<span class="type">int</span>[][] edges)</span> &#123;</span><br><span class="line">        n=edges.length;</span><br><span class="line">        graph=<span class="keyword">new</span> <span class="title class_">List</span>[n+<span class="number">1</span>];<span class="comment">//[0,n]</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            graph[i]=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] edge : edges) &#123;</span><br><span class="line">            <span class="type">int</span> a=edge[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> b=edge[<span class="number">1</span>];</span><br><span class="line">            graph[a].add(b);</span><br><span class="line">            graph[b].add(a);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>[] arr=bfs(<span class="number">0</span>);</span><br><span class="line">        <span class="type">int</span> a=arr[<span class="number">0</span>];   <span class="comment">//one of the farthest nodes</span></span><br><span class="line">        <span class="keyword">return</span> bfs(a)[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//find the farthest node and distance</span></span><br><span class="line">    <span class="type">int</span>[] bfs(<span class="type">int</span> start)&#123;</span><br><span class="line">        <span class="type">boolean</span>[] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[n+<span class="number">1</span>];</span><br><span class="line">        Deque&lt;Integer&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        q.offer(start);</span><br><span class="line">        visited[start]=<span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> d=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> cur=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> size=q.size();</span><br><span class="line">            <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                cur=q.poll();</span><br><span class="line">                <span class="keyword">for</span> (Integer next : graph[cur]) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!visited[next])&#123;</span><br><span class="line">                        q.offer(next);</span><br><span class="line">                        visited[next]=<span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!q.isEmpty())&#123;</span><br><span class="line">                d++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;cur,d&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1490-Clone-N-ary-Tree"><a href="#1490-Clone-N-ary-Tree" class="headerlink" title="1490. Clone N-ary Tree"></a>1490. Clone N-ary Tree</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">cloneTree</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;Node,Node&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    Deque&lt;Node&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    q.offer(root);</span><br><span class="line">    map.put(root,<span class="keyword">new</span> <span class="title class_">Node</span>(root.val));</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        Node cur=q.poll();</span><br><span class="line">        Node copy=map.get(cur);</span><br><span class="line">        <span class="keyword">for</span> (Node child : cur.children) &#123;</span><br><span class="line">            q.offer(child);</span><br><span class="line">            Node nextcopy=<span class="keyword">new</span> <span class="title class_">Node</span>(child.val);</span><br><span class="line">            map.put(child,nextcopy);</span><br><span class="line">            copy.children.add(nextcopy);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map.get(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="1466-Reorder-Routes-to-Make-All-Paths-Lead-to-the-City-Zero"><a href="#1466-Reorder-Routes-to-Make-All-Paths-Lead-to-the-City-Zero" class="headerlink" title="1466. Reorder Routes to Make All Paths Lead to the City Zero"></a>1466. Reorder Routes to Make All Paths Lead to the City Zero</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minReorder</span><span class="params">(<span class="type">int</span> n, <span class="type">int</span>[][] connections)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt;[] graphFrom=<span class="keyword">new</span> <span class="title class_">List</span>[n];</span><br><span class="line">    List&lt;Integer&gt;[] graphTo=<span class="keyword">new</span> <span class="title class_">List</span>[n];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        graphFrom[i]=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        graphTo[i]=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] connection : connections) &#123;</span><br><span class="line">        <span class="type">int</span> from=connection[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> to=connection[<span class="number">1</span>];</span><br><span class="line">        graphFrom[to].add(from);</span><br><span class="line">        graphTo[from].add(to);</span><br><span class="line">    &#125;</span><br><span class="line">    Deque&lt;Integer&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">boolean</span>[] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[n];</span><br><span class="line">    visited[<span class="number">0</span>]=<span class="literal">true</span>;</span><br><span class="line">    q.offer(<span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> cur=q.poll();</span><br><span class="line">        <span class="keyword">for</span> (Integer from : graphFrom[cur]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!visited[from])&#123;</span><br><span class="line">                q.offer(from);</span><br><span class="line">                visited[from]=<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Integer to : graphTo[cur]) &#123;</span><br><span class="line">            <span class="keyword">if</span>(!visited[to])&#123;</span><br><span class="line">                res++;</span><br><span class="line">                q.offer(to);</span><br><span class="line">                visited[to]=<span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/25/strobogrammatic-number/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/25/strobogrammatic-number/" class="post-title-link" itemprop="url">Strobogrammatic Number</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-25 18:53:52" itemprop="dateCreated datePublished" datetime="2022-11-25T18:53:52+08:00">2022-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-26 11:59:51" itemprop="dateModified" datetime="2022-11-26T11:59:51+08:00">2022-11-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Strobogrammatic-Number"><a href="#Strobogrammatic-Number" class="headerlink" title="Strobogrammatic Number"></a>Strobogrammatic Number</h1><p>A <strong>strobogrammatic number</strong> is a number that looks the same when rotated <code>180</code> degrees (looked at upside down).</p>
<h2 id="246-Strobogrammatic-Number"><a href="#246-Strobogrammatic-Number" class="headerlink" title="246. Strobogrammatic Number"></a>246. Strobogrammatic Number</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isStrobogrammatic</span><span class="params">(String num)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=num.length();</span><br><span class="line">    <span class="comment">//0 n-1</span></span><br><span class="line">    <span class="comment">//1 n-2</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= (n-<span class="number">1</span>)/<span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//0 1 8</span></span><br><span class="line">        <span class="comment">//6 9</span></span><br><span class="line">        <span class="type">char</span> c=num.charAt(i);</span><br><span class="line">        <span class="keyword">if</span>(c!=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c!=<span class="string">&#x27;1&#x27;</span> &amp;&amp; c!=<span class="string">&#x27;8&#x27;</span> &amp;&amp; c!=<span class="string">&#x27;6&#x27;</span> &amp;&amp; c!=<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span> r=num.charAt(n-<span class="number">1</span>-i);</span><br><span class="line">        <span class="keyword">switch</span> (c)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;8&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;8&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;6&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="247-Strobogrammatic-Number-II"><a href="#247-Strobogrammatic-Number-II" class="headerlink" title="247. Strobogrammatic Number II"></a>247. Strobogrammatic Number II</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findStrobogrammatic</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    List&lt;String&gt; one= Arrays.asList(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;8&quot;</span>);</span><br><span class="line">    List&lt;String&gt; two=Arrays.asList(<span class="string">&quot;11&quot;</span>,<span class="string">&quot;69&quot;</span>,<span class="string">&quot;88&quot;</span>,<span class="string">&quot;96&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> one;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> two;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;String&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> t=n/<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> o=n%<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(o==<span class="number">0</span>)&#123;</span><br><span class="line">        build(res,two,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(),t);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String s : one) &#123;</span><br><span class="line">            LinkedList&lt;Character&gt; list=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">            list.add(s.charAt(<span class="number">0</span>));</span><br><span class="line">            build(res,two,list,t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">build</span><span class="params">(List&lt;String&gt; res, List&lt;String&gt; two, LinkedList&lt;Character&gt; list, <span class="type">int</span> t)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="number">0</span>)&#123;</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (Character c : list) &#123;</span><br><span class="line">            sb.append(c);</span><br><span class="line">        &#125;</span><br><span class="line">        res.add(sb.toString());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(t!=<span class="number">1</span>)&#123;</span><br><span class="line">        list.addFirst(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        list.addLast(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        build(res,two,list,t-<span class="number">1</span>);</span><br><span class="line">        list.removeFirst();</span><br><span class="line">        list.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String s : two) &#123;</span><br><span class="line">        list.addFirst(s.charAt(<span class="number">0</span>));</span><br><span class="line">        list.addLast(s.charAt(<span class="number">1</span>));</span><br><span class="line">        build(res,two,list,t-<span class="number">1</span>);</span><br><span class="line">        list.removeFirst();</span><br><span class="line">        list.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="248-Strobogrammatic-Number-III"><a href="#248-Strobogrammatic-Number-III" class="headerlink" title="248. Strobogrammatic Number III"></a>248. Strobogrammatic Number III</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span>[][] PAIRS = <span class="keyword">new</span> <span class="title class_">char</span>[][] &#123;</span><br><span class="line">    &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span>&#125;, &#123;<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>&#125;, &#123;<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;9&#x27;</span>&#125;, &#123;<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;8&#x27;</span>&#125;, &#123;<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;6&#x27;</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strobogrammaticInRange</span><span class="params">(String low, String high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (low == <span class="literal">null</span> || high == <span class="literal">null</span> || low.length() &gt; high.length()</span><br><span class="line">        || (low.length() == high.length() &amp;&amp; low.compareTo(high) &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> low.length(); len &lt;= high.length(); len++) &#123;</span><br><span class="line">        count += dfs(low, high, <span class="keyword">new</span> <span class="title class_">char</span>[len], <span class="number">0</span>, len - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(String low, String high, <span class="type">char</span>[] ch, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (left &gt; right) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(ch);</span><br><span class="line">        <span class="keyword">if</span> ((ch.length == low.length() &amp;&amp; s.compareTo(low) &lt; <span class="number">0</span>)</span><br><span class="line">            || (ch.length == high.length() &amp;&amp; s.compareTo(high) &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span>[] p : PAIRS) &#123;</span><br><span class="line">        ch[left] = p[<span class="number">0</span>];</span><br><span class="line">        ch[right] = p[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (ch.length != <span class="number">1</span> &amp;&amp; ch[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>; <span class="comment">//don&#x27;t start with 0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (left == right &amp;&amp; (p[<span class="number">0</span>] == <span class="string">&#x27;6&#x27;</span> || p[<span class="number">0</span>] == <span class="string">&#x27;9&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>; <span class="comment">//don&#x27;t put 6/9 at the middle of string.</span></span><br><span class="line">        &#125;</span><br><span class="line">        count += dfs(low, high, ch, left + <span class="number">1</span>, right - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span>[][] PAIRS=<span class="keyword">new</span> <span class="title class_">char</span>[][]&#123;</span><br><span class="line">        &#123;<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;0&#x27;</span>&#125;,&#123;<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>&#125;,&#123;<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;9&#x27;</span>&#125;,&#123;<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;8&#x27;</span>&#125;,&#123;<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;6&#x27;</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strobogrammaticInRange</span><span class="params">(String low, String high)</span> &#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=low.length(); i&lt;=high.length(); i++)&#123;</span><br><span class="line">        res+=dfs(low,high,<span class="keyword">new</span> <span class="title class_">char</span>[i],<span class="number">0</span>,i-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">dfs</span><span class="params">(String low, String high, <span class="type">char</span>[] chars, <span class="type">int</span> left, <span class="type">int</span> right)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(left&gt;right)&#123;</span><br><span class="line">        String s=<span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">        <span class="keyword">if</span>(s.length()==low.length() &amp;&amp; s.compareTo(low)&lt;<span class="number">0</span></span><br><span class="line">                || s.length()==high.length() &amp;&amp;s.compareTo(high)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span>[] pair : PAIRS) &#123;</span><br><span class="line">        chars[left]=pair[<span class="number">0</span>];</span><br><span class="line">        chars[right]=pair[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">//no leading zero</span></span><br><span class="line">        <span class="keyword">if</span>(chars[<span class="number">0</span>]==<span class="string">&#x27;0&#x27;</span> &amp;&amp; chars.length&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//no middle &#x27;6&#x27; or &#x27;9&#x27;</span></span><br><span class="line">        <span class="keyword">if</span>(left==right &amp;&amp; (chars[left]==<span class="string">&#x27;9&#x27;</span> || chars[left]==<span class="string">&#x27;6&#x27;</span>))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        count+=dfs(low,high,chars,left+<span class="number">1</span>,right-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/unusable-index/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/unusable-index/">1</a><a class="page-number" href="/unusable-index/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/unusable-index/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/unusable-index/page/9/">9</a><a class="extend next" rel="next" href="/unusable-index/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">invincible-nerd</p>
  <div class="site-description" itemprop="description">For explorer everywhere</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">81</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022-04 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">invincible-nerd</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">1.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">15:56</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
