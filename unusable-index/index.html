<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"invincible-nerd.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="For explorer everywhere">
<meta property="og:type" content="website">
<meta property="og:title" content="IVN">
<meta property="og:url" content="http://invincible-nerd.github.io/unusable-index/index.html">
<meta property="og:site_name" content="IVN">
<meta property="og:description" content="For explorer everywhere">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="invincible-nerd">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://invincible-nerd.github.io/unusable-index/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>IVN</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">IVN</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/12/04/COEN317/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/04/COEN317/" class="post-title-link" itemprop="url">COEN317 Final Review</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-04 16:34:54" itemprop="dateCreated datePublished" datetime="2022-12-04T16:34:54+08:00">2022-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-05 11:49:59" itemprop="dateModified" datetime="2022-12-05T11:49:59+08:00">2022-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>17 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="COEN317-Final-Review"><a href="#COEN317-Final-Review" class="headerlink" title="COEN317 Final Review"></a>COEN317 Final Review</h1><h2 id="Global-Time-and-Global-State"><a href="#Global-Time-and-Global-State" class="headerlink" title="Global Time and Global State"></a>Global Time and Global State</h2><ul>
<li>Asynchronous distributed systems consist of several  processes without common memory which communicate  via messages with <strong>unpredictable transmission delays</strong></li>
<li>Global time &amp; global state are hard to realize in distributed  systems<ul>
<li>Processes are distributed geographically</li>
<li>Rate of event occurrence can be high (unpredictable)</li>
<li>Event execution times can be small</li>
</ul>
</li>
<li>We can only approximate the global view<ul>
<li>Simulate a global time – Logical Clocks</li>
<li>Simulate a global state – Global Snapshots</li>
</ul>
</li>
</ul>
<h2 id="Simulating-global-time"><a href="#Simulating-global-time" class="headerlink" title="Simulating global time"></a>Simulating global time</h2><ul>
<li><p>An accurate notion of global time is difficult to achieve in distributed systems.</p>
<ul>
<li>We often derive “causality” from loosely synchronized clocks</li>
</ul>
</li>
<li><p>Clocks in a distributed system drift</p>
<ul>
<li>Relative to each other</li>
<li>Relative to a real world clock<ul>
<li>Determination of this real world clock itself may be an issue</li>
</ul>
</li>
<li>Clock Skew versus Drift<ul>
<li>Clock Skew &#x3D; Relative Difference in clock values of two processes</li>
<li>Clock Drift &#x3D; Relative Difference in clock frequencies (rates) of two  processes</li>
</ul>
</li>
</ul>
</li>
<li><p>Clock synchronization is needed to simulate global time</p>
<ul>
<li>Correctness – consistency, fairness</li>
</ul>
</li>
<li><p>Physical Clocks vs. Logical clocks </p>
<ul>
<li>Physical clocks - must not deviate from the real-time by more than a  certain amount.</li>
</ul>
</li>
</ul>
<h2 id="Cristian’s-Time-Server-Algorithm"><a href="#Cristian’s-Time-Server-Algorithm" class="headerlink" title="Cristian’s (Time Server) Algorithm"></a>Cristian’s (Time Server) Algorithm</h2><ul>
<li><p>Uses <strong>a time server</strong> to synchronize clocks</p>
<ul>
<li>Time server keeps the reference time (say UTC)</li>
<li>A client asks the time server for time, the server responds with its current  time, and the client uses the received value <strong>T</strong> to set its clock</li>
</ul>
</li>
<li><p>But network round-trip time introduces errors…</p>
<ul>
<li><p>Let <strong>RTT</strong> &#x3D; response-received-time – request-sent-time (measurable at  client),</p>
</li>
<li><p>If we know </p>
<ul>
<li>(a) <strong>min1</strong> &#x3D; minimum P -&gt; S latency </li>
<li>(b) <strong>min2</strong> &#x3D; minimum S -&gt; P latency </li>
<li>(c) that the server timestamped the message at the last possible instant  before sending it back</li>
</ul>
</li>
<li><p>Then, the actual time could be between <strong>[T+min2,T+RTT— min1]</strong></p>
</li>
<li><p>P sets its time to halfway through this interval</p>
<ul>
<li>To: t + (RTT+min2-min1)&#x2F;2</li>
</ul>
</li>
<li><p>Error is at most (RTT-min2-min1)&#x2F;2 </p>
<ul>
<li>Bounded!</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Berkeley-UNIX-algorithm"><a href="#Berkeley-UNIX-algorithm" class="headerlink" title="Berkeley UNIX algorithm"></a>Berkeley UNIX algorithm</h2><ul>
<li>One daemon without UTC</li>
<li>Periodically, this <strong>daemon</strong> polls and asks all the machines for their  time</li>
<li>The machines respond.</li>
<li>The daemon computes an average time and then broadcasts this  average time.</li>
</ul>
<h2 id="Decentralized-Averaging-Algorithm"><a href="#Decentralized-Averaging-Algorithm" class="headerlink" title="Decentralized Averaging Algorithm"></a>Decentralized Averaging Algorithm</h2><ul>
<li>Each machine has a daemon without UTC</li>
<li>Periodically, at fixed agreed-upon times, each machine broadcasts its  local time.</li>
<li>Each of them calculates the average time by averaging all the received  local times.</li>
</ul>
<h2 id="Network-Time-Protocol-NTP"><a href="#Network-Time-Protocol-NTP" class="headerlink" title="Network Time Protocol (NTP)"></a>Network Time Protocol (NTP)</h2><ul>
<li>Most widely used physical clock synchronization protocol on the Internet</li>
<li>Hierarchical tree of time servers.<ul>
<li>The primary server at the root synchronizes with the UTC.</li>
<li>Secondary servers - backup to primary server.</li>
<li>Lowest</li>
<li>synchronization subnet with clients.</li>
</ul>
</li>
</ul>
<p><img src="/images/317/NTP.JPG"></p>
<p><img src="/images/317/NTP1.JPG"></p>
<p><img src="/images/317/NTP2.JPG"></p>
<p><img src="/images/317/NTP3.JPG"></p>
<p><img src="/images/317/NTP4.JPG"></p>
<h2 id="Event-Ordering"><a href="#Event-Ordering" class="headerlink" title="Event Ordering"></a>Event Ordering</h2><ul>
<li>Lamport defined the “happens before” (-&gt;) relation<ul>
<li>If a and b are events in the same process, and a occurs before b, then  a-&gt;b.</li>
<li>If a is the event of a message being sent by one process and b is the  event of the message being received by another process, then a -&gt; b.</li>
<li>If X -&gt; Y and Y-&gt; Z then X -&gt; Z.</li>
</ul>
</li>
<li>If a -&gt; b then time (a) &lt; time (b)</li>
</ul>
<h2 id="Causal-Ordering"><a href="#Causal-Ordering" class="headerlink" title="Causal Ordering"></a>Causal Ordering</h2><ul>
<li><p>“Happens Before” also called causal ordering</p>
</li>
<li><p>Possible to draw a causality relation between 2 events if</p>
<ul>
<li>They happen in the same process</li>
<li>There is a chain of messages between them</li>
</ul>
</li>
<li><p>“Happens Before” notion is not straightforward in distributed system</p>
<ul>
<li><p>No guarantees of synchronized clocks</p>
</li>
<li><p>Communication latency</p>
</li>
</ul>
</li>
</ul>
<h2 id="Types-of-Logical-Clocks"><a href="#Types-of-Logical-Clocks" class="headerlink" title="Types of Logical Clocks"></a>Types of Logical Clocks</h2><ul>
<li>Systems of logical clocks differ in their representation of logical time  and also in the protocol to update the logical clocks.</li>
<li>2 kinds of logical clocks<ul>
<li>Lamport</li>
<li>Vector</li>
</ul>
</li>
</ul>
<h2 id="Lamport-Clock"><a href="#Lamport-Clock" class="headerlink" title="Lamport Clock"></a>Lamport Clock</h2><ul>
<li><p>Proposed by Lamport in 1978 as an attempt to totally order events in  a distributed system.</p>
</li>
<li><p>Each process uses a local counter (clock) which is an integer</p>
<ul>
<li><p>initial value of counter is set to a non-negative integer or zero</p>
</li>
<li><p>A process increments its counter when a send or an instruction happens at it.</p>
<p>The counter is assigned to the event as its timestamp.</p>
</li>
<li><p>Each process keeps its own logical clock used to timestamp events</p>
</li>
</ul>
</li>
<li><p>A send (message) event carries its timestamp</p>
</li>
<li><p>For a receive (message) event the counter is updated by</p>
<ul>
<li>max(local clock, message timestamp) + 1</li>
</ul>
</li>
</ul>
<p><img src="/images/317/Lamport1.JPG"></p>
<h2 id="Vector-Timestamp"><a href="#Vector-Timestamp" class="headerlink" title="Vector Timestamp"></a>Vector Timestamp</h2><ul>
<li>In the system of vector clocks, the time domain is represented by a set of  n-dimensional non-negative integer vectors.</li>
<li>Each process has a clock Ci consisting of a vector of length n, where n is  the total number of processes vt[1..n], where vt[j ] is the local logical  clock of Pj and describes the logical time progress at process Pj .</li>
<li>Incrementing vector clocks<ul>
<li>On an instruction or send event at process i, it increments only its ith element of its vector clock</li>
</ul>
</li>
<li>Each message carries the send-event’s vector timestamp  Vmessage[1…N]</li>
<li>On receiving a message at process i:<ul>
<li>Vi[i] &#x3D; Vi[i] + 1</li>
<li>Vi[j] &#x3D; max(Vmessage[j], Vi[j]) for j≠ i</li>
</ul>
</li>
<li>Vector Clocks example</li>
</ul>
<p><img src="/images/317/Vector.JPG"></p>
<p><img src="/images/317/Vector1.JPG"></p>
<p><img src="/images/317/Vector2.JPG"></p>
<p><img src="/images/317/Vector3.JPG"></p>
<p><img src="/images/317/Vector4.JPG"></p>
<h2 id="Global-State"><a href="#Global-State" class="headerlink" title="Global State"></a>Global State</h2><ul>
<li>Recording the global state of a distributed system on-the-fly is an  important paradigm.<ul>
<li>Challenge: lack of globally shared memory, global clock and unpredictable message  delays in a distributed system</li>
</ul>
</li>
<li>Notions of global time and global state closely related</li>
<li>A process can (without freezing the whole computation) compute the  best possible approximation of global state</li>
<li>A global state that could have occurred<ul>
<li>No process in the system can decide whether the state did really occur</li>
<li>Guarantee stable properties (i.e. once they become true, they remain true)</li>
</ul>
</li>
</ul>
<h2 id="Consistent-Cuts"><a href="#Consistent-Cuts" class="headerlink" title="Consistent Cuts"></a>Consistent Cuts</h2><ul>
<li>A cut (or time slice) is a zigzag line cutting a time diagram  into 2 parts (past and future)</li>
<li>Consistent Cut: a cut that obeys causality<ul>
<li>A cut C is a consistent cut if and only if:<ul>
<li>for (each pair of events e, f in the system)</li>
<li>Such that event e is in the cut C, and if f-&gt;e (f happens-before e)</li>
<li>Then: Event f is also in the cut C</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/317/Cut.JPG"></p>
<h2 id="System-Model-for-Global-Snapshots"><a href="#System-Model-for-Global-Snapshots" class="headerlink" title="System Model for Global Snapshots"></a>System Model for Global Snapshots</h2><ul>
<li>The system consists of a collection of n processes p1, p2, …, pn that are  connected by channels.</li>
<li>There are no globally shared memory and physical global clock and processes  communicate by passing messages through communication channels.</li>
<li>Cij denotes the channel from process pi to process pj and its state is denoted by Si</li>
<li>The actions performed by a process are modeled as three types of events:<ul>
<li>Internal events,the message send event and the message receive event.</li>
<li>For a message mij that is sent by process pi to process pj , let send(mij ) and rec(mij ) denote  its send and receive events.</li>
</ul>
</li>
</ul>
<h2 id="Chandy-Lamport-Distributed-Snapshot-Algorithm"><a href="#Chandy-Lamport-Distributed-Snapshot-Algorithm" class="headerlink" title="Chandy-Lamport Distributed Snapshot Algorithm"></a>Chandy-Lamport Distributed Snapshot Algorithm</h2><ul>
<li>Assumes FIFO communication in channels</li>
<li>Uses a marker message to separate messages in the channels.<ul>
<li>After a process has recorded its snapshot, it sends a marker, along all of its  outgoing channels before sending out any more messages.</li>
<li>The marker separates the messages in the channel into those to be included  in the snapshot from those not to be recorded in the snapshot.</li>
</ul>
</li>
<li>A process must record its snapshot no later than when it receives a marker on  any of its incoming channels.</li>
<li>The algorithm terminates after each process has received a marker on all of its  incoming channels.</li>
<li>All the local snapshots get disseminated to all other processes and all the  processes can determine the global state</li>
</ul>
<p><img src="/images/317/Chandy_Lamport1.JPG"></p>
<p><img src="/images/317/Chandy_Lamport2.JPG"></p>
<p><img src="/images/317/Chandy_Lamport3.JPG"></p>
<ul>
<li>Global Snapshot calculated by Chandy-Lamport algorithm is  causally correct</li>
</ul>
<h2 id="Distributed-Mutual-Exclusion"><a href="#Distributed-Mutual-Exclusion" class="headerlink" title="Distributed Mutual Exclusion"></a>Distributed Mutual Exclusion</h2><ul>
<li>Mutual exclusion<ul>
<li>ensures that concurrent processes have serialized access to  shared resources - the critical section problem</li>
<li>At any point in time, only one process can be executing in its  critical section</li>
</ul>
</li>
<li>Shared variables (semaphores) cannot be used in a distributed  system<ul>
<li>Mutual exclusion must be based on message passing, in the  context of unpredictable delays and incomplete knowledge</li>
</ul>
</li>
</ul>
<h2 id="Approaches-to-Distributed-Mutual-Exclusion"><a href="#Approaches-to-Distributed-Mutual-Exclusion" class="headerlink" title="Approaches to Distributed Mutual Exclusion"></a>Approaches to Distributed Mutual Exclusion</h2><ul>
<li>Central coordinator-based approach<ul>
<li>A centralized coordinator determines who enters the CS</li>
</ul>
</li>
<li>Distributed approaches to mutual exclusion<ul>
<li>Token based approach<ul>
<li>A unique token is shared among the processes. A process is allowed to  enter its CS if it possesses the token.</li>
<li>Mutual exclusion is ensured because the token is unique.</li>
</ul>
</li>
<li>Non-token based approach<ul>
<li>Two or more successive rounds of messages are exchanged among the  processes to determine which process will enter the CS next.</li>
</ul>
</li>
<li>Quorum based approach<ul>
<li>Each process requests permission to execute the CS from a subset of  processes (called a quorum).</li>
<li>Any two quorums contain a common process. This common process makes sure that only one request executes the CS at any time.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Requirements-x2F-Conditions"><a href="#Requirements-x2F-Conditions" class="headerlink" title="Requirements&#x2F;Conditions"></a>Requirements&#x2F;Conditions</h3><ul>
<li>Safety Property<ul>
<li>At any instant, only one process can execute the critical section.</li>
</ul>
</li>
<li>Liveness Property<ul>
<li>This property states the absence of deadlock and starvation. Two or more  processess should not endlessly wait for messages which will never arrive.</li>
</ul>
</li>
<li>Ordering&#x2F;Fairness<ul>
<li>Each process gets a fair chance to execute the CS which means the CS  execution requests are executed in the order of their arrival (time is  determined by a logical clock) in the system.</li>
</ul>
</li>
</ul>
<h2 id="Mutual-Exclusion-Techniques-Covered"><a href="#Mutual-Exclusion-Techniques-Covered" class="headerlink" title="Mutual Exclusion Techniques Covered"></a>Mutual Exclusion Techniques Covered</h2><ul>
<li><p>Central Coordinator Algorithm</p>
<p><img src="/images/317/central_coordinator.JPG"></p>
</li>
<li><p>In a distributed environment it seems more natural to implement  mutual exclusion, based upon distributed agreement - not on a  central coordinator.</p>
</li>
<li><p>Distributed Non-token based</p>
<ul>
<li>Ricart-Agrawala Algorithm</li>
<li>Maekawa’s Algorithm</li>
</ul>
</li>
</ul>
<h2 id="Ricart-Agrawala-Algorithm"><a href="#Ricart-Agrawala-Algorithm" class="headerlink" title="Ricart-Agrawala Algorithm"></a>Ricart-Agrawala Algorithm</h2><ul>
<li>Uses only two types of messages – REQUEST and REPLY.</li>
<li>It is assumed that all processes keep a (Lamport’s) logical clock which is updated  according to the clock rules.<ul>
<li>Requests are ordered according to their global logical timestamps; if  timestamps are equal, process identifiers are compared to order them.</li>
</ul>
</li>
<li>The process that requires entry to a CS multicasts the request message to all  other processes competing for the same resource.<ul>
<li>Process is allowed to enter the CS when all processes have replied to this  message.</li>
<li>The request message consists of the requesting process’ timestamp (logical  clock) and its identifier.</li>
</ul>
</li>
<li>Each process keeps its state with respect to the CS: released, requested, or held.</li>
</ul>
<p><img src="/images/317/RA.JPG"></p>
<h3 id="Analysis-Ricart-Agrawala’s-Algorithm"><a href="#Analysis-Ricart-Agrawala’s-Algorithm" class="headerlink" title="Analysis: Ricart-Agrawala’s Algorithm"></a>Analysis: Ricart-Agrawala’s Algorithm</h3><ul>
<li>Safety<ul>
<li>Two processes Pi and Pj cannot both have access to CS</li>
</ul>
</li>
<li>Liveness<ul>
<li>Worst-case: wait for all other (N-1) processes to send Reply</li>
</ul>
</li>
<li>Ordering<ul>
<li>Requests with lower Lamport timestamps are granted earlier</li>
</ul>
</li>
</ul>
<h3 id="Performance-Ricart-Agrawala’s-Algorithm"><a href="#Performance-Ricart-Agrawala’s-Algorithm" class="headerlink" title="Performance: Ricart-Agrawala’s Algorithm"></a>Performance: Ricart-Agrawala’s Algorithm</h3><ul>
<li>Bandwidth: 2*(N-1) messages per enter() operation</li>
<li>Client delay: one round-trip time</li>
<li>Synchronization delay: one message transmission time</li>
</ul>
<h2 id="Quorum-Based-–-Maekawa’s-Algorithm"><a href="#Quorum-Based-–-Maekawa’s-Algorithm" class="headerlink" title="Quorum-Based – Maekawa’s Algorithm"></a>Quorum-Based – Maekawa’s Algorithm</h2><ul>
<li><p>Site obtains permission only from a subset of sites to enter CS</p>
</li>
<li><p>Multicasts messages to a voting subset of processes</p>
<ul>
<li><p>Each process pi is associated with a voting set vi (of processes)</p>
<ul>
<li>Each process belongs to its own voting set</li>
<li>The intersection of any two voting sets is non-empty</li>
<li>Each voting set is of size K</li>
<li>Each process belongs to M other voting sets</li>
</ul>
</li>
<li><p>To access a critical section, pi requests permission from all other processes in  its own voting set vi</p>
<ul>
<li><p>Voting set member gives permission to only one requestor at a time, and  queues all other requests</p>
</li>
<li><p>Guarantees safety </p>
</li>
<li><p>May not guarantee liveness (may deadlock)</p>
<p><img src="/images/317/M_liveness.JPG"></p>
</li>
<li><p>Maekawa showed that K&#x3D;M&#x3D;N^0.5 works best</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/317/Maekawa1.JPG"></p>
<p><img src="/images/317/Maekawa2.JPG"></p>
<h2 id="Election-Algorithms"><a href="#Election-Algorithms" class="headerlink" title="Election Algorithms"></a>Election Algorithms</h2><ul>
<li>It doesn’t matter which process is elected.<ul>
<li>What is important is that one and only one process is chosen (we call this  process the coordinator) and all processes agree on this decision</li>
</ul>
</li>
<li>Assume that each process has a unique number (identifier)<ul>
<li>In general, election algorithms attempt to locate the process with the highest  number, among those which currently are up</li>
</ul>
</li>
<li>Election is typically started after a failure occurs<ul>
<li>The detection of a failure (e.g. the crash of the current coordinator) is  normally based on time-out → a process that gets no response for a period of  time suspects a failure and initiates an election process.</li>
</ul>
</li>
<li>An election process is typically performed in two phases:<ul>
<li>Select a leader with the highest priority.</li>
<li>Inform all processes about the winner.</li>
</ul>
</li>
</ul>
<h2 id="The-Ring-based-Algorithm"><a href="#The-Ring-based-Algorithm" class="headerlink" title="The Ring-based Algorithm"></a>The Ring-based Algorithm</h2><ul>
<li>We assume that the processes are arranged in a logical ring<ul>
<li>Each process knows the address of one other process, which is its  neighbor in the clockwise direction</li>
</ul>
</li>
<li>The algorithm elects a single coordinator, which is the highest id process.</li>
<li>Election is started by a process which detects the coordinator failure<ul>
<li>The process prepares an election message which includes its id and passed it to the successor process.</li>
<li>When a process receives an election message<ul>
<li>It compares the identifier in the message with its own</li>
<li>If the arrived identifier is greater, it forwards the received election  message to its neighbor</li>
<li>If the arrived identifier is smaller, it substitutes its own identifier in the  election message before forwarding it.</li>
<li>If the received id is that of the receiver itself → this will be the  coordinator.</li>
</ul>
</li>
</ul>
</li>
<li>The new coordinator sends an elected message through the ring</li>
</ul>
<p><img src="/images/317/ring.JPG"></p>
<h2 id="The-Bully-Algorithm"><a href="#The-Bully-Algorithm" class="headerlink" title="The Bully Algorithm"></a>The Bully Algorithm</h2><ul>
<li>A process has to know the identifier of all other processes <ul>
<li>(it doesn’t know, however, which one is still up); the process with the highest identifier, among those which are  up, is selected.</li>
</ul>
</li>
<li>Any process could fail during the election procedure.</li>
<li>When a process Pi detects a failure and a coordinator has to be elected<ul>
<li>it sends an election message to all the processes with a higher identifier and then waits for an answer message:</li>
<li>If no response arrives within a time limit<ul>
<li>Pi becomes the coordinator (all processes with higher identifier are down)</li>
<li>it broadcasts a coordinator message to all processes to let them know.</li>
</ul>
</li>
<li>If an answer message arrives, <ul>
<li>Pi knows that another process has to become the coordinator → it waits in order to receive the  coordinator message.</li>
<li>If this message fails to arrive within a time limit (which means that a potential coordinator crashed after  sending the answer message) Pi resends the election message.</li>
</ul>
</li>
</ul>
</li>
<li>When receiving an election message from Pi<ul>
<li>a process Pj replies with an answer message to Pi and</li>
<li>then starts an election procedure itself( unless it has already started one) it sends an election message to all  processes with higher identifier.</li>
</ul>
</li>
<li>Finally all processes get an answer message, except the one which becomes the coordinator.</li>
</ul>
<p><img src="D:\Blog\source\images\317\bully.JPG"></p>
<h2 id="Distributed-File-System-DFS"><a href="#Distributed-File-System-DFS" class="headerlink" title="Distributed File System (DFS)"></a>Distributed File System (DFS)</h2><ul>
<li>Files are stored on a server machine<ul>
<li>client machine does RPCs to server to perform operations on file</li>
</ul>
</li>
<li>Desirable Properties from a DFS<ul>
<li>Transparency: client accesses DFS files as if it were accessing local files<ul>
<li>Same API as local files, i.e., client code doesn’t change</li>
<li>Need to make location, replication, etc. invisible to client</li>
</ul>
</li>
<li>Support concurrent clients<ul>
<li>Multiple client processes reading&#x2F;writing the file concurrently</li>
</ul>
</li>
</ul>
</li>
<li>Replication: for fault-tolerance</li>
</ul>
<h2 id="File-Sharing-Semantics"><a href="#File-Sharing-Semantics" class="headerlink" title="File Sharing Semantics"></a>File Sharing Semantics</h2><ul>
<li>One-copy Serializability<ul>
<li>Updates are written to the single copy and are available immediately</li>
</ul>
</li>
<li>Serializability<ul>
<li>Transaction semantics (file locking protocols implemented - share for  read, exclusive for write).</li>
</ul>
</li>
</ul>
<h2 id="Example-Sun-NFS"><a href="#Example-Sun-NFS" class="headerlink" title="Example: Sun-NFS"></a>Example: Sun-NFS</h2><ul>
<li><p>Network File System</p>
</li>
<li><p>Supports heterogeneous systems</p>
</li>
<li><p>Architecture</p>
<ul>
<li>Server exports one or more directory trees for access by  remote clients</li>
<li>Clients access exported directory trees by mounting them  to the client local tree</li>
</ul>
</li>
<li><p>Protocols</p>
<ul>
<li>Mounting protocol</li>
<li>Directory and file access protocol - stateless, no open-close  messages, full access path on read&#x2F;write</li>
</ul>
</li>
</ul>
<h3 id="NFS-Architecture"><a href="#NFS-Architecture" class="headerlink" title="NFS Architecture"></a>NFS Architecture</h3><p><img src="/images/317/NFS.JPG"></p>
<h2 id="Example-Andrew-File-System"><a href="#Example-Andrew-File-System" class="headerlink" title="Example: Andrew File System"></a>Example: Andrew File System</h2><ul>
<li><p>Designed at CMU</p>
<ul>
<li>Named after Andrew Carnegie and Andrew Mellon, the “C” and  “M” in CMU</li>
</ul>
</li>
<li><p>In use today in some clusters (especially University  clusters)</p>
</li>
<li><p>Supports information sharing on a large scale</p>
</li>
<li><p>Uses a session semantics</p>
<ul>
<li>Entire file is copied to the local machine (Venus) from the server  (Vice) when open. If file is changed, it is copied to server when  closed.<ul>
<li>Works because in practice, most files are changed by one  person</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Replication"><a href="#Replication" class="headerlink" title="Replication"></a>Replication</h2><ul>
<li><p>Enhances a service by replicating data</p>
<ul>
<li><p>Increased Availability</p>
<ul>
<li>Of service. When servers fail or when the network is partitioned.</li>
</ul>
</li>
<li><p>Fault Tolerance</p>
<ul>
<li>Under the fail-stop model, if up to f of f+1 servers crash, at least one is alive</li>
</ul>
</li>
<li><p>Load Balancing</p>
<ul>
<li>One approach: Multiple server IPs can be assigned to the same name in DNS,  which returns answers round-robin.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Passive-Replication"><a href="#Passive-Replication" class="headerlink" title="Passive Replication"></a>Passive Replication</h3><ul>
<li><p>uses a primary replica (master)</p>
<p>master: elected leader</p>
</li>
</ul>
<p><img src="/images/317/passive_replication.JPG"></p>
<h3 id="Active-Replication"><a href="#Active-Replication" class="headerlink" title="Active Replication"></a>Active Replication</h3><ul>
<li><p>treats all replicas identically</p>
</li>
<li><p>multicast inside replica group</p>
</li>
<li><p>can use any flavor of multicast ordering</p>
<ul>
<li>FIFO ordering</li>
<li>causal ordering</li>
<li>total ordering</li>
<li>hybrid ordering</li>
</ul>
</li>
</ul>
<p><img src="/images/317/active_replication.JPG"></p>
<h2 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h2><ul>
<li><p>Sequence of Read&#x2F;Write operations that act as ONE unit of execution</p>
</li>
<li><p>ACID Properties</p>
<ul>
<li>Atomicity<ul>
<li>All or nothing</li>
<li>a transaction should either <ul>
<li>i)complete successfully, so its effects are recorded in the  server objects; </li>
<li>or ii) the transaction has no effect at all.</li>
</ul>
</li>
</ul>
</li>
<li>Consistency<ul>
<li>if the server starts in a consistent state,  the transaction ends the server in a consistent state.</li>
</ul>
</li>
<li>Isolation<ul>
<li>Each transaction must be performed  without interference from other transactions</li>
<li>i.e.,  non-final effects of a transaction must not be visible  to other transactions</li>
</ul>
</li>
<li>Durability<ul>
<li>After a transaction has completed  successfully, all its effects are saved in permanent  storage.</li>
</ul>
</li>
</ul>
</li>
<li><p>Serializable Schedule </p>
<ul>
<li>Goal: increase <strong>concurrency</strong> while maintaining  <strong>correctness (ACID)</strong></li>
<li>Equivalent to some Serial execution → Correctness</li>
<li>Serial Equivalency Test</li>
</ul>
</li>
<li><p>serial</p>
<ul>
<li>An interleaving (say O) of transaction operations is  <strong>serially equivalent</strong> iff (if and only if):<ul>
<li>Cannot distinguish end-result of real  operation O from (fake) serial transaction order O’</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Distributed-Transactions"><a href="#Distributed-Transactions" class="headerlink" title="Distributed Transactions"></a>Distributed Transactions</h2><ul>
<li>Transactions distributed based on which entity hosts the  object&#x2F;replica</li>
<li>One-phase Commit: Issues<ul>
<li>Server with object has no say in whether transaction  commits or aborts<ul>
<li>If object corrupted, it just cannot commit (while other servers have  committed)</li>
</ul>
</li>
<li>Server may crash before receiving commit message,  with some updates still in memory</li>
</ul>
</li>
<li>Uses 2 Phase Commit protocol for guaranteeing atomic commit (in  contrast to 1 Phase Commit)<ul>
<li>Failures in Two-phase Commit <ul>
<li>To deal with server crashes<ul>
<li>Each server saves tentative updates into permanent storage, right  before replying Yes&#x2F;No in first phase. Retrievable after crash  recovery</li>
</ul>
</li>
<li>To deal with coordinator crashes<ul>
<li>Coordinator logs all decisions and received&#x2F;sent messages on disk</li>
<li>After recovery or new election &#x3D;&gt; new coordinator takes over</li>
</ul>
</li>
<li>To deal with Yes&#x2F;No message loss, <ul>
<li>coordinator aborts  the transaction after a timeout (pessimistic!)</li>
</ul>
</li>
<li>To deal with Commit or Abort message loss<ul>
<li>Server can poll coordinator (repeatedly)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Concurrency-Control"><a href="#Concurrency-Control" class="headerlink" title="Concurrency Control"></a>Concurrency Control</h2><ul>
<li>Optimistic Concurrency Control<ul>
<li>Used in Dropbox, Google apps, Wikipedia, key-value  stores like Cassandra, Riak, and Amazon’s Dynamo</li>
<li>Used for Read&#x2F;Read-Only transaction</li>
<li>Allow the transaction to execute</li>
<li>If Serial Equivalency passed, then commit. Otherwise, abort</li>
</ul>
</li>
<li>Pessimistic Concurrency Control<ul>
<li>Use Locking (Mutual Exclusion)</li>
</ul>
</li>
<li>2 Phase Locking protocol (2PL)<ul>
<li>Growing&#x2F;expanding phase – Acquire locks</li>
<li>Shrinking phase – release locks and no new locks can be acquired</li>
</ul>
</li>
<li>Strict 2PL – hold on to locks until transactions commits&#x2F;aborts</li>
</ul>
<h2 id="Deadlocks"><a href="#Deadlocks" class="headerlink" title="Deadlocks"></a>Deadlocks</h2><ul>
<li><p>3 necessary conditions for a deadlock to occur</p>
<ol>
<li>Some objects are accessed in exclusive lock modes</li>
<li>Transactions holding locks cannot be preempted</li>
<li>There is a circular wait (cycle) in the Wait-for graph</li>
</ol>
</li>
</ul>
<h2 id="Handling-Deadlocks"><a href="#Handling-Deadlocks" class="headerlink" title="Handling Deadlocks"></a>Handling Deadlocks</h2><ol>
<li><p>Lock timeout: </p>
<ul>
<li>abort transaction if lock cannot be  acquired within timeout</li>
<li>Expensive; leads to wasted work</li>
</ul>
</li>
<li><p>Deadlock Detection:</p>
<ul>
<li>keep track of Wait-for graph (e.g., via Global  Snapshot algorithm), and</li>
<li>find cycles in it (e.g., periodically)</li>
<li>If find cycle, there’s a deadlock &#x3D;&gt; Abort one or  more transactions to break cycle</li>
<li>Still allows deadlocks to occur</li>
</ul>
</li>
<li><p>Deadlock Prevention</p>
</li>
</ol>
<ul>
<li><p>Set up the system so one of the necessary conditions is violated</p>
<ol>
<li><p>Some objects are accessed in exclusive lock modes</p>
<p>Fix: Allow read-only access to objects</p>
</li>
<li><p>Transactions holding locks cannot be preempted</p>
<p>Fix: Allow preemption of some transactions</p>
</li>
<li><p>There is a circular wait (cycle) in the Wait-for graph</p>
<p>Fix: Lock all objects in the beginning; if fail any, abort  transaction &#x3D;&gt; No cycles in Wait-for graph</p>
</li>
</ol>
</li>
</ul>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><ul>
<li>Threats<ul>
<li>Leakage<ul>
<li>Unauthorized access to service or data</li>
<li>E.g., Someone knows your bank balance</li>
</ul>
</li>
<li>Tampering<ul>
<li>Unauthorized modification of service or data</li>
<li>E.g., Someone modifies your bank balance</li>
</ul>
</li>
<li>Vandalism<ul>
<li>Interference with normal service, without  direct gain to attacker</li>
<li>E.g., Denial of Service attacks</li>
</ul>
</li>
</ul>
</li>
<li>Common Attacks<ul>
<li>Eavesdropping<ul>
<li>Attacker taps into network</li>
</ul>
</li>
<li>Masquerading<ul>
<li>Attacker pretends to be someone else, i.e.,  identity theft</li>
</ul>
</li>
<li>Message tampering<ul>
<li>Attacker modifies messages</li>
</ul>
</li>
<li>Replay attack<ul>
<li>Attacker replays old messages</li>
</ul>
</li>
<li>Denial of service<ul>
<li>bombard a port</li>
</ul>
</li>
</ul>
</li>
<li>CIA properties<ul>
<li>Confidentiality<ul>
<li>Protection against disclosure to unauthorized  individuals</li>
<li>Addresses Leakage threat</li>
</ul>
</li>
<li>Integrity<ul>
<li>Protection against unauthorized alteration or  corruption</li>
<li>Addresses Tampering threat</li>
</ul>
</li>
<li>Availability<ul>
<li>Service&#x2F;data is always readable&#x2F;writable</li>
<li>Addresses Vandalism threat</li>
</ul>
</li>
</ul>
</li>
<li>Policy vs Mechanism<ul>
<li>Many scientists (e.g., Hansen) have argued for a  separation of policy vs. mechanism</li>
<li>A security policy indicates what a secure system  accomplishes</li>
<li>A security mechanism indicates how these goals  are accomplished</li>
<li>E.g.,<ul>
<li>Policy: in a file system, only authorized individuals  allowed to access files (i.e., CIA properties)</li>
<li>Mechanism: Encryption, capabilities, etc.</li>
</ul>
</li>
</ul>
</li>
<li>Mechanisms: Golden A’s<ul>
<li>Authentication<ul>
<li>Is a user (communicating over the network)  claiming to be Alice, really Alice?</li>
</ul>
</li>
<li>Authorization<ul>
<li>Yes, the user is Alice, but is she allowed to  perform her requested operation on this  object?</li>
</ul>
</li>
<li>Auditing<ul>
<li>How did Eve manage to attack the system and  breach defenses? Usually done by  continuously logging all operations.</li>
</ul>
</li>
</ul>
</li>
<li>Encryption<ul>
<li>Symmetric Keys<ul>
<li>Same key (KAB) used to both encrypt and decrypt a  message</li>
<li>E.g., DES (Data Encryption Standard): 56 b key  operates on 64 b blocks from the message</li>
</ul>
</li>
<li>Public-Private keys<ul>
<li>Anything encrypted with KApriv can be decrypted only with  KApub</li>
<li>Anything encrypted with KApub can be decrypted only with  KApri</li>
<li>If Alice wants to send a secret message M that can  be read only by Bob<ol>
<li>Alice encrypts it with Bob’s public key</li>
<li>KBpub(M)</li>
<li>Bob only one able to decrypt it</li>
<li>KBpriv(KBpub(M)) &#x3D; M</li>
</ol>
</li>
</ul>
</li>
<li>Shared&#x2F;Symmetric vs. Public&#x2F;Private<ul>
<li>Shared keys reveal too much information<ul>
<li>Hard to revoke permissions from principals</li>
<li>E.g., group of principals shares one key <ul>
<li>want to remove one principal from group</li>
<li>need everyone in group to change key</li>
</ul>
</li>
</ul>
</li>
<li>Public&#x2F;private keys involve costly encryption or  decryption<ul>
<li>At least one of these 2 operations is costly</li>
</ul>
</li>
<li>Many systems use public&#x2F;private key system to  generate shared key, and use latter on messages</li>
</ul>
</li>
</ul>
</li>
<li>Digital Signature&#x2F;Certificate<ul>
<li>To sign a message M, Alice encrypts message with her  own private key<ul>
<li>Signed message: [M, KApriv(M)]</li>
<li>Anyone can verify, using Alice’s public key, that Alice signed it</li>
</ul>
</li>
<li>Digital Certificates implemented using digital signatures</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/12/04/COEN210/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/04/COEN210/" class="post-title-link" itemprop="url">COEN 210 — Computer Architecture</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-12-04 16:34:43" itemprop="dateCreated datePublished" datetime="2022-12-04T16:34:43+08:00">2022-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-12-05 08:46:24" itemprop="dateModified" datetime="2022-12-05T08:46:24+08:00">2022-12-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="COEN-210-Computer-Architecture"><a href="#COEN-210-Computer-Architecture" class="headerlink" title="COEN 210 Computer Architecture"></a>COEN 210 Computer Architecture</h1><h2 id="Chapter-1-—-Computer-Abstraction-and-Technology"><a href="#Chapter-1-—-Computer-Abstraction-and-Technology" class="headerlink" title="Chapter 1 — Computer Abstraction and Technology"></a>Chapter 1 — Computer Abstraction and Technology</h2><h3 id="Understanding-Performance"><a href="#Understanding-Performance" class="headerlink" title="Understanding Performance"></a>Understanding Performance</h3><ul>
<li><p>Algorithm </p>
<ul>
<li>Determines number of operations executed</li>
</ul>
</li>
<li><p>Programming language, compiler, architecture </p>
<ul>
<li>Determine number of machine instructions  executed per operation</li>
</ul>
</li>
<li><p>Processor and memory system </p>
<ul>
<li>Determine how fast instructions are executed</li>
</ul>
</li>
<li><p>I&#x2F;O system (including OS) </p>
<ul>
<li>Determines how fast I&#x2F;O operations are executed</li>
</ul>
</li>
</ul>
<h3 id="Eight-Great-Ideas"><a href="#Eight-Great-Ideas" class="headerlink" title="Eight Great Ideas"></a>Eight Great Ideas</h3><ul>
<li>Design for Moore’s Law</li>
<li>Use abstraction to simplify design</li>
<li>Make the common case fast</li>
<li>Performance via parallelism</li>
<li>Performance via pipelining</li>
<li>Performance via prediction</li>
<li>Hierarchy of memories</li>
<li>Dependability via redundancy</li>
</ul>
<h3 id="Pitfalls"><a href="#Pitfalls" class="headerlink" title="Pitfalls"></a>Pitfalls</h3><ul>
<li><p>Amdahl’s Law</p>
<ul>
<li>Improving an aspect of a computer and expecting a  proportional improvement in overall performance</li>
<li>Corollary: make the common case fast</li>
</ul>
</li>
<li><p>Low Power at Idle</p>
<ul>
<li>Google data center <ul>
<li>Mostly operates at 10% – 50% load </li>
<li>At 100% load less than 1% of the time</li>
</ul>
</li>
<li>Consider designing processors to make power  proportional to load</li>
</ul>
</li>
<li><p>MIPS as a Performance Metric</p>
<ul>
<li>MIPS: Millions of Instructions Per Second</li>
<li>Doesn’t account for<ul>
<li>Differences in ISAs between computers</li>
<li>Differences in complexity between instructions</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Chapter-2-—-Instructions-Language-of-the-Computer"><a href="#Chapter-2-—-Instructions-Language-of-the-Computer" class="headerlink" title="Chapter 2 — Instructions: Language of the Computer"></a>Chapter 2 — Instructions: Language of the Computer</h2><h3 id="Design-Principle"><a href="#Design-Principle" class="headerlink" title="Design Principle"></a>Design Principle</h3><ol>
<li><p>Simplicity favors regularity</p>
<ul>
<li><p>All arithmetic operations have this form</p>
<p><strong>ADD a, b, c &#x2F;&#x2F; a &#x3D; b + c</strong></p>
</li>
<li><p>Regularity makes implementation simpler</p>
</li>
<li><p>Simplicity enables higher performance at lower  cost</p>
</li>
</ul>
</li>
<li><p>Smaller is faster</p>
<ul>
<li>LEGv8 has a 32 × 64-bit register file</li>
<li>64-bit data is called a “doubleword” <ul>
<li>31 x 64-bit general purpose registers X0 to X30</li>
</ul>
</li>
<li>c.f. main memory: millions of locations</li>
</ul>
</li>
<li><p>Make the common case fast</p>
<ul>
<li><p>Constant data specified in an instruction </p>
<p><strong>ADDI X22, X22, #4</strong></p>
</li>
<li><p>Small constants are common</p>
</li>
<li><p>Immediate operand avoids a load instruction</p>
</li>
</ul>
</li>
<li><p>Good design demands good compromises</p>
<ul>
<li>Different formats complicate decoding, but allow 32-bit instructions  uniformly</li>
<li>Keep formats as similar as possible</li>
</ul>
</li>
</ol>
<h3 id="LEGv8-Registers"><a href="#LEGv8-Registers" class="headerlink" title="LEGv8 Registers"></a>LEGv8 Registers</h3><ul>
<li>X0 – X7: procedure arguments&#x2F;results </li>
<li>X8: indirect result location register </li>
<li>X9 – X15: temporaries </li>
<li>X16 – X17 (IP0 – IP1): may be used by linker as a scratch  register, other times as temporary register</li>
<li>X18: platform register for platform independent code;  otherwise a temporary register </li>
<li>X19 – X27: saved </li>
<li>X28 (SP): stack pointer </li>
<li>X29 (FP): frame pointer </li>
<li>X30 (LR): link register (return address) </li>
<li>XZR (register 31): the constant value 0</li>
</ul>
<h3 id="Memory-Layout"><a href="#Memory-Layout" class="headerlink" title="Memory Layout"></a>Memory Layout</h3><ul>
<li>Text: program code</li>
<li>Static data: global variables <ul>
<li>e.g., static variables in C,  constant arrays and strings</li>
</ul>
</li>
<li>Dynamic data: heap <ul>
<li>E.g., malloc in C, new in Java</li>
</ul>
</li>
<li>Stack: automatic storage</li>
</ul>
<p><img src="/images/210/memory_layout.JPG"></p>
<h3 id="LEGv8-Addressing-Summary"><a href="#LEGv8-Addressing-Summary" class="headerlink" title="LEGv8 Addressing Summary"></a>LEGv8 Addressing Summary</h3><p><img src="/images/210/addressing.JPG"></p>
<h3 id="LEGv8-Encoding-Summary"><a href="#LEGv8-Encoding-Summary" class="headerlink" title="LEGv8 Encoding Summary"></a>LEGv8 Encoding Summary</h3><p><img src="/images/210/encoding.JPG"></p>
<h3 id="Synchronization"><a href="#Synchronization" class="headerlink" title="Synchronization"></a>Synchronization</h3><ul>
<li>Two processors sharing an area of memory<ul>
<li>P1 writes, then P2 reads</li>
<li>Data race if P1 and P2 don’t synchronize<ul>
<li>Result depends on order of accesses</li>
</ul>
</li>
</ul>
</li>
<li>Hardware support required<ul>
<li>Atomic read&#x2F;write memory operation</li>
<li>No other access to the location allowed between the read  and write</li>
</ul>
</li>
<li>Could be a single instruction<ul>
<li>E.g., atomic swap of register ↔ memory</li>
<li>Or an atomic pair of instructions</li>
</ul>
</li>
</ul>
<h3 id="Translation-and-Startup"><a href="#Translation-and-Startup" class="headerlink" title="Translation and Startup"></a>Translation and Startup</h3><p><img src="/images/210/translation_startup.JPG"></p>
<p><img src="/images/210/java_startup.JPG"></p>
<h3 id="Loading-a-Program"><a href="#Loading-a-Program" class="headerlink" title="Loading a Program"></a>Loading a Program</h3><p>Load from image file on disk into memory</p>
<ol>
<li>Read header to determine segment sizes</li>
<li>Create virtual address space</li>
<li>Copy text and initialized data into memory <ul>
<li>Or set page table entries so they can be faulted in</li>
</ul>
</li>
<li>Set up arguments on stack</li>
<li>Initialize registers (including SP, FP)</li>
<li>Jump to startup routine<ul>
<li>Copies arguments to X0, … and calls main</li>
<li>When main returns, do exit syscall</li>
</ul>
</li>
</ol>
<h3 id="Dynamic-Linking"><a href="#Dynamic-Linking" class="headerlink" title="Dynamic Linking"></a>Dynamic Linking</h3><ul>
<li>Only link&#x2F;load library procedure when it is  called<ul>
<li>Requires procedure code to be relocatable</li>
<li>Avoids image bloat caused by static linking of all  (transitively) referenced libraries</li>
<li>Automatically picks up new library versions</li>
</ul>
</li>
</ul>
<h3 id="Lessons-Learnt"><a href="#Lessons-Learnt" class="headerlink" title="Lessons Learnt"></a>Lessons Learnt</h3><ul>
<li>Instruction count and CPI are not good  performance indicators in isolation</li>
<li>Compiler optimizations are sensitive to the  algorithm</li>
<li>Java&#x2F;JIT compiled code is significantly faster  than JVM interpreted<ul>
<li>Comparable to optimized C in some cases</li>
</ul>
</li>
<li>Nothing can fix a dumb algorithm!</li>
</ul>
<h3 id="Fallacies"><a href="#Fallacies" class="headerlink" title="Fallacies"></a>Fallacies</h3><ol>
<li>Powerful instruction -&gt; higher performance<ul>
<li>Fewer instructions required</li>
<li>But complex instructions are hard to implement<ul>
<li>May slow down all instructions, including simple ones</li>
</ul>
</li>
<li>Compilers are good at making fast code from simple  instructions</li>
</ul>
</li>
<li>Use assembly code for high performance<ul>
<li>But modern compilers are better at dealing with modern  processors</li>
<li>More lines of code -&gt; more errors and less productivity</li>
</ul>
</li>
<li>Backward compatibility -&gt; instruction set  doesn’t change<ul>
<li>But they do accrete more instructions</li>
</ul>
</li>
</ol>
<h3 id="Pitfalls-1"><a href="#Pitfalls-1" class="headerlink" title="Pitfalls"></a>Pitfalls</h3><ol>
<li>Sequential words are not at sequential  addresses<ul>
<li>Increment by 4, not by 1!</li>
</ul>
</li>
<li>Keeping a pointer to an automatic variable  after procedure returns<ul>
<li>e.g., passing pointer back via an argument</li>
<li>Pointer becomes invalid when stack popped</li>
</ul>
</li>
</ol>
<h2 id="Chapter-4-—-The-Processor"><a href="#Chapter-4-—-The-Processor" class="headerlink" title="Chapter 4 — The Processor"></a>Chapter 4 — The Processor</h2><h3 id="Logic-Design-Basics"><a href="#Logic-Design-Basics" class="headerlink" title="Logic Design Basics"></a>Logic Design Basics</h3><ul>
<li>Information encoded in binary<ul>
<li>Low voltage &#x3D; 0, High voltage &#x3D; 1</li>
<li>One wire per bit</li>
<li>Multi-bit data encoded on multi-wire buses</li>
</ul>
</li>
<li>Combinational element<ul>
<li>Operate on data</li>
<li>Output is a function of input<ul>
<li>AND-gate</li>
<li>Multiplexer</li>
<li>Adder</li>
<li>Arithmetic&#x2F;Logic Unit</li>
</ul>
</li>
</ul>
</li>
<li>State (sequential) elements<ul>
<li>Store information</li>
<li>Register: stores data in a circuit<ul>
<li>Uses a clock signal to determine when to update  the stored value</li>
<li>Edge-triggered: update when Clk changes from 0  to 1</li>
</ul>
</li>
<li>Register with write control<ul>
<li>Only updates on clock edge when write control  input is 1</li>
<li>Used when stored value is required later</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Clocking-Methodology"><a href="#Clocking-Methodology" class="headerlink" title="Clocking Methodology"></a>Clocking Methodology</h3><ul>
<li>Combinational logic transforms data during  clock cycles<ul>
<li>Between clock edges</li>
<li>Input from state elements, output to state element</li>
<li>Longest delay determines clock period</li>
</ul>
</li>
</ul>
<h3 id="Full-Datapath"><a href="#Full-Datapath" class="headerlink" title="Full Datapath"></a>Full Datapath</h3><p>control signals derived from instruction</p>
<p><img src="/images/210/full_datapath.JPG"></p>
<h3 id="Datapath-With-Control"><a href="#Datapath-With-Control" class="headerlink" title="Datapath With Control"></a>Datapath With Control</h3><p><img src="/images/210/datapath_with_control.JPG"></p>
<h3 id="R-Type-Instruction"><a href="#R-Type-Instruction" class="headerlink" title="R-Type Instruction"></a>R-Type Instruction</h3><p><img src="/images/210/r_type.JPG"></p>
<h3 id="Load-Instruction"><a href="#Load-Instruction" class="headerlink" title="Load Instruction"></a>Load Instruction</h3><p><img src="/images/210/load.JPG"></p>
<h3 id="CBZ-Instruction"><a href="#CBZ-Instruction" class="headerlink" title="CBZ Instruction"></a>CBZ Instruction</h3><p><img src="/images/210/CBZ.JPG"></p>
<h3 id="Datapath-With-B-Added"><a href="#Datapath-With-B-Added" class="headerlink" title="Datapath With B Added"></a>Datapath With B Added</h3><p><img src="/images/210/B_added.JPG"></p>
<h3 id="Single-Cycle-Performance-Issues"><a href="#Single-Cycle-Performance-Issues" class="headerlink" title="Single Cycle Performance Issues"></a>Single Cycle Performance Issues</h3><ul>
<li>Longest delay determines clock period<ul>
<li>Critical path: load instruction</li>
<li>Instruction memory → register file → ALU → data  memory → register file</li>
</ul>
</li>
<li>Not feasible to vary period for different  instructions</li>
<li>Violates design principle<ul>
<li>Making the common case fast</li>
</ul>
</li>
<li>We will improve performance by pipelining</li>
</ul>
<h3 id="Pipelining-Analogy"><a href="#Pipelining-Analogy" class="headerlink" title="Pipelining Analogy"></a>Pipelining Analogy</h3><ul>
<li>Pipelined laundry: overlapping execution<ul>
<li>Parallelism improves performance</li>
</ul>
</li>
</ul>
<p><img src="/images/210/pipeline_analogy.JPG"></p>
<h3 id="LEGv8-Pipeline"><a href="#LEGv8-Pipeline" class="headerlink" title="LEGv8 Pipeline"></a>LEGv8 Pipeline</h3><ul>
<li>Five stages, one step per stage<ol>
<li>IF: Instruction fetch from memory</li>
<li>ID: Instruction decode &amp; register read</li>
<li>EX: Execute operation or calculate address</li>
<li>MEM: Access memory operand</li>
<li>WB: Write result back to register</li>
</ol>
</li>
</ul>
<h3 id="Pipeline-Performance"><a href="#Pipeline-Performance" class="headerlink" title="Pipeline Performance"></a>Pipeline Performance</h3><p><img src="D:\Blog\source\images\210\pipeline_performance1.JPG"></p>
<p><img src="/images/210/pipeline_performance2.JPG"></p>
<h3 id="Pipeline-Speedup"><a href="#Pipeline-Speedup" class="headerlink" title="Pipeline Speedup"></a>Pipeline Speedup</h3><ul>
<li>If all stages take the same time (balanced)<ul>
<li>Time between instructions(pipelined) &#x3D; Time between instructions(nonpipelined) &#x2F; Number of stages</li>
</ul>
</li>
<li>If not balanced, speedup is less</li>
<li>Speedup due to increased throughput<ul>
<li>Latency (time for each instruction) does not  decrease</li>
</ul>
</li>
</ul>
<h3 id="Pipelining-and-ISA-Design"><a href="#Pipelining-and-ISA-Design" class="headerlink" title="Pipelining and ISA Design"></a>Pipelining and ISA Design</h3><ul>
<li>LEGv8 ISA designed for pipelining<ul>
<li>All instructions are 32-bits<ul>
<li>Easier to fetch and decode in one cycle</li>
<li>c.f. x86: 1- to 17-byte instructions</li>
</ul>
</li>
<li>Few and regular instruction formats<ul>
<li>Can decode and read registers in one step</li>
</ul>
</li>
<li>Load&#x2F;store addressing<ul>
<li>Can calculate address in 3rd stage, access memory in 4th stage</li>
</ul>
</li>
<li>Alignment of memory operands<ul>
<li>Memory access takes only one cycle</li>
<li>registers &amp; stack</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Hazards"><a href="#Hazards" class="headerlink" title="Hazards"></a>Hazards</h3><p>Situations that prevent starting the next  instruction in the next cycle</p>
<ol>
<li><p>Structure hazards</p>
<ul>
<li>A required resource is busy</li>
<li>Conflict for use of a resource</li>
<li>In LEGv8 pipeline with a single memory<ul>
<li>Load&#x2F;store requires data access</li>
<li>Instruction fetch would have to stall for that cycle<ul>
<li>Would cause a pipeline “bubble”</li>
</ul>
</li>
</ul>
</li>
<li>Hence, pipelined datapaths require separate  instruction&#x2F;data memories<ul>
<li>Or separate instruction&#x2F;data caches</li>
</ul>
</li>
</ul>
</li>
<li><p>Data hazard</p>
<ul>
<li><p>Need to wait for previous instruction to complete  its data read&#x2F;write</p>
</li>
<li><p>An instruction depends on completion of data  access by a previous instruction</p>
<p><strong>ADD <em>X19</em>, X0, X1</strong> </p>
<p><strong>SUB X2, <em>X19</em>, X3</strong></p>
</li>
<li><p>Forwarding (aka Bypassing)</p>
<ul>
<li>Use result when it is computed</li>
<li>Don’t wait for it to be stored in a register</li>
<li>Requires extra connections in the datapath</li>
</ul>
<p><img src="/images/210/forwarding.JPG"></p>
</li>
<li><p>Load-Use Data Hazard</p>
<ul>
<li>Can’t always avoid stalls by forwarding<ul>
<li>If value not computed when needed</li>
<li>Can’t forward backward in time!</li>
</ul>
</li>
</ul>
<p><img src="/images/210/bubble.JPG"></p>
<ul>
<li>Code Scheduling to Avoid Stalls<ul>
<li>Reorder code to avoid use of load result in the  next instruction</li>
</ul>
</li>
</ul>
<p><img src="/images/210/code_scheduling.JPG"></p>
</li>
</ul>
</li>
<li><p>Control hazard</p>
<ul>
<li>Deciding on control action depends on previous  instruction</li>
<li>Branch determines flow of control<ul>
<li>Fetching next instruction depends on branch  outcome</li>
<li>Pipeline can’t always fetch correct instruction<ul>
<li>Still working on ID stage of branch</li>
</ul>
</li>
</ul>
</li>
<li>In LEGv8 pipeline<ul>
<li>Need to compare registers and compute target  early in the pipeline</li>
<li>Add hardware to do it in ID stage</li>
</ul>
</li>
<li>Stall on Branch<ul>
<li>Wait until branch outcome determined before  fetching next instruction</li>
</ul>
</li>
</ul>
<p><img src="/images/210/stall_on_branch.JPG"></p>
</li>
</ol>
<h3 id="Branch-Prediction"><a href="#Branch-Prediction" class="headerlink" title="Branch Prediction"></a>Branch Prediction</h3><ul>
<li>Longer pipelines can’t readily determine  branch outcome early<ul>
<li>Stall penalty becomes unacceptable</li>
</ul>
</li>
<li>Predict outcome of branch<ul>
<li>Only stall if prediction is wrong</li>
</ul>
</li>
<li>In LEGv8 pipeline<ul>
<li>Can predict branches not taken</li>
<li>Fetch instruction after branch, with no delay</li>
</ul>
</li>
</ul>
<h3 id="More-Realistic-Branch-Prediction"><a href="#More-Realistic-Branch-Prediction" class="headerlink" title="More-Realistic Branch Prediction"></a>More-Realistic Branch Prediction</h3><ul>
<li><p>Static branch prediction</p>
<ul>
<li><p>Based on typical branch behavior</p>
</li>
<li><p>Example: loop and if-statement branches</p>
<ul>
<li><p>Predict backward branches taken</p>
<p>do loop</p>
</li>
<li><p>Predict forward branches not taken</p>
<p>for loop</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Dynamic branch prediction</p>
<ul>
<li>Hardware measures actual branch behavior<ul>
<li>e.g., record recent history of each branch</li>
</ul>
</li>
<li>Assume future behavior will continue the trend<ul>
<li>When wrong, stall while re-fetching, and update history</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Pipeline-Summary"><a href="#Pipeline-Summary" class="headerlink" title="Pipeline Summary"></a>Pipeline Summary</h3><ul>
<li>Pipelining improves performance by increasing  instruction throughput<ul>
<li>Executes multiple instructions in parallel</li>
<li>Each instruction has the same latency</li>
</ul>
</li>
<li>Subject to hazards<ul>
<li>Structure, data, control</li>
</ul>
</li>
<li>Instruction set design affects complexity of  pipeline implementation</li>
</ul>
<h3 id="LEGv8-Pipelined-Datapath"><a href="#LEGv8-Pipelined-Datapath" class="headerlink" title="LEGv8 Pipelined Datapath"></a>LEGv8 Pipelined Datapath</h3><p><img src="/images/210/legv8_pipelined_datapath.JPG"></p>
<h3 id="Pipeline-registers"><a href="#Pipeline-registers" class="headerlink" title="Pipeline registers"></a>Pipeline registers</h3><p>Need registers between stages</p>
<ul>
<li>To hold information produced in previous cycle</li>
</ul>
<p><img src="/images/210/pipeline_registers.JPG"></p>
<h3 id="Multi-Cycle-Pipeline-Diagram"><a href="#Multi-Cycle-Pipeline-Diagram" class="headerlink" title="Multi-Cycle Pipeline Diagram"></a>Multi-Cycle Pipeline Diagram</h3><p><img src="/images/210/multi_cycle_pipeline.JPG"></p>
<h3 id="Single-Cycle-Pipeline-Diagram"><a href="#Single-Cycle-Pipeline-Diagram" class="headerlink" title="Single-Cycle Pipeline Diagram"></a>Single-Cycle Pipeline Diagram</h3><p><img src="/images/210/single_cycle_pipeline.JPG"></p>
<h3 id="Pipelined-Control"><a href="#Pipelined-Control" class="headerlink" title="Pipelined Control"></a>Pipelined Control</h3><p><img src="/images/210/pipelined_control2.JPG"></p>
<h3 id="Forwarding-and-Hazard-Detection"><a href="#Forwarding-and-Hazard-Detection" class="headerlink" title="Forwarding and Hazard Detection"></a>Forwarding and Hazard Detection</h3><ul>
<li><p>Detecting the Need to Forward</p>
<p><img src="/images/210/need_to_forward.JPG"></p>
<p><img src="/images/210/need_to_forward2.JPG"></p>
</li>
</ul>
<p>​        <img src="/images/210/forwarding_path.JPG"></p>
<p>​    <img src="/images/210/revised_forwarding_condition.JPG"></p>
<ul>
<li>Hazard in ALU</li>
<li>Load-use hazard</li>
</ul>
<p>​        <img src="/images/210/load_use_data_hazard.JPG"></p>
<p><img src="/images/210/datapath_with_hazard_detection.JPG"></p>
<ul>
<li>Branch hazard</li>
</ul>
<p><img src="/images/210/branch_hazard.JPG"></p>
<h3 id="Stalls-and-Performance"><a href="#Stalls-and-Performance" class="headerlink" title="Stalls and Performance"></a>Stalls and Performance</h3><ul>
<li>Stalls reduce performance<ul>
<li>But are required to get correct results</li>
</ul>
</li>
<li>Compiler can arrange code to avoid hazards  and stalls<ul>
<li>Requires knowledge of the pipeline structure</li>
</ul>
</li>
</ul>
<h3 id="Dynamic-Branch-Prediction"><a href="#Dynamic-Branch-Prediction" class="headerlink" title="Dynamic Branch Prediction"></a>Dynamic Branch Prediction</h3><ul>
<li>In deeper and superscalar pipelines, branch penalty is  more significant</li>
<li>Use dynamic prediction<ul>
<li>Branch prediction buffer (aka branch history table)</li>
<li>Indexed by recent branch instruction addresses</li>
<li>Stores outcome (taken&#x2F;not taken)</li>
<li>To execute a branch<ul>
<li>Check table, expect the same outcome</li>
<li>Start fetching from fall-through or target</li>
<li>If wrong, flush pipeline and flip prediction</li>
</ul>
</li>
</ul>
</li>
<li>1-Bit Predictor: Shortcoming<ul>
<li>Inner loop branches mispredicted twice!</li>
</ul>
</li>
<li>2-Bit Predictor<ul>
<li>Only change prediction on two successive  mispredictions</li>
</ul>
</li>
</ul>
<h3 id="Exceptions-and-Interrupts"><a href="#Exceptions-and-Interrupts" class="headerlink" title="Exceptions and Interrupts"></a>Exceptions and Interrupts</h3><ul>
<li>“Unexpected” events requiring change in flow of control<ul>
<li>Different ISAs use the terms differently</li>
</ul>
</li>
<li>Exception<ul>
<li>Arises within the CPU<ul>
<li>e.g., undefined opcode, overflow, syscall, …</li>
</ul>
</li>
</ul>
</li>
<li>Interrupt<ul>
<li>From an external I&#x2F;O controller</li>
</ul>
</li>
<li>Dealing with them without sacrificing performance is hard</li>
</ul>
<p><img src="/images/210/exception_interrupt.JPG"></p>
<h3 id="Handling-Exceptions"><a href="#Handling-Exceptions" class="headerlink" title="Handling Exceptions"></a>Handling Exceptions</h3><ul>
<li><p>Save PC of offending (or interrupted) instruction <strong>&#x3D;EPC</strong></p>
<ul>
<li>In LEGv8: Exception Link Register (ELR)</li>
</ul>
</li>
<li><p>Save indication of the problem</p>
<ul>
<li>In LEGv8: Exception Syndrome Rregister (ESR)</li>
<li>We’ll assume 1-bit<ul>
<li>0 for undefined opcode, 1 for overflow</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/210/pipeline_with_exceptions.JPG"></p>
<h3 id="Exception-Properties"><a href="#Exception-Properties" class="headerlink" title="Exception Properties"></a>Exception Properties</h3><ul>
<li>Restartable exceptions<ul>
<li>Pipeline can flush the instruction</li>
<li>Handler executes, then returns to the instruction<ul>
<li>Refetched and executed from scratch</li>
</ul>
</li>
</ul>
</li>
<li>PC saved in ELR register<ul>
<li>Identifies causing instruction</li>
<li>Actually PC + 4 is saved<ul>
<li>Actually PC + 4 is saved</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Instruction-Level-Parallelism-ILP"><a href="#Instruction-Level-Parallelism-ILP" class="headerlink" title="Instruction-Level Parallelism (ILP)"></a>Instruction-Level Parallelism (ILP)</h3><ul>
<li>Pipelining: multiple instructions in parallel</li>
<li>To increase ILP<ul>
<li>Deeper pipeline<ul>
<li>Less work per stage -&gt; shorter clock cycle</li>
</ul>
</li>
<li>Multiple issue<ul>
<li>Replicate pipeline stages -&gt; multiple pipelines</li>
<li>Start multiple instructions per clock cycle</li>
<li>CPI &lt; 1, so use Instructions Per Cycle (IPC)</li>
<li>E.g., 4GHz 4-way multiple-issue<ul>
<li>16 BIPS, peak CPI &#x3D; 0.25, peak IPC &#x3D; 4</li>
</ul>
</li>
<li>But dependencies reduce this in practice</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Multiple-Issue"><a href="#Multiple-Issue" class="headerlink" title="Multiple Issue"></a>Multiple Issue</h3><ul>
<li>Static multiple issue (compile time)<ul>
<li>Compiler groups instructions to be issued together</li>
<li>Packages them into “issue slots”</li>
<li>Compiler detects and avoids hazards</li>
</ul>
</li>
<li>Dynamic multiple issue (run time)<ul>
<li>CPU examines instruction stream and chooses instructions  to issue each cycle</li>
<li>Compiler can help by reordering instructions</li>
<li>CPU resolves hazards using advanced techniques at runtime</li>
</ul>
</li>
</ul>
<h3 id="Speculation"><a href="#Speculation" class="headerlink" title="Speculation"></a>Speculation</h3><ul>
<li>“Guess” what to do with an instruction<ul>
<li>Start the guessed operation as soon as possible</li>
<li>Check whether guess was right<ul>
<li>If so, complete the operation</li>
<li>If not, roll-back and do the right thing</li>
</ul>
</li>
</ul>
</li>
<li>Common to static and dynamic multiple issue</li>
<li>Examples<ul>
<li>Speculate on branch outcome<ul>
<li>Roll back if path taken is different</li>
</ul>
</li>
<li>Speculate on load<ul>
<li>Roll back if location is updated</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Loop-Unrolling"><a href="#Loop-Unrolling" class="headerlink" title="Loop Unrolling"></a>Loop Unrolling</h3><ul>
<li>Replicate loop body to expose more  parallelism<ul>
<li>Reduces loop-control overhead</li>
</ul>
</li>
<li>Use different registers per replication<ul>
<li>Called “register renaming”</li>
<li>Avoid loop-carried “anti-dependencies”<ul>
<li>Store followed by a load of the same register</li>
<li>Aka “name dependence”<ul>
<li>Reuse of a register name</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Does-Multiple-Issue-Work"><a href="#Does-Multiple-Issue-Work" class="headerlink" title="Does Multiple Issue Work?"></a>Does Multiple Issue Work?</h3><ul>
<li>Yes, but not as much as we’d like</li>
<li>Programs have real dependencies that limit ILP</li>
<li>Some dependencies are hard to eliminate<ul>
<li>e.g., pointer aliasing</li>
</ul>
</li>
<li>Some parallelism is hard to expose<ul>
<li>Limited window size during instruction issue</li>
</ul>
</li>
<li>Memory delays and limited bandwidth<ul>
<li>Hard to keep pipelines full</li>
</ul>
</li>
<li>Speculation can help if done well</li>
</ul>
<h3 id="Fallacies-1"><a href="#Fallacies-1" class="headerlink" title="Fallacies"></a>Fallacies</h3><ol>
<li>Pipelining is easy (!)<ul>
<li>The basic idea is easy</li>
<li>The devil is in the details<ul>
<li>e.g., detecting data hazards</li>
</ul>
</li>
</ul>
</li>
<li>Pipelining is independent of technology<ul>
<li>So why haven’t we always done pipelining?</li>
<li>More transistors make more advanced techniques feasible</li>
<li>Pipeline-related ISA design needs to take account of  technology trends<ul>
<li>e.g., predicated instructions</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Pitfalls-2"><a href="#Pitfalls-2" class="headerlink" title="Pitfalls"></a>Pitfalls</h3><ul>
<li>Poor ISA design can make pipelining harder<ul>
<li>e.g., complex instruction sets (VAX, IA-32)<ul>
<li>Significant overhead to make pipelining work</li>
<li>IA-32 micro-op approach</li>
</ul>
</li>
<li>e.g., complex addressing modes<ul>
<li>Register update side effects, memory indirection</li>
</ul>
</li>
<li>e.g., delayed branches<ul>
<li>Advanced pipelines have long delay slots</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Concluding-Remarks"><a href="#Concluding-Remarks" class="headerlink" title="Concluding Remarks"></a>Concluding Remarks</h3><ul>
<li>ISA influences design of datapath and control</li>
<li>Datapath and control influence design of ISA</li>
<li>Pipelining improves instruction throughput using parallelism<ul>
<li>More instructions completed per second</li>
<li>Latency for each instruction not reduced</li>
</ul>
</li>
<li>Hazards: structural, data, control</li>
<li>Multiple issue and dynamic scheduling (ILP)<ul>
<li>Dependencies limit achievable parallelism</li>
<li>Complexity leads to the power wall</li>
</ul>
</li>
</ul>
<h2 id="Chapter-5-—-Large-and-Fast-Exploiting-Memory-Hierarchy"><a href="#Chapter-5-—-Large-and-Fast-Exploiting-Memory-Hierarchy" class="headerlink" title="Chapter 5 — Large and Fast: Exploiting Memory Hierarchy"></a>Chapter 5 — Large and Fast: Exploiting Memory Hierarchy</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/28/Web-Developer-Bootcamp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/28/Web-Developer-Bootcamp/" class="post-title-link" itemprop="url">Web Developer Bootcamp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-28 23:21:41" itemprop="dateCreated datePublished" datetime="2022-11-28T23:21:41+08:00">2022-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 15:34:21" itemprop="dateModified" datetime="2022-11-29T15:34:21+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Project/" itemprop="url" rel="index"><span itemprop="name">Project</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>44k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>40 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Web-Developer-Bootcamp"><a href="#Web-Developer-Bootcamp" class="headerlink" title="Web Developer Bootcamp"></a>Web Developer Bootcamp</h1><h2 id="1-快捷键"><a href="#1-快捷键" class="headerlink" title="1. 快捷键"></a>1. 快捷键</h2><p>ctrl shift p : format document</p>
<p>a tab</p>
<p>lorem</p>
<p>ctrl &#x2F;</p>
<p>inp tab</p>
<p>! 标准html初始化</p>
<h2 id="2-HTML5"><a href="#2-HTML5" class="headerlink" title="2. HTML5"></a>2. HTML5</h2><p>HTML is not a version, but a standard.</p>
<p>You can’t turn off HTML5!</p>
<ul>
<li><p>inline elements</p>
<ul>
<li><p>a    anchor</p>
</li>
<li><p>span </p>
<p>generic element</p>
</li>
</ul>
</li>
<li><p>block elements</p>
<ul>
<li><p>p    paragraph</p>
</li>
<li><p>div  division</p>
<p>generic element</p>
</li>
</ul>
</li>
</ul>
<p>hr: a segment line</p>
<p>br: a line break</p>
<p>sup: superscript</p>
<p>sub: subscript</p>
<h3 id="HTML-Entities：start-with-ampersand-amp-end-with-semicolon"><a href="#HTML-Entities：start-with-ampersand-amp-end-with-semicolon" class="headerlink" title="HTML Entities：start with ampersand&amp;, end with semicolon;"></a>HTML Entities：start with ampersand&amp;, end with semicolon;</h3><ul>
<li>greater than： </li>
<li>less than：</li>
</ul>
<h3 id="Semantic-Markup-meaningful-markup-accessibility"><a href="#Semantic-Markup-meaningful-markup-accessibility" class="headerlink" title="Semantic Markup: meaningful markup       accessibility"></a>Semantic Markup: meaningful markup       accessibility</h3><p>not div, but</p>
<ul>
<li>main</li>
<li>nav</li>
<li>section</li>
<li>article</li>
<li>aside</li>
<li>header</li>
<li>footer</li>
<li>time</li>
<li>figure<ul>
<li>figcaption</li>
</ul>
</li>
</ul>
<h3 id="Emmet"><a href="#Emmet" class="headerlink" title="Emmet:"></a>Emmet:</h3><ul>
<li>child: &gt;</li>
<li>sibling: +</li>
<li>multiplication:  *</li>
<li>item numbering: $</li>
</ul>
<h3 id="table"><a href="#table" class="headerlink" title="table:"></a>table:</h3><ul>
<li>tr : table row</li>
<li>td : single data cell</li>
<li>th : single header:<ul>
<li>rowspan&#x3D;”2”</li>
<li>colspan&#x3D;”2”</li>
</ul>
</li>
<li>thead</li>
<li>tbody</li>
<li>tfoot</li>
</ul>
<h3 id="form"><a href="#form" class="headerlink" title="form:"></a>form:</h3><ul>
<li><p>empty container for data inputs</p>
</li>
<li><p>specify how and where the data should be sent</p>
</li>
<li><p>action: where the http request should be sent</p>
</li>
<li><p>method: “get” “post”</p>
</li>
<li><p>input: </p>
<ul>
<li>type:<ul>
<li>text</li>
<li>password</li>
<li>email: pattern</li>
<li>url: pattern</li>
<li>color: color picker</li>
<li>file</li>
<li>number:<ul>
<li>min</li>
<li>max</li>
<li>step</li>
</ul>
</li>
<li>time</li>
<li>range:<ul>
<li>id + label for</li>
<li>name</li>
<li>min</li>
<li>max</li>
<li>value: initial value</li>
<li>step</li>
</ul>
</li>
<li>radio:<ul>
<li>one name for a group of radio</li>
<li>id</li>
<li>label for</li>
<li>value 绑定 name</li>
</ul>
</li>
<li>checkbox:<ul>
<li>name 选中后属性为on，不选中则没有该属性</li>
<li>id</li>
<li>label for 绑定 id</li>
<li>checked</li>
</ul>
</li>
<li>submit:<ul>
<li>value</li>
</ul>
</li>
</ul>
</li>
<li>placeholder </li>
<li>label + input<ul>
<li>input id name</li>
<li>label for</li>
</ul>
</li>
</ul>
</li>
<li><p>button:</p>
<ul>
<li>type:<ul>
<li>submit (default)</li>
<li>button</li>
</ul>
</li>
</ul>
</li>
<li><p>select:</p>
<ul>
<li>name</li>
<li>id</li>
<li>option:<ul>
<li>value</li>
<li>selected</li>
</ul>
</li>
</ul>
</li>
<li><p>textarea:</p>
<ul>
<li>id + label for</li>
<li>name</li>
<li>placeholder</li>
<li>rows </li>
<li>cols</li>
</ul>
</li>
</ul>
<h3 id="validation"><a href="#validation" class="headerlink" title="validation:"></a>validation:</h3><ul>
<li>browser side validation:<ul>
<li>html built-in :<ul>
<li>required</li>
<li>minlength</li>
<li>maxlength</li>
<li>min</li>
<li>max</li>
<li>pattern : regular expression: a pattern</li>
<li>type: <ul>
<li>url</li>
<li>email</li>
<li>tel</li>
</ul>
</li>
</ul>
</li>
<li>javascript</li>
</ul>
</li>
<li>server side validation</li>
</ul>
<h2 id="3-CSS"><a href="#3-CSS" class="headerlink" title="3. CSS"></a>3. CSS</h2><p>cascading style sheets</p>
<p>selector {</p>
<p>​        property: value;</p>
<p>}</p>
<p>where:</p>
<ol>
<li>inline style&#x3D;”color: green”   bad!</li>
<li>head style</li>
<li>css file + link :<ul>
<li>href</li>
<li>rel&#x3D;”stylesheet”</li>
</ul>
</li>
</ol>
<p>color: text color</p>
<p>background-color</p>
<p>font-size:</p>
<ul>
<li>px : not recommended for responsive websites</li>
</ul>
<h3 id="CSS-selector"><a href="#CSS-selector" class="headerlink" title="CSS selector:"></a>CSS selector:</h3><ul>
<li><p>universal selector:</p>
<ul>
<li><ul>
<li></li>
</ul>
</li>
</ul>
</li>
<li><p>h1 ,h2</p>
</li>
<li><p>id selector:</p>
<ul>
<li>#signup</li>
</ul>
</li>
<li><p>class selector:</p>
<ul>
<li>.tag</li>
</ul>
</li>
<li><p>descendant selector: (generic descendant)</p>
<ul>
<li>li a</li>
<li>span a </li>
<li>.tag a</li>
</ul>
</li>
<li><p>adjacent selector: (immediately after)</p>
<ul>
<li>h1 + p</li>
</ul>
</li>
<li><p>direct child: (direct descendant)</p>
<ul>
<li>div &gt; li</li>
</ul>
</li>
<li><p>attribute selector:</p>
<ul>
<li>input[type&#x3D;”password”]</li>
<li>section[class&#x3D;”post”]</li>
<li>a[href*&#x3D;”google”]  <ul>
<li>contains</li>
</ul>
</li>
</ul>
</li>
<li><p>pseudo class:</p>
<ul>
<li>button:hover</li>
<li>.post a:hover</li>
<li>button:active</li>
<li>.post:nth-of-type(2n)</li>
<li>.post:nth-of-type(2n-1)</li>
</ul>
</li>
<li><p>pseudo element:</p>
<ul>
<li>h2::first-letter</li>
<li>p::first-line</li>
<li>p::selection</li>
<li>::selection</li>
</ul>
</li>
</ul>
<p>“cascade”: order matters!</p>
<h3 id="specificity"><a href="#specificity" class="headerlink" title="specificity:"></a>specificity:</h3><ul>
<li><p>The more specific selector wins!</p>
</li>
<li><p>id &gt; class, attribute, pseudo class &gt; element, pseudo element</p>
</li>
<li><p>!important</p>
</li>
<li><p>inherit</p>
</li>
</ul>
<h3 id="CSS-box-model"><a href="#CSS-box-model" class="headerlink" title="CSS box model"></a>CSS box model</h3><ul>
<li>content box:<ul>
<li>width</li>
<li>height</li>
</ul>
</li>
<li>padding</li>
<li>margin</li>
<li>border</li>
</ul>
<h2 id="4-JS"><a href="#4-JS" class="headerlink" title="4.JS"></a>4.JS</h2><h3 id="loop"><a href="#loop" class="headerlink" title="loop:"></a>loop:</h3><ul>
<li><p>for of: 遍历iterable</p>
</li>
<li><p>for in: object</p>
</li>
</ul>
<h3 id="scope"><a href="#scope" class="headerlink" title="scope:"></a>scope:</h3><ul>
<li>var 只限定function scope, 不限定block scope( loop, conditional)</li>
<li>let 限定block scope</li>
<li>const 限定block scope</li>
</ul>
<h3 id="callback；"><a href="#callback；" class="headerlink" title="callback；"></a>callback；</h3><p>A callback function is a function passed into another function as an argument, which is then invoked inside the outer function to complete some kind of routine or action.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//array.forEach(function)</span></span><br><span class="line">nums.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(num%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//array.map(function)</span></span><br><span class="line"><span class="keyword">const</span> doubles=nums.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">num</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//arrow function</span></span><br><span class="line"><span class="keyword">const</span> double=nums.<span class="title function_">map</span>(<span class="function">(<span class="params">num</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num*<span class="number">2</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//arrow function implicit return</span></span><br><span class="line"><span class="keyword">const</span> double1=nums.<span class="title function_">map</span>(<span class="function">(<span class="params">num</span>)=&gt;</span>&#123;</span><br><span class="line">    num*<span class="number">2</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> double2=nums.<span class="title function_">map</span>(<span class="function"><span class="params">num</span>=&gt;</span>num*<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//setTimeOut(function,t)</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"><span class="title function_">setTimeOut</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;...Are you still there?&quot;</span>)</span><br><span class="line">&#125;,<span class="number">3000</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;I SHOULD BE THE SECOND LINE&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//setInterval(function,t)</span></span><br><span class="line"><span class="keyword">const</span> id=<span class="built_in">setInterval</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>());</span><br><span class="line">&#125;,<span class="number">2000</span>);</span><br><span class="line"><span class="built_in">clearInterval</span>(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">//array.filter(function)</span></span><br><span class="line"><span class="keyword">const</span> filters=nums.<span class="title function_">filter</span>(<span class="function"><span class="params">num</span>=&gt;</span>num%<span class="number">2</span>==<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//&quot;sum of all&quot;</span></span><br><span class="line"><span class="keyword">const</span> total=nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total,price</span>)=&gt;</span>total+price)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&quot;product of all&quot;</span></span><br><span class="line"><span class="keyword">const</span> total=nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total,price</span>)=&gt;</span>total*price)</span><br><span class="line"></span><br><span class="line"><span class="comment">//&quot;minimum of all&quot;</span></span><br><span class="line"><span class="keyword">const</span> min=nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">min,num</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//the return value becomes the next min</span></span><br><span class="line">    <span class="comment">//num start from nums[1] to nums[n-1]</span></span><br><span class="line">    <span class="keyword">if</span>(min&lt;num)&#123;</span><br><span class="line">        <span class="keyword">return</span> num;	</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//reduce with initial value 100</span></span><br><span class="line"><span class="keyword">const</span> total=nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total,num</span>)=&gt;</span>total+num,<span class="number">100</span>)</span><br></pre></td></tr></table></figure>



<h4 id="synchronous-callback"><a href="#synchronous-callback" class="headerlink" title="synchronous callback:"></a>synchronous callback:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function greeting(name) &#123;</span><br><span class="line">  alert(`Hello, $&#123;name&#125;`);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function processUserInput(callback) &#123;</span><br><span class="line">  const name = prompt(&#x27;Please enter your name.&#x27;);</span><br><span class="line">  callback(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">processUserInput(greeting);</span><br></pre></td></tr></table></figure>



<h4 id="asynchronous-callback"><a href="#asynchronous-callback" class="headerlink" title="asynchronous callback:"></a>asynchronous callback:</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function">https://developer.mozilla.org/en-US/docs/Glossary/Callback_function</a></p>
<h3 id="this"><a href="#this" class="headerlink" title="this:"></a>this:</h3><ul>
<li><p>“this” in regular function:  </p>
<ul>
<li><strong>whoever calling it; object before “.”</strong></li>
<li>how it is executed!</li>
</ul>
</li>
<li><p>“this” in arrow function: </p>
<ul>
<li><strong>the scope that it was created in</strong> </li>
<li>where it is created!</li>
</ul>
</li>
</ul>
<h3 id="spread"><a href="#spread" class="headerlink" title="spread:"></a>spread:</h3><ol>
<li>iterables:</li>
</ol>
<ul>
<li>array</li>
<li>string</li>
</ul>
<ol start="2">
<li>objects</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Math</span>.<span class="title function_">max</span>(...[<span class="number">10</span>,<span class="number">5</span>,<span class="number">7</span>])</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(...<span class="string">&quot;Happy&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr1=[<span class="number">5</span>,<span class="number">8</span>]</span><br><span class="line"><span class="keyword">const</span> arr2=[<span class="number">1</span>,<span class="number">6</span>]</span><br><span class="line"><span class="keyword">const</span> arr=[...arr1,...arr2]</span><br></pre></td></tr></table></figure>



<h3 id="arguments"><a href="#arguments" class="headerlink" title="arguments:"></a>arguments:</h3><p>like an array but not an array</p>
<h3 id="rest"><a href="#rest" class="headerlink" title="rest:"></a>rest:</h3><p>an actual array</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params">...nums</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> nums.<span class="title function_">reduce</span>(<span class="function">(<span class="params">total,el</span>)=&gt;</span>total+el);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="destructuring："><a href="#destructuring：" class="headerlink" title="destructuring："></a>destructuring：</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> scores=[<span class="number">100</span>,<span class="number">99</span>,<span class="number">98</span>,<span class="number">67</span>,<span class="number">59</span>]</span><br><span class="line"><span class="keyword">const</span> [first,second,...everyoneElse]=scores</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">born</span>:birthYear, <span class="attr">deathYear</span>:dead =<span class="string">&#x27;N/A&#x27;</span>&#125;=user	<span class="comment">//destructuring object; rename variable; with default value</span></span><br></pre></td></tr></table></figure>





<h2 id="5-DOM"><a href="#5-DOM" class="headerlink" title="5.DOM"></a>5.DOM</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(<span class="variable language_">document</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">all</span>[<span class="number">10</span>].<span class="property">innerText</span>=<span class="string">&quot;New&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//select the JavaScript object</span></span><br><span class="line"><span class="keyword">const</span> toc=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(toc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> allImages=<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;img&quot;</span>)	<span class="comment">//a HTML Collection, consisting of HTML Elements, not an array</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">dir</span>(allImages[<span class="number">0</span>])	</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> image <span class="keyword">of</span> allImages)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(image.<span class="property">src</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> squareImages=<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&quot;square&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//querySelector</span></span><br><span class="line"><span class="keyword">const</span> firstPTag=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> firstPId=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#p&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> firstPClass=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.p&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;a[title=&#x27;Java&#x27;]&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;p a&quot;</span>)</span><br></pre></td></tr></table></figure>



<ul>
<li><p>innerText</p>
</li>
<li><p>textContent</p>
</li>
<li><p>innerHTML</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>).<span class="property">innerHTML</span> += <span class="string">&quot;&lt;sup&gt;superscript&lt;/sup&gt;&quot;</span></span><br></pre></td></tr></table></figure>




</li>
<li><p>attribute</p>
</li>
<li><p>style</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allLinks=<span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;a&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> link <span class="keyword">of</span> allLinks)&#123;</span><br><span class="line">    link.<span class="property">style</span>.<span class="property">color</span>=<span class="string">&quot;magenta&quot;</span></span><br><span class="line">    link.<span class="property">style</span>.<span class="property">textDecorationColor</span>=<span class="string">&quot;olive&quot;</span></span><br><span class="line">    link.<span class="property">style</span>.<span class="property">textDecorationStyle</span>=<span class="string">&quot;wavy&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">const</span> h1=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>)</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(h1).<span class="property">fontSize</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>classList</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const h2=document.querySelector(&quot;h2&quot;)</span><br><span class="line">h2.classList.add(&quot;border&quot;)</span><br><span class="line">h2.classList.remove(&quot;purple&quot;)</span><br><span class="line">h2.classList.contains(&quot;green&quot;)	//false</span><br><span class="line"></span><br><span class="line">//on and off</span><br><span class="line">h2.classList.toggle(&quot;purple&quot;)</span><br><span class="line">h2.classList.toggle(&quot;purple&quot;)</span><br><span class="line">h2.classList.toggle(&quot;purple&quot;)</span><br></pre></td></tr></table></figure>



<ul>
<li>parentElement</li>
<li>children      &#x2F;&#x2F;HTMLCollection</li>
<li>nextElementSibling</li>
<li>previousElementSibling</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//appendChild</span></span><br><span class="line"><span class="keyword">const</span> newH3=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;h3&quot;</span>)</span><br><span class="line">newH3.<span class="property">innerText</span>=<span class="string">&quot;I AM NEW&quot;</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendCHild</span>(newH3)</span><br><span class="line"></span><br><span class="line"><span class="comment">//append </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//prepend</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//insertAjacentElement</span></span><br><span class="line"><span class="keyword">const</span> h4=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;h4&quot;</span>)</span><br><span class="line">h4.<span class="title function_">append</span>(<span class="string">&quot;hhhh&quot;</span>)</span><br><span class="line">newH3.<span class="title function_">insertAjacentElement</span>(<span class="string">&quot;afterend&quot;</span>,h4)	<span class="comment">//newH3.nextElementSibling</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//removeChild()</span></span><br><span class="line">img.<span class="property">parentElement</span>.<span class="title function_">removeChild</span>(img)</span><br><span class="line"><span class="comment">//remove()</span></span><br><span class="line">img.<span class="title function_">remove</span>()</span><br></pre></td></tr></table></figure>





<h2 id="6-DOM-events"><a href="#6-DOM-events" class="headerlink" title="6.DOM events"></a>6.DOM events</h2><h3 id="button"><a href="#button" class="headerlink" title="button"></a>button</h3><ul>
<li>onclick</li>
<li>ondblclick</li>
<li>onmouseenter</li>
<li>onmouseleave</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> btn=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;button&quot;</span>)</span><br><span class="line"></span><br><span class="line">btn.<span class="property">onclick</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HAHAHA!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//recommended, generic way</span></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&quot;You clicked me!!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,shout)</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,twist)	<span class="comment">//can coexist!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//not recommended</span></span><br><span class="line">btn.<span class="property">onclick</span>=shout</span><br><span class="line">btn.<span class="property">onclick</span>=twist	<span class="comment">//shout is lost, can not coexit</span></span><br></pre></td></tr></table></figure>



<h3 id="keyboard-event-objects"><a href="#keyboard-event-objects" class="headerlink" title="(keyboard) event objects"></a>(keyboard) event objects</h3><ul>
<li>keydown</li>
<li>keyup</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> input=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;input&quot;</span>)</span><br><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">key</span>)	<span class="comment">//q	</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">code</span>)	<span class="comment">//KeyQ</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">code</span>)	<span class="comment">//ArrowUp, ArrowLeft, ArrowRight, ArrowDown</span></span><br><span class="line">    <span class="keyword">switch</span>(e.<span class="property">code</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ArrowUp&quot;</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;UP&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;ArrowDown&quot;</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;DOWN&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IGNORED!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="form-event"><a href="#form-event" class="headerlink" title="form event"></a>form event</h3><p>form action: send form data to the url, and switch to that url</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/url&quot;</span>&gt;</span>	</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;catName&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span></span><br><span class="line">        Submit</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">    Available Cats</span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;cats&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>to stay in the same page after submitting form: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> form=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;form&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> input=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#catName&quot;</span>)	<span class="comment">//input.value</span></span><br><span class="line"><span class="keyword">const</span> list=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#cats&quot;</span>)</span><br><span class="line"></span><br><span class="line">form.<span class="title function_">addEventListener</span>(<span class="string">&quot;submit&quot;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Submitted the form!&quot;</span>)</span><br><span class="line">    <span class="keyword">const</span> name=input.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">const</span> newLi=<span class="variable language_">document</span>.<span class="title class_">CreateElement</span>(<span class="string">&quot;li&quot;</span>)</span><br><span class="line">    newLi.<span class="property">innerText</span>=name</span><br><span class="line">    list.<span class="title function_">append</span>(newLi)	<span class="comment">//list.appendChild(newLi)</span></span><br><span class="line">    input.<span class="property">value</span>=<span class="string">&quot;&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="input-event"><a href="#input-event" class="headerlink" title="input event"></a>input event</h3><ul>
<li>change event</li>
<li>input event</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> h1=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;h1&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> input=docuemnt.<span class="title function_">querySelector</span>(<span class="string">&quot;input&quot;</span>)</span><br><span class="line">input.<span class="title function_">addEventListener</span>(<span class="string">&quot;input&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    h1.<span class="property">innerText</span>=input.<span class="property">value</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="event-bubbling"><a href="#event-bubbling" class="headerlink" title="event bubbling"></a>event bubbling</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.hide</span>&#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">display</span>: none;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;changeColor&quot;</span>&gt;</span></span><br><span class="line">        change color</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container=docuemnt.<span class="title function_">querySelector</span>(<span class="string">&quot;#container&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> button=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#changeColor&quot;</span>)</span><br><span class="line">container.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    container.<span class="property">classList</span>.<span class="title function_">toggle</span>(<span class="string">&quot;hide&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">changeColor</span>=(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> r=<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">    <span class="keyword">const</span> g=<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">    <span class="keyword">const</span> b=<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">255</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span></span><br><span class="line">&#125;</span><br><span class="line">button.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">    container.<span class="property">style</span>.<span class="property">backgroundColor</span>=<span class="title function_">makeRandColor</span>()</span><br><span class="line">    e.<span class="title function_">stopPropagation</span>();	<span class="comment">//stop bubbling!</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="event-delegation"><a href="#event-delegation" class="headerlink" title="event delegation"></a>event delegation</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> container=<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#list&quot;</span>)</span><br><span class="line">container.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    <span class="comment">//console.log(&quot;Click on ul&quot;)</span></span><br><span class="line">    <span class="comment">//e.target.remove()</span></span><br><span class="line">    e.<span class="property">target</span>.<span class="property">nodeName</span>===<span class="string">&quot;LI&quot;</span> &amp;&amp; e.<span class="property">target</span>.<span class="title function_">remove</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="7-Asynchronous-JavaScript"><a href="#7-Asynchronous-JavaScript" class="headerlink" title="7. Asynchronous JavaScript"></a>7. Asynchronous JavaScript</h2><h3 id="call-stack"><a href="#call-stack" class="headerlink" title="call stack"></a>call stack</h3><h3 id="js-is-single-threaded"><a href="#js-is-single-threaded" class="headerlink" title="js is single-threaded!"></a>js is single-threaded!</h3><h3 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h3><ul>
<li>pending</li>
<li>resolved</li>
<li>rejected</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request=<span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee&quot;</span>)</span><br><span class="line">request.<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!&quot;</span>)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, ERROR!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page1&quot;</span>).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page1)&quot;</span>)</span><br><span class="line">    <span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page2&quot;</span>).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page2)&quot;</span>)</span><br><span class="line">    	&#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, ERROR!!&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, ERROR!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//promise chain: dependent asynchronous functions</span></span><br><span class="line"><span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page1&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page1)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page2&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page2)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fakeRequestPromise</span>(<span class="string">&quot;yelp.com/api/coffee/page3&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!!!!(page3)&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, A REQUEST FAILED!!&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//create a promise</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fakeRequest</span>=(<span class="params">url</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> rand=<span class="title class_">Math</span>.<span class="title function_">random</span>()</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(rand&gt;<span class="number">0.7</span>)&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="string">&quot;Your fake data here&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">reject</span>(<span class="string">&quot;Request error&quot;</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fakeRequest</span>(<span class="string">&#x27;/dogs/1&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;DONE WITH REQUEST&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Your data is: &quot;</span>,data)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO, ERROR&quot;</span>+err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//example: rainbow</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">delayedColorChange</span>=(<span class="params">color, delay</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">style</span>.<span class="property">backgroundColor</span>=color</span><br><span class="line">            <span class="title function_">resolve</span>()</span><br><span class="line">        &#125;, delay)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">delayedColorChange</span>(<span class="string">&quot;red&quot;</span>,<span class="number">1000</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;orange&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;yellow&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;green&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;blue&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;indigo&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span><span class="title function_">delayedColorChange</span>(<span class="string">&quot;violet&quot;</span>,<span class="number">1000</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="async"><a href="#async" class="headerlink" title="async"></a>async</h3><ul>
<li>syntax sugar</li>
<li><strong>async function always returns Promise()</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">sing</span>= <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&quot;OH NO&quot;</span>	<span class="comment">//a rejected Promise</span></span><br><span class="line">    <span class="comment">//after throw, becomes a rejected Promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;LA LA LA&quot;</span>	<span class="comment">//a resolved Promise</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">sing</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">login</span> = <span class="keyword">async</span>(<span class="params">username, password</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(!username || !password) <span class="keyword">throw</span> <span class="string">&quot;Missing Credentials&quot;</span></span><br><span class="line">    <span class="keyword">if</span>(password === <span class="string">&quot;ivnwth&quot;</span>) <span class="keyword">return</span> <span class="string">&quot;Welcome&quot;</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="string">&quot;Invalid Password&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">login</span>(<span class="string">&quot;wrong input&quot;</span>)</span><br><span class="line">	.<span class="title function_">then</span>(<span class="function"><span class="params">msg</span>=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line">	.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="await"><a href="#await" class="headerlink" title="await"></a>await</h3><p>only valid when inside async functions</p>
<p><strong>wait for a Promise to be resolved</strong> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">rainbow</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;red&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="comment">//without await, won&#x27;t see red color because codes happen at the same time!!</span></span><br><span class="line">    <span class="comment">//with await, first see red, then see orange, ...</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;orange&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;yellow&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;green&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;blue&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;indigo&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">delayedColorChange</span>(<span class="string">&quot;violet&quot;</span>,<span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ALL DONE&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">rainbow</span>().<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;End of rainbow&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fakeRequest = (<span class="function"><span class="params">url0</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> delay = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*(<span class="number">4500</span>))+<span class="number">500</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(delay&gt;<span class="number">4000</span>)&#123;</span><br><span class="line">                <span class="title function_">reject</span>(<span class="string">&quot;Connection Timeout:(&quot;</span>)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="title function_">resolve</span>(<span class="string">`Here is your fake data from <span class="subst">$&#123;url&#125;</span>`</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, delay)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">                     </span><br><span class="line"><span class="keyword">async</span> <span class="title function_">makeTwoRequests</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> data1=<span class="keyword">await</span> <span class="title function_">fakeRequest</span>(<span class="string">&quot;/page1&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data1)</span><br><span class="line">        <span class="keyword">let</span> data2=<span class="keyword">await</span> <span class="title function_">fakeRequest</span>(<span class="string">&quot;/page2&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data2)</span><br><span class="line">&#125;                     </span><br></pre></td></tr></table></figure>





<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">makeTwoRequest</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> data1=<span class="keyword">await</span> <span class="title function_">fakeRequest</span>(<span class="string">&quot;/page1&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data1)</span><br><span class="line">        <span class="keyword">let</span> data2=<span class="keyword">await</span> <span class="title function_">fakeRequest</span>(<span class="string">&quot;/page2&quot;</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data2)</span><br><span class="line">    &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="8-AJAX"><a href="#8-AJAX" class="headerlink" title="8.AJAX"></a>8.AJAX</h2><ul>
<li>request a <strong>web API</strong>, and get a JSON string in return, instead of HTML, CSS and JavaScript<ul>
<li>JSON.parse(string)</li>
<li>JSON.stringify(object)</li>
</ul>
</li>
<li>AJAX? AJAJ!</li>
<li>JSON: JavaScript Object Notation</li>
</ul>
<h3 id="HTTP-Verbs"><a href="#HTTP-Verbs" class="headerlink" title="HTTP Verbs"></a>HTTP Verbs</h3><ul>
<li>get        &#x2F;&#x2F;get data through APIs<ul>
<li>a GET request <strong>cannot</strong> have <strong>req.body</strong>, only <strong>req.query</strong></li>
</ul>
</li>
<li>post      &#x2F;&#x2F;send data and store somewhere</li>
<li>put        &#x2F;&#x2F;completely update</li>
<li>patch    &#x2F;&#x2F;partly update data</li>
<li>delete</li>
</ul>
<h3 id="HTTP-Status-Codes"><a href="#HTTP-Status-Codes" class="headerlink" title="HTTP Status Codes"></a>HTTP Status Codes</h3><p>1:</p>
<p>2: success</p>
<p>3: redirection</p>
<p>4: client error</p>
<p>5: server error</p>
<h3 id="Query-string"><a href="#Query-string" class="headerlink" title="Query string"></a>Query string</h3><h3 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h3><ul>
<li>request header<ul>
<li>Accept: <ol>
<li>text&#x2F;html</li>
<li>application&#x2F;json</li>
<li>text&#x2F;plain</li>
</ol>
</li>
</ul>
</li>
<li>response header</li>
</ul>
<h3 id="XHRs"><a href="#XHRs" class="headerlink" title="XHRs"></a>XHRs</h3><p>old, unrecommended way</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> req=<span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"></span><br><span class="line">req.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT LOADED!!&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">this</span>.<span class="property">responseText</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req.<span class="property">onerror</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!!&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>,<span class="string">&quot;https://swapi.dev/api/people/1&quot;</span>);</span><br><span class="line">req.<span class="title function_">send</span>();</span><br></pre></td></tr></table></figure>







<h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h3><p>return a Promise</p>
<p>res.json() also returns a Promise</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;https://swapi.dev/api/people/1&quot;</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;RESOLVED!&quot;</span>,res);</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">json</span>();</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;JSON DONE&quot;</span>,data);</span><br><span class="line">      &#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>,e);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//a series of request</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loadPeople</span>= <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> res1=<span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://swapi.dev/api/people/1&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> data1=<span class="keyword">await</span> res1.<span class="title function_">json</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data1);</span><br><span class="line">        <span class="keyword">const</span> res2=<span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://swapi.dev/api/people/2&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> data2=<span class="keyword">await</span> res2.<span class="title function_">json</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(data2);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>,e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">loadPeople</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="axios"><a href="#axios" class="headerlink" title="axios"></a>axios</h3><p>axios.get() returns a data object</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">axios.<span class="title function_">get</span>(<span class="string">&quot;https://swapi.dev/api/people/1&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;RESPONSE:&quot;</span>,res);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>,e);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>axios.get(api, config_object)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getDadJoke</span>= <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> config=&#123;<span class="attr">header</span>:&#123;<span class="title class_">Accept</span>: <span class="string">&quot;application/json&quot;</span>&#125;&#125;;</span><br><span class="line">    	<span class="keyword">const</span> res=<span class="keyword">await</span> axios.<span class="title function_">get</span>(<span class="string">&quot;https://icanhazdadjoke.com/&quot;</span>,config);</span><br><span class="line">    	<span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>.<span class="property">joke</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="9-OOP"><a href="#9-OOP" class="headerlink" title="9.OOP"></a>9.OOP</h2><p>Array.prototype 和 String.prototype 可定义自定义方法，可override默认方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">grumpus</span>=<span class="function">()=&gt;</span><span class="title function_">alert</span>(<span class="string">&quot;GO AWAY!!&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cat=<span class="string">&quot;cat&quot;</span>;</span><br><span class="line">cat.<span class="title function_">grumpus</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">String</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">yell</span>=<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`OMG!!!<span class="subst">$&#123;<span class="variable language_">this</span>.toUpperCase()&#125;</span>!!!!!!`</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="string">&quot;i love you&quot;</span>.<span class="title function_">yell</span>();</span><br><span class="line"></span><br><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>	<span class="comment">//actual template object</span></span><br><span class="line">[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>].<span class="property">__proto__</span>	<span class="comment">//reference to Array.prototype, no need to use it </span></span><br></pre></td></tr></table></figure>



<p>syntactic sugar</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Color</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">r,g,b,name</span>)&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">r</span>=r;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">g</span>=g;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">b</span>=b;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">name</span>=name;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">calcHSL</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="title function_">greet</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`HELLO FROM COLOR <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">rgb</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;r,g,b&#125;=<span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`rgb(<span class="subst">$&#123;r&#125;</span>,<span class="subst">$&#123;g&#125;</span>,<span class="subst">$&#123;b&#125;</span>)`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">hex</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;r,g,b&#125;=<span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;#&#x27;</span>+((<span class="number">1</span>&lt;&lt;<span class="number">24</span>)+(r&lt;&lt;<span class="number">16</span>)+(g&lt;&lt;<span class="number">8</span>)+b).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_">calcHSL</span>(<span class="params"></span>)&#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">//adding new values to this object</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">h</span>=h;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">s</span>=s;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">l</span>=l;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">const</span> c1=<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>,<span class="string">&quot;blue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> c2=<span class="keyword">new</span> <span class="title class_">Color</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,<span class="string">&quot;white&quot;</span>);</span><br><span class="line">c1.<span class="property">hex</span>===c2.<span class="property">hex</span>		<span class="comment">//true</span></span><br></pre></td></tr></table></figure>





<p>hsl:    hew([1,360]), saturation, lightness</p>
<h3 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h3><h3 id="super"><a href="#super" class="headerlink" title="super"></a>super</h3><p>调用父类的constructor</p>
<h2 id="10-Terminal"><a href="#10-Terminal" class="headerlink" title="10.Terminal"></a>10.Terminal</h2><ul>
<li>faster than GUI</li>
<li>all-access pass</li>
</ul>
<p>terminal:    </p>
<ul>
<li>a text-based interface to your computer</li>
<li>originally a physical object, but now we use software terminals</li>
</ul>
<p>shell:</p>
<ul>
<li>the program running on the terminal</li>
</ul>
<p>bash:</p>
<ul>
<li><p>one of the most popular shells</p>
</li>
<li><p>ls</p>
</li>
<li><p>pwd</p>
</li>
<li><p>cd</p>
</li>
<li><p>~ means home directory</p>
</li>
<li><p>&#x2F; means root directory</p>
</li>
<li><p>cd .. 后退一级 </p>
</li>
<li><p>cd &#x2F;</p>
</li>
<li><p>cd ~</p>
</li>
<li><p>mkdir Frogs&#x2F;TreeFrogs SugarGliders</p>
</li>
<li><p>touch index.html app.css app.js</p>
</li>
<li><p>rm index.html</p>
</li>
<li><p>rmdir 只能删空directory</p>
</li>
<li><p>rm -rf</p>
<ul>
<li>can delete (non-empty) directory</li>
<li>recursive </li>
<li>force</li>
</ul>
</li>
</ul>
<h3 id="man"><a href="#man" class="headerlink" title="man"></a>man</h3><ul>
<li>zsh 支持 man ls</li>
<li>bash 不支持</li>
</ul>
<h2 id="11-NodeJS"><a href="#11-NodeJS" class="headerlink" title="11.NodeJS"></a>11.NodeJS</h2><h3 id="Node-REPL"><a href="#Node-REPL" class="headerlink" title="Node REPL"></a>Node REPL</h3><p>Read Evaluate Print Loop</p>
<ul>
<li>.exit    &#x2F;&#x2F;ctrl+d</li>
<li>no <strong>window</strong>, but <strong>global</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node firstScript.js</span><br></pre></td></tr></table></figure>



<h3 id="process"><a href="#process" class="headerlink" title="process"></a>process</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process.argv</span><br></pre></td></tr></table></figure>





<h3 id="fs"><a href="#fs" class="headerlink" title="fs"></a>fs</h3><ul>
<li>sync: try, catch</li>
<li>async: callback function</li>
</ul>
<h3 id="module-exports"><a href="#module-exports" class="headerlink" title="module.exports"></a>module.exports</h3><ol>
<li><p>export a single file</p>
<ul>
<li><p>export an object that other files can require</p>
</li>
<li><p>in the same directory: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> math=<span class="built_in">require</span>(<span class="string">&quot;./math&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>export a directory</p>
<ul>
<li>该directory的<strong>index.js</strong> module.exports什么，其他文件就require到什么</li>
</ul>
</li>
</ol>
<h3 id="npm"><a href="#npm" class="headerlink" title="npm"></a>npm</h3><p>Node Package Manager</p>
<ol>
<li>a free library</li>
<li>a command line tool</li>
<li>normally and by default install <strong>locally</strong></li>
<li>or, installed globly, and <strong>npm link</strong></li>
</ol>
<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><ul>
<li><p>npm init</p>
<p>npm init -y</p>
<p>创建package.json</p>
</li>
<li><p>npm install</p>
<p>根据package.json中的dependencies安装所有依赖包</p>
</li>
</ul>
<h2 id="12-Express"><a href="#12-Express" class="headerlink" title="12.Express"></a>12.Express</h2><h3 id="listen-amp-use"><a href="#listen-amp-use" class="headerlink" title="listen&amp;use"></a>listen&amp;use</h3><ul>
<li>libraries: You are in charge</li>
<li>framework: The framework is in charge!</li>
</ul>
<p>​        <strong>inversion of control</strong></p>
<ul>
<li><p>app.use(callback)</p>
<ul>
<li><p>express将html request&#x2F;response变成两个JS对象，传入callback</p>
</li>
<li><p>req: based on the incoming HTTP request</p>
</li>
<li><p>res: going to generate a HTTP response to the client</p>
<p><strong>can only have one request for one response</strong></p>
</li>
<li><p>res.send()</p>
<ul>
<li>可以传回html</li>
<li>也可以传回json</li>
</ul>
</li>
</ul>
</li>
<li><p>app.listen(8080,callback)</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> app=<span class="title function_">express</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//anytime we have an incoming request</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;WE GOT A NEW REQUEST!!&quot;</span>);</span><br><span class="line">    <span class="comment">//console.dir(req);</span></span><br><span class="line">    <span class="comment">//res.send(&quot;HELLO, WE GOT YOUR REQUEST! THIS IS A RESPONSE!!&quot;);</span></span><br><span class="line">    res.<span class="title function_">send</span>(&#123; <span class="attr">name</span>: <span class="string">&quot;ivn&quot;</span>, <span class="attr">message</span>: <span class="string">&quot;HELLO WORLD!&quot;</span> &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//start listening!</span></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8080</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;LISTENING ON PORT 8080&quot;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3 id="routing"><a href="#routing" class="headerlink" title="routing"></a>routing</h3><p>app.get() only match get request</p>
<p>browser地址栏输入都是get request</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;&lt;h1&gt;IVN&lt;h1&gt;&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/r/:sub&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//console.log(req.params);</span></span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`Welcome to subpage: <span class="subst">$&#123;req.params.sub&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/r/:sub/:postId&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; sub, postId &#125; = req.<span class="property">params</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`&lt;h1&gt;Viewing PostID: <span class="subst">$&#123;postId&#125;</span> on <span class="subst">$&#123;sub&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//必须放最后</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;*&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;I don&#x27;t know that path!!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="query-string"><a href="#query-string" class="headerlink" title="query string"></a>query string</h3><p>&#x2F;search?q&#x3D;cat</p>
<p>request.query</p>
<h3 id="nodemon"><a href="#nodemon" class="headerlink" title="nodemon"></a>nodemon</h3><p>automatic restart after change</p>
<h2 id="13-Templating"><a href="#13-Templating" class="headerlink" title="13.Templating"></a>13.Templating</h2><p>fill in the blank to create HTML</p>
<p>similar to <em>string template literal</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;view engine&quot;</span>, <span class="string">&quot;ejs&quot;</span>);</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&quot;views&quot;</span>, path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;/views&quot;</span>));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&quot;home.ejs&quot;</span>);	<span class="comment">//.ejs可以省略</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3 id="EJS-syntax"><a href="#EJS-syntax" class="headerlink" title="EJS syntax"></a>EJS syntax</h3><ul>
<li>Embedded JS</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;</span><br><span class="line">    Page &lt;%=5+6-1 %&gt;</span><br><span class="line">&lt;/h1&gt;</span><br></pre></td></tr></table></figure>



<p>res.render还可以传对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> num = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>) + <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//res.render(&quot;home&quot;,&#123;allNum:num&#125;); </span></span><br><span class="line">    <span class="comment">//in ejs template: allNum</span></span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&quot;home&quot;</span>, &#123; num &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<ul>
<li>show data</li>
<li>conditions</li>
<li>loops</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;Random number: &lt;%= num %&gt;</span><br><span class="line">    </span><br><span class="line">  </span><br><span class="line">&lt;%if (num%2==0)&#123;	%&gt;</span><br><span class="line">    &lt;h2&gt;</span><br><span class="line">        This is an even number!</span><br><span class="line">    &lt;/h2&gt;</span><br><span class="line">&lt;%&#125;	%&gt;</span><br></pre></td></tr></table></figure>



<h3 id="express-static"><a href="#express-static" class="headerlink" title="express.static()"></a>express.static()</h3><p>middleware</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//规定路径</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname,<span class="string">&#x27;public&#x27;</span>)));</span><br></pre></td></tr></table></figure>



<h3 id="ejs-partials"><a href="#ejs-partials" class="headerlink" title="ejs partials"></a>ejs partials</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- include(&quot;partials/head&quot;)%&gt;</span><br></pre></td></tr></table></figure>





<h2 id="14-Bootstrap"><a href="#14-Bootstrap" class="headerlink" title="14.Bootstrap"></a>14.Bootstrap</h2><p>svg    fontawesome</p>
<h2 id="15-RESTful"><a href="#15-RESTful" class="headerlink" title="15.RESTful"></a>15.RESTful</h2><ul>
<li>get: <ul>
<li>query string</li>
<li>retrieve data, not creating anything</li>
</ul>
</li>
<li>post:<ul>
<li>request body</li>
<li>create data</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//built-in parsing middlewares	</span></span><br><span class="line"><span class="comment">//form data</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">urlencoded</span>(&#123;<span class="attr">extended</span>: <span class="literal">true</span>&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">//json data</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>());</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/tacos&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;meat, qty&#125;=req.<span class="property">body</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`OK, here are your <span class="subst">$&#123;qty&#125;</span> <span class="subst">$&#123;meat&#125;</span> tacos!`</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>REpresentational State Transfer</p>
<ul>
<li>client-server architecture</li>
</ul>
<p>​        Can make requests from browser or Postman. Doesn’t matter where the request is coming from.</p>
<ul>
<li>statelessness</li>
</ul>
<p>​        Every request is on its own.</p>
<ul>
<li><p>uniform interface</p>
<p>combine <strong>URLs</strong> with <strong>HTTP methods</strong> to expose full <strong>CRUD operations</strong> over HTTP</p>
</li>
</ul>
<h3 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h3><ol>
<li><p>app.get(“&#x2F;comments&#x2F;new”)    一个包含form的页面，submit调用app.post()完成新建</p>
</li>
<li><p>app.post(“&#x2F;comments”)   </p>
</li>
<li><p>post完毕后，app.redirect(“&#x2F;comments”)</p>
<p>redirect默认为get</p>
</li>
</ol>
<h3 id="show-x2F-detail-route"><a href="#show-x2F-detail-route" class="headerlink" title="show&#x2F;detail route"></a>show&#x2F;detail route</h3><p>nested route</p>
<h3 id="uuid"><a href="#uuid" class="headerlink" title="uuid"></a>uuid</h3><p>v4</p>
<p>uuidv4()</p>
<h3 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h3><p>html form only supports GET and POST</p>
<p>however, <strong>method-override</strong></p>
<h2 id="16-MongoDB"><a href="#16-MongoDB" class="headerlink" title="16.MongoDB"></a>16.MongoDB</h2><p>database</p>
<p>database management system</p>
<ul>
<li>effiecency</li>
<li>security</li>
<li>scalability</li>
</ul>
<h3 id="Structured-Query-Language"><a href="#Structured-Query-Language" class="headerlink" title="Structured Query Language"></a>Structured Query Language</h3><ul>
<li><p>predefined schema&#x2F;tables</p>
</li>
<li><p>relational&#x2F;referencing</p>
</li>
</ul>
<h3 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h3><ul>
<li>document</li>
<li>key-value</li>
<li>graph</li>
</ul>
<h3 id="mongod-exe"><a href="#mongod-exe" class="headerlink" title="mongod.exe"></a>mongod.exe</h3><p>get the server running</p>
<p>cmd打开后不要关！！</p>
<h3 id="mongo-exe"><a href="#mongo-exe" class="headerlink" title="mongo.exe"></a>mongo.exe</h3><p>enter the shell</p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1:27017/">http://127.0.0.1:27017/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br><span class="line">use loginDemo</span><br><span class="line">show collections</span><br><span class="line">db.users.find()</span><br></pre></td></tr></table></figure>



<h3 id="BSON"><a href="#BSON" class="headerlink" title="BSON"></a>BSON</h3><p>db</p>
<p>show collections</p>
<p>db.dogs.insertOne({name:”hhh”, age:3})</p>
<p>db.dogs.insert([{name:”iii”, age:5},{age:9}])    &#x2F;&#x2F;single or multiple </p>
<p>db.dogs.find()</p>
<p>db.dogs.find({age:9})    &#x2F;&#x2F;return the cursors</p>
<p>db.dogs.findOne({age:9})    &#x2F;&#x2F;return the actual object</p>
<p>db.cats.updateOne({} ,{})</p>
<p>db.cats.updateMany({}, {})</p>
<p>db.replaceOne()</p>
<p>db.deleteOne({})</p>
<p>db.deleteMany({})</p>
<h2 id="17-Mongoose"><a href="#17-Mongoose" class="headerlink" title="17.Mongoose"></a>17.Mongoose</h2><p>npm package </p>
<h3 id="Object-Data-x2F-Document-Mapper"><a href="#Object-Data-x2F-Document-Mapper" class="headerlink" title="Object Data&#x2F;Document Mapper"></a>Object Data&#x2F;Document Mapper</h3><p>nosql</p>
<h3 id="Object-Relation-Mapper"><a href="#Object-Relation-Mapper" class="headerlink" title="Object Relation Mapper"></a>Object Relation Mapper</h3><p>sql</p>
<h3 id="schema"><a href="#schema" class="headerlink" title="schema"></a>schema</h3><p>类比mybatis    .xml</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose=<span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line">mongoose.<span class="title function_">connect</span>(<span class="string">&quot;mongodb://localhost:27017/moviewApp&quot;</span>,&#123;<span class="attr">useNewUrlParser</span>: <span class="literal">true</span>, <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CONNECTION OPEN!!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;OH NO ERROR!!!&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//schema</span></span><br><span class="line"><span class="keyword">const</span> movieSchema=<span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">year</span>:<span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">score</span>:<span class="title class_">Number</span></span><br><span class="line">    <span class="attr">rating</span>:<span class="title class_">String</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//name of model, schema</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Movie</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;Movie&quot;</span>, movieSchema);</span><br><span class="line"><span class="comment">//create a db collection called movies</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//make a new JS object</span></span><br><span class="line"><span class="keyword">const</span> amadeus = <span class="keyword">new</span> <span class="title class_">Movie</span>(&#123;<span class="attr">title</span>:<span class="string">&quot;Amadeus&quot;</span>, <span class="attr">year</span>: <span class="number">1986</span>, <span class="attr">score</span>: <span class="number">9.2</span>, <span class="attr">rating</span>: <span class="string">&quot;G&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//save to database collection!</span></span><br><span class="line">amadeus.<span class="title function_">save</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//insert many</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">insertMany</span>([</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">    &#123;&#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>



<h3 id="load"><a href="#load" class="headerlink" title=".load"></a>.load</h3><p>node</p>
<p>.load index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//return an array; zero, one or many</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">find</span>(&#123;<span class="attr">year</span>: &#123;<span class="attr">$lt</span>: <span class="number">1990</span>&#125;&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//findById</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">findById</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//updateOne</span></span><br><span class="line"><span class="comment">//updateMany</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">updateMany</span>(&#123;<span class="attr">title</span>: &#123;<span class="attr">$in</span>:[<span class="string">&quot;Amadeus&quot;</span>,<span class="string">&quot;Stand By Me&quot;</span>]&#125;&#125;, &#123;<span class="attr">score</span>: <span class="number">10</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(res))</span><br><span class="line"></span><br><span class="line"><span class="comment">//findOneAndUpdate</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">findOneAndUpdate</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//remove is deprecated</span></span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">remove</span>(&#123;&#125;)</span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">deleteMany</span>(&#123;&#125;)</span><br><span class="line"><span class="title class_">Movie</span>.<span class="title function_">findOneAndDelete</span>(&#123;&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="Operation-Buffering"><a href="#Operation-Buffering" class="headerlink" title="Operation Buffering"></a>Operation Buffering</h3><h3 id="schema-constraints"><a href="#schema-constraints" class="headerlink" title="schema constraints"></a>schema constraints</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> productSchema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">maxlength</span>: <span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">price</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">        <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">//min: 0</span></span><br><span class="line">        <span class="comment">//constraint and error message</span></span><br><span class="line">        <span class="attr">min</span>:[<span class="number">0</span>,<span class="string">&quot;Price must be positive!&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onSale</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="literal">false</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">categories</span>: [<span class="title class_">String</span>],	<span class="comment">//attempt to cast input into String</span></span><br><span class="line">    <span class="attr">qty</span>: &#123;</span><br><span class="line">        <span class="attr">online</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">inStore</span>:&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">size</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">        <span class="comment">//all valid values</span></span><br><span class="line">        <span class="attr">enum</span>: [<span class="string">&quot;S&quot;</span>, <span class="string">&quot;M&quot;</span>, <span class="string">&#x27;L&#x27;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Product</span> = mongoose.<span class="title function_">model</span>(<span class="string">&quot;Product&quot;</span>, productSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bike = <span class="keyword">new</span> <span class="title class_">Product</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Bike Helmet&quot;</span>, <span class="attr">price</span>: <span class="number">9.5</span>&#125;, <span class="attr">categories</span>: [<span class="string">&quot;Cycling&quot;</span>, <span class="string">&quot;Safety&quot;</span>, <span class="number">123</span>]);</span><br><span class="line"></span><br><span class="line">bike.<span class="title function_">save</span>()</span><br><span class="line">	.<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">	.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//When updating, schema constraint by default Not working</span></span><br><span class="line"><span class="title class_">Product</span>.<span class="title function_">findOneAndUpdate</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Bike Helmet&quot;</span>&#125;, &#123;<span class="attr">price</span>: <span class="number">99</span>&#125;, &#123;<span class="attr">new</span>:<span class="literal">true</span>, <span class="attr">runValidators</span>: <span class="literal">true</span>&#125; )</span><br><span class="line">	.<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;IT WORKED!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">	.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ERROR!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="model-instance-method"><a href="#model-instance-method" class="headerlink" title="model instance method"></a>model instance method</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">productSchema.<span class="property">methods</span>.<span class="property">toggleOnSale</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">onSale</span> = !<span class="variable language_">this</span>.<span class="property">onSale</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">save</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">findProduct</span> = <span class="keyword">async</span>(<span class="params"></span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> foundProduct = <span class="keyword">await</span> <span class="title class_">Product</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;hhh&quot;</span>&#125;);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(foundProduct);</span><br><span class="line">    <span class="keyword">await</span> foundProduct.<span class="title function_">toggleOnSale</span>();</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(foundProduct);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="model-static-method"><a href="#model-static-method" class="headerlink" title="model static method"></a>model static method</h3><p><strong>fancy ways of CRUD</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">productSchema.<span class="property">statics</span>.<span class="property">fireSale</span>=<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="virtuals"><a href="#virtuals" class="headerlink" title="virtuals"></a>virtuals</h3><ul>
<li><p>behave as if it is a virtual property</p>
</li>
<li><p>not in Mongo database, but only in JS</p>
</li>
<li><p>get</p>
</li>
<li><p>set</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> personSchema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">first</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">last</span>:<span class="title class_">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">personSchema.<span class="title function_">virtual</span>(<span class="string">&quot;fullName&quot;</span>).<span class="title function_">get</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.first&#125;</span> <span class="subst">$&#123;<span class="variable language_">this</span>.last&#125;</span>`</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Person</span> = mongoose.<span class="title function_">model</span>(<span class="string">&quot;Person&quot;</span>, personSchema);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tammy = <span class="keyword">new</span> <span class="title class_">Person</span>(&#123;<span class="attr">first</span>:<span class="string">&quot;Tammy&quot;</span>, <span class="attr">last</span>:<span class="string">&quot;Chow&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tammy.<span class="property">fullName</span>)</span><br><span class="line">                                            </span><br></pre></td></tr></table></figure>





<h3 id="middleware"><a href="#middleware" class="headerlink" title="middleware"></a>middleware</h3><p>do things before and after something(CRUD)</p>
<ul>
<li>pre hook</li>
<li>post hook</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">personSchema.<span class="title function_">pre</span>(<span class="string">&quot;save&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">first</span>=<span class="string">&quot;first&quot;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">last</span>=<span class="string">&quot;last&quot;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;ABOUT TO SAVE!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">personSchema.<span class="title function_">post</span>(<span class="string">&quot;save&quot;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;JUST SAVED!!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="18-Express-Middleware"><a href="#18-Express-Middleware" class="headerlink" title="18.Express Middleware"></a>18.Express Middleware</h2><ul>
<li>Express middleware are functions that run during the req&#x2F;res lifecycle.</li>
<li>Middleware can end the HTTP request by sending back a response with methods like res.send()</li>
<li>OR middleware can be chained together, one afte another by calling next()</li>
</ul>
<h3 id="morgan"><a href="#morgan" class="headerlink" title="morgan"></a>morgan</h3><p>logger</p>
<p>npm i morgan</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> morgan=<span class="built_in">require</span>(<span class="string">&quot;morgan&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//app.use 		whenever a request comes in</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;HIJACKED BY MY APP.USE()&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">morgan</span>(<span class="string">&quot;tiny&quot;</span>))	<span class="comment">//inject in the middle</span></span><br><span class="line"><span class="comment">//app.use(morgan(&quot;common&quot;))</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY FIRST MIDDLEWARE&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY FIRST MIDDLEWARE - AFTER CALLING NEXT()&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY SECOND MIDDLEWARE&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//to make sure nothing happens after next, return next</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY FIRST MIDDLEWARE&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">next</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;THIS IS MY FIRST MIDDLEWARE - AFTER CALLING NEXT()&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    req.<span class="property">method</span>=<span class="string">&quot;GET&quot;</span></span><br><span class="line">    req.<span class="property">requestTime</span>=<span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">path</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;password&#125;=req.<span class="property">query</span></span><br><span class="line">    <span class="keyword">if</span>(password===<span class="string">&quot;chickennugget&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;SORRY YOU NEED A PASSWORD!!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/secret&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">send</span>(<span class="string">&quot;NOT FOUND!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">verifyPassword</span>=(<span class="params">req,res,next</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;password&#125;=req.<span class="property">query</span></span><br><span class="line">    <span class="keyword">if</span>(password===<span class="string">&quot;chickennugget&quot;</span>)&#123;</span><br><span class="line">        <span class="title function_">next</span>()</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;SORRY YOU NEED A PASSWORD!!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//can have multiple callbacks</span></span><br><span class="line"><span class="comment">//not all callbacks will necessarily be executed</span></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/secret&quot;</span>,verifyPassword,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;My secret:   &quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3 id="ejs-mate"><a href="#ejs-mate" class="headerlink" title="ejs -mate"></a>ejs -mate</h3><h4 id="basic-index"><a href="#basic-index" class="headerlink" title="basic index"></a>basic index</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;% layout(&quot;layouts/boilerplate&quot;) %&gt;</span><br><span class="line">&lt;h1&gt;All Campgrounds&lt;/h1&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;a href=&quot;/campgrounds/new&quot;&gt;Add Campground&lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">  &lt;% for( let campground of campgrounds ) &#123; %&gt;</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">    &lt;a href=&quot;/campgrounds/&lt;%= campground._id %&gt; &quot;&gt;</span><br><span class="line">      &lt;%=campground.title %&gt;</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">  &lt;% &#125; %&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>





<h4 id="basic-new"><a href="#basic-new" class="headerlink" title="basic new"></a>basic new</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;% layout(&quot;layouts/boilerplate&quot;) %&gt;</span><br><span class="line">&lt;form action=&quot;/campgrounds&quot; method=&quot;post&quot;&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label for=&quot;title&quot;&gt;Title&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;title&quot; name=&quot;campground[title]&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label for=&quot;location&quot;&gt;Location&lt;/label&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; id=&quot;location&quot; name=&quot;campground[location]&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;button&gt;Add Campground&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;a href=&quot;/campgrounds&quot;&gt;Back&lt;/a&gt;</span><br></pre></td></tr></table></figure>



<h4 id="basic-show"><a href="#basic-show" class="headerlink" title="basic show"></a>basic show</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;</span><br><span class="line">  &lt;%= campground.title %&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;h2&gt;</span><br><span class="line">  &lt;%= campground.location %&gt;</span><br><span class="line">&lt;/h2&gt;</span><br><span class="line">&lt;img src=&quot;&lt;%= campground.image %&gt; &quot; alt=&quot;&quot;&gt;</span><br><span class="line">&lt;p&gt;&lt;%= campground.description  %&gt; &lt;/p&gt;</span><br><span class="line">&lt;p&gt;&lt;a href=&quot;/campgrounds/&lt;%= campground._id %&gt;/edit &quot;&gt;Edit&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">&lt;form action=&quot;/campgrounds/&lt;%= campground._id %&gt;?_method=DELETE&quot; method=&quot;post&quot;&gt;</span><br><span class="line">  &lt;button&gt;Delete Campground&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;footer&gt;</span><br><span class="line">  &lt;p&gt;&lt;a href=&quot;/campgrounds&quot;&gt;All Campgrounds&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;/footer&gt;</span><br></pre></td></tr></table></figure>





<h3 id="error-handling"><a href="#error-handling" class="headerlink" title="error-handling"></a>error-handling</h3><ul>
<li>next()        calling next non-error-handling middleware</li>
<li>next(err)   calling next(default) error-handling middleware</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//custom error handling middleware</span></span><br><span class="line"><span class="comment">//if custom error handler is defined, the default one will no longer work, except we add next(err)</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">err,req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=======ERROR========&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;====================&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err)</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&quot;OH BOY, WE GOT AN ERROR!!&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>(err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="19-Mongo-Relationships"><a href="#19-Mongo-Relationships" class="headerlink" title="19. Mongo Relationships"></a>19. Mongo Relationships</h2><h3 id="SQL-relationships-tables"><a href="#SQL-relationships-tables" class="headerlink" title="SQL relationships        tables!"></a>SQL relationships        tables!</h3><ul>
<li>one-to-many<ul>
<li>primary key     User[id]</li>
<li>foreign key      Post[user_id]</li>
</ul>
</li>
<li>many-to-many<ul>
<li>a third table</li>
<li>Movie[id], Actor[id]</li>
<li>Role[movie_id,actor_id]</li>
</ul>
</li>
</ul>
<h3 id="One-to-Few"><a href="#One-to-Few" class="headerlink" title="One to Few"></a>One to Few</h3><ul>
<li><p>example: users&#x2F;accounts &#x3D;&gt; addresses</p>
</li>
<li><p>embed the data directly in the document</p>
</li>
<li><p>mongo add a new _id for each document&#x2F;schema</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">first</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">last</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">addresses</span>:[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//by default, each address will also have a _id</span></span><br><span class="line">            <span class="comment">//can be turned off</span></span><br><span class="line">            <span class="attr">_id</span>: &#123;<span class="attr">id</span>: <span class="literal">false</span>&#125;,</span><br><span class="line">            <span class="attr">street</span>: <span class="title class_">String</span>,</span><br><span class="line">            <span class="attr">city</span>: <span class="title class_">String</span>,</span><br><span class="line">            <span class="attr">state</span>: <span class="title class_">String</span>,</span><br><span class="line">            <span class="attr">country</span>: <span class="title class_">String</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="One-to-Many"><a href="#One-to-Many" class="headerlink" title="One to Many"></a>One to Many</h3><ul>
<li>store refenrences(object id) to document inside the parent</li>
<li>similar to SQL one-to-many</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> productSchema=<span class="keyword">new</span> mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">price</span>: <span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">season</span>:&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">        <span class="attr">enum</span>: [<span class="string">&quot;Spring&quot;</span>,<span class="string">&quot;Summer&quot;</span>,<span class="string">&quot;Fall&quot;</span>,<span class="string">&quot;Autumn&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Product</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;Product&quot;</span>,productSchema);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Product</span>.<span class="title function_">insertMany</span>([</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">&quot;Goddess Melon&quot;</span>,<span class="attr">price</span>: <span class="number">4.99</span>,<span class="attr">season</span>:<span class="string">&quot;Summer&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">&quot;Sugar Baby Melon&quot;</span>,<span class="attr">price</span>: <span class="number">4.99</span>,<span class="attr">season</span>:<span class="string">&quot;Summer&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>:<span class="string">&quot;Asparagus&quot;</span>,<span class="attr">price</span>: <span class="number">3.99</span>,<span class="attr">season</span>:<span class="string">&quot;Spring&quot;</span>&#125;</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">//const Schema=mongoose.Schema;</span></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="title class_">Schema</span>&#125;=mongoose;</span><br><span class="line"><span class="comment">//the ref option tells Mongoose which model to use during population, or the name of the model we are referencing</span></span><br><span class="line"><span class="keyword">const</span> farmSchema=<span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">city</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">products</span>:[&#123;<span class="attr">type</span>: <span class="title class_">Schema</span>.<span class="property">Types</span>.<span class="property">ObjectId</span>, <span class="attr">ref</span>: <span class="string">&quot;Product&quot;</span>&#125;]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Farm</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;Farm&quot;</span>,farmSchema);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> farm=<span class="keyword">new</span> <span class="title class_">Farm</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Fully Belly Farms&quot;</span>, <span class="attr">city</span>: <span class="string">&quot;Guinda, CA&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> melon1=<span class="title class_">Product</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Goddess Melon&quot;</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> melon2=<span class="title class_">Product</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Asparagus&quot;</span>&#125;);</span><br><span class="line"><span class="comment">//not pushing the entire object, but just the id</span></span><br><span class="line">farm.<span class="property">products</span>.<span class="title function_">push</span>(melon1);</span><br><span class="line">farm.<span class="property">products</span>.<span class="title function_">push</span>(melon2);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Farm</span>.<span class="title function_">findOne</span>(&#123;<span class="attr">name</span>: <span class="string">&quot;Fully Belly Farms&quot;</span>&#125;)</span><br><span class="line">    .<span class="title function_">populate</span>(<span class="string">&quot;products&quot;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">farm</span>=&gt;</span><span class="variable language_">console</span>.<span class="title function_">log</span>(farm))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="One-to-Bajillions"><a href="#One-to-Bajillions" class="headerlink" title="One to Bajillions"></a>One to Bajillions</h3><ul>
<li><p>example: users &#x3D;&gt; tweets</p>
</li>
<li><p>store reference to parent in child</p>
</li>
<li><p>ref: Model</p>
</li>
<li><p>populate: field</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userSchema=<span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">username</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">age</span>:<span class="title class_">Number</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tweetSchema=<span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">    <span class="attr">text</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">likes</span>:<span class="title class_">Number</span>,</span><br><span class="line">    <span class="attr">user</span>:&#123;<span class="attr">type</span>:<span class="title class_">Schema</span>.<span class="property">Type</span>.<span class="property">ObjectId</span>, <span class="attr">ref</span>:<span class="string">&quot;User&quot;</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;User&quot;</span>,userSchema)</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Tweet</span>=mongoose.<span class="title function_">model</span>(<span class="string">&quot;Tweet&quot;</span>,tweetSchema)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(&#123;<span class="attr">name</span>:<span class="string">&quot;chickenfan99&quot;</span>,<span class="attr">age</span>:<span class="number">63</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> tweet1=<span class="keyword">new</span> <span class="title class_">Tweet</span>(&#123;<span class="attr">text</span>:<span class="string">&quot;omg I love my chicken family!&quot;</span>, <span class="attr">likes</span>:<span class="number">0</span>&#125;);</span><br><span class="line">tweet1.<span class="property">user</span>=user;</span><br><span class="line">user.<span class="title function_">save</span>();</span><br><span class="line">tweet1.<span class="title function_">save</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//populate: name of the field, not name of the model</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Tweet</span>.<span class="title function_">findOne</span>(&#123;&#125;).<span class="title function_">populate</span>(<span class="string">&quot;user&quot;</span>))</span><br><span class="line"><span class="comment">//only want user.username</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Tweet</span>.<span class="title function_">findOne</span>(&#123;&#125;).<span class="title function_">populate</span>(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;username&quot;</span>))</span><br></pre></td></tr></table></figure>



<h3 id="paradox-of-choice-rule-of-thumb"><a href="#paradox-of-choice-rule-of-thumb" class="headerlink" title="paradox of choice: rule of thumb"></a>paradox of choice: rule of thumb</h3><ul>
<li>favor embedding unless there is compelling reason not to</li>
<li>needing to access an object on its own is a compelling reason not to embed it </li>
<li>Arrays should not grow without bound.</li>
<li>Don’t be afraid of application-level joins.</li>
<li>Consider the write&#x2F;read ratio when denormalizing.<ul>
<li>denormal: duplicate and store some requently accessed field together with objectId</li>
</ul>
</li>
<li>As always with MongoDB, how you model your data depends - entirely - on your particular application’s data access patterns.<ul>
<li>query?</li>
<li>update?</li>
</ul>
</li>
</ul>
<h3 id="deletion-mongoose-middleware"><a href="#deletion-mongoose-middleware" class="headerlink" title="deletion mongoose middleware"></a>deletion mongoose middleware</h3><ul>
<li>query middleware</li>
<li>document middleware</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//before &quot;findByIdAndDelete&quot;, have no access to data deleted</span></span><br><span class="line">farmSchema.<span class="title function_">pre</span>(<span class="string">&quot;findOneAndDelete&quot;</span>,<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;PRE MIDDLEWARE&quot;</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//after &quot;findByIdAndDelete&quot;, have access to data deleted</span></span><br><span class="line">farmSchema.<span class="title function_">post</span>(<span class="string">&quot;findOneAndDelete&quot;</span>,<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">farm</span>)&#123;</span><br><span class="line">    <span class="comment">//console.log(&quot;POST MIDDLEWARE&quot;)</span></span><br><span class="line">    <span class="comment">//console.log(data)</span></span><br><span class="line">    <span class="keyword">if</span>(farm.<span class="property">products</span>.<span class="property">length</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> res =<span class="keyword">await</span> <span class="title class_">Product</span>.<span class="title function_">deleteMany</span>(&#123;<span class="attr">_id</span>:&#123;<span class="attr">$in</span>: farm.<span class="property">products</span>&#125;&#125;)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(res)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="20-express-router"><a href="#20-express-router" class="headerlink" title="20. express router"></a>20. express router</h2><ul>
<li><p>better handle nested routes</p>
</li>
<li><p>separate and group different routes</p>
</li>
<li><p>assign middlewares to specific groups</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> router=express.<span class="title class_">Router</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//middleware</span></span><br><span class="line">router.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">query</span>.<span class="property">isAdmin</span>)&#123;</span><br><span class="line">        <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;SORRY NOT AN ADMIN!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//router.get(&quot;/shelters&quot;,(req,res)=&gt;&#123;</span></span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//router.post(&quot;/shelters&quot;,(req,res)=&gt;&#123;</span></span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/shelters/:id&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/:id&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//router.get(&quot;/shelters/:id/edit&quot;,(req,res)=&gt;&#123;</span></span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/:id/edit&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>=router</span><br></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> app=<span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> shelterRoutes=<span class="built_in">require</span>(<span class="string">&quot;./routes/shelters&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//app.use(&quot;/&quot;,shelterRoutes)</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/shelters&quot;</span>,shelterRoutes)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Serving app on localhost:3000&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="21-http-cookies"><a href="#21-http-cookies" class="headerlink" title="21. http cookies"></a>21. http cookies</h2><ul>
<li><strong>cookies</strong> are little bits of information that are stored in a user’s browser when browsing a particular website</li>
<li>once a <strong>cookie</strong> is set, a user’s browser will send the cookie on every subsequent request to the site</li>
<li><strong>cookies</strong> add some <strong>“statefulness”</strong> to HTTP , between requests</li>
</ul>
<h3 id="send-cookies"><a href="#send-cookies" class="headerlink" title="send cookies"></a>send cookies</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/setname&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;steve chicks&quot;</span>);</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;OK SENT YOU A COOKIE!!&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="cookie-parser-middleware"><a href="#cookie-parser-middleware" class="headerlink" title="cookie parser middleware"></a>cookie parser middleware</h3><p>npm i cookie-parser</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cookieParser=<span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>())</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/greet&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//console.log(req.cookies)</span></span><br><span class="line">    <span class="keyword">const</span> &#123;name=<span class="string">&quot;No-name&quot;</span>&#125; = req.<span class="property">cookies</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`HEY THERE, <span class="subst">$&#123;name&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="signed-cookie"><a href="#signed-cookie" class="headerlink" title="signed cookie:"></a>signed cookie:</h3><h4 id="signed"><a href="#signed" class="headerlink" title="signed?"></a>signed?</h4><ul>
<li>analogy: old wax seal on letter, proving its <strong>validity&#x2F;integrity</strong></li>
<li>analogy: seal on peanut butter jar, if it’s broken, don’t eat it</li>
<li>is way to make sure it is not tampered with, not to make it a secret&#x2F;encrypted!!</li>
</ul>
<h4 id="basic-idea"><a href="#basic-idea" class="headerlink" title="basic idea:"></a>basic idea:</h4><ol>
<li>server send signed cookie to client</li>
<li>client send plain cookie to server on every request</li>
<li>client able to tell whether the cookie has been tampered with</li>
</ol>
<p>​        cookie-parser</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cookieParser=<span class="built_in">require</span>(<span class="string">&quot;cookie-parser&quot;</span>)</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>(<span class="string">&quot;thisismysecret&quot;</span>))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/getsignedcookie&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&quot;fruit&quot;</span>,<span class="string">&quot;grape&quot;</span>,&#123;<span class="attr">signed</span>: <span class="literal">true</span>&#125;)</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;sent you a signed cookie!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/verifyfruit&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">cookies</span>)	<span class="comment">//won&#x27;t contain signed cookie</span></span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">signedCookies</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h4 id="HMAC"><a href="#HMAC" class="headerlink" title="HMAC"></a>HMAC</h4><p><strong>Hash-based Message Authentication Code</strong></p>
<p>hashing function: SHA256</p>
<h2 id="22-session"><a href="#22-session" class="headerlink" title="22. session"></a>22. session</h2><ul>
<li><p>server side data store to make requests somewhat <strong>stateful</strong></p>
</li>
<li><p>example: shopping cart</p>
<ol>
<li>session contains the whole shopping carts of different id’s</li>
<li>cookie only contains the session id, <strong>connect.sid</strong></li>
</ol>
</li>
<li><p>server send back the session id as cookie</p>
</li>
<li><p>default store: <strong>MemoryStore</strong></p>
<p>when restart the browser, everything is reset</p>
</li>
<li><p>impermenant data store: Redis</p>
</li>
</ul>
<h3 id="why-not-cookie"><a href="#why-not-cookie" class="headerlink" title="why not cookie?"></a>why not cookie?</h3><ol>
<li>limited size</li>
<li>insecure</li>
</ol>
<h3 id="express-session"><a href="#express-session" class="headerlink" title="express-session"></a>express-session</h3><p>npm i express-session</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express=<span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> app=<span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> session=<span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">session</span>(&#123;<span class="attr">secret</span>: <span class="string">&quot;thisisnotagoodsecret&quot;</span>, <span class="attr">resave</span>: <span class="literal">false</span>, <span class="attr">saveUninitialized</span>: <span class="literal">false</span>&#125;))</span><br><span class="line"><span class="comment">//send back a signed cookie: connect.sid</span></span><br><span class="line"><span class="comment">//to the browser</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/viewcount&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.<span class="property">session</span>.<span class="property">count</span>)&#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">count</span>+=<span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">count</span>=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`YOU HAVE VIEWED THIS PAGE <span class="subst">$&#123;req.session.count&#125;</span> TIMES`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/register&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;username=<span class="string">&quot;Anonymous&quot;</span>&#125; = req.<span class="property">query</span>;</span><br><span class="line">    req.<span class="property">session</span>.<span class="property">username</span>=username;</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&quot;/greet&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/greet&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;username&#125; = req.<span class="property">session</span>;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">`Welcome back, <span class="subst">$&#123;username&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Serving app on localhost:3000&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="connect-flash"><a href="#connect-flash" class="headerlink" title="connect-flash"></a>connect-flash</h3><ul>
<li>after some action (create, delete, log in)</li>
<li>before redirection</li>
<li>depends on session</li>
</ul>
<p>npm i connect-flash</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> flash=<span class="built_in">require</span>(<span class="string">&quot;connect-flash&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">flash</span>())</span><br></pre></td></tr></table></figure>



<p>with the flash middleware in place, all requests will have a req.flash() function that can be used to flash messages</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//(key, value), stored in session</span></span><br><span class="line"><span class="comment">//before redirect</span></span><br><span class="line">req.<span class="title function_">flash</span>(<span class="string">&quot;info&quot;</span>,<span class="string">&quot;information I want to flash&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//when I want to use it, in the redirected page</span></span><br><span class="line">res.<span class="title function_">render</span>(<span class="string">&quot;index&quot;</span>,&#123;<span class="attr">messages</span>:req.<span class="title function_">flash</span>(<span class="string">&quot;info&quot;</span>)&#125;)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= messages %&gt;</span><br></pre></td></tr></table></figure>



<h3 id="improvement-using-res-locals"><a href="#improvement-using-res-locals" class="headerlink" title="improvement using res.locals"></a>improvement using res.locals</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req,res,next</span>)=&gt;</span>&#123;</span><br><span class="line">    res.<span class="property">locals</span>.<span class="property">messages</span>=req.<span class="title function_">flash</span>(<span class="string">&quot;success&quot;</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h2 id="23-Authentication-amp-Authorization"><a href="#23-Authentication-amp-Authorization" class="headerlink" title="23. Authentication &amp; Authorization"></a>23. Authentication &amp; Authorization</h2><ul>
<li><p>authentication is the process of verifying <strong>who a particular user is</strong></p>
<ol>
<li>username&#x2F;password combo</li>
<li>security questions</li>
<li>facial recognition</li>
</ol>
</li>
<li><p>authorization is verifying <strong>what a specific user has access to</strong></p>
<p>“Now that we know who you are, here is what you are allowed to do and NOT allowed to do”</p>
</li>
</ul>
<h3 id="NEVER-STORE-PASSWORDS"><a href="#NEVER-STORE-PASSWORDS" class="headerlink" title="NEVER STORE PASSWORDS"></a>NEVER STORE PASSWORDS</h3><ul>
<li>Rather than storing a password in the database, wu run the password through a <strong>hashing function</strong> first and then store the result in the database</li>
</ul>
<h3 id="hashing-function"><a href="#hashing-function" class="headerlink" title="hashing function"></a>hashing function</h3><ul>
<li>functions that map input data of some <strong>arbitrary size</strong> to <strong>fixed-size</strong> output values</li>
</ul>
<h3 id="cryptographic-hash-functions"><a href="#cryptographic-hash-functions" class="headerlink" title="cryptographic hash functions"></a>cryptographic hash functions</h3><ul>
<li><strong>one-way function</strong> which is infeasible to invert</li>
</ul>
<p>​       unable to get the input from the output</p>
<ul>
<li><p>small change in input yields large change in the output</p>
</li>
<li><p><strong>deterministic</strong>: same input yields same output</p>
</li>
<li><p>unlikely to find 2 outputs with same value</p>
<p>collisions are rare</p>
</li>
<li><p>password hash functions are <strong>deliberately slow</strong></p>
</li>
</ul>
<h3 id="password-salts"><a href="#password-salts" class="headerlink" title="password salts"></a>password salts</h3><ul>
<li><p>an extra safeguard</p>
</li>
<li><p>facts:</p>
<ol>
<li>people use same passwords from one site to the next frequently</li>
<li>people in general, use the same passwords from one person to the next</li>
</ol>
</li>
<li><p>if hackers know the hash fuction is Bcrypt ahead of time, they can precompute, trying every common password</p>
</li>
<li><p>password salts:</p>
<pre><code>1. A salt is a **random value** added to the password before we hash it.
   + append
   + prepend
</code></pre>
<ol>
<li>It helps ensure unique hashes and mitigate common attacks.</li>
</ol>
</li>
</ul>
<h3 id="Bcrypt"><a href="#Bcrypt" class="headerlink" title="Bcrypt"></a>Bcrypt</h3><ul>
<li><p>saltRounds: difficulty, amoun of time to hash</p>
<p>recommended around 12</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bcrypt=<span class="built_in">require</span>(<span class="string">&quot;bcrypt&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">hashPassword</span>=<span class="keyword">async</span>(<span class="params">pw</span>)=&gt;&#123;</span><br><span class="line">    <span class="comment">//const salt=await bcrypt.genSalt(10);</span></span><br><span class="line">    <span class="comment">//const hash=await bcrypt.hash(pw,salt);</span></span><br><span class="line">    <span class="comment">//console.log(salt)</span></span><br><span class="line">    <span class="keyword">const</span> hash=<span class="keyword">await</span> bcrypt.<span class="title function_">hash</span>(pw,<span class="number">10</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(hash)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">login</span>=<span class="keyword">async</span>(<span class="params">pw,hashedPassword</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> result=<span class="keyword">await</span> bcrypt.<span class="title function_">compare</span>(pw,hashedPassword)</span><br><span class="line">    <span class="keyword">if</span>(result)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;LOGGED IN !!&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;INCORRECT&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">hashPassword</span>(<span class="string">&quot;monkey&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="use-session-to-log-in-x2F-out"><a href="#use-session-to-log-in-x2F-out" class="headerlink" title="use session to log in&#x2F;out"></a>use session to log in&#x2F;out</h3><p>On an incoming http request, Express middleware that supports the session checks a particular client cookie and if that particular cookie is found on the http request and is found in the global session object&#x2F;database, then it adds that session’s stored info to the request object for the http request handler to later use.</p>
<p>So, here’s a typical sequence:</p>
<ol>
<li>Incoming HTTP request.</li>
<li>Middleware checks for session cookie.</li>
<li>If session cookie not there, then create one and, in the process created a unique id to identify this http client.</li>
<li>In the persistent session store, initialize the session for this new client.</li>
<li>If session cookie is there, then look in the session store for the session data for this client and add that data to the request object.</li>
<li>End of session middleware processing</li>
<li>Later on in the Express processing of this http request, it gets to a matching request handler. The session data from the session store for this particular http client is already attached to the request object and available for the request handler to use.</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>,<span class="title function_">async</span>(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;username,password&#125;=req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123;username&#125;)</span><br><span class="line">    <span class="keyword">const</span> validPassword=<span class="keyword">await</span> bcrypt.<span class="title function_">compare</span>(password,user.<span class="property">password</span>)</span><br><span class="line">    <span class="keyword">if</span>(validPassword)&#123;</span><br><span class="line">        req.<span class="property">session</span>.<span class="property">user_id</span>=user.<span class="property">_id</span></span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;YAY WELCOME!!&quot;</span>)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        res.<span class="title function_">send</span>(<span class="string">&quot;TRY AGAIN&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&quot;/secret&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!req.<span class="property">session</span>.<span class="property">user_id</span>)&#123;</span><br><span class="line">        res.<span class="title function_">redierct</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    res.<span class="title function_">send</span>(<span class="string">&quot;This is a secret for logged in users!!&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;logout&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//req.session.user_id=null;</span></span><br><span class="line">    req.<span class="property">session</span>.<span class="title function_">destroy</span>(); <span class="comment">//destroy the entire session</span></span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>





<h3 id="refactor-to-model-methods"><a href="#refactor-to-model-methods" class="headerlink" title="refactor to model methods"></a>refactor to model methods</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">userSchema.<span class="property">statics</span>.<span class="property">findAndValidate</span>=<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">username,password</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> foundUser=<span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">findOne</span>(&#123;username&#125;)</span><br><span class="line">    <span class="keyword">const</span> isValid=<span class="keyword">await</span> bcrypt.<span class="title function_">compare</span>(password,foundUser.<span class="property">password</span>)</span><br><span class="line">    <span class="keyword">return</span> isValid ? foundUser : <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">userSchema.<span class="title function_">pre</span>(<span class="string">&quot;save&quot;</span>,<span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">next</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable language_">this</span>.<span class="title function_">isModified</span>(<span class="string">&quot;password&quot;</span>)) <span class="keyword">return</span> <span class="title function_">next</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">password</span>=<span class="keyword">await</span> bcrypt.<span class="title function_">hash</span>(<span class="variable language_">this</span>.<span class="property">password</span>,<span class="number">12</span>)</span><br><span class="line">    <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="24-image-upload"><a href="#24-image-upload" class="headerlink" title="24. image upload"></a>24. image upload</h2><ul>
<li>mongo document size limit: 16MB</li>
<li>GridFS</li>
</ul>
<ol>
<li>set up a form that would accept images</li>
<li>submit the form</li>
<li>store image data in Cloudinary</li>
<li>Cloudinary send back URLs</li>
<li>store URLs in mongo</li>
</ol>
<h3 id="Cloudinary"><a href="#Cloudinary" class="headerlink" title="Cloudinary"></a>Cloudinary</h3><ul>
<li>like AWS</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CLOUDINARY_CLOUD_NAME=</span><br><span class="line">CLOUDINARY_KEY=</span><br><span class="line">CLOUDINARY_SECRET=</span><br></pre></td></tr></table></figure>



<h3 id="enctype"><a href="#enctype" class="headerlink" title="enctype"></a>enctype</h3><ul>
<li><p>application&#x2F;x-www-form-urlencoded</p>
<p>default</p>
</li>
<li><p>multipart&#x2F;form-data</p>
<p>if the form contains file inputs</p>
</li>
</ul>
<h3 id="Multer"><a href="#Multer" class="headerlink" title="Multer"></a>Multer</h3><ol>
<li><p>first upload</p>
</li>
<li><p>then we can use req.body and req.file(s)</p>
</li>
</ol>
<p>in order to parse mutlipart form</p>
<ul>
<li><p>req.body</p>
<p>other information, except for the file</p>
</li>
<li><p>req.file</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multer=<span class="built_in">require</span>(<span class="string">&quot;multer&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> upload=<span class="title function_">multer</span>(&#123;<span class="attr">dest</span>:<span class="string">&quot;uploads/&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">route</span>(<span class="string">&quot;/&quot;</span>).<span class="title function_">post</span>(upload.<span class="title function_">single</span>(<span class="string">&quot;image&quot;</span>),<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>,req.<span class="property">file</span>)</span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">file</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">route</span>(<span class="string">&quot;/&quot;</span>).<span class="title function_">post</span>(upload.<span class="title function_">array</span>(<span class="string">&quot;image&quot;</span>),<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>,req.<span class="property">files</span>)</span><br><span class="line">    res.<span class="title function_">send</span>(req.<span class="property">files</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="dotenv"><a href="#dotenv" class="headerlink" title="dotenv"></a>dotenv</h3><ul>
<li>avoid embedding api credentials right inside applications</li>
<li>instead, store in .env files</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SECRET=lololololol</span><br><span class="line">API_KEY=fasdjfoiahfawe8</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !==<span class="string">&quot;production&quot;</span>)&#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>).<span class="title function_">config</span>()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(process.<span class="property">env</span>.<span class="property">SECRET</span>)</span><br></pre></td></tr></table></figure>





<h2 id="25-common-security-vulnerabilities"><a href="#25-common-security-vulnerabilities" class="headerlink" title="25. common security vulnerabilities"></a>25. common security vulnerabilities</h2><h3 id="database-injection"><a href="#database-injection" class="headerlink" title="database injection"></a>database injection</h3><ul>
<li><p>sql injection</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">; DROP TABLE user</span><br></pre></td></tr></table></figure>


</li>
<li><p>mongo injection</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.users.find(&#123;username:req.body.username&#125;)</span><br><span class="line">//</span><br><span class="line">db.users.find(&#123;username:&#123;&quot;$gt&quot;:&quot;&quot;&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Cross-Site-Scripting-XSS"><a href="#Cross-Site-Scripting-XSS" class="headerlink" title="Cross Site Scripting(XSS)"></a>Cross Site Scripting(XSS)</h3><p><a target="_blank" rel="noopener" href="https://xss-game.appspot.com/">https://xss-game.appspot.com/</a></p>
<h3 id="helmet"><a href="#helmet" class="headerlink" title="helmet"></a>helmet</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(</span><br><span class="line">    <span class="title function_">helmet</span>(&#123;</span><br><span class="line">        <span class="attr">contentSecurityPolicy</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">crossOriginEmbedderPolicy</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>





<h2 id="26-heroku"><a href="#26-heroku" class="headerlink" title="26. heroku"></a>26. heroku</h2><h3 id="heroku-CLI"><a href="#heroku-CLI" class="headerlink" title="heroku CLI"></a>heroku CLI</h3><p>command line interface</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">heroku git:remote -a &lt;name of the heroku app&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">heroku login</span><br><span class="line"></span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;new message&quot;</span><br><span class="line">git push heroku master</span><br><span class="line"></span><br><span class="line">heroku restart</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/28/Sentence-Similarity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/28/Sentence-Similarity/" class="post-title-link" itemprop="url">Sentence Similarity</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-28 17:50:20" itemprop="dateCreated datePublished" datetime="2022-11-28T17:50:20+08:00">2022-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-29 10:11:47" itemprop="dateModified" datetime="2022-11-29T10:11:47+08:00">2022-11-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Sentence-Similarity"><a href="#Sentence-Similarity" class="headerlink" title="Sentence Similarity"></a>Sentence Similarity</h1><h2 id="734-Sentence-Similarity"><a href="#734-Sentence-Similarity" class="headerlink" title="734. Sentence Similarity"></a>734. Sentence Similarity</h2><p>not transitive:</p>
<ul>
<li>HashSet</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">areSentencesSimilar</span><span class="params">(String[] sentence1, String[] sentence2, List&lt;List&lt;String&gt;&gt; similarPairs)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=sentence1.length;</span><br><span class="line">    <span class="keyword">if</span>(n!= sentence2.length)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    HashSet&lt;String&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (List&lt;String&gt; similarPair : similarPairs) &#123;</span><br><span class="line">        String a=similarPair.get(<span class="number">0</span>);</span><br><span class="line">        String b=similarPair.get(<span class="number">1</span>);</span><br><span class="line">        set.add(a+b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        String s1=sentence1[i];</span><br><span class="line">        String s2=sentence2[i];</span><br><span class="line">        <span class="keyword">if</span>(s1.equals(s2))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!set.contains(s1+s2) &amp;&amp; !set.contains(s2+s1))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="737-Sentence-Similarity-II"><a href="#737-Sentence-Similarity-II" class="headerlink" title="737. Sentence Similarity II"></a>737. Sentence Similarity II</h2><p>transitive: </p>
<ul>
<li>BFS search</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">areSentencesSimilarTwo</span><span class="params">(String[] sentence1, String[] sentence2, List&lt;List&lt;String&gt;&gt; similarPairs)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=sentence1.length;</span><br><span class="line">    <span class="keyword">if</span>(n!= sentence2.length)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, List&lt;String&gt;&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (List&lt;String&gt; similarPair : similarPairs) &#123;</span><br><span class="line">        String a=similarPair.get(<span class="number">0</span>);</span><br><span class="line">        String b=similarPair.get(<span class="number">1</span>);</span><br><span class="line">        map.putIfAbsent(a,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;());</span><br><span class="line">        map.get(a).add(b);</span><br><span class="line">        map.putIfAbsent(b,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;());</span><br><span class="line">        map.get(b).add(a);</span><br><span class="line">    &#125;</span><br><span class="line">    Deque&lt;String&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    Set&lt;String&gt; visited=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        String s1=sentence1[i];</span><br><span class="line">        String s2=sentence2[i];</span><br><span class="line">        <span class="keyword">if</span>(s1.equals(s2))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        q.clear();</span><br><span class="line">        visited.clear();</span><br><span class="line">        q.offer(s1);</span><br><span class="line">        <span class="type">boolean</span> found=<span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">            String cur=q.poll();</span><br><span class="line">            <span class="keyword">if</span>(cur.equals(s2))&#123;</span><br><span class="line">                found=<span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(map.containsKey(cur))&#123;</span><br><span class="line">                <span class="keyword">for</span> (String next : map.get(cur)) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(!visited.contains(next))&#123;</span><br><span class="line">                        q.offer(next);</span><br><span class="line">                        visited.add(next);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!found)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/27/BFS-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/27/BFS-2/" class="post-title-link" itemprop="url">BFS(2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-27 20:06:34" itemprop="dateCreated datePublished" datetime="2022-11-27T20:06:34+08:00">2022-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-28 12:08:48" itemprop="dateModified" datetime="2022-11-28T12:08:48+08:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>662</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="BFS选编（2）"><a href="#BFS选编（2）" class="headerlink" title="BFS选编（2）"></a>BFS选编（2）</h1><h2 id="733-Flood-Fill"><a href="#733-Flood-Fill" class="headerlink" title="733. Flood Fill"></a>733. Flood Fill</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] floodFill(<span class="type">int</span>[][] image, <span class="type">int</span> sr, <span class="type">int</span> sc, <span class="type">int</span> color) &#123;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> row=image.length;</span><br><span class="line">    <span class="type">int</span> col=image[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span> c=image[sr][sc];</span><br><span class="line">    <span class="type">int</span>[] dx=&#123;<span class="number">1</span>,-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="type">int</span>[] dy=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;sr,sc&#125;);</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">        <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(image[i][j]!=color)&#123;</span><br><span class="line">            image[i][j]=color;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>; k &lt; <span class="number">4</span>; k++) &#123;</span><br><span class="line">                <span class="type">int</span> x=i+dx[k];</span><br><span class="line">                <span class="type">int</span> y=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col</span><br><span class="line">                        &amp;&amp; image[x][y]==c)&#123;</span><br><span class="line">                    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> image;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/25/strobogrammatic-number/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/25/strobogrammatic-number/" class="post-title-link" itemprop="url">Strobogrammatic Number</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-25 18:53:52" itemprop="dateCreated datePublished" datetime="2022-11-25T18:53:52+08:00">2022-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-26 11:59:51" itemprop="dateModified" datetime="2022-11-26T11:59:51+08:00">2022-11-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Strobogrammatic-Number"><a href="#Strobogrammatic-Number" class="headerlink" title="Strobogrammatic Number"></a>Strobogrammatic Number</h1><p>A <strong>strobogrammatic number</strong> is a number that looks the same when rotated <code>180</code> degrees (looked at upside down).</p>
<h2 id="246-Strobogrammatic-Number"><a href="#246-Strobogrammatic-Number" class="headerlink" title="246. Strobogrammatic Number"></a>246. Strobogrammatic Number</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isStrobogrammatic</span><span class="params">(String num)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=num.length();</span><br><span class="line">    <span class="comment">//0 n-1</span></span><br><span class="line">    <span class="comment">//1 n-2</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= (n-<span class="number">1</span>)/<span class="number">2</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//0 1 8</span></span><br><span class="line">        <span class="comment">//6 9</span></span><br><span class="line">        <span class="type">char</span> c=num.charAt(i);</span><br><span class="line">        <span class="keyword">if</span>(c!=<span class="string">&#x27;0&#x27;</span> &amp;&amp; c!=<span class="string">&#x27;1&#x27;</span> &amp;&amp; c!=<span class="string">&#x27;8&#x27;</span> &amp;&amp; c!=<span class="string">&#x27;6&#x27;</span> &amp;&amp; c!=<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span> r=num.charAt(n-<span class="number">1</span>-i);</span><br><span class="line">        <span class="keyword">switch</span> (c)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;8&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;8&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;6&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">                <span class="keyword">if</span>(r!=<span class="string">&#x27;6&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="247-Strobogrammatic-Number-II"><a href="#247-Strobogrammatic-Number-II" class="headerlink" title="247. Strobogrammatic Number II"></a>247. Strobogrammatic Number II</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findStrobogrammatic</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    List&lt;String&gt; one= Arrays.asList(<span class="string">&quot;0&quot;</span>,<span class="string">&quot;1&quot;</span>,<span class="string">&quot;8&quot;</span>);</span><br><span class="line">    List&lt;String&gt; two=Arrays.asList(<span class="string">&quot;11&quot;</span>,<span class="string">&quot;69&quot;</span>,<span class="string">&quot;88&quot;</span>,<span class="string">&quot;96&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> one;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">2</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> two;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;String&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> t=n/<span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> o=n%<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(o==<span class="number">0</span>)&#123;</span><br><span class="line">        build(res,two,<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;(),t);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String s : one) &#123;</span><br><span class="line">            LinkedList&lt;Character&gt; list=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">            list.add(s.charAt(<span class="number">0</span>));</span><br><span class="line">            build(res,two,list,t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">build</span><span class="params">(List&lt;String&gt; res, List&lt;String&gt; two, LinkedList&lt;Character&gt; list, <span class="type">int</span> t)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(t==<span class="number">0</span>)&#123;</span><br><span class="line">        StringBuilder sb=<span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (Character c : list) &#123;</span><br><span class="line">            sb.append(c);</span><br><span class="line">        &#125;</span><br><span class="line">        res.add(sb.toString());</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(t!=<span class="number">1</span>)&#123;</span><br><span class="line">        list.addFirst(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        list.addLast(<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        build(res,two,list,t-<span class="number">1</span>);</span><br><span class="line">        list.removeFirst();</span><br><span class="line">        list.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String s : two) &#123;</span><br><span class="line">        list.addFirst(s.charAt(<span class="number">0</span>));</span><br><span class="line">        list.addLast(s.charAt(<span class="number">1</span>));</span><br><span class="line">        build(res,two,list,t-<span class="number">1</span>);</span><br><span class="line">        list.removeFirst();</span><br><span class="line">        list.removeLast();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="248-Strobogrammatic-Number-III"><a href="#248-Strobogrammatic-Number-III" class="headerlink" title="248. Strobogrammatic Number III"></a>248. Strobogrammatic Number III</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span>[][] PAIRS = <span class="keyword">new</span> <span class="title class_">char</span>[][] &#123;</span><br><span class="line">    &#123;<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span>&#125;, &#123;<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>&#125;, &#123;<span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;9&#x27;</span>&#125;, &#123;<span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;8&#x27;</span>&#125;, &#123;<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;6&#x27;</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strobogrammaticInRange</span><span class="params">(String low, String high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (low == <span class="literal">null</span> || high == <span class="literal">null</span> || low.length() &gt; high.length()</span><br><span class="line">        || (low.length() == high.length() &amp;&amp; low.compareTo(high) &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> low.length(); len &lt;= high.length(); len++) &#123;</span><br><span class="line">        count += dfs(low, high, <span class="keyword">new</span> <span class="title class_">char</span>[len], <span class="number">0</span>, len - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(String low, String high, <span class="type">char</span>[] ch, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (left &gt; right) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(ch);</span><br><span class="line">        <span class="keyword">if</span> ((ch.length == low.length() &amp;&amp; s.compareTo(low) &lt; <span class="number">0</span>)</span><br><span class="line">            || (ch.length == high.length() &amp;&amp; s.compareTo(high) &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span>[] p : PAIRS) &#123;</span><br><span class="line">        ch[left] = p[<span class="number">0</span>];</span><br><span class="line">        ch[right] = p[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (ch.length != <span class="number">1</span> &amp;&amp; ch[<span class="number">0</span>] == <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>; <span class="comment">//don&#x27;t start with 0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (left == right &amp;&amp; (p[<span class="number">0</span>] == <span class="string">&#x27;6&#x27;</span> || p[<span class="number">0</span>] == <span class="string">&#x27;9&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">continue</span>; <span class="comment">//don&#x27;t put 6/9 at the middle of string.</span></span><br><span class="line">        &#125;</span><br><span class="line">        count += dfs(low, high, ch, left + <span class="number">1</span>, right - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span>[][] PAIRS=<span class="keyword">new</span> <span class="title class_">char</span>[][]&#123;</span><br><span class="line">        &#123;<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;0&#x27;</span>&#125;,&#123;<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>&#125;,&#123;<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;9&#x27;</span>&#125;,&#123;<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;8&#x27;</span>&#125;,&#123;<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;6&#x27;</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strobogrammaticInRange</span><span class="params">(String low, String high)</span> &#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=low.length(); i&lt;=high.length(); i++)&#123;</span><br><span class="line">        res+=dfs(low,high,<span class="keyword">new</span> <span class="title class_">char</span>[i],<span class="number">0</span>,i-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">dfs</span><span class="params">(String low, String high, <span class="type">char</span>[] chars, <span class="type">int</span> left, <span class="type">int</span> right)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(left&gt;right)&#123;</span><br><span class="line">        String s=<span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">        <span class="keyword">if</span>(s.length()==low.length() &amp;&amp; s.compareTo(low)&lt;<span class="number">0</span></span><br><span class="line">                || s.length()==high.length() &amp;&amp;s.compareTo(high)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span>[] pair : PAIRS) &#123;</span><br><span class="line">        chars[left]=pair[<span class="number">0</span>];</span><br><span class="line">        chars[right]=pair[<span class="number">1</span>];</span><br><span class="line">        <span class="comment">//no leading zero</span></span><br><span class="line">        <span class="keyword">if</span>(chars[<span class="number">0</span>]==<span class="string">&#x27;0&#x27;</span> &amp;&amp; chars.length&gt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//no middle &#x27;6&#x27; or &#x27;9&#x27;</span></span><br><span class="line">        <span class="keyword">if</span>(left==right &amp;&amp; (chars[left]==<span class="string">&#x27;9&#x27;</span> || chars[left]==<span class="string">&#x27;6&#x27;</span>))&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        count+=dfs(low,high,chars,left+<span class="number">1</span>,right-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/25/shortest-word-distance/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/25/shortest-word-distance/" class="post-title-link" itemprop="url">Shortest Word Distance</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-25 18:19:47" itemprop="dateCreated datePublished" datetime="2022-11-25T18:19:47+08:00">2022-11-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-26 10:54:40" itemprop="dateModified" datetime="2022-11-26T10:54:40+08:00">2022-11-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Shortest-Word-Distance"><a href="#Shortest-Word-Distance" class="headerlink" title="Shortest Word Distance"></a>Shortest Word Distance</h1><h2 id="243-Shortest-Word-Distance"><a href="#243-Shortest-Word-Distance" class="headerlink" title="243. Shortest Word Distance"></a>243. Shortest Word Distance</h2><h3 id="法一："><a href="#法一：" class="headerlink" title="法一："></a>法一：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shortestDistance</span><span class="params">(String[] wordsDict, String word1, String word2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n= wordsDict.length;</span><br><span class="line">    List&lt;Integer&gt; list1=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    List&lt;Integer&gt; list2=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(wordsDict[i].equals(word1))&#123;</span><br><span class="line">            list1.add(i);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(wordsDict[i].equals(word2))&#123;</span><br><span class="line">            list2.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> res=Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (Integer a : list1) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Integer b : list2) &#123;</span><br><span class="line">            res=Math.min(res,Math.abs(a-b));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="法二："><a href="#法二：" class="headerlink" title="法二："></a>法二：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shortestWordDistance</span><span class="params">(String[] words, String word1, String word2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> words.length;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; words.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (words[i].equals(word1) || words[i].equals(word2)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (index != -<span class="number">1</span> &amp;&amp; !words[index].equals(words[i])) &#123;</span><br><span class="line">                min = Math.min(i - index, min);</span><br><span class="line">            &#125;</span><br><span class="line">            index = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> min;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="244-Shortest-Word-Distance-II"><a href="#244-Shortest-Word-Distance-II" class="headerlink" title="244. Shortest Word Distance II"></a>244. Shortest Word Distance II</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WordDistance</span> &#123;</span><br><span class="line"></span><br><span class="line">    HashMap&lt;String, List&lt;Integer&gt;&gt; map;</span><br><span class="line">    HashMap&lt;String,Integer&gt; res;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WordDistance</span><span class="params">(String[] wordsDict)</span> &#123;</span><br><span class="line">        map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        res=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> n= wordsDict.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            map.putIfAbsent(wordsDict[i],<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">            map.get(wordsDict[i]).add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shortest</span><span class="params">(String word1, String word2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(res.containsKey(word1+<span class="string">&quot;,&quot;</span>+word2))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.get(word1+<span class="string">&quot;,&quot;</span>+word2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(res.containsKey(word2+<span class="string">&quot;,&quot;</span>+word1))&#123;</span><br><span class="line">            <span class="keyword">return</span> res.get(word2+<span class="string">&quot;,&quot;</span>+word1);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; list1=map.get(word1);</span><br><span class="line">        List&lt;Integer&gt; list2=map.get(word2);</span><br><span class="line">        <span class="type">int</span> min=Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">for</span> (Integer a : list1) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Integer b : list2) &#123;</span><br><span class="line">                min=Math.min(min,Math.abs(a-b));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res.put(word1+<span class="string">&quot;,&quot;</span>+word2,min);</span><br><span class="line">        <span class="keyword">return</span> min;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="245-Shortest-Word-Distance-III"><a href="#245-Shortest-Word-Distance-III" class="headerlink" title="245. Shortest Word Distance III"></a>245. Shortest Word Distance III</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shortestWordDistance</span><span class="params">(String[] wordsDict, String word1, String word2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> n=wordsDict.length;</span><br><span class="line">    <span class="type">int</span> res=Integer.MAX_VALUE;</span><br><span class="line">    <span class="type">int</span> index=-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (wordsDict[i].equals(word1) || wordsDict[i].equals(word2)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(index!=-<span class="number">1</span> &amp;&amp; (word1.equals(word2) || !wordsDict[index].equals(wordsDict[i])))&#123;</span><br><span class="line">                res=Math.min(res,i-index);</span><br><span class="line">            &#125;</span><br><span class="line">            index=i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/14/DFS-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/14/DFS-2/" class="post-title-link" itemprop="url">DFS(2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-14 22:58:14" itemprop="dateCreated datePublished" datetime="2022-11-14T22:58:14+08:00">2022-11-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-28 12:08:37" itemprop="dateModified" datetime="2022-11-28T12:08:37+08:00">2022-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="DFS选编（2）"><a href="#DFS选编（2）" class="headerlink" title="DFS选编（2）"></a>DFS选编（2）</h1><h2 id="472-Concatenated-Words"><a href="#472-Concatenated-Words" class="headerlink" title="472. Concatenated Words"></a>472. Concatenated Words</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">findAllConcatenatedWordsInADict</span><span class="params">(String[] words)</span> &#123;</span><br><span class="line">    List&lt;String&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">        set.add(word);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; word.length()-<span class="number">1</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//[0,i]</span></span><br><span class="line">            <span class="keyword">if</span>(set.contains(word.substring(<span class="number">0</span>,i+<span class="number">1</span>))</span><br><span class="line">                    &amp;&amp; dfs(word,i+<span class="number">1</span>))&#123;</span><br><span class="line">                res.add(word);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(String s, <span class="type">int</span> start)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(start==s.length())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(set.contains(s.substring(start,i+<span class="number">1</span>)) &amp;&amp; dfs(s,i+<span class="number">1</span>))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="508-Most-Frequent-Subtree-Sum"><a href="#508-Most-Frequent-Subtree-Sum" class="headerlink" title="508. Most Frequent Subtree Sum"></a>508. Most Frequent Subtree Sum</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">  <span class="type">int</span> max=Integer.MIN_VALUE;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] findFrequentTreeSum(TreeNode root) &#123;</span><br><span class="line">    dfs(root);</span><br><span class="line">    List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Integer i : map.keySet()) &#123;</span><br><span class="line">        <span class="keyword">if</span>(map.get(i)==max)&#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span>[] res=<span class="keyword">new</span> <span class="title class_">int</span>[list.size()];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; res.length; i++) &#123;</span><br><span class="line">        res[i]=list.get(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">dfs</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> l=dfs(node.left);</span><br><span class="line">    <span class="type">int</span> r=dfs(node.right);</span><br><span class="line">    <span class="type">int</span> sum=l+r+node.val;</span><br><span class="line">    map.put(sum,map.getOrDefault(sum,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> freq=map.get(sum);</span><br><span class="line">    max=Math.max(max,freq);</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="529-Minesweeper"><a href="#529-Minesweeper" class="headerlink" title="529. Minesweeper"></a>529. Minesweeper</h2><p>注意adjacent的定义：</p>
<ul>
<li><code>&#39;B&#39;</code> represents a revealed blank square that has no adjacent mines (i.e., <strong>above, below, left, right, and all 4 diagonals</strong>)</li>
</ul>
<h3 id="DFS"><a href="#DFS" class="headerlink" title="DFS:"></a>DFS:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">    <span class="type">int</span> row;</span><br><span class="line">    <span class="type">int</span> col;</span><br><span class="line">    <span class="type">char</span>[][] board;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">char</span>[][] updateBoard(<span class="type">char</span>[][] board, <span class="type">int</span>[] click) &#123;</span><br><span class="line">        row=board.length;</span><br><span class="line">        col=board[<span class="number">0</span>].length;</span><br><span class="line">        <span class="built_in">this</span>.board=board;</span><br><span class="line">        <span class="type">int</span> i=click[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> j=click[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(board[i][j]==<span class="string">&#x27;M&#x27;</span>)&#123;</span><br><span class="line">            board[i][j]=<span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            dfs(i,j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> board;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* [[&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;],</span></span><br><span class="line"><span class="comment">        [&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;M&quot;],</span></span><br><span class="line"><span class="comment">        [&quot;E&quot;,&quot;E&quot;,&quot;M&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;],</span></span><br><span class="line"><span class="comment">        [&quot;M&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;],</span></span><br><span class="line"><span class="comment">        [&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;],</span></span><br><span class="line"><span class="comment">        [&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;],</span></span><br><span class="line"><span class="comment">        [&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;],</span></span><br><span class="line"><span class="comment">        [&quot;E&quot;,&quot;E&quot;,&quot;M&quot;,&quot;M&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;,&quot;E&quot;]]</span></span><br><span class="line"><span class="comment">[0,0]*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;<span class="number">0</span> || i&gt;=row || j&lt;<span class="number">0</span> || j&gt;=col || board[i][j]!=<span class="string">&#x27;E&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> x=i-<span class="number">1</span>; x&lt;=i+<span class="number">1</span>; x++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> y=j-<span class="number">1</span>; y&lt;=j+<span class="number">1</span>; y++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col &amp;&amp; board[x][y]==<span class="string">&#x27;M&#x27;</span>)&#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(count==<span class="number">0</span>)&#123;</span><br><span class="line">            board[i][j]=<span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">            dfs(i-<span class="number">1</span>,j-<span class="number">1</span>);</span><br><span class="line">            dfs(i-<span class="number">1</span>,j);</span><br><span class="line">            dfs(i-<span class="number">1</span>,j+<span class="number">1</span>);</span><br><span class="line">            dfs(i,j-<span class="number">1</span>);</span><br><span class="line">            dfs(i,j+<span class="number">1</span>);</span><br><span class="line">            dfs(i+<span class="number">1</span>,j-<span class="number">1</span>);</span><br><span class="line">            dfs(i+<span class="number">1</span>,j);</span><br><span class="line">            dfs(i+<span class="number">1</span>,j+<span class="number">1</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            board[i][j]=(<span class="type">char</span>)(<span class="string">&#x27;0&#x27;</span>+count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="BFS"><a href="#BFS" class="headerlink" title="BFS:"></a>BFS:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">char</span>[][] updateBoard(<span class="type">char</span>[][] board, <span class="type">int</span>[] click) &#123;</span><br><span class="line">    <span class="type">int</span> row=board.length;</span><br><span class="line">    <span class="type">int</span> col=board[<span class="number">0</span>].length;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span>(board[click[<span class="number">0</span>]][click[<span class="number">1</span>]]==<span class="string">&#x27;M&#x27;</span>)&#123;</span><br><span class="line">        board[click[<span class="number">0</span>]][click[<span class="number">1</span>]]=<span class="string">&#x27;X&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        q.offer(click);</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">            <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(board[i][j]!=<span class="string">&#x27;E&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> count=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> x=i-<span class="number">1</span>; x&lt;=i+<span class="number">1</span>; x++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> y=j-<span class="number">1</span>; y&lt;=j+<span class="number">1</span>; y++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col</span><br><span class="line">                            &amp;&amp; board[x][y]==<span class="string">&#x27;M&#x27;</span>)&#123;</span><br><span class="line">                        count++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(count==<span class="number">0</span>)&#123;</span><br><span class="line">                board[i][j]=<span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> x=i-<span class="number">1</span>; x&lt;=i+<span class="number">1</span>; x++)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="type">int</span> y=j-<span class="number">1</span>; y&lt;=j+<span class="number">1</span>; y++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col</span><br><span class="line">                                &amp;&amp; board[x][y]==<span class="string">&#x27;E&#x27;</span>)&#123;</span><br><span class="line">                            q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x,y&#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                board[i][j]=(<span class="type">char</span>)(<span class="string">&#x27;0&#x27;</span>+count);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> board;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="545-Boundary-of-Binary-Tree"><a href="#545-Boundary-of-Binary-Tree" class="headerlink" title="545. Boundary of Binary Tree"></a>545. Boundary of Binary Tree</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">boundaryOfBinaryTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    res.add(root.val);</span><br><span class="line">    leftBoundary(root.left);</span><br><span class="line">    leaf(root.left);</span><br><span class="line">    leaf(root.right);</span><br><span class="line">    rightBoundary(root.right);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">leaf</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(node.left==<span class="literal">null</span> &amp;&amp; node.right==<span class="literal">null</span>)&#123;</span><br><span class="line">        res.add(node.val);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    leaf(node.left);</span><br><span class="line">    leaf(node.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">leftBoundary</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node==<span class="literal">null</span> || node.left==<span class="literal">null</span> &amp;&amp; node.right==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    res.add(node.val);</span><br><span class="line">    <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        leftBoundary(node.left);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        leftBoundary(node.right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">rightBoundary</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node==<span class="literal">null</span> || node.left==<span class="literal">null</span> &amp;&amp; node.right==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">        rightBoundary(node.right);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        rightBoundary(node.left);</span><br><span class="line">    &#125;</span><br><span class="line">    res.add(node.val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="549-Binary-Tree-Longest-Consecutive-Sequence-II"><a href="#549-Binary-Tree-Longest-Consecutive-Sequence-II" class="headerlink" title="549. Binary Tree Longest Consecutive Sequence II"></a>549. Binary Tree Longest Consecutive Sequence II</h2><p>好题！需要返回两个值怎么办？</p>
<ul>
<li>返回arr</li>
<li>arr[0] 为increasing consecutive sequence的长度</li>
<li>arr[1] 为decreasing consecutive sequence的长度</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> max=<span class="number">1</span>;</span><br><span class="line">  <span class="comment">//[icr,dcr]</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestConsecutive</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    dfs(root);</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>[] dfs(TreeNode node)&#123;</span><br><span class="line">    <span class="keyword">if</span>(node==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> icr=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> dcr=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(node.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">int</span>[] l=dfs(node.left);</span><br><span class="line">        <span class="keyword">if</span>(node.val==node.left.val+<span class="number">1</span>)&#123;</span><br><span class="line">            icr+=l[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node.val==node.left.val-<span class="number">1</span>)&#123;</span><br><span class="line">            dcr+=l[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(node.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">int</span>[] r=dfs(node.right);</span><br><span class="line">        <span class="keyword">if</span>(node.val==node.right.val+<span class="number">1</span>)&#123;</span><br><span class="line">            icr=Math.max(icr,<span class="number">1</span>+r[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node.val==node.right.val-<span class="number">1</span>)&#123;</span><br><span class="line">            dcr=Math.max(dcr,<span class="number">1</span>+r[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    max=Math.max(max,icr+dcr-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;icr,dcr&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="563-Binary-Tree-Tilt"><a href="#563-Binary-Tree-Tilt" class="headerlink" title="563. Binary Tree Tilt"></a>563. Binary Tree Tilt</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findTilt</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">     sum(root);</span><br><span class="line">     <span class="keyword">return</span> res;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sum</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(node==<span class="literal">null</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">     &#125;</span><br><span class="line">   </span><br><span class="line">     <span class="keyword">if</span>(node.left==<span class="literal">null</span> &amp;&amp; node.right==<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="type">int</span> val=node.val;</span><br><span class="line">           node.val=<span class="number">0</span>;</span><br><span class="line">           <span class="keyword">return</span> val;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="type">int</span> l=sum(node.left);</span><br><span class="line">     <span class="type">int</span> r=sum(node.right);</span><br><span class="line">     <span class="type">int</span> val=node.val;</span><br><span class="line">     node.val=Math.abs(l-r);</span><br><span class="line">     res+=node.val;</span><br><span class="line">     <span class="keyword">return</span> l+r+val;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="565-Array-Nesting"><a href="#565-Array-Nesting" class="headerlink" title="565. Array Nesting"></a>565. Array Nesting</h2><h3 id="Time-Limit-Exceeded"><a href="#Time-Limit-Exceeded" class="headerlink" title="Time Limit Exceeded"></a>Time Limit Exceeded</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">arrayNesting</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        dfs(nums,nums[i],<span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length],<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> cur, <span class="type">boolean</span>[] visited, <span class="type">int</span> l)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(visited[cur])&#123;</span><br><span class="line">        max=Math.max(max,l);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    visited[cur]=<span class="literal">true</span>;</span><br><span class="line">    dfs(nums,nums[cur],visited,l+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="无需重复考虑元素："><a href="#无需重复考虑元素：" class="headerlink" title="无需重复考虑元素："></a>无需重复考虑元素：</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    <span class="type">int</span> max=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">arrayNesting</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    HashSet&lt;Integer&gt; set=<span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        dfs(nums,nums[i],set,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> cur, Set&lt;Integer&gt; visited, <span class="type">int</span> l)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(visited.contains(cur))&#123;</span><br><span class="line">        max=Math.max(max,l);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    visited.add(cur);</span><br><span class="line">    dfs(nums,nums[cur],visited,l+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="572-Subtree-of-Another-Tree"><a href="#572-Subtree-of-Another-Tree" class="headerlink" title="572. Subtree of Another Tree"></a>572. Subtree of Another Tree</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubtree</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">if</span>(isEqual(root,subRoot))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isSubtree(root.left,subRoot) || isSubtree(root.right,subRoot);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isEqual</span><span class="params">(TreeNode root, TreeNode subRoot)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span> &amp;&amp; subRoot==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span> || subRoot==<span class="literal">null</span> || root.val!=subRoot.val)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> isEqual(root.left,subRoot.left) &amp;&amp; isEqual(root.right,subRoot.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="589-N-ary-Tree-Preorder-Traversal"><a href="#589-N-ary-Tree-Preorder-Traversal" class="headerlink" title="589. N-ary Tree Preorder Traversal"></a>589. N-ary Tree Preorder Traversal</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    Deque&lt;Node&gt; stack=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    stack.push(root);</span><br><span class="line">    <span class="keyword">while</span>(!stack.isEmpty())&#123;</span><br><span class="line">        <span class="comment">//root, 0,1,2</span></span><br><span class="line">        <span class="comment">//2,1,0, root</span></span><br><span class="line">        Node node=stack.pop();</span><br><span class="line">        <span class="keyword">if</span>(node!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> node.children.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                stack.push(node.children.get(i));</span><br><span class="line">            &#125;</span><br><span class="line">            stack.push(node);</span><br><span class="line">            stack.push(<span class="literal">null</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            node=stack.poll();</span><br><span class="line">            res.add(node.val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="652-Find-Duplicate-Subtrees"><a href="#652-Find-Duplicate-Subtrees" class="headerlink" title="652. Find Duplicate Subtrees"></a>652. Find Duplicate Subtrees</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">List&lt;TreeNode&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Map&lt;String,Integer&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">public</span> List&lt;TreeNode&gt; <span class="title function_">findDuplicateSubtrees</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    dfs(root);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">String <span class="title function_">dfs</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(node==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;#&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    String l=dfs(node.left);</span><br><span class="line">    String r=dfs(node.right);</span><br><span class="line">    String cur=node.val+<span class="string">&quot;,&quot;</span>+l+<span class="string">&quot;,&quot;</span>+r;</span><br><span class="line">    map.put(cur,map.getOrDefault(cur,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(map.get(cur)==<span class="number">2</span>)&#123;</span><br><span class="line">        res.add(node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cur;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="663-Equal-Tree-Partition"><a href="#663-Equal-Tree-Partition" class="headerlink" title="663. Equal Tree Partition"></a>663. Equal Tree Partition</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;TreeNode,Long&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkEqualTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="type">long</span> l=sum(root.left);</span><br><span class="line">    <span class="type">long</span> r=sum(root.right);</span><br><span class="line">    <span class="keyword">if</span>(root.right!=<span class="literal">null</span> &amp;&amp; l+root.val==r || root.left!=<span class="literal">null</span> &amp;&amp; r+root.val==l)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">        root.left.val+=root.val+r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">        root.right.val+=root.val+l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> checkEqualTree(root.left) || checkEqualTree(root.right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="title function_">sum</span><span class="params">(TreeNode node)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(node==<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(map.containsKey(node))&#123;</span><br><span class="line">          <span class="keyword">return</span> map.get(node);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">long</span> res=sum(node.left)+sum(node.right)+node.val;</span><br><span class="line">      map.put(node,res);</span><br><span class="line">      <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="690-Employee-Importance"><a href="#690-Employee-Importance" class="headerlink" title="690. Employee Importance"></a>690. Employee Importance</h2><h3 id="DFS-1"><a href="#DFS-1" class="headerlink" title="DFS:"></a>DFS:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (Employee employee : employees) &#123;</span><br><span class="line">    <span class="keyword">if</span>(employee.id==id)&#123;</span><br><span class="line">        res+=employee.importance;</span><br><span class="line">        <span class="keyword">for</span> (Integer next : employee.subordinates) &#123;</span><br><span class="line">            res+=getImportance(employees,next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure>



<h3 id="BFS-1"><a href="#BFS-1" class="headerlink" title="BFS:"></a>BFS:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getImportance</span><span class="params">(List&lt;Employee&gt; employees, <span class="type">int</span> id)</span> &#123;</span><br><span class="line">    Map&lt;Integer,Employee&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Employee employee : employees) &#123;</span><br><span class="line">        map.put(employee.id,employee);</span><br><span class="line">    &#125;</span><br><span class="line">    Deque&lt;Integer&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    q.offer(id);</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        Employee cur=map.get(q.poll());</span><br><span class="line">        res+=cur.importance;</span><br><span class="line">        <span class="keyword">for</span> (Integer next : cur.subordinates) &#123;</span><br><span class="line">            q.offer(next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/11/NestedList/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/11/NestedList/" class="post-title-link" itemprop="url">NestedList</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-11 19:05:07" itemprop="dateCreated datePublished" datetime="2022-11-11T19:05:07+08:00">2022-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-12 11:07:49" itemprop="dateModified" datetime="2022-11-12T11:07:49+08:00">2022-11-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="NestedList问题"><a href="#NestedList问题" class="headerlink" title="NestedList问题"></a>NestedList问题</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * // This is the interface that allows for creating nested lists.</span></span><br><span class="line"><span class="comment"> * // You should not implement it, or speculate about its implementation</span></span><br><span class="line"><span class="comment"> * public interface NestedInteger &#123;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     // <span class="doctag">@return</span> true if this NestedInteger holds a single integer, rather than a nested list.</span></span><br><span class="line"><span class="comment"> *     public boolean isInteger();</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     // <span class="doctag">@return</span> the single integer that this NestedInteger holds, if it holds a single integer</span></span><br><span class="line"><span class="comment"> *     // Return null if this NestedInteger holds a nested list</span></span><br><span class="line"><span class="comment"> *     public Integer getInteger();</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *     // <span class="doctag">@return</span> the nested list that this NestedInteger holds, if it holds a nested list</span></span><br><span class="line"><span class="comment"> *     // Return empty list if this NestedInteger holds a single integer</span></span><br><span class="line"><span class="comment"> *     public List&lt;NestedInteger&gt; getList();</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>



<h2 id="339-Nested-List-Weight-Sum"><a href="#339-Nested-List-Weight-Sum" class="headerlink" title="339. Nested List Weight Sum"></a>339. Nested List Weight Sum</h2><h3 id="DFS"><a href="#DFS" class="headerlink" title="DFS:"></a>DFS:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">depthSum</span><span class="params">(List&lt;NestedInteger&gt; nestedList)</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> dfs(nestedList,<span class="number">1</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(List&lt;NestedInteger&gt; nestedList, <span class="type">int</span> depth)</span>&#123;</span><br><span class="line">     <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">     <span class="keyword">for</span>(NestedInteger i: nestedList)&#123;</span><br><span class="line">         <span class="keyword">if</span>(i.isInteger())&#123;</span><br><span class="line">             res+=i.getInteger()*depth;</span><br><span class="line">         &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">             res+=dfs(i.getList(),depth+<span class="number">1</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> res;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h3 id="BFS"><a href="#BFS" class="headerlink" title="BFS:"></a>BFS:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">depthSum</span><span class="params">(List&lt;NestedInteger&gt; nestedList)</span> &#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    Deque&lt;NestedInteger&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(NestedInteger i : nestedList)&#123;</span><br><span class="line">        q.offer(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> depth=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> size=q.size();</span><br><span class="line">        <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            NestedInteger i=q.poll();</span><br><span class="line">            <span class="keyword">if</span>(i.isInteger())&#123;</span><br><span class="line">                res+=i.getInteger()*depth;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">for</span>(NestedInteger j: i.getList())&#123;</span><br><span class="line">                    q.offer(j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        depth++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="364-Nested-List-Weight-Sum-II"><a href="#364-Nested-List-Weight-Sum-II" class="headerlink" title="364. Nested List Weight Sum II"></a>364. Nested List Weight Sum II</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> maxDepth=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">depthSumInverse</span><span class="params">(List&lt;NestedInteger&gt; nestedList)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span>(NestedInteger i : nestedList)&#123;</span><br><span class="line">        maxDepth=Math.max(maxDepth,getMax(i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dfs(nestedList,maxDepth);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">dfs</span><span class="params">(List&lt;NestedInteger&gt; nestedList, <span class="type">int</span> depth)</span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(NestedInteger i : nestedList)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i.isInteger())&#123;</span><br><span class="line">            res+=i.getInteger()*depth;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            res+=dfs(i.getList(),depth-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">getMax</span><span class="params">(NestedInteger i)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i.isInteger())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> depth=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(NestedInteger next : i.getList())&#123;</span><br><span class="line">        depth=Math.max(depth,getMax(next)+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> depth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="341-Flatten-Nested-List-Iterator"><a href="#341-Flatten-Nested-List-Iterator" class="headerlink" title="341. Flatten Nested List Iterator"></a>341. Flatten Nested List Iterator</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://invincible-nerd.github.io/2022/11/09/maze/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="invincible-nerd">
      <meta itemprop="description" content="For explorer everywhere">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="IVN">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/09/maze/" class="post-title-link" itemprop="url">maze</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-11-09 19:18:28" itemprop="dateCreated datePublished" datetime="2022-11-09T19:18:28+08:00">2022-11-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-11-12 09:56:43" itemprop="dateModified" datetime="2022-11-12T09:56:43+08:00">2022-11-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="The-Maze三重奏"><a href="#The-Maze三重奏" class="headerlink" title="The Maze三重奏"></a>The Maze三重奏</h1><h2 id="490-The-Maze"><a href="#490-The-Maze" class="headerlink" title="490. The Maze"></a>490. The Maze</h2><h3 id="Approach-1-Depth-First-Search"><a href="#Approach-1-Depth-First-Search" class="headerlink" title="Approach 1: Depth First Search"></a>Approach 1: Depth First Search</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> row;</span><br><span class="line"><span class="type">int</span> col;</span><br><span class="line"><span class="type">int</span>[][] maze;</span><br><span class="line"><span class="type">int</span>[][] dirs=&#123;&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,-<span class="number">1</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPath</span><span class="params">(<span class="type">int</span>[][] maze, <span class="type">int</span>[] start, <span class="type">int</span>[] destination)</span> &#123;</span><br><span class="line">    row=maze.length;</span><br><span class="line">    col=maze[<span class="number">0</span>].length;</span><br><span class="line">    <span class="built_in">this</span>.maze=maze;</span><br><span class="line">    <span class="keyword">return</span> dfs(start[<span class="number">0</span>],start[<span class="number">1</span>],destination,<span class="keyword">new</span> <span class="title class_">boolean</span>[row][col]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span>[] end,<span class="type">boolean</span>[][] visited)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i==end[<span class="number">0</span>] &amp;&amp; j==end[<span class="number">1</span>])&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    visited[i][j]=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] dir : dirs) &#123;</span><br><span class="line">        <span class="type">int</span> x=i+dir[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> y=j+dir[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">while</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col &amp;&amp; maze[x][y]==<span class="number">0</span>)&#123;</span><br><span class="line">            x+=dir[<span class="number">0</span>];</span><br><span class="line">            y+=dir[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(!visited[x-dir[<span class="number">0</span>]][y-dir[<span class="number">1</span>]] )&#123;</span><br><span class="line">            <span class="keyword">if</span>(dfs(x-dir[<span class="number">0</span>],y-dir[<span class="number">1</span>],end,visited))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Approach-2-Breadth-First-Search"><a href="#Approach-2-Breadth-First-Search" class="headerlink" title="Approach 2: Breadth First Search"></a>Approach 2: Breadth First Search</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasPath</span><span class="params">(<span class="type">int</span>[][] maze, <span class="type">int</span>[] start, <span class="type">int</span>[] destination)</span> &#123;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> row=maze.length;</span><br><span class="line">    <span class="type">int</span> col=maze[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">boolean</span>[][] visited=<span class="keyword">new</span> <span class="title class_">boolean</span>[row][col];</span><br><span class="line">    <span class="type">int</span>[][] dirs=<span class="keyword">new</span> <span class="title class_">int</span>[][]&#123;&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,-<span class="number">1</span>&#125;&#125;;</span><br><span class="line">    visited[start[<span class="number">0</span>]][start[<span class="number">1</span>]]=<span class="literal">true</span>;</span><br><span class="line">    q.offer(start);</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">        <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(i==destination[<span class="number">0</span>] &amp;&amp; j==destination[<span class="number">1</span>])&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] dir : dirs) &#123;</span><br><span class="line">            <span class="type">int</span> x=i+dir[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> y=j+dir[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">while</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col &amp;&amp; maze[x][y]==<span class="number">0</span>)&#123;</span><br><span class="line">                x+=dir[<span class="number">0</span>];</span><br><span class="line">                y+=dir[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!visited[x-dir[<span class="number">0</span>]][y-dir[<span class="number">1</span>]])&#123;</span><br><span class="line">                visited[x-dir[<span class="number">0</span>]][y-dir[<span class="number">1</span>]]=<span class="literal">true</span>;</span><br><span class="line">                q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x-dir[<span class="number">0</span>],y-dir[<span class="number">1</span>]&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="505-The-Maze-II"><a href="#505-The-Maze-II" class="headerlink" title="505. The Maze II"></a>505. The Maze II</h2><h3 id="DFS"><a href="#DFS" class="headerlink" title="DFS:"></a>DFS:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> row;</span><br><span class="line"><span class="type">int</span> col;</span><br><span class="line"><span class="type">int</span>[][] maze;</span><br><span class="line"><span class="type">int</span>[][] dirs=&#123;&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,-<span class="number">1</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shortestDistance</span><span class="params">(<span class="type">int</span>[][] maze, <span class="type">int</span>[] start, <span class="type">int</span>[] destination)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.maze=maze;</span><br><span class="line">    row=maze.length;</span><br><span class="line">    col=maze[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[][] dist=<span class="keyword">new</span> <span class="title class_">int</span>[row][col];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] ints : dist) &#123;</span><br><span class="line">        Arrays.fill(ints,Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    dist[start[<span class="number">0</span>]][start[<span class="number">1</span>]]=<span class="number">0</span>;</span><br><span class="line">    dfs(start[<span class="number">0</span>],start[<span class="number">1</span>],destination,dist);</span><br><span class="line">    <span class="keyword">return</span> dist[destination[<span class="number">0</span>]][destination[<span class="number">1</span>]]==Integer.MAX_VALUE ? -<span class="number">1</span> : dist[destination[<span class="number">0</span>]][destination[<span class="number">1</span>]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j, <span class="type">int</span>[] end,<span class="type">int</span>[][] dist)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i==end[<span class="number">0</span>] &amp;&amp; j==end[<span class="number">1</span>])&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] dir : dirs) &#123;</span><br><span class="line">        <span class="type">int</span> x=i+dir[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> y=j+dir[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> d=dist[i][j];</span><br><span class="line">        <span class="keyword">while</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col &amp;&amp; maze[x][y]==<span class="number">0</span>)&#123;</span><br><span class="line">            x+=dir[<span class="number">0</span>];</span><br><span class="line">            y+=dir[<span class="number">1</span>];</span><br><span class="line">            d++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(d&lt;dist[x-dir[<span class="number">0</span>]][y-dir[<span class="number">1</span>]])&#123;</span><br><span class="line">            dist[x-dir[<span class="number">0</span>]][y-dir[<span class="number">1</span>]]=d;</span><br><span class="line">            dfs(x-dir[<span class="number">0</span>],y-dir[<span class="number">1</span>],end,dist);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="BFS"><a href="#BFS" class="headerlink" title="BFS:"></a>BFS:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">shortestDistance</span><span class="params">(<span class="type">int</span>[][] maze, <span class="type">int</span>[] start, <span class="type">int</span>[] destination)</span> &#123;</span><br><span class="line">    <span class="type">int</span> row=maze.length;</span><br><span class="line">    <span class="type">int</span> col=maze[<span class="number">0</span>].length;</span><br><span class="line">    <span class="type">int</span>[][] dirs=&#123;&#123;<span class="number">0</span>,<span class="number">1</span>&#125;,&#123;<span class="number">0</span>,-<span class="number">1</span>&#125;,&#123;<span class="number">1</span>,<span class="number">0</span>&#125;,&#123;-<span class="number">1</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line">    Deque&lt;<span class="type">int</span>[]&gt; q=<span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span>[][] visited=<span class="keyword">new</span> <span class="title class_">int</span>[row][col];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>[] ints : visited) &#123;</span><br><span class="line">        Arrays.fill(ints,Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;start[<span class="number">0</span>],start[<span class="number">1</span>]&#125;);</span><br><span class="line">    visited[start[<span class="number">0</span>]][start[<span class="number">1</span>]]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(!q.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> size=q.size();</span><br><span class="line">        <span class="keyword">while</span>(size--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">int</span>[] cur=q.poll();</span><br><span class="line">            <span class="type">int</span> i=cur[<span class="number">0</span>];</span><br><span class="line">            <span class="type">int</span> j=cur[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span>[] dir : dirs) &#123;</span><br><span class="line">                <span class="type">int</span> x=i+dir[<span class="number">0</span>];</span><br><span class="line">                <span class="type">int</span> y=j+dir[<span class="number">1</span>];</span><br><span class="line">                <span class="type">int</span> dist=visited[i][j];</span><br><span class="line">                <span class="keyword">while</span>(x&gt;=<span class="number">0</span> &amp;&amp; x&lt;row &amp;&amp; y&gt;=<span class="number">0</span> &amp;&amp; y&lt;col &amp;&amp; maze[x][y]==<span class="number">0</span>)&#123;</span><br><span class="line">                    x+=dir[<span class="number">0</span>];</span><br><span class="line">                    y+=dir[<span class="number">1</span>];</span><br><span class="line">                    dist++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//only add meaningful updates to queue</span></span><br><span class="line">                <span class="keyword">if</span>(dist&lt;visited[x-dir[<span class="number">0</span>]][y-dir[<span class="number">1</span>]])&#123;</span><br><span class="line">                    visited[x-dir[<span class="number">0</span>]][y-dir[<span class="number">1</span>]]=dist;</span><br><span class="line">                    q.offer(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;x-dir[<span class="number">0</span>],y-dir[<span class="number">1</span>]&#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> visited[destination[<span class="number">0</span>]][destination[<span class="number">1</span>]]==Integer.MAX_VALUE ? -<span class="number">1</span> : visited[destination[<span class="number">0</span>]][destination[<span class="number">1</span>]];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h2 id="499-The-Maze-III"><a href="#499-The-Maze-III" class="headerlink" title="499. The Maze III"></a>499. The Maze III</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/unusable-index/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/unusable-index/page/6/">6</a><a class="extend next" rel="next" href="/unusable-index/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">invincible-nerd</p>
  <div class="site-description" itemprop="description">For explorer everywhere</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2022-04 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">invincible-nerd</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">632k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:34</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
